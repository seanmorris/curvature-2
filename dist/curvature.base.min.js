"use strict";function _typeof(a){"@babel/helpers - typeof";return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(a){return typeof a}:function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a},_typeof(a)}Object.defineProperty(exports,"__esModule",{value:!0}),exports.Bag=void 0;var _Bindable=require("./Bindable"),_Mixin=require("./Mixin"),_EventTargetMixin=require("../mixin/EventTargetMixin");function _classCallCheck(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function _defineProperties(a,b){for(var c,d=0;d<b.length;d++)c=b[d],c.enumerable=c.enumerable||!1,c.configurable=!0,"value"in c&&(c.writable=!0),Object.defineProperty(a,c.key,c)}function _createClass(a,b,c){return b&&_defineProperties(a.prototype,b),c&&_defineProperties(a,c),a}function _inherits(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function");a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,writable:!0,configurable:!0}}),b&&_setPrototypeOf(a,b)}function _setPrototypeOf(a,b){return _setPrototypeOf=Object.setPrototypeOf||function(a,b){return a.__proto__=b,a},_setPrototypeOf(a,b)}function _createSuper(a){var b=_isNativeReflectConstruct();return function(){var c,d=_getPrototypeOf(a);if(b){var e=_getPrototypeOf(this).constructor;c=Reflect.construct(d,arguments,e)}else c=d.apply(this,arguments);return _possibleConstructorReturn(this,c)}}function _possibleConstructorReturn(a,b){return b&&("object"===_typeof(b)||"function"==typeof b)?b:_assertThisInitialized(a)}function _assertThisInitialized(a){if(void 0===a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return a}function _isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(a){return!1}}function _getPrototypeOf(a){return _getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(a){return a.__proto__||Object.getPrototypeOf(a)},_getPrototypeOf(a)}var toId=function(a){return+a},fromId=function(a){return parseInt(a)},Bag=function(a){function b(){var a,d=0<arguments.length&&void 0!==arguments[0]?arguments[0]:void 0;return _classCallCheck(this,b),a=c.call(this),a.meta=Symbol("meta"),a.content=new Map,a.list=_Bindable.Bindable.makeBindable([]),a.current=0,a.type=void 0,a.length=0,a.changeCallback=d,a}_inherits(b,a);var c=_createSuper(b);return _createClass(b,[{key:"has",value:function has(a){return this.content.has(a)}},{key:"add",value:function(a){if(void 0===a||!(a instanceof Object))throw new Error("Only objects may be added to Bags.");if(this.type&&!(a instanceof this.type))throw console.error(this.type,a),new Error("Only objects of type ".concat(this.type," may be added to this Bag."));if(!this.content.has(a)){var c=new CustomEvent("adding",{detail:{item:a}});if(this.dispatchEvent(c)){var d=toId(this.current++);this.content.set(a,d),this.list[d]=a,this.changeCallback&&this.changeCallback(a,this.meta,b.ITEM_ADDED,d);var e=new CustomEvent("added",{detail:{item:a,id:d}});this.dispatchEvent(e),this.length=this.size}}}},{key:"remove",value:function(a){if(void 0===a||!(a instanceof Object))throw new Error("Only objects may be removed from Bags.");if(this.type&&!(a instanceof this.type))throw console.error(this.type,a),new Error("Only objects of type ".concat(this.type," may be removed from this Bag."));if(!this.content.has(a))return this.changeCallback&&this.changeCallback(a,this.meta,0,void 0),!1;var c=new CustomEvent("removing",{detail:{item:a}});if(this.dispatchEvent(c)){var d=this.content.get(a);delete this.list[d],this.content["delete"](a),this.changeCallback&&this.changeCallback(a,this.meta,b.ITEM_REMOVED,d);var e=new CustomEvent("removed",{detail:{item:a,id:d}});return this.dispatchEvent(e),this.length=this.size,a}}},{key:"size",get:function get(){return this.content.size}},{key:"items",value:function items(){return Array.from(this.content.entries()).map(function(a){return a[0]})}}]),b}(_Mixin.Mixin["with"](_EventTargetMixin.EventTargetMixin));exports.Bag=Bag,Object.defineProperty(Bag,"ITEM_ADDED",{configurable:!1,enumerable:!1,writable:!0,value:1}),Object.defineProperty(Bag,"ITEM_REMOVED",{configurable:!1,enumerable:!1,writable:!0,value:-1});
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.Bindable=void 0;function _construct(){return _construct=_isNativeReflectConstruct()?Reflect.construct:function(b,c,d){var e=[null];e.push.apply(e,c);var a=Function.bind.apply(b,e),f=new a;return d&&_setPrototypeOf(f,d.prototype),f},_construct.apply(null,arguments)}function _isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(a){return!1}}function _setPrototypeOf(a,b){return _setPrototypeOf=Object.setPrototypeOf||function(a,b){return a.__proto__=b,a},_setPrototypeOf(a,b)}function _toConsumableArray(a){return _arrayWithoutHoles(a)||_iterableToArray(a)||_unsupportedIterableToArray(a)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _iterableToArray(a){if("undefined"!=typeof Symbol&&null!=a[Symbol.iterator]||null!=a["@@iterator"])return Array.from(a)}function _arrayWithoutHoles(a){if(Array.isArray(a))return _arrayLikeToArray(a)}function _createForOfIteratorHelper(a,b){var c="undefined"!=typeof Symbol&&a[Symbol.iterator]||a["@@iterator"];if(!c){if(Array.isArray(a)||(c=_unsupportedIterableToArray(a))||b&&a&&"number"==typeof a.length){c&&(a=c);var d=0,e=function(){};return{s:e,n:function n(){return d>=a.length?{done:!0}:{done:!1,value:a[d++]}},e:function e(a){throw a},f:e}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var f,g=!0,h=!1;return{s:function s(){c=c.call(a)},n:function n(){var a=c.next();return g=a.done,a},e:function e(a){h=!0,f=a},f:function f(){try{g||null==c["return"]||c["return"]()}finally{if(h)throw f}}}}function _unsupportedIterableToArray(a,b){if(a){if("string"==typeof a)return _arrayLikeToArray(a,b);var c=Object.prototype.toString.call(a).slice(8,-1);return"Object"===c&&a.constructor&&(c=a.constructor.name),"Map"===c||"Set"===c?Array.from(a):"Arguments"===c||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(c)?_arrayLikeToArray(a,b):void 0}}function _arrayLikeToArray(a,b){(null==b||b>a.length)&&(b=a.length);for(var c=0,d=Array(b);c<b;c++)d[c]=a[c];return d}function _typeof(a){"@babel/helpers - typeof";return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(a){return typeof a}:function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a},_typeof(a)}function _classCallCheck(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function _defineProperties(a,b){for(var c,d=0;d<b.length;d++)c=b[d],c.enumerable=c.enumerable||!1,c.configurable=!0,"value"in c&&(c.writable=!0),Object.defineProperty(a,c.key,c)}function _createClass(a,b,c){return b&&_defineProperties(a.prototype,b),c&&_defineProperties(a,c),a}function _defineProperty(a,b,c){return b in a?Object.defineProperty(a,b,{value:c,enumerable:!0,configurable:!0,writable:!0}):a[b]=c,a}var Ref=Symbol("ref"),Original=Symbol("original"),Deck=Symbol("deck"),Binding=Symbol("binding"),SubBinding=Symbol("subBinding"),BindingAll=Symbol("bindingAll"),IsBindable=Symbol("isBindable"),Wrapping=Symbol("wrapping"),Names=Symbol("Names"),Executing=Symbol("executing"),Stack=Symbol("stack"),ObjSymbol=Symbol("object"),Wrapped=Symbol("wrapped"),Unwrapped=Symbol("unwrapped"),GetProto=Symbol("getProto"),OnGet=Symbol("onGet"),OnAllGet=Symbol("onAllGet"),BindChain=Symbol("bindChain"),Descriptors=Symbol("Descriptors"),NoGetters=Symbol("NoGetters"),TypedArray=Object.getPrototypeOf(Int8Array),SetIterator=Set.prototype[Symbol.iterator],MapIterator=Map.prototype[Symbol.iterator],win=globalThis,excludedClasses=[win.Node,win.File,win.Map,win.Set,win.WeakMap,win.WeakSet,win.ArrayBuffer,win.ResizeObserver,win.MutationObserver,win.PerformanceObserver,win.IntersectionObserver].filter(function(a){return"function"==typeof a}),Bindable=function(){function a(){_classCallCheck(this,a)}return _createClass(a,null,[{key:"isBindable",value:function isBindable(b){return!!(b&&b[IsBindable])&&b[IsBindable]===a}},{key:"onDeck",value:function onDeck(a,b){return a[Deck][b]||!1}},{key:"ref",value:function ref(a){return a[Ref]||a||!1}},{key:"makeBindable",value:function makeBindable(a){return this.make(a)}},{key:"shuck",value:function shuck(b,c){c=c||new Map;var d={};if(b instanceof TypedArray||b instanceof ArrayBuffer){var g=b.slice(0);return c.set(b,g),g}var e=Object.keys(b);for(var h in e){var i=e[h];if("___"!==i.substring(0,3)){var f=c.get(b[i]);if(f){d[i]=f;continue}if(b[i]===b){c.set(b[i],d),d[i]=d;continue}if(b[i]&&"object"===_typeof(b[i])){var j=b[i];a.isBindable(b[i])&&(j=b[i][Original]),d[i]=this.shuck(j,c)}else d[i]=b[i];c.set(b[i],d[i])}}return a.isBindable(b)&&(delete d.bindTo,delete d.isBound),d}},{key:"make",value:function make(b){var c=this;if(!b||!["function","object"].includes(_typeof(b)))return b;if(excludedClasses.filter(function(a){return b instanceof a}).length||Object.isSealed(b)||!Object.isExtensible(b))return b;if(b[Ref])return b[Ref];if(b[Binding])return b;Object.defineProperty(b,Ref,{configurable:!0,enumerable:!1,writable:!0,value:!1}),Object.defineProperty(b,Original,{configurable:!1,enumerable:!1,writable:!1,value:b}),Object.defineProperty(b,Deck,{configurable:!1,enumerable:!1,writable:!1,value:{}}),Object.defineProperty(b,Binding,{configurable:!1,enumerable:!1,writable:!1,value:{}}),Object.defineProperty(b,SubBinding,{configurable:!1,enumerable:!1,writable:!1,value:new Map}),Object.defineProperty(b,BindingAll,{configurable:!1,enumerable:!1,writable:!1,value:[]}),Object.defineProperty(b,IsBindable,{configurable:!1,enumerable:!1,writable:!1,value:a}),Object.defineProperty(b,Executing,{enumerable:!1,writable:!0}),Object.defineProperty(b,Wrapping,{enumerable:!1,writable:!0}),Object.defineProperty(b,Stack,{configurable:!1,enumerable:!1,writable:!1,value:[]}),Object.defineProperty(b,"___before___",{configurable:!1,enumerable:!1,writable:!1,value:[]}),Object.defineProperty(b,"___after___",{configurable:!1,enumerable:!1,writable:!1,value:[]}),Object.defineProperty(b,Wrapped,{configurable:!1,enumerable:!1,writable:!1,value:new Map}),Object.defineProperty(b,Unwrapped,{configurable:!1,enumerable:!1,writable:!1,value:{}}),Object.defineProperty(b,Descriptors,{configurable:!1,enumerable:!1,writable:!1,value:new Map});var d=function(e){var f=1<arguments.length&&void 0!==arguments[1]?arguments[1]:null,g=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{},h=!1;if(Array.isArray(e)){var k=e.forEach(function(a){return d(a,f,g)});return function(){return k.forEach(function(a){return a()})}}if(e instanceof Function&&(g=f||{},f=e,h=!0),0<=g.delay&&(f=c.wrapDelayCallback(f,g.delay)),0<=g.throttle&&(f=c.wrapThrottleCallback(f,g.throttle)),0<=g.wait&&(f=c.wrapWaitCallback(f,g.wait)),g.frame&&(f=c.wrapFrameCallback(f,g.frame)),g.idle&&(f=c.wrapIdleCallback(f)),h){var l=b[BindingAll].length;if(b[BindingAll].push(f),!("now"in g)||g.now)for(var m in b)f(b[m],m,b,!1);return function(){delete b[BindingAll][l]}}if(b[Binding][e]||(b[Binding][e]=new Set),g.children){var i=f;f=function(){for(var c=arguments.length,d=Array(c),e=0;e<c;e++)d[e]=arguments[e];var f=d[0],h=b[SubBinding].get(i);if(h&&(b[SubBinding]["delete"](i),h()),"object"!==_typeof(f))return void i.apply(void 0,d);var j=a.make(f);a.isBindable(j)&&b[SubBinding].set(i,j.bindTo(function(){for(var a=arguments.length,b=Array(a),c=0;c<a;c++)b[c]=arguments[c];return i.apply(void 0,d.concat(b))},Object.assign({},g,{children:!1}))),i.apply(void 0,d)}}b[Binding][e].add(f),(!("now"in g)||g.now)&&f(b[e],e,b,!1);var j=function(){var a=b[SubBinding].get(f);a&&(b[SubBinding]["delete"](f),a()),b[Binding][e]&&b[Binding][e].has(f)&&b[Binding][e]["delete"](f)};return g.removeWith&&g.removeWith instanceof View&&g.removeWith.onRemove(function(){return j}),j};Object.defineProperty(b,"bindTo",{configurable:!1,enumerable:!1,writable:!1,value:d});Object.defineProperty(b,BindChain,{configurable:!1,enumerable:!1,writable:!1,value:function value(a,e){var f=a.split("."),g=f.shift(),h=f.slice(0),i=[];return i.push(b.bindTo(g,function(a,b,f,g){var d=h.join(".");return 0===h.length?void e(a,b,f,g):void(void 0===a&&(a=f[b]=c.makeBindable({})),i=i.concat(a[BindChain](d,e)))})),function(){return i.forEach(function(a){return a()})}}}),Object.defineProperty(b,"___before",{configurable:!1,enumerable:!1,writable:!1,value:function ___before(a){var c=b.___before___.length;b.___before___.push(a);var d=!1;return function(){d||(d=!0,delete b.___before___[c])}}}),Object.defineProperty(b,"___after",{configurable:!1,enumerable:!1,writable:!1,value:function ___after(a){var c=b.___after___.length;b.___after___.push(a);var d=!1;return function(){d||(d=!0,delete b.___after___[c])}}});Object.defineProperty(b,"isBound",{configurable:!1,enumerable:!1,writable:!1,value:function isBound(){for(var a in b[BindingAll])if(b[BindingAll][a])return!0;for(var c in b[Binding])for(var d in b[Binding][c])if(b[Binding][c][d])return!0;return!1}});var e=function(c){b[c]&&b[c]instanceof Object&&!b[c]instanceof Promise&&!excludedClasses.filter(function(a){return b[c]instanceof a}).length&&Object.isExtensible(b[c])&&!Object.isSealed(b[c])&&(b[c]=a.make(b[c]))};for(var p in b)e(p);var f=function(c,d,e){if(d===Original)return!0;if(void 0!==b[Deck][d]&&b[Deck][d]===e)return!0;if("string"==typeof d&&"___"===d.substring(0,3)&&"___"===d.slice(-3))return!0;if(c[d]===e)return!0;for(var l in e&&e instanceof Object&&!excludedClasses.filter(function(a){return b instanceof a}).length&&Object.isExtensible(b)&&!Object.isSealed(b)&&(!b[NoGetters],e=a.makeBindable(e)),b[Deck][d]=e,b[BindingAll])b[BindingAll][l]&&b[BindingAll][l](e,d,c,!1);var f=!1;if(d in b[Binding]){var g,h=_createForOfIteratorHelper(b[Binding][d]);try{for(h.s();!(g=h.n()).done;){var m=g.value;!1===m(e,d,c,!1,c[d])&&(f=!0)}}catch(a){h.e(a)}finally{h.f()}}if(delete b[Deck][d],!f){var i=Object.getOwnPropertyDescriptor(c,d),j=c instanceof File&&"lastModifiedDate"==d;j||i&&!i.writable||c[d]!==e||(c[d]=e)}var k=Reflect.set(c,d,e);if(Array.isArray(c)&&b[Binding].length)for(var n in b[Binding].length){var o=b[Binding].length[n];o(c.length,"length",c,!1,c.length)}return k},g=function(a,c){if(!(c in a))return!0;if(j.has(c)){var d=j.get(c);if(d&&!d.configurable)return!1;j["delete"](c)}for(var e in b[BindingAll])b[BindingAll][e](void 0,c,a,!0,a[c]);if(c in b[Binding])for(var f in b[Binding][c])b[Binding][c][f]&&b[Binding][c][f](void 0,c,a,!0,a[c]);return delete a[c],!0},h=function(c,d){for(var f in c.___before___)c.___before___[f](c,"constructor",b[Stack],void 0,d);var e=a.make(_construct(c[Original],_toConsumableArray(d)));for(var g in c.___after___)c.___after___[g](c,"constructor",b[Stack],e,d);return e},j=b[Descriptors],k=b[Wrapped],l=b[Stack],m=function(c,d){if(k.has(d))return k.get(d);if(d===Ref||d===Original||"apply"===d||"isBound"===d||"bindTo"===d||"__proto__"===d||"constructor"===d)return b[d];var e;if(j.has(d)?e=j.get(d):(e=Object.getOwnPropertyDescriptor(b,d),j.set(d,e)),e&&!e.configurable&&!e.writable)return b[d];if(OnAllGet in b)return b[OnAllGet](d);if(OnGet in b&&!(d in b))return b[OnGet](d);if(e&&!e.configurable&&!e.writable)return k.set(d,b[d]),b[d];if("function"==typeof b[d]){if(Names in b[d])return b[d];Object.defineProperty(b[Unwrapped],d,{configurable:!1,enumerable:!1,writable:!1,value:b[d]});var f=Object.getPrototypeOf(b),g=f[d]===b[d],h="function"==typeof Promise&&b instanceof Promise||"function"==typeof Map&&b instanceof Map||"function"==typeof Set&&b instanceof Set||"function"==typeof MapIterator&&b.prototype===MapIterator||"function"==typeof SetIterator&&b.prototype===SetIterator||"function"==typeof SetIterator&&b.prototype===SetIterator||"function"==typeof WeakMap&&b instanceof WeakMap||"function"==typeof WeakSet&&b instanceof WeakSet||"function"==typeof Date&&b instanceof Date||"function"==typeof TypedArray&&b instanceof TypedArray||"function"==typeof ArrayBuffer&&b instanceof ArrayBuffer||"function"==typeof EventTarget&&b instanceof EventTarget||"function"==typeof ResizeObserver&&b instanceof ResizeObserver||"function"==typeof MutationObserver&&b instanceof MutationObserver||"function"==typeof PerformanceObserver&&b instanceof PerformanceObserver||"function"==typeof IntersectionObserver&&b instanceof IntersectionObserver||"function"==typeof b[Symbol.iterator]&&"next"===d?b:b[Ref],i=function(){b[Executing]=d,l.unshift(d);for(var a=arguments.length,c=Array(a),e=0;e<a;e++)c[e]=arguments[e];var f,i=_createForOfIteratorHelper(b.___before___);try{for(i.s();!(f=i.n()).done;){var n=f.value;n(b,d,l,b,c)}}catch(a){i.e(a)}finally{i.f()}var j;if(new.target)j=_construct(b[Unwrapped][d],c);else{var o=b[Unwrapped][d];j=g?o.apply(h||b,c):o.apply(void 0,c)}var k,m=_createForOfIteratorHelper(b.___after___);try{for(m.s();!(k=m.n()).done;){var p=k.value;p(b,d,l,b,c)}}catch(a){m.e(a)}finally{m.f()}return b[Executing]=null,l.shift(),j};i[Names]=i[Names]||new WeakMap,i[Names].set(b,d),i[OnAllGet]=function(a){var c=i[Names].get(b);return b[c][a]};var m=a.make(i);return k.set(d,m),m}return b[d]},n=function(a){return GetProto in b?b[GetProto]:Reflect.getPrototypeOf(a)},o={get:m,set:f,construct:h,getPrototypeOf:n,deleteProperty:g};return b[NoGetters]&&delete o.get,Object.defineProperty(b,Ref,{configurable:!1,enumerable:!1,writable:!1,value:new Proxy(b,o)}),b[Ref]}},{key:"clearBindings",value:function clearBindings(a){var b=function maps(a){return function(){for(var b=arguments.length,c=Array(b),d=0;d<b;d++)c[d]=arguments[d];return c.map(a)}}(function clearObj(a){return Object.keys(a).map(function(b){return delete a[b]})});b(a[Wrapped],a[Binding],a[BindingAll],a.___after___,a.___before___)}},{key:"resolve",value:function resolve(a,b){for(var c,d=!!(2<arguments.length&&void 0!==arguments[2])&&arguments[2],e=b.split("."),f=e[0];e.length;){if(d&&1===e.length){var g=this.make(a);return[g,e.shift(),f]}c=e.shift(),!(!c in a)&&a[c]&&a[c]instanceof Object||(a[c]={}),a=this.make(a[c])}return[this.make(a),c,f]}},{key:"wrapDelayCallback",value:function wrapDelayCallback(a,b){return function(){for(var c=arguments.length,d=Array(c),e=0;e<c;e++)d[e]=arguments[e];return setTimeout(function(){return a.apply(void 0,d)},b)}}},{key:"wrapThrottleCallback",value:function wrapThrottleCallback(a,b){var c=this;return this.throttles.set(a,!1),function(){c.throttles.get(a,!0)||(a.apply(void 0,arguments),c.throttles.set(a,!0),setTimeout(function(){c.throttles.set(a,!1)},b))}}},{key:"wrapWaitCallback",value:function wrapWaitCallback(a,b){var c=this;return function(){for(var d=arguments.length,e=Array(d),f=0;f<d;f++)e[f]=arguments[f];var g;(g=c.waiters.get(a))&&(c.waiters["delete"](a),clearTimeout(g)),g=setTimeout(function(){return a.apply(void 0,e)},b),c.waiters.set(a,g)}}},{key:"wrapFrameCallback",value:function wrapFrameCallback(a){return function(){for(var b=arguments.length,c=Array(b),d=0;d<b;d++)c[d]=arguments[d];requestAnimationFrame(function(){return a.apply(void 0,c)})}}},{key:"wrapIdleCallback",value:function wrapIdleCallback(a){return function(){for(var b=arguments.length,c=Array(b),d=0;d<b;d++)c[d]=arguments[d];var e=window.requestIdleCallback||requestAnimationFrame;e(function(){return a.apply(void 0,c)})}}}]),a}();exports.Bindable=Bindable,_defineProperty(Bindable,"waiters",new WeakMap),_defineProperty(Bindable,"throttles",new WeakMap),Object.defineProperty(Bindable,"OnGet",{configurable:!1,enumerable:!1,writable:!1,value:OnGet}),Object.defineProperty(Bindable,"NoGetters",{configurable:!1,enumerable:!1,writable:!1,value:NoGetters}),Object.defineProperty(Bindable,"GetProto",{configurable:!1,enumerable:!1,writable:!1,value:GetProto}),Object.defineProperty(Bindable,"OnAllGet",{configurable:!1,enumerable:!1,writable:!1,value:OnAllGet});
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.Cache=void 0;function _classCallCheck(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function _defineProperties(a,b){for(var c,d=0;d<b.length;d++)c=b[d],c.enumerable=c.enumerable||!1,c.configurable=!0,"value"in c&&(c.writable=!0),Object.defineProperty(a,c.key,c)}function _createClass(a,b,c){return b&&_defineProperties(a.prototype,b),c&&_defineProperties(a,c),a}var Cache=function(){function a(){_classCallCheck(this,a)}return _createClass(a,null,[{key:"store",value:function store(a,b,c){var d=3<arguments.length&&void 0!==arguments[3]?arguments[3]:"standard",e=0;c&&(e=1e3*c+new Date().getTime()),this.buckets||(this.buckets=new Map),this.buckets.has(d)||this.buckets.set(d,new Map);var f=new CustomEvent("cvCacheStore",{cancelable:!0,detail:{key:a,value:b,expiry:c,bucket:d}});document.dispatchEvent(f)&&this.buckets.get(d).set(a,{value:b,expiration:e})}},{key:"load",value:function load(a){var b=!!(1<arguments.length&&void 0!==arguments[1])&&arguments[1],c=2<arguments.length&&void 0!==arguments[2]?arguments[2]:"standard",d=new CustomEvent("cvCacheLoad",{cancelable:!0,detail:{key:a,defaultvalue:b,bucket:c}});if(!document.dispatchEvent(d))return b;if(this.buckets&&this.buckets.has(c)&&this.buckets.get(c).has(a)){var e=this.buckets.get(c).get(a);if(0===e.expiration||e.expiration>new Date().getTime())return this.buckets.get(c).get(a).value}return b}}]),a}();exports.Cache=Cache;
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.Config=void 0;function _classCallCheck(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function _defineProperties(a,b){for(var c,d=0;d<b.length;d++)c=b[d],c.enumerable=c.enumerable||!1,c.configurable=!0,"value"in c&&(c.writable=!0),Object.defineProperty(a,c.key,c)}function _createClass(a,b,c){return b&&_defineProperties(a.prototype,b),c&&_defineProperties(a,c),a}var AppConfig={};try{AppConfig=require("/Config").Config||{}}catch(a){!0===window.devMode&&console.error(a)}var Config=function(){function a(){_classCallCheck(this,a)}return _createClass(a,null,[{key:"get",value:function get(a){return this.configs[a]}},{key:"set",value:function set(a,b){return this.configs[a]=b,this}},{key:"dump",value:function dump(){return this.configs}},{key:"init",value:function init(){for(var a=arguments.length,b=Array(a),c=0;c<a;c++)b[c]=arguments[c];for(var d in b){var e=b[d];for(var f in"string"==typeof e&&(e=JSON.parse(e)),e){var g=e[f];return this.configs[f]=g}}return this}}]),a}();exports.Config=Config,Object.defineProperty(Config,"configs",{configurable:!1,enumerable:!1,writable:!1,value:AppConfig});
"use strict";var _Bindable=require("./Bindable");Object.defineProperty(exports,"__esModule",{value:!0}),exports.Cookie=void 0;function _slicedToArray(a,b){return _arrayWithHoles(a)||_iterableToArrayLimit(a,b)||_unsupportedIterableToArray(a,b)||_nonIterableRest()}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(a,b){if(a){if("string"==typeof a)return _arrayLikeToArray(a,b);var c=Object.prototype.toString.call(a).slice(8,-1);return"Object"===c&&a.constructor&&(c=a.constructor.name),"Map"===c||"Set"===c?Array.from(a):"Arguments"===c||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(c)?_arrayLikeToArray(a,b):void 0}}function _arrayLikeToArray(a,b){(null==b||b>a.length)&&(b=a.length);for(var c=0,d=Array(b);c<b;c++)d[c]=a[c];return d}function _iterableToArrayLimit(a,b){var c=null==a?null:"undefined"!=typeof Symbol&&a[Symbol.iterator]||a["@@iterator"];if(null!=c){var d,e,f=[],g=!0,h=!1;try{for(c=c.call(a);!(g=(d=c.next()).done)&&(f.push(d.value),!(b&&f.length===b));g=!0);}catch(a){h=!0,e=a}finally{try{g||null==c["return"]||c["return"]()}finally{if(h)throw e}}return f}}function _arrayWithHoles(a){if(Array.isArray(a))return a}function _classCallCheck(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function _defineProperties(a,b){for(var c,d=0;d<b.length;d++)c=b[d],c.enumerable=c.enumerable||!1,c.configurable=!0,"value"in c&&(c.writable=!0),Object.defineProperty(a,c.key,c)}function _createClass(a,b,c){return b&&_defineProperties(a.prototype,b),c&&_defineProperties(a,c),a}var Cookie=function(){function a(){_classCallCheck(this,a)}return _createClass(a,null,[{key:"set",value:function set(b,c){a.jar[b]=c}},{key:"get",value:function get(b){return a.jar[b]}},{key:"delete",value:function _delete(b){delete a.jar[b]}}]),a}();exports.Cookie=Cookie;Cookie.jar=Cookie.jar||_Bindable.Bindable.make({}),document.cookie&&"data"!==window.location.href.substr(0,4)&&(document.cookie.split(";").map(function(a){var b=a.split("="),c=_slicedToArray(b,2),d=c[0],e=c[1];try{e=JSON.parse(e)}catch(a){e=e}d=d.trim(),Cookie.jar[decodeURIComponent(d)]=e}),Cookie.jar.bindTo(function(a,b,c,e){document.cookie=e?"".concat(encodeURIComponent(b),"=;expires=").concat(new Date(0)):"".concat(encodeURIComponent(b),"=").concat(a)}));
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.Dom=void 0;function _classCallCheck(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function _defineProperties(a,b){for(var c,d=0;d<b.length;d++)c=b[d],c.enumerable=c.enumerable||!1,c.configurable=!0,"value"in c&&(c.writable=!0),Object.defineProperty(a,c.key,c)}function _createClass(a,b,c){return b&&_defineProperties(a.prototype,b),c&&_defineProperties(a,c),a}var traversals=0,Dom=function(){function a(){_classCallCheck(this,a)}return _createClass(a,null,[{key:"mapTags",value:function mapTags(a,b,c,d,e){var f=[],g=!0;d&&(g=!1);for(var h=!1,i=document.createTreeWalker(a,NodeFilter.SHOW_ELEMENT|NodeFilter.SHOW_TEXT,{acceptNode:function acceptNode(a){if(!g)if(a===d)g=!0;else return NodeFilter.FILTER_SKIP;return e&&a===e&&(h=!0),h?NodeFilter.FILTER_SKIP:b?a instanceof Element&&a.matches(b)?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP:NodeFilter.FILTER_ACCEPT}},!1),j=traversals++;i.nextNode();)f.push(c(i.currentNode,i));return f}},{key:"dispatchEvent",value:function dispatchEvent(b,c){b.dispatchEvent(c),a.mapTags(b,!1,function(a){a.dispatchEvent(c)})}}]),a}();exports.Dom=Dom;
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.Import=void 0;function _classCallCheck(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function _defineProperties(a,b){for(var c,d=0;d<b.length;d++)c=b[d],c.enumerable=c.enumerable||!1,c.configurable=!0,"value"in c&&(c.writable=!0),Object.defineProperty(a,c.key,c)}function _createClass(a,b,c){return b&&_defineProperties(a.prototype,b),c&&_defineProperties(a,c),a}var Import=function(){function a(b){if(_classCallCheck(this,a),console.log(this.__proto__.constructor),this.__proto__.constructor.instances[b])return this.__proto__.constructor.instances[b];this.uri=b;var c=document.createElement("script");c.setAttribute("src",this.uri),this.ready=new Promise(function(a,b){c.addEventListener("load",function(){return a(c)}),c.addEventListener("error",function(a){console.error(a),b(a)})}),this.tag=c,this.attached=!1,this.__proto__.constructor.instances[b]=this}return _createClass(a,[{key:"attach",value:function attach(){var a=0<arguments.length&&void 0!==arguments[0]?arguments[0]:null;this.attached||(a=a||document.head,a.append(this.tag),this.attached=!0)}}]),a}();exports.Import=Import,Import.instances={};
"use strict";var _Bindable=require("curvature/base/Bindable");Object.defineProperty(exports,"__esModule",{value:!0}),exports.Mixin=void 0;function _toConsumableArray(a){return _arrayWithoutHoles(a)||_iterableToArray(a)||_unsupportedIterableToArray(a)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _iterableToArray(a){if("undefined"!=typeof Symbol&&null!=a[Symbol.iterator]||null!=a["@@iterator"])return Array.from(a)}function _arrayWithoutHoles(a){if(Array.isArray(a))return _arrayLikeToArray(a)}function _typeof(a){"@babel/helpers - typeof";return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(a){return typeof a}:function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a},_typeof(a)}function _createForOfIteratorHelper(a,b){var c="undefined"!=typeof Symbol&&a[Symbol.iterator]||a["@@iterator"];if(!c){if(Array.isArray(a)||(c=_unsupportedIterableToArray(a))||b&&a&&"number"==typeof a.length){c&&(a=c);var d=0,e=function(){};return{s:e,n:function n(){return d>=a.length?{done:!0}:{done:!1,value:a[d++]}},e:function e(a){throw a},f:e}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var f,g=!0,h=!1;return{s:function s(){c=c.call(a)},n:function n(){var a=c.next();return g=a.done,a},e:function e(a){h=!0,f=a},f:function f(){try{g||null==c["return"]||c["return"]()}finally{if(h)throw f}}}}function _unsupportedIterableToArray(a,b){if(a){if("string"==typeof a)return _arrayLikeToArray(a,b);var c=Object.prototype.toString.call(a).slice(8,-1);return"Object"===c&&a.constructor&&(c=a.constructor.name),"Map"===c||"Set"===c?Array.from(a):"Arguments"===c||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(c)?_arrayLikeToArray(a,b):void 0}}function _arrayLikeToArray(a,b){(null==b||b>a.length)&&(b=a.length);for(var c=0,d=Array(b);c<b;c++)d[c]=a[c];return d}function _inherits(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function");a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,writable:!0,configurable:!0}}),b&&_setPrototypeOf(a,b)}function _setPrototypeOf(a,b){return _setPrototypeOf=Object.setPrototypeOf||function(a,b){return a.__proto__=b,a},_setPrototypeOf(a,b)}function _createSuper(a){var b=_isNativeReflectConstruct();return function(){var c,d=_getPrototypeOf(a);if(b){var e=_getPrototypeOf(this).constructor;c=Reflect.construct(d,arguments,e)}else c=d.apply(this,arguments);return _possibleConstructorReturn(this,c)}}function _possibleConstructorReturn(a,b){return b&&("object"===_typeof(b)||"function"==typeof b)?b:_assertThisInitialized(a)}function _assertThisInitialized(a){if(void 0===a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return a}function _isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(a){return!1}}function _getPrototypeOf(a){return _getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(a){return a.__proto__||Object.getPrototypeOf(a)},_getPrototypeOf(a)}function _classCallCheck(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function _defineProperties(a,b){for(var c,d=0;d<b.length;d++)c=b[d],c.enumerable=c.enumerable||!1,c.configurable=!0,"value"in c&&(c.writable=!0),Object.defineProperty(a,c.key,c)}function _createClass(a,b,c){return b&&_defineProperties(a.prototype,b),c&&_defineProperties(a,c),a}var Constructor=Symbol("constructor"),MixinList=Symbol("mixinList"),Mixin=function(){function a(){_classCallCheck(this,a)}return _createClass(a,null,[{key:"from",value:function from(b){for(var c=arguments.length,d=Array(1<c?c-1:0),e=1;e<c;e++)d[e-1]=arguments[e];var f=function(b){function c(){var b;_classCallCheck(this,c);for(var f=arguments.length,g=Array(f),h=0;h<f;h++)g[h]=arguments[h];var i,j=b=e.call.apply(e,[this].concat(g)),k=_createForOfIteratorHelper(d);try{for(k.s();!(i=k.n()).done;){var l=i.value;switch(l[a.Constructor]&&l[a.Constructor].apply(_assertThisInitialized(b)),_typeof(l)){case"object":a.mixObject(l,_assertThisInitialized(b));}}}catch(a){k.e(a)}finally{k.f()}return _possibleConstructorReturn(b,j)}_inherits(c,b);var e=_createSuper(c);return c}(b);return f}},{key:"to",value:function to(a){for(var b={},c=arguments.length,d=Array(1<c?c-1:0),e=1;e<c;e++)d[e-1]=arguments[e];d.map(function(c){switch(_typeof(c)){case"object":Object.assign(b,Object.getOwnPropertyDescriptors(c));break;case"function":Object.assign(b,Object.getOwnPropertyDescriptors(c.prototype));}delete b.constructor,Object.defineProperties(a.prototype,b)})}},{key:"with",value:function _with(){for(var a=arguments.length,b=Array(a),c=0;c<a;c++)b[c]=arguments[c];return this.from.apply(this,[Object].concat(b))}},{key:"mixObject",value:function mixObject(a,b){var c,d=_createForOfIteratorHelper(Object.getOwnPropertyNames(a));try{for(d.s();!(c=d.n()).done;){var g=c.value;if("function"==typeof a[g]){b[g]=a[g].bind(b);continue}b[g]=a[g]}}catch(a){d.e(a)}finally{d.f()}var e,f=_createForOfIteratorHelper(Object.getOwnPropertySymbols(a));try{for(f.s();!(e=f.n()).done;){var h=e.value;if("function"==typeof a[h]){b[h]=a[h].bind(b);continue}b[h]=a[h]}}catch(a){f.e(a)}finally{f.f()}}},{key:"mixClass",value:function mixClass(a,b){var c,d=_createForOfIteratorHelper(Object.getOwnPropertyNames(a.prototype));try{for(d.s();!(c=d.n()).done;){var o=c.value;b.prototype[o]=a.prototype[o].bind(b.prototype)}}catch(a){d.e(a)}finally{d.f()}var e,f=_createForOfIteratorHelper(Object.getOwnPropertySymbols(a.prototype));try{for(f.s();!(e=f.n()).done;){var p=e.value;b.prototype[p]=a.prototype[p].bind(b.prototype)}}catch(a){f.e(a)}finally{f.f()}var g,h=_createForOfIteratorHelper(Object.getOwnPropertyNames(a));try{var i=function(){var c=g.value;if("function"!=typeof a[c])return"continue";var d=b[c]||!1,e=a[c].bind(b);b[c]=function(){return d&&d.apply(void 0,arguments),e.apply(void 0,arguments)}};for(h.s();!(g=h.n()).done;){var j=i()}}catch(a){h.e(a)}finally{h.f()}var k,l=_createForOfIteratorHelper(Object.getOwnPropertySymbols(a));try{var m=function(){var c=k.value;if("function"!=typeof a[c])return"continue";var d=b[c]||!1,e=a[c].bind(b);b[c]=function(){return d&&d.apply(void 0,arguments),e.apply(void 0,arguments)}};for(l.s();!(k=l.n()).done;){var n=m()}}catch(a){l.e(a)}finally{l.f()}}},{key:"mix",value:function mix(a){for(var b={},c={},d=_Bindable.Bindable.makeBindable(a),e=function(e){var f,g=Object.getOwnPropertyNames(e.prototype),h=Object.getOwnPropertyNames(e),i=/^(before|after)__(.+)/,j=_createForOfIteratorHelper(h);try{var k=function(){var c=f.value,g=c.match(i);if(g){switch(g[1]){case"before":d.___before(function(b,d,f,h,i){if(d===g[2]){var a=e[c].bind(h);return a.apply(void 0,_toConsumableArray(i))}});break;case"after":d.___after(function(b,d,f,h,i){if(d===g[2]){var a=e[c].bind(h);return a.apply(void 0,_toConsumableArray(i))}});}return"continue"}return b[c]?"continue":"function"==typeof e[c]?void(b[c]=e[c]):"continue"};for(j.s();!(f=j.n()).done;){var l=k()}}catch(a){j.e(a)}finally{j.f()}var m,n=_createForOfIteratorHelper(g);try{var o=function(){var b=m.value,f=b.match(i);if(f){switch(f[1]){case"before":d.___before(function(c,d,g,h,i){if(d===f[2]){var a=e.prototype[b].bind(h);return a.apply(void 0,_toConsumableArray(i))}});break;case"after":d.___after(function(c,d,g,h,i){if(d===f[2]){var a=e.prototype[b].bind(h);return a.apply(void 0,_toConsumableArray(i))}});}return"continue"}return c[b]?"continue":"function"==typeof e.prototype[b]?void(c[b]=e.prototype[b]):"continue"};for(n.s();!(m=n.n()).done;){var p=o()}}catch(a){n.e(a)}finally{n.f()}},f=this;f&&f.prototype;f=Object.getPrototypeOf(f))e(f);for(var h in b)a[h]=b[h].bind(a);var g=function(b){a.prototype[b]=function(){for(var a=arguments.length,d=Array(a),e=0;e<a;e++)d[e]=arguments[e];return c[b].apply(this,d)}};for(var i in c)g(i);return d}}]),a}();exports.Mixin=Mixin,Mixin.Constructor=Constructor;
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.Model=void 0;var _Cache=require("./Cache"),_Bindable=require("./Bindable"),_Repository=require("./Repository");function _classCallCheck(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function _defineProperties(a,b){for(var c,d=0;d<b.length;d++)c=b[d],c.enumerable=c.enumerable||!1,c.configurable=!0,"value"in c&&(c.writable=!0),Object.defineProperty(a,c.key,c)}function _createClass(a,b,c){return b&&_defineProperties(a.prototype,b),c&&_defineProperties(a,c),a}var Model=function(){function a(b){_classCallCheck(this,a),this.repository=b}return _createClass(a,[{key:"consume",value:function consume(b){for(var e in b){var f=b[e];if(b[e]instanceof Object&&b[e]["class"]&&b[e].publicId){var c="".concat(b[e]["class"],"::").concat(b[e].publidId),d=_Cache.Cache.load(c,!1,"model-type-repo");f=_Bindable.Bindable.makeBindable(new a(this.repository)),d&&(f=d),f.consume(b[e]),_Cache.Cache.store(c,f,0,"model-type-repo")}this[e]=f}}}]),a}();exports.Model=Model;
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.Repository=void 0;var _Bindable=require("./Bindable"),_Router=require("./Router"),_Cache=require("./Cache"),_Model=require("./Model"),_Bag=require("./Bag"),_Form=require("../form/Form"),_FormWrapper=require("../form/multiField/FormWrapper");function _typeof(a){"@babel/helpers - typeof";return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(a){return typeof a}:function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a},_typeof(a)}function _classCallCheck(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function _defineProperties(a,b){for(var c,d=0;d<b.length;d++)c=b[d],c.enumerable=c.enumerable||!1,c.configurable=!0,"value"in c&&(c.writable=!0),Object.defineProperty(a,c.key,c)}function _createClass(a,b,c){return b&&_defineProperties(a.prototype,b),c&&_defineProperties(a,c),a}var objects={},Repository=function(){function a(b){_classCallCheck(this,a),this.uri=b}return _createClass(a,[{key:"get",value:function get(b){var c=this,d=!!(1<arguments.length&&void 0!==arguments[1])&&arguments[1],e=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{},f=this.uri+"/"+b,g=_Cache.Cache.load(f+_Router.Router.queryToString(_Router.Router.queryOver(e),!0),!1,"model-uri-repo");return!d&&g?Promise.resolve(g):a.request(f,e).then(function(a){return c.extractModel(a.body)})}},{key:"page",value:function page(){var b=this,c=0<arguments.length&&void 0!==arguments[0]?arguments[0]:0,d=1<arguments.length?arguments[1]:void 0;return a.request(this.uri,d).then(function(a){var c=[];for(var d in a.body){var e=a.body[d];c.push(b.extractModel(e))}return a.body=c,a})}},{key:"edit",value:function edit(){var b=0<arguments.length&&void 0!==arguments[0]?arguments[0]:null,c=1<arguments.length&&void 0!==arguments[1]?arguments[1]:null,d=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{},e=this.uri+"/create";return b&&(e=this.uri+"/"+b+"/edit"),c?a.request(e,{api:"json"},c).then(function(a){return a.body}):a.request(e).then(function(a){var b=new _Form.Form(a.meta.form,d);return new _FormWrapper.FormWrapper(b,e,"POST",d)})}},{key:"extractModel",value:function extractModel(a){var b=_Bindable.Bindable.makeBindable(new _Model.Model(this));b.consume(a);this.uri+"/"+b.publicId;if(b["class"])var c="".concat(b["class"],"::").concat(b.publidId),d=_Cache.Cache.load(c,!1,"model-type-repo");return b}}],[{key:"loadPage",value:function loadPage(){var a=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},b=!!(1<arguments.length&&void 0!==arguments[1])&&arguments[1];return this.request(this.uri,a).then(function(a){return a})}},{key:"domCache",value:function domCache(){}},{key:"load",value:function load(a){!!(1<arguments.length&&void 0!==arguments[1])&&arguments[1];return this.objects=this.objects||{},this.objects[this.uri]=this.objects[this.uri]||{},this.objects[this.uri][a]?Promise.resolve(this.objects[this.uri][a]):this.request(this.uri+"/"+a).then(function(){})}},{key:"form",value:function form(){var a=0<arguments.length&&void 0!==arguments[0]?arguments[0]:null,b=this.uri+"/create";return a&&(b=this.uri+"/"+a+"/edit"),this.request(b).then(function(a){return a})}},{key:"clearCache",value:function clearCache(){this.objects&&this.objects[this.uri]&&(this.objects[this.uri]={})}},{key:"encode",value:function encode(a){var b=1<arguments.length&&void 0!==arguments[1]?arguments[1]:null,c=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null;for(var d in c||(c=new FormData),a){var e=d;b&&(e="".concat(b,"[").concat(e,"]")),a[d]&&"object"!==_typeof(a[d])?c.append(e,a[d]):this.encode(a[d],e,c)}return c}},{key:"onResponse",value:function onResponse(a){return this._onResponse||(this._onResponse=new _Bag.Bag),this._onResponse.add(a)}},{key:"request",value:function request(a){var b=this,c=1<arguments.length&&void 0!==arguments[1]?arguments[1]:null,d=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null,e=!(3<arguments.length&&void 0!==arguments[3])||arguments[3],f=4<arguments.length&&void 0!==arguments[4]?arguments[4]:{},g="GET",h="",i=null,j={};c&&(j=c),this._onResponse||(this._onResponse=new _Bag.Bag),this.runningRequests||(this.runningRequests={}),j.api=j.api||"json",h=Object.keys(j).map(function(a){return encodeURIComponent(a)+"="+encodeURIComponent(j[a])}).join("&");var k=a;if(k=a+"?"+h,!d&&this.runningRequests[k])return this.runningRequests[k];d&&(e=!1,g="POST",i=d instanceof FormData?d:this.encode(d));var l=new XMLHttpRequest;if("responseType"in f&&(l.responseType=f.responseType),!d&&e&&this.cache&&this.cache[k])return Promise.resolve(this.cache[k]);var m="script[data-uri=\""+k+"\"]",n=document.querySelector(m);if(!d&&e&&n){var q=JSON.parse(n.innerText);return Promise.resolve(q)}l.withCredentials=!("withCredentials"in f)||f.withCredentials;var o=document.createElement("a");o.href=k,d||(l.timeout=f.timeout||15e3,this.xhrs[k]=l);var p=new Promise(function(a,c){if(d&&"progressUp"in f&&(l.upload.onprogress=f.progressUp),"progressDown"in f&&(l.onprogress=f.progressDown),l.onreadystatechange=function(){var d,e=200;if(4===l.readyState)if(delete b.xhrs[k],delete b.runningRequests[k],b.cache||(b.cache={}),"application/json"!=l.getResponseHeader("Content-Type")&&"application/json; charset=utf-8"!=l.getResponseHeader("Content-Type")&&"text/json"!=l.getResponseHeader("Content-Type")&&"text/json; charset=utf-8"!=l.getResponseHeader("Content-Type")){var h=b._onResponse.items();for(var j in h)h[j](l,!0);l.status===e?a(l):c(l)}else if(d=JSON.parse(l.responseText),d&&0==d.code){var f=document.querySelector("script[data-uri=\""+k+"\"]"),g=window.prerenderer||navigator.userAgent.match(/prerender/i);g&&(window.prerenderer=window.prerenderer||!0,!f&&(f=document.createElement("script"),f.type="text/json",f.setAttribute("data-hack","application/ld+json-NOT!"),f.setAttribute("data-uri",k),document.head.appendChild(f)),f.innerText=JSON.stringify(d));var m=b._onResponse.items();for(var n in m)m[n](d,!0);d._http=l.status,l.status===e?a(d):c(d)}else{var i=b._onResponse.items();for(var o in i)i[o](d,!0);c(d)}},l.open(g,k,!0),f.headers)for(var e in f.headers)l.setRequestHeader(e,f.headers[e]);l.send(i)});return d||(this.runningRequests[k]=p),p}},{key:"cancel",value:function cancel(){var a=0<arguments.length&&void 0!==arguments[0]?arguments[0]:/^.$/;for(var b in this.xhrs)this.xhrs[b]&&b.match(a)&&(this.xhrs[b].abort(),delete this.xhrs[b])}}]),a}();exports.Repository=Repository,Repository.xhrs=[];
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.Router=void 0;var _View=require("./View"),_Cache=require("./Cache"),_Config=require("./Config"),_Routes=require("./Routes");function _createForOfIteratorHelper(a,b){var c="undefined"!=typeof Symbol&&a[Symbol.iterator]||a["@@iterator"];if(!c){if(Array.isArray(a)||(c=_unsupportedIterableToArray(a))||b&&a&&"number"==typeof a.length){c&&(a=c);var d=0,e=function(){};return{s:e,n:function n(){return d>=a.length?{done:!0}:{done:!1,value:a[d++]}},e:function e(a){throw a},f:e}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var f,g=!0,h=!1;return{s:function s(){c=c.call(a)},n:function n(){var a=c.next();return g=a.done,a},e:function e(a){h=!0,f=a},f:function f(){try{g||null==c["return"]||c["return"]()}finally{if(h)throw f}}}}function _unsupportedIterableToArray(a,b){if(a){if("string"==typeof a)return _arrayLikeToArray(a,b);var c=Object.prototype.toString.call(a).slice(8,-1);return"Object"===c&&a.constructor&&(c=a.constructor.name),"Map"===c||"Set"===c?Array.from(a):"Arguments"===c||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(c)?_arrayLikeToArray(a,b):void 0}}function _arrayLikeToArray(a,b){(null==b||b>a.length)&&(b=a.length);for(var c=0,d=Array(b);c<b;c++)d[c]=a[c];return d}function _classCallCheck(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function _defineProperties(a,b){for(var c,d=0;d<b.length;d++)c=b[d],c.enumerable=c.enumerable||!1,c.configurable=!0,"value"in c&&(c.writable=!0),Object.defineProperty(a,c.key,c)}function _createClass(a,b,c){return b&&_defineProperties(a.prototype,b),c&&_defineProperties(a,c),a}var NotFoundError=Symbol("NotFound"),InternalError=Symbol("Internal"),Router=function(){function a(){_classCallCheck(this,a)}return _createClass(a,null,[{key:"wait",value:function wait(a){var b=this,c=1<arguments.length&&void 0!==arguments[1]?arguments[1]:"DOMContentLoaded",d=2<arguments.length&&void 0!==arguments[2]?arguments[2]:document;d.addEventListener(c,function(){b.listen(a)})}},{key:"listen",value:function(a){var b=this,c=!!(1<arguments.length&&void 0!==arguments[1])&&arguments[1];this.routes=c||a.routes,Object.assign(this.query,this.queryOver({}));var d=function(c){for(var d in c.preventDefault(),c.state&&"routedId"in c.state?(c.state.routedId<=b.routeCount?(b.history.splice(c.state.routedId),b.routeCount=c.state.routedId):c.state.routedId>b.routeCount&&(b.history.push(c.state.prev),b.routeCount=c.state.routedId),b.state=c.state):null!==b.prevPath&&b.prevPath!==location.pathname&&b.history.push(b.prevPath),"null"===location.origin?b.match(b.nextPath,a):b.match(location.pathname,a),b.query)delete b.query[d];Object.assign(b.query,b.queryOver({}))};window.addEventListener("popstate",d),window.addEventListener("cvUrlChanged",d);var e="null"!==location.origin&&location.pathname+location.search;location.origin&&location.hash&&(e+=location.hash);var f={routedId:this.routeCount,url:location.pathname,prev:this.prevPath};"null"!==location.origin&&history.replaceState(f,null,location.pathname),this.go(!1===e?"/":e)}},{key:"go",value:function go(a,b){var c=_Config.Config.get("title");c&&(document.title=c);var d={routedId:this.routeCount,prev:this.prevPath,url:location.pathname};for(var e in"null"===location.origin?this.nextPath=a:2===b&&location.pathname!==a?history.replaceState(d,null,a):location.pathname!==a&&history.pushState(d,null,a),b||(!1===b&&(this.path=null),"#"===a.substring(0,1)?window.dispatchEvent(new HashChangeEvent("hashchange")):window.dispatchEvent(new CustomEvent("cvUrlChanged"))),this.query)delete this.query[e];Object.assign(this.query,this.queryOver({})),this.prevPath=a}},{key:"match",value:function match(a,b){var c=this,d=!!(2<arguments.length&&void 0!==arguments[2])&&arguments[2];if(this.path!==a||d){this.queryString=location.search,this.path=a;var e=this.prevPath,f=b.args.content,g=this.routes||b.routes||_Routes.Routes.dump(),h=new URLSearchParams(location.search);for(var q in this.query)delete this.query[q];Object.assign(this.query,this.queryOver({}));var k={},l=!1,m="";for(var i in a=a.substr(1).split("/"),this.query)k[i]=this.query[i];L1:for(var r in g){var s=r.split("/");if(!(s.length<a.length&&"*"!==s[s.length-1])){L2:for(var t in s)if("%"==s[t].substr(0,1)){var n=null,o=/^%(\w+)\??/.exec(s[t]);if(o&&o[1]&&(n=o[1]),!n)throw new Error("".concat(s[t]," is not a valid argument segment in route \"").concat(r,"\""));if(!!a[t])k[n]=a[t];else if("?"==s[t].substr(s[t].length-1,1))k[n]="";else continue L1}else if("*"!==s[t]&&a[t]!==s[t])continue L1;l=r,m=g[r],"*"===s[s.length-1]&&(k.pathparts=a.slice(s.length-1));break}}var p=new CustomEvent("cvRouteStart",{cancelable:!0,detail:{path:a,prev:e,root:b,selected:l,routes:g}});if(document.dispatchEvent(p)){if(!d&&b&&f&&m instanceof Object&&f instanceof m&&!(m instanceof Promise)&&f.update(k))return b.args.content=f,!0;try{l in g||(g[l]=g[NotFoundError]);var j=function(a){var b=!1;return b="function"==typeof g[a]?g[a].prototype instanceof _View.View?new g[a](k):g[a](k):g[a],b};return m=j(l),!1===m&&(m=j(NotFoundError)),m instanceof Promise?m.then(function(e){c.update(b,a,e,g,l,k,d)})["catch"](function(f){throw document.dispatchEvent(new CustomEvent("cvRouteError",{detail:{error:f,path:a,prev:e,view:b,routes:g,selected:l}})),c.update(b,a,window.devMode?f+"":"Error: 500",g,l,k,d),f}):this.update(b,a,m,g,l,k,d)}catch(c){throw document.dispatchEvent(new CustomEvent("cvRouteError",{detail:{error:c,path:a,prev:e,view:b,routes:g,selected:l}})),this.update(b,a,window.devMode?c+"":"Error: 500",g,l,k,d),c}}}}},{key:"update",value:function update(a,b,c,d,e,f,g){if(a){var h=this.prevPath,i=new CustomEvent("cvRoute",{cancelable:!0,detail:{result:c,path:b,prev:h,view:a,routes:d,selected:e}});!1!==c&&(a.args.content instanceof _View.View&&(a.args.content.pause(!0),a.args.content.remove()),document.dispatchEvent(i)&&(a.args.content=c),c instanceof _View.View&&(c.pause(!1),c.update(f,g)));var j=new CustomEvent("cvRouteEnd",{cancelable:!0,detail:{result:c,path:b,prev:h,view:a,routes:d,selected:e}});document.dispatchEvent(j)}}},{key:"queryOver",value:function queryOver(){var a,b=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},c=new URLSearchParams(location.search),d={},e={},f=_createForOfIteratorHelper(c);try{for(f.s();!(a=f.n()).done;){var g=a.value;e[g[0]]=g[1]}}catch(a){f.e(a)}finally{f.f()}return d=Object.assign(d,e,b),delete d.api,d}},{key:"queryToString",value:function queryToString(){var a=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},b=!!(1<arguments.length&&void 0!==arguments[1])&&arguments[1],c=[],d=a;for(var e in b||(d=this.queryOver(a)),d)""!==d[e]&&c.push(e+"="+encodeURIComponent(d[e]));return c.join("&")}},{key:"setQuery",value:function setQuery(a,b,c){var d=this.queryOver();d[a]=b,void 0===b&&delete d[a];var e=this.queryToString(d,!0);this.go(location.pathname+(e?"?"+e:""),c)}}]),a}();exports.Router=Router,Object.defineProperty(Router,"query",{configurable:!1,enumerable:!1,writable:!1,value:{}}),Object.defineProperty(Router,"history",{configurable:!1,enumerable:!1,writable:!1,value:[]}),Object.defineProperty(Router,"routeCount",{configurable:!1,enumerable:!1,writable:!0,value:0}),Object.defineProperty(Router,"prevPath",{configurable:!1,enumerable:!1,writable:!0,value:null}),Object.defineProperty(Router,"queryString",{configurable:!1,enumerable:!1,writable:!0,value:null}),Object.defineProperty(Router,"InternalError",{configurable:!1,enumerable:!1,writable:!1,value:InternalError}),Object.defineProperty(Router,"NotFoundError",{configurable:!1,enumerable:!1,writable:!1,value:NotFoundError});
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.Routes=void 0;function _classCallCheck(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function _defineProperties(a,b){for(var c,d=0;d<b.length;d++)c=b[d],c.enumerable=c.enumerable||!1,c.configurable=!0,"value"in c&&(c.writable=!0),Object.defineProperty(a,c.key,c)}function _createClass(a,b,c){return b&&_defineProperties(a.prototype,b),c&&_defineProperties(a,c),a}var AppRoutes={};try{Object.assign(AppRoutes,require("Routes").Routes||{})}catch(a){!0===globalThis.devMode&&console.warn(a)}var Routes=function(){function a(){_classCallCheck(this,a)}return _createClass(a,null,[{key:"get",value:function get(a){return this.routes[a]}},{key:"dump",value:function dump(){return this.routes}}]),a}();exports.Routes=Routes,Object.defineProperty(Routes,"routes",{configurable:!1,enumerable:!1,writable:!1,value:AppRoutes});
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.RuleSet=void 0;var _Dom=require("./Dom"),_Tag=require("./Tag"),_View=require("./View");function _slicedToArray(a,b){return _arrayWithHoles(a)||_iterableToArrayLimit(a,b)||_unsupportedIterableToArray(a,b)||_nonIterableRest()}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _iterableToArrayLimit(a,b){var c=null==a?null:"undefined"!=typeof Symbol&&a[Symbol.iterator]||a["@@iterator"];if(null!=c){var d,e,f=[],g=!0,h=!1;try{for(c=c.call(a);!(g=(d=c.next()).done)&&(f.push(d.value),!(b&&f.length===b));g=!0);}catch(a){h=!0,e=a}finally{try{g||null==c["return"]||c["return"]()}finally{if(h)throw e}}return f}}function _arrayWithHoles(a){if(Array.isArray(a))return a}function _createForOfIteratorHelper(a,b){var c="undefined"!=typeof Symbol&&a[Symbol.iterator]||a["@@iterator"];if(!c){if(Array.isArray(a)||(c=_unsupportedIterableToArray(a))||b&&a&&"number"==typeof a.length){c&&(a=c);var d=0,e=function(){};return{s:e,n:function n(){return d>=a.length?{done:!0}:{done:!1,value:a[d++]}},e:function e(a){throw a},f:e}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var f,g=!0,h=!1;return{s:function s(){c=c.call(a)},n:function n(){var a=c.next();return g=a.done,a},e:function e(a){h=!0,f=a},f:function f(){try{g||null==c["return"]||c["return"]()}finally{if(h)throw f}}}}function _unsupportedIterableToArray(a,b){if(a){if("string"==typeof a)return _arrayLikeToArray(a,b);var c=Object.prototype.toString.call(a).slice(8,-1);return"Object"===c&&a.constructor&&(c=a.constructor.name),"Map"===c||"Set"===c?Array.from(a):"Arguments"===c||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(c)?_arrayLikeToArray(a,b):void 0}}function _arrayLikeToArray(a,b){(null==b||b>a.length)&&(b=a.length);for(var c=0,d=Array(b);c<b;c++)d[c]=a[c];return d}function _classCallCheck(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function _defineProperties(a,b){for(var c,d=0;d<b.length;d++)c=b[d],c.enumerable=c.enumerable||!1,c.configurable=!0,"value"in c&&(c.writable=!0),Object.defineProperty(a,c.key,c)}function _createClass(a,b,c){return b&&_defineProperties(a.prototype,b),c&&_defineProperties(a,c),a}var RuleSet=function(){function a(){_classCallCheck(this,a)}return _createClass(a,[{key:"add",value:function add(a,b){return this.rules=this.rules||{},this.rules[a]=this.rules[a]||[],this.rules[a].push(b),this}},{key:"apply",value:function apply(){var b=0<arguments.length&&void 0!==arguments[0]?arguments[0]:document,c=1<arguments.length&&void 0!==arguments[1]?arguments[1]:null;for(var j in a.apply(b,c),this.rules)for(var k in this.rules[j]){var d,e=this.rules[j][k],f=a.wrap(b,e,c),g=b.querySelectorAll(j),h=_createForOfIteratorHelper(g);try{for(h.s();!(d=h.n()).done;){var i=d.value;f(i)}}catch(a){h.e(a)}finally{h.f()}}}},{key:"purge",value:function purge(){if(this.rules)for(var a=0,b=Object.entries(this.rules);a<b.length;a++){var c=_slicedToArray(b[a],2),d=c[0],e=c[1];if(this.rules[d])for(var f in this.rules[d])delete this.rules[d][f]}}}],[{key:"add",value:function add(a,b){return this.globalRules=this.globalRules||{},this.globalRules[a]=this.globalRules[a]||[],this.globalRules[a].push(b),this}},{key:"apply",value:function apply(){var a=0<arguments.length&&void 0!==arguments[0]?arguments[0]:document,b=1<arguments.length&&void 0!==arguments[1]?arguments[1]:null;for(var h in this.globalRules)for(var j in this.globalRules[h]){var c,d=this.globalRules[h][j],e=this.wrap(a,d,b),f=a.querySelectorAll(h),g=_createForOfIteratorHelper(f);try{for(g.s();!(c=g.n()).done;){var i=c.value;e(i)}}catch(a){g.e(a)}finally{g.f()}}}},{key:"wait",value:function wait(){var a=this,b=0<arguments.length&&void 0!==arguments[0]?arguments[0]:"DOMContentLoaded",c=1<arguments.length&&void 0!==arguments[1]?arguments[1]:document,d=function(b,c){return function(){return c.removeEventListener(b,d),a.apply()}}(b,c);c.addEventListener(b,d)}},{key:"wrap",value:function wrap(a,b){var c=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null,d=b;return(b instanceof _View.View||b&&b.prototype&&b.prototype instanceof _View.View)&&(d=function(){return b}),function(a){if("undefined"==typeof a.___cvApplied___&&Object.defineProperty(a,"___cvApplied___",{enumerable:!1,writable:!1,value:new WeakSet}),!a.___cvApplied___.has(b)){var e,f;c&&(e=f=c,c.viewList&&(f=c.viewList.parent));var g=new _Tag.Tag(a,f,null,void 0,e),h=g.element.parentNode,i=g.element.nextSibling,j=d(g);if(!1!==j&&a.___cvApplied___.add(b),j instanceof HTMLElement&&(j=new _Tag.Tag(j)),j instanceof _Tag.Tag){if(!j.element.contains(g.element)){for(;g.element.firstChild;)j.element.appendChild(g.element.firstChild);g.remove()}i?h.insertBefore(j.element,i):h.appendChild(j.element)}j&&j.prototype&&j.prototype instanceof _View.View&&(j=new j({},c)),j instanceof _View.View&&(c&&(c.cleanup.push(function(a){return function(){a.remove()}}(j)),c.cleanup.push(c.args.bindTo(function(a,b,c){c[b]=a,j.args[b]=a})),c.cleanup.push(j.args.bindTo(function(a,b,d){d[b]=a,c.args[b]=a}))),g.clear(),j.render(g.element))}}}}]),a}();exports.RuleSet=RuleSet;
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.SetMap=void 0;function _construct(){return _construct=_isNativeReflectConstruct()?Reflect.construct:function(b,c,d){var e=[null];e.push.apply(e,c);var a=Function.bind.apply(b,e),f=new a;return d&&_setPrototypeOf(f,d.prototype),f},_construct.apply(null,arguments)}function _isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(a){return!1}}function _setPrototypeOf(a,b){return _setPrototypeOf=Object.setPrototypeOf||function(a,b){return a.__proto__=b,a},_setPrototypeOf(a,b)}function _toConsumableArray(a){return _arrayWithoutHoles(a)||_iterableToArray(a)||_unsupportedIterableToArray(a)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _iterableToArray(a){if("undefined"!=typeof Symbol&&null!=a[Symbol.iterator]||null!=a["@@iterator"])return Array.from(a)}function _arrayWithoutHoles(a){if(Array.isArray(a))return _arrayLikeToArray(a)}function _createForOfIteratorHelper(a,b){var c="undefined"!=typeof Symbol&&a[Symbol.iterator]||a["@@iterator"];if(!c){if(Array.isArray(a)||(c=_unsupportedIterableToArray(a))||b&&a&&"number"==typeof a.length){c&&(a=c);var d=0,e=function(){};return{s:e,n:function n(){return d>=a.length?{done:!0}:{done:!1,value:a[d++]}},e:function e(a){throw a},f:e}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var f,g=!0,h=!1;return{s:function s(){c=c.call(a)},n:function n(){var a=c.next();return g=a.done,a},e:function e(a){h=!0,f=a},f:function f(){try{g||null==c["return"]||c["return"]()}finally{if(h)throw f}}}}function _unsupportedIterableToArray(a,b){if(a){if("string"==typeof a)return _arrayLikeToArray(a,b);var c=Object.prototype.toString.call(a).slice(8,-1);return"Object"===c&&a.constructor&&(c=a.constructor.name),"Map"===c||"Set"===c?Array.from(a):"Arguments"===c||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(c)?_arrayLikeToArray(a,b):void 0}}function _arrayLikeToArray(a,b){(null==b||b>a.length)&&(b=a.length);for(var c=0,d=Array(b);c<b;c++)d[c]=a[c];return d}function _classCallCheck(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function _defineProperties(a,b){for(var c,d=0;d<b.length;d++)c=b[d],c.enumerable=c.enumerable||!1,c.configurable=!0,"value"in c&&(c.writable=!0),Object.defineProperty(a,c.key,c)}function _createClass(a,b,c){return b&&_defineProperties(a.prototype,b),c&&_defineProperties(a,c),a}function _defineProperty(a,b,c){return b in a?Object.defineProperty(a,b,{value:c,enumerable:!0,configurable:!0,writable:!0}):a[b]=c,a}var SetMap=function(){function a(){_classCallCheck(this,a),_defineProperty(this,"_map",new Map)}return _createClass(a,[{key:"has",value:function has(a){return this._map.has(a)}},{key:"get",value:function get(a){return this._map.get(a)}},{key:"getOne",value:function getOne(a){var b,c=this.get(a),d=_createForOfIteratorHelper(c);try{for(d.s();!(b=d.n()).done;){var e=b.value;return e}}catch(a){d.e(a)}finally{d.f()}}},{key:"add",value:function add(a,b){var c=this._map.get(a);return c||this._map.set(a,c=new Set),c.add(b)}},{key:"remove",value:function remove(a,b){var c=this._map.get(a);if(c){var d=c["delete"](b);return c.size||this._map["delete"](a),d}}},{key:"values",value:function values(){return _construct(Set,_toConsumableArray(_toConsumableArray(this._map.values()).map(function(a){return _toConsumableArray(a.values())})))}}]),a}();exports.SetMap=SetMap;
"use strict";var _Bindable=require("./Bindable");Object.defineProperty(exports,"__esModule",{value:!0}),exports.Tag=void 0;function _classCallCheck(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function _defineProperties(a,b){for(var c,d=0;d<b.length;d++)c=b[d],c.enumerable=c.enumerable||!1,c.configurable=!0,"value"in c&&(c.writable=!0),Object.defineProperty(a,c.key,c)}function _createClass(a,b,c){return b&&_defineProperties(a.prototype,b),c&&_defineProperties(a,c),a}var Tag=function(){function a(b,c,d,e,f){var g=this;if(_classCallCheck(this,a),"string"==typeof b){var h=document.createRange().createContextualFragment(b);b=h.firstChild}this.element=_Bindable.Bindable.makeBindable(b),this.node=this.element,this.parent=c,this.direct=f,this.ref=d,this.index=e,this.cleanup=[],this[_Bindable.Bindable.OnAllGet]=function(a){return"function"==typeof g[a]?g[a]:g.node&&"function"==typeof g.node[a]?function(){var b;return(b=g.node)[a].apply(b,arguments)}:g.node&&a in g.node?g.node[a]:g[a]};return this.style=function generateStyler(a){return _Bindable.Bindable.make(function(b){if(a.node)for(var c in b)"-"===c[0]?a.node.style.setProperty(c,b[c]+""):a.node.style[c]=b[c]+""})}(this),this.proxy=_Bindable.Bindable.make(this),this.proxy.style.bindTo(function(a,b){g.element.style[b]=a}),this.proxy.bindTo(function(a,c){return c in b&&(b[c]=a),!1}),this.proxy}return _createClass(a,[{key:"attr",value:function attr(a){for(var b in a)void 0===a[b]?this.node.removeAttribute(b):null===a[b]?this.node.setAttribute(b,""):this.node.setAttribute(b,a[b])}},{key:"remove",value:function remove(){this.node&&this.node.remove(),_Bindable.Bindable.clearBindings(this);for(var b;b=this.cleanup.shift();)b();if(this.clear(),!!this.node){var a=new Event("cvDomDetached");this.node.dispatchEvent(a),this.node=this.element=this.ref=this.parent=void 0}}},{key:"clear",value:function clear(){if(this.node)for(var a=new Event("cvDomDetached");this.node.firstChild;)this.node.firstChild.dispatchEvent(a),this.node.removeChild(this.node.firstChild)}},{key:"pause",value:function pause(){!(0<arguments.length&&void 0!==arguments[0])||arguments[0]}},{key:"listen",value:function listen(a,b,c){var d=this.node;d.addEventListener(a,b,c);var e=function(){d.removeEventListener(a,b,c)},f=function(){e(),e=function(){return console.warn("Already removed!")}};return this.parent.onRemove(function(){return f()}),f}}]),a}();exports.Tag=Tag;
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.Theme=void 0;function _slicedToArray(a,b){return _arrayWithHoles(a)||_iterableToArrayLimit(a,b)||_unsupportedIterableToArray(a,b)||_nonIterableRest()}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _iterableToArrayLimit(a,b){var c=null==a?null:"undefined"!=typeof Symbol&&a[Symbol.iterator]||a["@@iterator"];if(null!=c){var d,e,f=[],g=!0,h=!1;try{for(c=c.call(a);!(g=(d=c.next()).done)&&(f.push(d.value),!(b&&f.length===b));g=!0);}catch(a){h=!0,e=a}finally{try{g||null==c["return"]||c["return"]()}finally{if(h)throw e}}return f}}function _arrayWithHoles(a){if(Array.isArray(a))return a}function _createForOfIteratorHelper(a,b){var c="undefined"!=typeof Symbol&&a[Symbol.iterator]||a["@@iterator"];if(!c){if(Array.isArray(a)||(c=_unsupportedIterableToArray(a))||b&&a&&"number"==typeof a.length){c&&(a=c);var d=0,e=function(){};return{s:e,n:function n(){return d>=a.length?{done:!0}:{done:!1,value:a[d++]}},e:function e(a){throw a},f:e}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var f,g=!0,h=!1;return{s:function s(){c=c.call(a)},n:function n(){var a=c.next();return g=a.done,a},e:function e(a){h=!0,f=a},f:function f(){try{g||null==c["return"]||c["return"]()}finally{if(h)throw f}}}}function _toConsumableArray(a){return _arrayWithoutHoles(a)||_iterableToArray(a)||_unsupportedIterableToArray(a)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(a,b){if(a){if("string"==typeof a)return _arrayLikeToArray(a,b);var c=Object.prototype.toString.call(a).slice(8,-1);return"Object"===c&&a.constructor&&(c=a.constructor.name),"Map"===c||"Set"===c?Array.from(a):"Arguments"===c||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(c)?_arrayLikeToArray(a,b):void 0}}function _iterableToArray(a){if("undefined"!=typeof Symbol&&null!=a[Symbol.iterator]||null!=a["@@iterator"])return Array.from(a)}function _arrayWithoutHoles(a){if(Array.isArray(a))return _arrayLikeToArray(a)}function _arrayLikeToArray(a,b){(null==b||b>a.length)&&(b=a.length);for(var c=0,d=Array(b);c<b;c++)d[c]=a[c];return d}function _classCallCheck(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function _defineProperties(a,b){for(var c,d=0;d<b.length;d++)c=b[d],c.enumerable=c.enumerable||!1,c.configurable=!0,"value"in c&&(c.writable=!0),Object.defineProperty(a,c.key,c)}function _createClass(a,b,c){return b&&_defineProperties(a.prototype,b),c&&_defineProperties(a,c),a}function _defineProperty(a,b,c){return b in a?Object.defineProperty(a,b,{value:c,enumerable:!0,configurable:!0,writable:!0}):a[b]=c,a}var ThemeList=function(){function a(b){var c;_classCallCheck(this,a),_defineProperty(this,"themes",[]),(c=this.themes).push.apply(c,_toConsumableArray(b))}return _createClass(a,[{key:"getTemplate",value:function getTemplate(a){for(var b in this.themes){var c=this.themes[b].getTemplate(a);if(c)return c}}},{key:"getView",value:function getView(a){for(var b in this.themes){var c=this.themes[b].getView(a);if(c)return c}}}]),a}(),Theme=function(){function a(b){_classCallCheck(this,a),this.key=b,this.viewMap=new Map,this.templateMap=new Map,this.fallbacks=[]}return _createClass(a,[{key:"setFallback",value:function setFallback(){var a;return(a=this.fallbacks).push.apply(a,arguments),this}},{key:"setView",value:function setView(a,b){return this.viewMap.set(a,b),this}},{key:"getView",value:function getView(a){var b=this.resolve(a,"viewMap");if(!b)return null;var c=new b(a);return c}},{key:"setTemplate",value:function setTemplate(a,b){return this.templateMap.set(a,b),this}},{key:"getTemplate",value:function getTemplate(a){return this.resolve(a,"templateMap")}},{key:"resolve",value:function resolve(a,b){a.___object___&&a.isBound&&(a=a.___object___);var c=a.__proto__.constructor,d=this[b];if(d.has(c,a))return d.get(c);var e,f=null,g=_createForOfIteratorHelper(d);try{for(g.s();!(e=g.n()).done;){var h=_slicedToArray(e.value,2),i=h[0],j=h[1];a instanceof i&&(f=j)}}catch(a){g.e(a)}finally{g.f()}if(!f){var k,l=_createForOfIteratorHelper(this.fallbacks);try{for(l.s();!(k=l.n()).done;){var m=k.value;if(f=m.resolve(a,b))return f}}catch(a){l.e(a)}finally{l.f()}}return f&&d.set(c,f),f}}],[{key:"get",value:function get(){for(var a=arguments.length,b=Array(a),c=0;c<a;c++)b[c]=arguments[c];if(1>=b.length){var e=(b[0]||"")+"";return this.instances[e]||(this.instances[e]=new this(e)),this.instances[e]}var d=[];for(var f in b)d.push(this.get(b[f]));return new ThemeList(d)}}]),a}();exports.Theme=Theme,_defineProperty(Theme,"instances",{});
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.View=void 0;var _Bindable=require("./Bindable"),_ViewList=require("./ViewList"),_Router=require("./Router"),_Dom=require("./Dom"),_Tag=require("./Tag"),_Bag=require("./Bag"),_RuleSet=require("./RuleSet"),_Mixin=require("./Mixin"),_PromiseMixin=require("../mixin/PromiseMixin"),_EventTargetMixin=require("../mixin/EventTargetMixin");function _typeof(a){"@babel/helpers - typeof";return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(a){return typeof a}:function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a},_typeof(a)}function _toConsumableArray(a){return _arrayWithoutHoles(a)||_iterableToArray(a)||_unsupportedIterableToArray(a)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _iterableToArray(a){if("undefined"!=typeof Symbol&&null!=a[Symbol.iterator]||null!=a["@@iterator"])return Array.from(a)}function _arrayWithoutHoles(a){if(Array.isArray(a))return _arrayLikeToArray(a)}function _slicedToArray(a,b){return _arrayWithHoles(a)||_iterableToArrayLimit(a,b)||_unsupportedIterableToArray(a,b)||_nonIterableRest()}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _iterableToArrayLimit(a,b){var c=null==a?null:"undefined"!=typeof Symbol&&a[Symbol.iterator]||a["@@iterator"];if(null!=c){var d,e,f=[],g=!0,h=!1;try{for(c=c.call(a);!(g=(d=c.next()).done)&&(f.push(d.value),!(b&&f.length===b));g=!0);}catch(a){h=!0,e=a}finally{try{g||null==c["return"]||c["return"]()}finally{if(h)throw e}}return f}}function _arrayWithHoles(a){if(Array.isArray(a))return a}function _createForOfIteratorHelper(a,b){var c="undefined"!=typeof Symbol&&a[Symbol.iterator]||a["@@iterator"];if(!c){if(Array.isArray(a)||(c=_unsupportedIterableToArray(a))||b&&a&&"number"==typeof a.length){c&&(a=c);var d=0,e=function(){};return{s:e,n:function n(){return d>=a.length?{done:!0}:{done:!1,value:a[d++]}},e:function e(a){throw a},f:e}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var f,g=!0,h=!1;return{s:function s(){c=c.call(a)},n:function n(){var a=c.next();return g=a.done,a},e:function e(a){h=!0,f=a},f:function f(){try{g||null==c["return"]||c["return"]()}finally{if(h)throw f}}}}function _unsupportedIterableToArray(a,b){if(a){if("string"==typeof a)return _arrayLikeToArray(a,b);var c=Object.prototype.toString.call(a).slice(8,-1);return"Object"===c&&a.constructor&&(c=a.constructor.name),"Map"===c||"Set"===c?Array.from(a):"Arguments"===c||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(c)?_arrayLikeToArray(a,b):void 0}}function _arrayLikeToArray(a,b){(null==b||b>a.length)&&(b=a.length);for(var c=0,d=Array(b);c<b;c++)d[c]=a[c];return d}function _classCallCheck(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function _defineProperties(a,b){for(var c,d=0;d<b.length;d++)c=b[d],c.enumerable=c.enumerable||!1,c.configurable=!0,"value"in c&&(c.writable=!0),Object.defineProperty(a,c.key,c)}function _createClass(a,b,c){return b&&_defineProperties(a.prototype,b),c&&_defineProperties(a,c),a}function _inherits(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function");a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,writable:!0,configurable:!0}}),b&&_setPrototypeOf(a,b)}function _setPrototypeOf(a,b){return _setPrototypeOf=Object.setPrototypeOf||function(a,b){return a.__proto__=b,a},_setPrototypeOf(a,b)}function _createSuper(a){var b=_isNativeReflectConstruct();return function(){var c,d=_getPrototypeOf(a);if(b){var e=_getPrototypeOf(this).constructor;c=Reflect.construct(d,arguments,e)}else c=d.apply(this,arguments);return _possibleConstructorReturn(this,c)}}function _possibleConstructorReturn(a,b){return b&&("object"===_typeof(b)||"function"==typeof b)?b:_assertThisInitialized(a)}function _assertThisInitialized(a){if(void 0===a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return a}function _isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(a){return!1}}function _getPrototypeOf(a){return _getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(a){return a.__proto__||Object.getPrototypeOf(a)},_getPrototypeOf(a)}var dontParse=Symbol("dontParse"),expandBind=Symbol("expandBind"),uuid=Symbol("uuid"),moveIndex=0,View=function(a){function b(){var a,d=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:null;return _classCallCheck(this,b),a=c.call(this,d,e),Object.defineProperty(_assertThisInitialized(a),"args",{value:_Bindable.Bindable.make(d)}),Object.defineProperty(_assertThisInitialized(a),uuid,{value:a.constructor.uuid()}),Object.defineProperty(_assertThisInitialized(a),"nodesAttached",{value:new _Bag.Bag(function(){})}),Object.defineProperty(_assertThisInitialized(a),"nodesDetached",{value:new _Bag.Bag(function(){})}),Object.defineProperty(_assertThisInitialized(a),"_onRemove",{value:new _Bag.Bag(function(){})}),Object.defineProperty(_assertThisInitialized(a),"cleanup",{value:[]}),Object.defineProperty(_assertThisInitialized(a),"parent",{value:e}),Object.defineProperty(_assertThisInitialized(a),"views",{value:new Map}),Object.defineProperty(_assertThisInitialized(a),"viewLists",{value:new Map}),Object.defineProperty(_assertThisInitialized(a),"withViews",{value:new Map}),Object.defineProperty(_assertThisInitialized(a),"tags",{value:_Bindable.Bindable.make({})}),Object.defineProperty(_assertThisInitialized(a),"nodes",{value:_Bindable.Bindable.make([])}),Object.defineProperty(_assertThisInitialized(a),"timeouts",{value:new Map}),Object.defineProperty(_assertThisInitialized(a),"intervals",{value:[]}),Object.defineProperty(_assertThisInitialized(a),"frames",{value:[]}),Object.defineProperty(_assertThisInitialized(a),"ruleSet",{value:new _RuleSet.RuleSet}),Object.defineProperty(_assertThisInitialized(a),"preRuleSet",{value:new _RuleSet.RuleSet}),Object.defineProperty(_assertThisInitialized(a),"subBindings",{value:{}}),Object.defineProperty(_assertThisInitialized(a),"templates",{value:{}}),Object.defineProperty(_assertThisInitialized(a),"eventCleanup",{value:[]}),Object.defineProperty(_assertThisInitialized(a),"unpauseCallbacks",{value:new Map}),Object.defineProperty(_assertThisInitialized(a),"interpolateRegex",{value:/(\[\[((?:\$+)?[\w\.\|-]+)\]\])/g}),Object.defineProperty(_assertThisInitialized(a),"rendered",{value:new Promise(function(b){return Object.defineProperty(_assertThisInitialized(a),"renderComplete",{value:b})})}),a.loaded=Promise.resolve(_assertThisInitialized(a)),a.template="",a.firstNode=null,a.lastNode=null,a.viewList=null,a.mainView=null,a.preserve=!1,a.removed=!1,a}_inherits(b,a);var c=_createSuper(b);return _createClass(b,[{key:"_id",get:function get(){return this[uuid]}},{key:"onFrame",value:function onFrame(a){var b=this,d=!1,e=function(){d=!0},f=function(){b.removed||d||(!b.paused&&a(Date.now()),requestAnimationFrame(f))};return requestAnimationFrame(function(){return f(Date.now())}),this.frames.push(e),e}},{key:"onNextFrame",value:function onNextFrame(a){return requestAnimationFrame(function(){return a(Date.now())})}},{key:"onIdle",value:function onIdle(a){return requestIdleCallback(function(){return a(Date.now())})}},{key:"onTimeout",value:function onTimeout(a,b){var c=this,d={timeout:null,callback:null,time:a,fired:!1,created:new Date().getTime(),paused:!1},e=function(){b(),d.fired=!0,c.timeouts["delete"](d.timeout)},f=setTimeout(e,a);return d.callback=e,d.timeout=f,this.timeouts.set(d.timeout,d),f}},{key:"clearTimeout",value:function(a){function b(){return a.apply(this,arguments)}return b.toString=function(){return a.toString()},b}(function(){var a,b=_createForOfIteratorHelper(this.timeouts);try{for(b.s();!(a=b.n()).done;){var c=_slicedToArray(a.value,2),d=c[0],e=c[1];clearTimeout(e.timeout),this.timeouts["delete"](e.timeout)}}catch(a){b.e(a)}finally{b.f()}})},{key:"onInterval",value:function onInterval(a,b){var c=setInterval(b,a);return this.intervals.push({timeout:c,callback:b,time:a,paused:!1}),c}},{key:"clearInterval",value:function(a){function b(){return a.apply(this,arguments)}return b.toString=function(){return a.toString()},b}(function(a){for(var b in this.intervals)a===this.intervals[b].timeout&&(clearInterval(this.intervals[b].timeout),delete this.intervals[b])})},{key:"pause",value:function pause(){var a=0<arguments.length&&void 0!==arguments[0]?arguments[0]:void 0;if(void 0===a&&(this.paused=!this.paused),this.paused=a,this.paused){var b,c=_createForOfIteratorHelper(this.timeouts);try{for(c.s();!(b=c.n()).done;){var d=_slicedToArray(b.value,2),e=d[0],f=d[1];if(f.fired){this.timeouts["delete"](f.timeout);continue}clearTimeout(f.timeout),f.paused=!0,f.time=Math.max(0,f.time-(Date.now()-f.created))}}catch(a){c.e(a)}finally{c.f()}for(var j in this.intervals)clearInterval(this.intervals[j].timeout)}else{var g,h=_createForOfIteratorHelper(this.timeouts);try{for(h.s();!(g=h.n()).done;){var k=_slicedToArray(g.value,2),l=k[0],m=k[1];if(m.paused){if(m.fired){this.timeouts["delete"](m.timeout);continue}m.timeout=setTimeout(m.callback,m.time),m.paused=!1}}}catch(a){h.e(a)}finally{h.f()}for(var i in this.intervals)this.intervals[i].timeout.paused&&(this.intervals[i].timeout.paused=!1,this.intervals[i].timeout=setInterval(this.intervals[i].callback,this.intervals[i].time));var n,o=_createForOfIteratorHelper(this.unpauseCallbacks);try{for(o.s();!(n=o.n()).done;){var p=_slicedToArray(n.value,2),q=p[1];q()}}catch(a){o.e(a)}finally{o.f()}this.unpauseCallbacks.clear()}var r,s=_createForOfIteratorHelper(this.viewLists);try{for(s.s();!(r=s.n()).done;){var t=_slicedToArray(r.value,2),u=t[0],v=t[1];v.pause(!!a)}}catch(a){s.e(a)}finally{s.f()}for(var x in this.tags){if(Array.isArray(this.tags[x])){for(var w in this.tags[x])this.tags[x][w].pause(!!a);continue}this.tags[x].pause(!!a)}}},{key:"render",value:function render(){var a,c=this,d=0<arguments.length&&void 0!==arguments[0]?arguments[0]:null,e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:null;if(d instanceof b&&(d=d.firstNode.parentNode),e instanceof b&&(e=e.firstNode),this.firstNode)return this.reRender(d,e);this.dispatchEvent(new CustomEvent("render"));var f=this.template instanceof DocumentFragment?this.template.cloneNode(!0):b.templates.has(this.template),g=f?this.template instanceof DocumentFragment?f:b.templates.get(this.template).cloneNode(!0):document.createRange().createContextualFragment(this.template);if(f||this.template instanceof DocumentFragment||b.templates.set(this.template,g.cloneNode(!0)),this.mainView||this.preRuleSet.apply(g,this),this.mapTags(g),this.mainView||this.ruleSet.apply(g,this),!0===window.devMode?(this.firstNode=document.createComment("Template ".concat(this._id," Start")),this.lastNode=document.createComment("Template ".concat(this._id," End"))):(this.firstNode=document.createTextNode(""),this.lastNode=document.createTextNode("")),(a=this.nodes).push.apply(a,[this.firstNode].concat(_toConsumableArray(Array.from(g.childNodes)),[this.lastNode])),this.postRender(d),this.dispatchEvent(new CustomEvent("rendered")),!!this.dispatchAttach()){if(d){var h=d.getRootNode(),i="internal",j=!1;if(h.isConnected&&(i="external",j=!0),e?(d.insertBefore(this.firstNode,e),d.insertBefore(this.lastNode,e)):(d.appendChild(this.firstNode),d.appendChild(this.lastNode)),d.insertBefore(g,this.lastNode),moveIndex++,j)this.attached(h,d),this.dispatchAttached(h,d);else{var k=function(a){a.target.isConnected&&(c.attached(h,d),c.dispatchAttached(h,d),d.removeEventListener("cvDomAttached",k))};d.addEventListener("cvDomAttached",k)}}return this.renderComplete(this.nodes),this.nodes}}},{key:"dispatchAttach",value:function dispatchAttach(){return this.dispatchEvent(new CustomEvent("attach",{cancelable:!0,target:this}))}},{key:"dispatchAttached",value:function dispatchAttached(a,b){var c=2<arguments.length&&void 0!==arguments[2]?arguments[2]:void 0;this.dispatchEvent(new CustomEvent("attached",{detail:{view:c||this,node:b,root:a,mainView:this}}));var d=this.nodesAttached.items();for(var e in d)d[e](a,b);this.dispatchDomAttached(c)}},{key:"dispatchDomAttached",value:function dispatchDomAttached(a){var b=this;this.nodes.filter(function(a){return a.nodeType!==Node.COMMENT_NODE}).forEach(function(c){c.matches&&(_Dom.Dom.mapTags(c,!1,function(c){c.matches&&c.dispatchEvent(new CustomEvent("cvDomAttached",{target:c,detail:{view:a||b,mainView:b}}))}),c.dispatchEvent(new CustomEvent("cvDomAttached",{target:c,detail:{view:a||b,mainView:b}})))})}},{key:"reRender",value:function reRender(a,b){var c=this.dispatchEvent(new CustomEvent("reRender"),{cancelable:!0,target:this});if(c){var d=new DocumentFragment;if(this.firstNode.isConnected){var e=this.nodesDetached.items();for(var f in e)e[f]()}if(d.append.apply(d,_toConsumableArray(this.nodes)),a){b?(a.insertBefore(this.firstNode,b),a.insertBefore(this.lastNode,b)):(a.appendChild(this.firstNode),a.appendChild(this.lastNode)),a.insertBefore(d,this.lastNode),this.dispatchEvent(new CustomEvent("reRendered"),{cancelable:!0,target:this});var g=a.getRootNode();g.isConnected&&(this.attached(g,a),this.dispatchAttached(g,a))}return this.nodes}}},{key:"mapTags",value:function mapTags(a){var b=this;_Dom.Dom.mapTags(a,!1,function(a,c){a[dontParse]||(a.matches?(a=b.mapInterpolatableTag(a),a=a.matches("[cv-template]")&&b.mapTemplateTag(a)||a,a=a.matches("[cv-slot]")&&b.mapSlotTag(a)||a,a=a.matches("[cv-prerender]")&&b.mapPrendererTag(a)||a,a=a.matches("[cv-link]")&&b.mapLinkTag(a)||a,a=a.matches("[cv-attr]")&&b.mapAttrTag(a)||a,a=a.matches("[cv-expand]")&&b.mapExpandableTag(a)||a,a=a.matches("[cv-ref]")&&b.mapRefTag(a)||a,a=a.matches("[cv-on]")&&b.mapOnTag(a)||a,a=a.matches("[cv-each]")&&b.mapEachTag(a)||a,a=a.matches("[cv-bind]")&&b.mapBindTag(a)||a,a=a.matches("[cv-with]")&&b.mapWithTag(a)||a,a=a.matches("[cv-if]")&&b.mapIfTag(a)||a,a=a.matches("[cv-view]")&&b.mapViewTag(a)||a):a=b.mapInterpolatableTag(a),a!==c.currentNode&&(c.currentNode=a))})}},{key:"mapExpandableTag",value:function mapExpandableTag(a){var b=a[expandBind];b&&(b(),a[expandBind]=!1);var c=_Bindable.Bindable.resolve(this.args,a.getAttribute("cv-expand"),!0),d=_slicedToArray(c,2),e=d[0],f=d[1];return a.removeAttribute("cv-expand"),e[f]||(e[f]={}),e[f]=_Bindable.Bindable.make(e[f]),this.onRemove(a[expandBind]=e[f].bindTo(function(b,c,e,f){return f||void 0===b?void a.removeAttribute(c,b):null===b?void a.setAttribute(c,""):void a.setAttribute(c,b)})),a}},{key:"compileExpandableTag",value:function compileExpandableTag(a){return function(b){var c=a.cloneNode(!0),d=c.getAttribute("cv-expand"),e=_Bindable.Bindable.make(b.args[d]||{});c.removeAttribute("cv-expand");var f=function(a){if("name"===a||"type"===a)return"continue";var d=e.bindTo(a,function(a,b){return function(c){a.setAttribute(b,c)}}(c,a));b.onRemove(function(){d(),e.isBound()&&_Bindable.Bindable.clearBindings(e)})};for(var h in e){var g=f(h)}return c}}},{key:"mapAttrTag",value:function mapAttrTag(a){var b=this.compileAttrTag(a),c=b(this);return a.replaceWith(c),c}},{key:"compileAttrTag",value:function compileAttrTag(a){var b=a.getAttribute("cv-attr"),c=b.split(","),d=c.map(function(a){return a.split(":")});return a.removeAttribute("cv-attr"),function(b){var c=a.cloneNode(!0),e=function(a){var e=d[a][1]||d[a][0],f=_Bindable.Bindable.resolve(b.args,e,!0),g=_slicedToArray(f,2),h=g[0],i=g[1],j=d[a][0];b.onRemove(h.bindTo(i,function(a,b,e,f){return f||void 0===a?void c.removeAttribute(j,a):null===a?void c.setAttribute(j,""):void c.setAttribute(j,a)}))};for(var f in d)e(f);return c}}},{key:"mapInterpolatableTag",value:function mapInterpolatableTag(a){var c=this,d=this.interpolateRegex;if(a.nodeType===Node.TEXT_NODE){var o=a.nodeValue;if(!this.interpolatable(o))return a;for(var e,f,g=0,h=function(){var d=e[2],f=!1,h=!1,i=d.split("|"),j=!1;if(1<i.length&&(j=c.stringTransformer(i.slice(1)),d=i[0]),"$$"===d.substr(0,2)&&(f=!0,h=!0,d=d.substr(2)),"$"===d.substr(0,1)&&(f=!0,d=d.substr(1)),"000"===d.substr(0,3))return expand=!0,d=d.substr(3),"continue";var k=o.substring(g,e.index);g=e.index+e[1].length;var l=document.createTextNode(k);l[dontParse]=!0,a.parentNode.insertBefore(l,a);var m;m=f?document.createElement("div"):document.createTextNode(""),m[dontParse]=!0;var n=c.args,p=d;if(d.match(/\./)){var q=_Bindable.Bindable.resolve(c.args,d,!0),r=_slicedToArray(q,2);n=r[0],p=r[1]}if(a.parentNode.insertBefore(m,a),"object"!==_typeof(n))return"break";n=_Bindable.Bindable.make(n);var s=n.bindTo(p,function(d,e,g){if(g[e]!==d&&(g[e]instanceof b||g[e]instanceof Node||g[e]instanceof _Tag.Tag)&&!g[e].preserve&&g[e].remove(),m.nodeValue="",h&&!(d instanceof b)){var i=d;d=new b(c.args,c),d.template=i}if(j&&(d=j(d)),d instanceof b){var k=function(){d.dispatchDomAttached(c)};c.nodesAttached.add(k),d.render(a.parentNode,m);var l=function(){d.preserve||d.remove()};c.onRemove(l),d.onRemove(function(){c.nodesAttached.remove(k),c._onRemove.remove(l)})}else d instanceof Node?(a.parentNode.insertBefore(d,m),c.onRemove(function(){return d.remove()})):d instanceof _Tag.Tag?(a.parentNode.insertBefore(d.node,m),c.onRemove(function(){return d.remove()})):(d instanceof Object&&d.__toString instanceof Function&&(d=d.__toString()),f?m.innerHTML=d:m.nodeValue=d);m[dontParse]=!0});c.onRemove(s)};(e=d.exec(o))&&(f=h(),"continue"===f||"break"!==f););var j=o.substring(g),k=document.createTextNode(j);k[dontParse]=!0,a.parentNode.insertBefore(k,a),a.nodeValue=""}else if(a.nodeType===Node.ELEMENT_NODE)for(var l,m=function(b){if(!c.interpolatable(a.attributes[b].value))return"continue";for(var e=0,f=void 0,g=a.attributes[b].value,h=a.attributes[b],i={},l=[];f=d.exec(g);)l.push(g.substring(e,f.index)),i[f[2]]||(i[f[2]]=[]),i[f[2]].push(l.length),l.push(f[1]),e=f.index+f[1].length;l.push(g.substring(e));var m=function(b){var d=c.args,e=b,f=b.split("|"),g=!1,j=b;if(1<f.length&&(g=c.stringTransformer(f.slice(1)),e=f[0]),e.match(/\./)){var k=_Bindable.Bindable.resolve(c.args,e,!0),m=_slicedToArray(k,2);d=m[0],e=m[1]}i[j];c.onRemove(d.bindTo(e,function(b,d,f){for(var k in g&&(b=g(b)),i)for(var m in i[j])l[i[j][m]]=f[k],d===e&&(l[i[j][m]]=b);c.paused?c.unpauseCallbacks.set(h,function(){return a.setAttribute(h.name,l.join(""))}):a.setAttribute(h.name,l.join(""))})),c.onRemove(function(){d.isBound()||_Bindable.Bindable.clearBindings(d)})};for(var n in i)m(n)},n=0;n<a.attributes.length;n++)l=m(n),"continue"===l;return a}},{key:"mapRefTag",value:function mapRefTag(a){var b=a.getAttribute("cv-ref"),c=b.split(":"),d=_slicedToArray(c,3),e=d[0],f=d[1],g=void 0===f?null:f,h=d[2],i=void 0===h?null:h,j=_Tag.Tag;g&&(j=this.stringToClass(g)),a.removeAttribute("cv-ref"),Object.defineProperty(a,"___tag___",{enumerable:!1,writable:!0}),this.onRemove(function(){a.___tag___=null,a.remove()});var k=this,l=this;this.viewList&&(k=this.viewList.parent);var m=new j(a,this,e,void 0,l);for(a.___tag___=m,this.tags[e]=m;k;){!k.parent;var n=this.args[i];void 0===n?k.tags[e]=m:(!k.tags[e]&&(k.tags[e]=[]),k.tags[e][n]=m),k=k.parent}return a}},{key:"mapBindTag",value:function mapBindTag(a){var c=this,d=a.getAttribute("cv-bind"),e=this.args,f=d,g=null;if(d.match(/\./)){var h=_Bindable.Bindable.resolve(this.args,d,!0),i=_slicedToArray(h,3);e=i[0],f=i[1],g=i[2]}e!==this.args&&(this.subBindings[d]=this.subBindings[d]||[],this.onRemove(this.args.bindTo(g,function(){for(;c.subBindings.length;)c.subBindings.shift()()})));var j=!1;"$"===f.substr(0,1)&&(f=f.substr(1),j=!0);var k=e.bindTo(f,function(e,f,g,h,d){(d instanceof b||d instanceof Node||d instanceof _Tag.Tag)&&d!==e&&d.remove();var i=new CustomEvent("cvAutoChanged",{bubbles:!0});if(["INPUT","SELECT","TEXTAREA"].includes(a.tagName)){var q=a.getAttribute("type");if(q&&"checkbox"===q.toLowerCase())a.checked=!!e,a.dispatchEvent(i);else if(q&&"radio"===q.toLowerCase())a.checked=e==a.value,a.dispatchEvent(i);else if("file"!==q){if("SELECT"===a.tagName){var r=function(){for(var b,c=0;c<a.options.length;c++)b=a.options[c],b.value==e&&(a.selectedIndex=c)};r(),c.nodesAttached.add(r)}else a.value=null==e?"":e;a.dispatchEvent(i)}}else if(e instanceof b){var k,l=_createForOfIteratorHelper(a.childNodes);try{for(l.s();!(k=l.n()).done;){var s=k.value;s.remove()}}catch(a){l.e(a)}finally{l.f()}var t=function(){e.dispatchDomAttached(c)};c.nodesAttached.add(t),e.render(a),e.onRemove(function(){return c.nodesAttached.remove(t)})}else if(e instanceof Node)a.insert(e);else if(e instanceof _Tag.Tag)a.append(e.node);else if(j){if(a.innerHTML!==e){if(e+="",a.innerHTML===e.substring(0,a.innerHTML.length))a.innerHTML+=e.substring(a.innerHTML.length);else{var m,n=_createForOfIteratorHelper(a.childNodes);try{for(n.s();!(m=n.n()).done;){var u=m.value;u.remove()}}catch(a){n.e(a)}finally{n.f()}a.innerHTML=e}_Dom.Dom.mapTags(a,!1,function(a){return a[dontParse]=!0})}}else if(a.textContent!==e){var o,p=_createForOfIteratorHelper(a.childNodes);try{for(p.s();!(o=p.n()).done;){var w=o.value;w.remove()}}catch(a){p.e(a)}finally{p.f()}a.textContent=e}});e!==this.args&&this.subBindings[d].push(k),this.onRemove(k);var l=a.getAttribute("type"),m=a.getAttribute("multiple"),n=function(b){if(b.target===a)if(l&&"checkbox"===l.toLowerCase())e[f]=!!a.checked&&b.target.getAttribute("value");else if(b.target.matches("[contenteditable=true]"))e[f]=b.target.innerHTML;else if("file"===l&&m){var c=Array.from(b.target.files),d=e[f]||_Bindable.Bindable.onDeck(e,f);if(!d||!c.length)e[f]=c;else{var g=function(a){if(c[a]!==d[a])return c[a].toJSON=function(){return{name:file[a].name,size:file[a].size,type:file[a].type,date:file[a].lastModified}},d[a]=c[a],"break"};for(var j in c){var h=g(j);if("break"===h)break}}}else if("file"===l&&!m&&b.target.files.length){var i=b.target.files.item(0);i.toJSON=function(){return{name:i.name,size:i.size,type:i.type,date:i.lastModified}},e[f]=i}else e[f]=b.target.value};return"file"===l||"radio"===l?a.addEventListener("change",n):(a.addEventListener("input",n),a.addEventListener("change",n),a.addEventListener("value-changed",n)),this.onRemove(function(){"file"===l||"radio"===l?a.removeEventListener("change",n):(a.removeEventListener("input",n),a.removeEventListener("change",n),a.removeEventListener("value-changed",n))}),a.removeAttribute("cv-bind"),a}},{key:"mapOnTag",value:function mapOnTag(a){var b=this,c=a.getAttribute("cv-on")+"";return c.split(";").map(function(b){return b.split(":")}).forEach(function(c){c=c.map(function(b){return b.trim()});var d=c.length,e=(c.shift()+"").trim(),f=((c.shift()||e)+"").trim(),g=((c.shift()||"")+"").trim(),h=[],i=/(\w+)(?:\(([$\w\s-'",]+)\))?/.exec(f);i?(f=i[1].replace(/(^[\s\n]+|[\s\n]+$)/,""),i[2]&&(h=i[2].split(",").map(function(a){return a.trim()})),i.length):h.push("$event"),e&&1!==d||(e=f);for(var j,k=b;k;){if("function"==typeof k[f]){var l=function(){var a=k,b=f;return j=function(){a[b].apply(a,arguments)},"break"}();if("break"===l)break}if(k.parent)k=k.parent;else break}var m=function(c){var d=h.map(function(d){var e;return+d==d?d:"event"===d||"$event"===d?c:"$view"===d?k:"$tag"===d?a:"$parent"===d?b.parent:"$subview"===d?b:d in b.args?b.args[d]:(e=/^['"]([\w-]+?)["']$/.exec(d))?e[1]:void 0});if("function"!=typeof j)throw new Error("".concat(f," is not defined on View object.")+"\nTag:\n"+"".concat(a.outerHTML));j.apply(void 0,_toConsumableArray(d))},n={};switch(g.includes("p")?n.passive=!0:g.includes("P")&&(n.passive=!1),g.includes("c")?n.capture=!0:g.includes("C")&&(n.capture=!1),g.includes("o")?n.once=!0:g.includes("O")&&(n.once=!1),e){case"_init":m();break;case"_attach":b.nodesAttached.add(m);break;case"_detach":b.nodesDetached.add(m);break;default:a.addEventListener(e,m,n),b.onRemove(function(){a.removeEventListener(e,m,n)});}return[e,f,h]}),a.removeAttribute("cv-on"),a}},{key:"mapLinkTag",value:function mapLinkTag(a){var b=a.getAttribute("cv-link");a.setAttribute("href",b);var c=function(c){return c.preventDefault(),"http"===b.substring(0,4)||"//"===b.substring(0,2)?void window.open(a.getAttribute("href",b)):void _Router.Router.go(a.getAttribute("href"))};return a.addEventListener("click",c),this.onRemove(function(a,b){return function(){a.removeEventListener("click",b),a=void 0,b=void 0}}(a,c)),a.removeAttribute("cv-link"),a}},{key:"compileLinkTag",value:function compileLinkTag(a){var b=a.getAttribute("cv-link");return a.removeAttribute("cv-link"),function(){var c=a.cloneNode(!0);return c.setAttribute("href",b),c}}},{key:"mapPrendererTag",value:function mapPrendererTag(a){var b=a.getAttribute("cv-prerender"),c=window.prerenderer||navigator.userAgent.match(/prerender/i);return c&&(window.prerenderer=window.prerenderer||!0),("never"===b&&c||"only"===b&&!c)&&a.parentNode.removeChild(a),a}},{key:"mapWithTag",value:function mapWithTag(a){var c=this,d=a.getAttribute("cv-with"),e=a.getAttribute("cv-carry"),f=a.getAttribute("cv-view");a.removeAttribute("cv-with"),a.removeAttribute("cv-carry"),a.removeAttribute("cv-view");var g=f?this.stringToClass(f):b,h=new DocumentFragment;_toConsumableArray(a.childNodes).forEach(function(a){return h.appendChild(a)});var j=[];e&&(j=e.split(",").map(function(a){return a.trim()}));var k=this.args.bindTo(d,function(b){for(c.withViews.has(a)&&c.withViews["delete"](a);a.firstChild;)a.removeChild(a.firstChild);var d=new g({},c);c.onRemove(function(a){return function(){a.remove()}}(d)),d.template=h;var e=function(a){var b=c.args.bindTo(j[a],function(a,b){d.args[b]=a});d.onRemove(b),c.onRemove(function(){b(),d.remove()})};for(var l in j)e(l);var f=function(a){if("object"!==_typeof(b))return"continue";b=_Bindable.Bindable.make(b);var e=b.bindTo(a,function(a,b){d.args[b]=a}),f=d.args.bindTo(a,function(a,c){b[c]=a});c.onRemove(function(){e(),b.isBound()||_Bindable.Bindable.clearBindings(b),d.remove()}),d.onRemove(function(){e(),b.isBound()||_Bindable.Bindable.clearBindings(b)})};for(var i in b){var k=f(i)}d.render(a),c.withViews.set(a,d)});return this.onRemove(function(){c.withViews["delete"](a),k()}),a}},{key:"mapViewTag",value:function mapViewTag(a){var c=this,d=a.getAttribute("cv-view");a.removeAttribute("cv-view");var e=new DocumentFragment;_toConsumableArray(a.childNodes).forEach(function(a){return e.appendChild(a)});var f=d.split(":"),g=f.pop()?this.stringToClass(d):b,h=f.shift(),i=new g(this.args,this);return this.views.set(a,i),h&&this.views.set(h,i),this.onRemove(function(b){return function(){b.remove(),c.views["delete"](a),c.views["delete"](h)}}(i)),i.template=e,i.render(a),a}},{key:"mapEachTag",value:function mapEachTag(a){var c=this,d=a.getAttribute("cv-each"),e=a.getAttribute("cv-view");a.removeAttribute("cv-each"),a.removeAttribute("cv-view");var f=e?this.stringToClass(e):b,g=new DocumentFragment;_toConsumableArray(a.childNodes).forEach(function(a){return g.appendChild(a)});var h=d.split(":"),i=_slicedToArray(h,3),j=i[0],k=i[1],l=i[2],m=this.args.bindTo(j,function(b){c.viewLists.has(a)&&c.viewLists.get(a).remove();var e=new _ViewList.ViewList(g,k,b,c,l,f),h=function(){return e.remove()};c.onRemove(h),e.onRemove(function(){return c._onRemove.remove(h)});var i=c.args.bindTo(function(a,b,c,f){"_id"===b||(f&&delete e.subArgs[b],e.subArgs[b]=a)}),j=e.args.bindTo(function(a,b,e,f){"_id"===b||"value"===b||"___"===b.substring(0,3)||(f&&delete c.args[b],b in c.args&&(c.args[b]=a))});for(e.onRemove(i),e.onRemove(j),c.onRemove(i),c.onRemove(j);a.firstChild;)a.removeChild(a.firstChild);c.viewLists.set(a,e),e.render(a)});return this.onRemove(m),a}},{key:"mapIfTag",value:function mapIfTag(a){var c=this,d=a,e=d.getAttribute("cv-view"),f=d.getAttribute("cv-if"),g=d.getAttribute("cv-is"),h=!1,i=!1;d.removeAttribute("cv-view"),d.removeAttribute("cv-if"),d.removeAttribute("cv-is");var j=e?this.stringToClass(e):b;"!"===f.substr(0,1)&&(f=f.substr(1),h=!0),"?"===f.substr(0,1)&&(f=f.substr(1),i=!0);var k=new DocumentFragment;_toConsumableArray(d.childNodes).forEach(function(a){return k.appendChild(a)});var l=this,m=new DocumentFragment,n=new j(this.args,l);this.onRemove(n.tags.bindTo(function(a,b){c.tags[b]=a})),n.template=k;var o=l.args,p=f;if(f.match(/\./)){var q=_Bindable.Bindable.resolve(l.args,f,!0),r=_slicedToArray(q,2);o=r[0],p=r[1]}n.render(m);var s=o.bindTo(p,function(b){var d=b;i&&(b=null!==b&&void 0!==b),Array.isArray(b)&&(b=!!b.length),null!==g&&(b=d==g),h&&(b=!b),b?(a.appendChild(m),_toConsumableArray(m.childNodes).forEach(function(a){return _Dom.Dom.mapTags(a,!1,function(a){a.matches&&a.dispatchEvent(new CustomEvent("cvDomAttached",{target:a,detail:{view:n||c,mainView:c}}))})})):(n.nodes.forEach(function(a){return m.appendChild(a)}),_Dom.Dom.mapTags(m,!1,function(a){if(a.matches){var b=globalThis.requestIdleCallback;b(function(){return a.dispatchEvent(new CustomEvent("cvDomDetached",{target:a,detail:{view:n||c,mainView:c}}))})}}))},{children:Array.isArray(o[p])});l.onRemove(s);var t=function(){o.isBound()||_Bindable.Bindable.clearBindings(o)};return l.onRemove(function viewDebind(){s(),t(),l._onRemove.remove(s),l._onRemove.remove(t)}),this.onRemove(function(){n.remove(),l!==c&&l.remove()}),a}},{key:"compileIfTag",value:function compileIfTag(a){var c=a.getAttribute("cv-if"),d=!1;a.removeAttribute("cv-if"),"!"===c.substr(0,1)&&(c=c.substr(1),d=!0);var e=new DocumentFragment;return _toConsumableArray(a.childNodes).forEach(function(a){return e.appendChild(a.cloneNode(!0))}),function(f){var g=a.cloneNode(),h=new DocumentFragment,i=new b({},f);i.template=e,f.syncBind(i);var j=f.args,k=c;if(c.match(/\./)){var l=_Bindable.Bindable.resolve(f.args,c,!0),m=_slicedToArray(l,2);j=m[0],k=m[1]}var n=!1,o=j.bindTo(k,function(a){if(!n){var b=f.args[k]||d?g:h;return i.render(b),void(n=!0)}Array.isArray(a)&&(a=!!a.length),d&&(a=!a),a?g.appendChild(h):i.nodes.forEach(function(a){return h.appendChild(a)})});f.onRemove(o);var p=function(){j.isBound()||_Bindable.Bindable.clearBindings(j)};return i.onRemove(function viewDebind(){o(),p(),f._onRemove.remove(o),f._onRemove.remove(p)}),g}}},{key:"mapTemplateTag",value:function mapTemplateTag(a){var b=a.getAttribute("cv-template");return a.removeAttribute("cv-template"),this.templates[b]=function(){return"TEMPLATE"===a.tagName?a.content.cloneNode(!0):new DocumentFragment(a.innerHTML)},this.rendered.then(function(){return a.remove()}),a}},{key:"mapSlotTag",value:function mapSlotTag(a){var b=a.getAttribute("cv-slot"),c=this.templates[b];if(!c){for(var e=this;e&&(c=e.templates[b],!c);)e=this.parent;if(!c)return void console.error("Template ".concat(b," not found."))}var d=c();for(a.removeAttribute("cv-slot");a.firstChild;)a.firstChild.remove();return a.appendChild(d),a}},{key:"syncBind",value:function syncBind(a){var c=this,d=this.args.bindTo(function(b,c){"_id"===c||a.args[c]!==b&&(a.args[c]=b)}),e=a.args.bindTo(function(a,e,f,g,d){if("_id"!==e){var h=a,i=d;h instanceof b&&(h=h.___ref___),i instanceof b&&(i=i.___ref___),h!==i&&i instanceof b&&d.remove(),e in c.args&&(c.args[e]=a)}});this.onRemove(d),this.onRemove(e),a.onRemove(function(){c._onRemove.remove(d),c._onRemove.remove(e)})}},{key:"postRender",value:function postRender(){}},{key:"attached",value:function attached(){}},{key:"interpolatable",value:function interpolatable(a){return!!(a+"").match(this.interpolateRegex)}},{key:"remove",value:function remove(){var a=this,b=!!(0<arguments.length&&void 0!==arguments[0])&&arguments[0],c=function(){for(var b in a.tags)Array.isArray(a.tags[b])?(a.tags[b]&&a.tags[b].forEach(function(a){return a.remove()}),a.tags[b].splice(0)):(a.tags[b]&&a.tags[b].remove(),a.tags[b]=void 0);for(var c in a.nodes)a.nodes[c]&&a.nodes[c].dispatchEvent(new Event("cvDomDetached")),a.nodes[c]&&a.nodes[c].remove(),a.nodes[c]=void 0;a.nodes.splice(0),a.firstNode=a.lastNode=void 0};b?c():requestAnimationFrame(c);var d,e=this._onRemove.items(),f=_createForOfIteratorHelper(e);try{for(f.s();!(d=f.n()).done;){var s=d.value;this._onRemove.remove(s),s()}}catch(a){f.e(a)}finally{f.f()}for(var t;t=this.cleanup.shift();)t&&t();var g,h=_createForOfIteratorHelper(this.viewLists);try{for(h.s();!(g=h.n()).done;){var j=_slicedToArray(g.value,2),k=j[0],l=j[1];l.remove()}}catch(a){h.e(a)}finally{h.f()}this.viewLists.clear();var m,n=_createForOfIteratorHelper(this.timeouts);try{for(n.s();!(m=n.n()).done;){var o=_slicedToArray(m.value,2),p=o[0],q=o[1];clearTimeout(q.timeout),this.timeouts["delete"](q.timeout)}}catch(a){n.e(a)}finally{n.f()}for(var r in this.intervals)clearInterval(this.intervals[r].timeout),delete this.intervals[r];for(var r in this.frames)this.frames[r](),delete this.frames[r];this.preRuleSet.purge(),this.ruleSet.purge(),this.removed=!0}},{key:"findTag",value:function findTag(a){for(var b in this.nodes){var c=void 0;if(this.nodes[b].querySelector){if(this.nodes[b].matches(a))return new _Tag.Tag(this.nodes[b],this,void 0,void 0,this);if(c=this.nodes[b].querySelector(a))return new _Tag.Tag(c,this,void 0,void 0,this)}}}},{key:"findTags",value:function findTags(a){var b=this;return this.nodes.filter(function(a){return a.querySelectorAll}).map(function(b){return _toConsumableArray(b.querySelectorAll(a))}).flat().map(function(a){return new _Tag.Tag(a,b,void 0,void 0,b)})||[]}},{key:"onRemove",value:function onRemove(a){this._onRemove.add(a)}},{key:"update",value:function update(){}},{key:"beforeUpdate",value:function beforeUpdate(){}},{key:"afterUpdate",value:function afterUpdate(){}},{key:"stringTransformer",value:function stringTransformer(a){var b=this;return function(c){for(var f in a){for(var d=b,e=a[f];d&&!d[e];)d=d.parent;if(!d)return;c=d[a[f]](c)}return c}}},{key:"stringToClass",value:function stringToClass(a){if(b.refClasses.has(a))return b.refClasses.get(a);var c=a.split("/"),d=c[c.length-1],e=require(a);return b.refClasses.set(a,e[d]),e[d]}},{key:"preventParsing",value:function preventParsing(a){a[dontParse]=!0}},{key:"toString",value:function toString(){return this.nodes.map(function(a){return a.outerHTML}).join(" ")}},{key:"listen",value:function listen(a,c,d,e){var f=this;if("string"==typeof a&&(e=d,d=c,c=a,a=this),a instanceof b)return this.listen(a.nodes,c,d,e);if(Array.isArray(a))return a.map(function(a){return f.listen(a,c,d,e)}).forEach(function(a){return a()});if(a instanceof _Tag.Tag)return this.listen(a.element,c,d,e);a.addEventListener(c,d,e);var g=function(){return a.removeEventListener(c,d,e)},h=function(){g(),g=function(){}};return this.onRemove(function(){return h()}),h}},{key:"detach",value:function detach(){for(var a in this.nodes)this.nodes[a].remove();return this.nodes}}],[{key:"from",value:function from(a){var b=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},c=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null,d=new this(b,c);return d.template=a,d}},{key:"isView",value:function isView(){return b}},{key:"uuid",value:function(){return"10000000-1000-4000-8000-100000000000".replace(/[018]/g,function(a){return(a^crypto.getRandomValues(new Uint8Array(1))[0]&15>>a/4).toString(16)})}}]),b}(_Mixin.Mixin["with"](_EventTargetMixin.EventTargetMixin));exports.View=View,Object.defineProperty(View,"templates",{value:new Map}),Object.defineProperty(View,"refClasses",{value:new Map});
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.ViewList=void 0;var _Bindable=require("./Bindable"),_SetMap=require("./SetMap"),_View=require("./View"),_Bag=require("./Bag");function _createForOfIteratorHelper(a,b){var c="undefined"!=typeof Symbol&&a[Symbol.iterator]||a["@@iterator"];if(!c){if(Array.isArray(a)||(c=_unsupportedIterableToArray(a))||b&&a&&"number"==typeof a.length){c&&(a=c);var d=0,e=function(){};return{s:e,n:function n(){return d>=a.length?{done:!0}:{done:!1,value:a[d++]}},e:function e(a){throw a},f:e}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var f,g=!0,h=!1;return{s:function s(){c=c.call(a)},n:function n(){var a=c.next();return g=a.done,a},e:function e(a){h=!0,f=a},f:function f(){try{g||null==c["return"]||c["return"]()}finally{if(h)throw f}}}}function _unsupportedIterableToArray(a,b){if(a){if("string"==typeof a)return _arrayLikeToArray(a,b);var c=Object.prototype.toString.call(a).slice(8,-1);return"Object"===c&&a.constructor&&(c=a.constructor.name),"Map"===c||"Set"===c?Array.from(a):"Arguments"===c||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(c)?_arrayLikeToArray(a,b):void 0}}function _arrayLikeToArray(a,b){(null==b||b>a.length)&&(b=a.length);for(var c=0,d=Array(b);c<b;c++)d[c]=a[c];return d}function _typeof(a){"@babel/helpers - typeof";return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(a){return typeof a}:function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a},_typeof(a)}function _classCallCheck(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function _defineProperties(a,b){for(var c,d=0;d<b.length;d++)c=b[d],c.enumerable=c.enumerable||!1,c.configurable=!0,"value"in c&&(c.writable=!0),Object.defineProperty(a,c.key,c)}function _createClass(a,b,c){return b&&_defineProperties(a.prototype,b),c&&_defineProperties(a,c),a}var ViewList=function(){function a(b,c,d,e){var f=this,g=4<arguments.length&&void 0!==arguments[4]?arguments[4]:null,h=5<arguments.length&&void 0!==arguments[5]?arguments[5]:null;_classCallCheck(this,a),this.removed=!1,this.args=_Bindable.Bindable.makeBindable({}),this.args.value=_Bindable.Bindable.makeBindable(d||{}),this.subArgs=_Bindable.Bindable.makeBindable({}),this.views=[],this.cleanup=[],this.viewClass=h||_View.View,this._onRemove=new _Bag.Bag,this.template=b,this.subProperty=c,this.keyProperty=g,this.tag=null,this.downDebind=[],this.upDebind=[],this.paused=!1,this.parent=e,this.rendered=new Promise(function(a){Object.defineProperty(f,"renderComplete",{configurable:!1,writable:!0,value:a})}),this.willReRender=!1,this.args.___before(function(a,b){"bindTo"==b||(f.paused=!0)}),this.args.___after(function(a,b,c){"bindTo"==b||(f.paused=1<c.length,f.reRender())});var i=this.args.value.bindTo(function(a,b,c,e){if(!f.paused){var d=b;if("symbol"!==_typeof(b))if(isNaN(b)&&(d="_"+b),e)for(var g in f.views[d]&&f.views[d].remove(),delete f.views[d],f.views){if(isNaN(g)){f.views[g].args[f.keyProperty]=g.substr(1);continue}f.views[g].args[f.keyProperty]=g}else f.views[d]?f.views[d]&&f.views[d].args&&(f.views[d].args[f.keyProperty]=b,f.views[d].args[f.subProperty]=a):(cancelAnimationFrame(f.willReRender),f.willReRender=requestAnimationFrame(function(){f.reRender()}))}});this._onRemove.add(i)}return _createClass(a,[{key:"render",value:function render(a){var b,c=this,d=[],e=_createForOfIteratorHelper(this.views);try{var f=function(){var c=b.value;c.render(a),d.push(c.rendered.then(function(){return c}))};for(e.s();!(b=e.n()).done;)f()}catch(a){e.e(a)}finally{e.f()}this.tag=a,Promise.all(d).then(function(a){return c.renderComplete(a)}),this.parent.dispatchEvent(new CustomEvent("listRendered",{detail:{detail:{key:this.subProperty,value:this.args.value}}}))}},{key:"reRender",value:function reRender(){var a=this;if(!this.paused&&this.tag){var b=[],c=new _SetMap.SetMap;for(var r in this.views){var d=this.views[r],e=d.args[this.subProperty];c.add(e,d),b[r]=d}var f=[],g=new Set;this.downDebind.length&&this.downDebind.forEach(function(a){return a&&a()}),this.upDebind.length&&this.upDebind.forEach(function(a){return a&&a()}),this.upDebind.length=0,this.downDebind.length=0;var h=1/0,j=1/0,k=function(b){var d=!1,e=b;if(isNaN(e)?e="_"+b:(e+"").length&&(e=+e),void 0!==a.args.value[b]&&c.has(a.args.value[b])){var o=c.getOne(a.args.value[b]);o&&(o.args[a.keyProperty]=b,f[e]=o,g.add(o),d=!0,!isNaN(e)&&(h=Math.min(h,e),0<e&&(j=Math.min(j,e))),c.remove(a.args.value[b],o))}if(!d){var i={},l=f[e]=new a.viewClass(i,a.parent);isNaN(e)||(h=Math.min(h,e),0<e&&(j=Math.min(j,e))),f[e].template=a.template instanceof Object?a.template:a.template,f[e].viewList=a,f[e].args[a.keyProperty]=b,f[e].args[a.subProperty]=a.args.value[b],a.upDebind[e]=i.bindTo(a.subProperty,function(b,c,e,f){var d=i[a.keyProperty];return f?void delete a.args.value[d]:void(a.args.value[d]=b)}),a.downDebind[e]=a.subArgs.bindTo(function(a,b,c,e){return e?void delete i[b]:void(i[b]=a)});var m=function(){a.upDebind.filter(function(a){return a}).forEach(function(a){return a()}),a.upDebind.length=0},n=function(){a.downDebind.filter(function(a){return a}).forEach(function(a){return a()}),a.downDebind.length=0};l.onRemove(function(){a._onRemove.remove(m),a._onRemove.remove(n),a.upDebind[e]&&a.upDebind[e](),a.downDebind[e]&&a.downDebind[e](),delete a.upDebind[e],delete a.downDebind[e]}),a._onRemove.add(m),a._onRemove.add(n),i[a.subProperty]=a.args.value[b]}};for(var i in this.args.value)k(i);for(var s in b)g.has(b[s])||b[s].remove();if(Array.isArray(this.args.value)){var l=0===h&&void 0!==f[1]&&1<f.length||j===1/0?h:j,m=function(){for(var b=0<arguments.length&&void 0!==arguments[0]?arguments[0]:0,c=f.length-b-1;c>l&&void 0===f[c];)c--;return c<l?Promise.resolve():f[c]===a.views[c]?f[c].firstNode?m(+b+1):(f[c].render(a.tag,f[c+1]),f[c].rendered.then(function(){return m(+b+1)})):(f[c].render(a.tag,f[c+1]),a.views.splice(c,0,f[c]),f[c].rendered.then(function(){return m(+b+1)}))};this.rendered=m()}else{var n=[],o=Object.assign({},f),p=function(b){return delete o[b],f[b].firstNode&&f[b]===a.views[b]?"continue":void(f[b].render(a.tag),n.push(f[b].rendered.then(function(){return f[b]})))};for(var t in f){var q=p(t)}for(var u in o)delete this.args.views[u],o.remove();this.rendered=Promise.all(n)}for(var v in f){if(isNaN(v)){f[v].args[this.keyProperty]=v.substr(1);continue}f[v].args[this.keyProperty]=v}this.views=Array.isArray(this.args.value)?[].concat(f):f,g.clear(),this.willReRender=!1,this.parent.dispatchEvent(new CustomEvent("listRendered",{detail:{detail:{key:this.subProperty,value:this.args.value}}}))}}},{key:"pause",value:function pause(){var a=!(0<arguments.length&&void 0!==arguments[0])||arguments[0];for(var b in this.views)this.views[b].pause(a)}},{key:"onRemove",value:function onRemove(a){this._onRemove.add(a)}},{key:"remove",value:function remove(){for(var b in this.views)this.views[b].remove();var a=this._onRemove.items();for(var c in a)this._onRemove.remove(a[c]),a[c]();for(var d;this.cleanup.length;)d=this.cleanup.pop(),d();for(this.views=[];this.tag&&this.tag.firstChild;)this.tag.removeChild(this.tag.firstChild);this.subArgs&&_Bindable.Bindable.clearBindings(this.subArgs),_Bindable.Bindable.clearBindings(this.args),this.args.value&&!this.args.value.isBound()&&_Bindable.Bindable.clearBindings(this.args.value),this.removed=!0}}]),a}();exports.ViewList=ViewList;
