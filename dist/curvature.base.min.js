"use strict";var _Bindable=require("./Bindable");Object.defineProperty(exports,"__esModule",{value:!0}),exports.Bag=void 0;function _classCallCheck(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function _defineProperties(a,b){for(var c,d=0;d<b.length;d++)c=b[d],c.enumerable=c.enumerable||!1,c.configurable=!0,"value"in c&&(c.writable=!0),Object.defineProperty(a,c.key,c)}function _createClass(a,b,c){return b&&_defineProperties(a.prototype,b),c&&_defineProperties(a,c),a}var toId=function(a){return(+a).toString(36)},fromId=function(a){return parseInt(a,36)},Bag=function(){function a(){var b=0<arguments.length&&void 0!==arguments[0]?arguments[0]:void 0;_classCallCheck(this,a),this.meta=Symbol("meta"),this.content=new Map,this.list=_Bindable.Bindable.makeBindable({}),this.current=0,this.type=void 0,this.changeCallback=b}return _createClass(a,[{key:"add",value:function add(b){if(void 0===b||!(b instanceof Object))throw new Error("Only objects may be added to Bags.");if(this.type&&!(b instanceof this.type))throw console.error(this.type,b),new Error("Only objects of type ".concat(this.type," may be added to this Bag."));if(!this.content.has(b)){var c=toId(this.current++);this.content.set(b,c),this.list[c]=b,this.changeCallback&&this.changeCallback(b,this.meta,a.ITEM_ADDED,c)}}},{key:"remove",value:function remove(b){if(void 0===b||!(b instanceof Object))throw new Error("Only objects may be removed from Bags.");if(this.type&&!(b instanceof this.type))throw console.error(this.type,b),new Error("Only objects of type ".concat(this.type," may be removed from this Bag."));if(!this.content.has(b))return this.changeCallback&&this.changeCallback(b,this.meta,0,void 0),!1;var c=this.content.get(b);return delete this.list[c],this.content["delete"](b),this.changeCallback&&this.changeCallback(b,this.meta,a.ITEM_REMOVED,c),b}},{key:"items",value:function items(){return Array.from(this.content.entries()).map(function(a){return a[0]})}}]),a}();exports.Bag=Bag,Object.defineProperty(Bag,"ITEM_ADDED",{configurable:!1,enumerable:!1,writable:!0,value:1}),Object.defineProperty(Bag,"ITEM_REMOVED",{configurable:!1,enumerable:!1,writable:!0,value:-1});
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.Bindable=void 0;function _toConsumableArray(a){return _arrayWithoutHoles(a)||_iterableToArray(a)||_unsupportedIterableToArray(a)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(a,b){if(a){if("string"==typeof a)return _arrayLikeToArray(a,b);var c=Object.prototype.toString.call(a).slice(8,-1);return"Object"===c&&a.constructor&&(c=a.constructor.name),"Map"===c||"Set"===c?Array.from(a):"Arguments"===c||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(c)?_arrayLikeToArray(a,b):void 0}}function _iterableToArray(a){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(a))return Array.from(a)}function _arrayWithoutHoles(a){if(Array.isArray(a))return _arrayLikeToArray(a)}function _arrayLikeToArray(a,b){(null==b||b>a.length)&&(b=a.length);for(var c=0,d=Array(b);c<b;c++)d[c]=a[c];return d}function _construct(){return _construct=_isNativeReflectConstruct()?Reflect.construct:function(b,c,d){var e=[null];e.push.apply(e,c);var a=Function.bind.apply(b,e),f=new a;return d&&_setPrototypeOf(f,d.prototype),f},_construct.apply(null,arguments)}function _isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(a){return!1}}function _setPrototypeOf(a,b){return _setPrototypeOf=Object.setPrototypeOf||function(a,b){return a.__proto__=b,a},_setPrototypeOf(a,b)}function _typeof(a){"@babel/helpers - typeof";return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(a){return typeof a}:function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a},_typeof(a)}function _classCallCheck(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function _defineProperties(a,b){for(var c,d=0;d<b.length;d++)c=b[d],c.enumerable=c.enumerable||!1,c.configurable=!0,"value"in c&&(c.writable=!0),Object.defineProperty(a,c.key,c)}function _createClass(a,b,c){return b&&_defineProperties(a.prototype,b),c&&_defineProperties(a,c),a}function _defineProperty(a,b,c){return b in a?Object.defineProperty(a,b,{value:c,enumerable:!0,configurable:!0,writable:!0}):a[b]=c,a}var Ref=Symbol("ref"),Original=Symbol("original"),Deck=Symbol("deck"),Binding=Symbol("binding"),SubBinding=Symbol("subBinding"),BindingAll=Symbol("bindingAll"),IsBindable=Symbol("isBindable"),Executing=Symbol("executing"),Stack=Symbol("stack"),ObjSymbol=Symbol("object"),Wrapped=Symbol("wrapped"),GetProto=Symbol("getProto"),OnGet=Symbol("onGet"),OnAllGet=Symbol("onAllGet"),Bindable=function(){function a(){_classCallCheck(this,a)}return _createClass(a,null,[{key:"isBindable",value:function isBindable(b){return!!(b&&b[IsBindable])&&b[IsBindable]===a}},{key:"onDeck",value:function onDeck(a,b){return a[Deck][b]||!1}},{key:"ref",value:function ref(a){return a[Ref]||!1}},{key:"makeBindable",value:function makeBindable(a){return this.make(a)}},{key:"make",value:function make(b){var c=this;if(!b||!["function","object"].includes(_typeof(b)))return b;var d=window||{},e=[d.Node,d.Map,d.Set,d.ResizeObserver,d.MutationObserver,d.PerformanceObserver,d.IntersectionObserver].filter(function(a){return"function"==typeof a});if(e.filter(function(a){return b instanceof a}).length||Object.isSealed(b)||!Object.isExtensible(b))return b;if(b[Ref])return b;if(b[Binding])return b;Object.defineProperty(b,Ref,{configurable:!0,enumerable:!1,writable:!0,value:b}),Object.defineProperty(b,Deck,{configurable:!1,enumerable:!1,writable:!1,value:{}}),Object.defineProperty(b,Binding,{configurable:!1,enumerable:!1,writable:!1,value:{}}),Object.defineProperty(b,SubBinding,{configurable:!1,enumerable:!1,writable:!1,value:new Map}),Object.defineProperty(b,BindingAll,{configurable:!1,enumerable:!1,writable:!1,value:[]}),Object.defineProperty(b,IsBindable,{configurable:!1,enumerable:!1,writable:!1,value:a}),Object.defineProperty(b,Executing,{enumerable:!1,writable:!0}),Object.defineProperty(b,Stack,{configurable:!1,enumerable:!1,writable:!1,value:[]}),Object.defineProperty(b,"___before___",{configurable:!1,enumerable:!1,writable:!1,value:[]}),Object.defineProperty(b,"___after___",{configurable:!1,enumerable:!1,writable:!1,value:[]}),Object.defineProperty(b,Wrapped,{configurable:!1,enumerable:!1,writable:!1,value:{}});var f=function(d){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:null,g=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{},h=!1;if(Array.isArray(d)){var m=d.map(function(a){return f(a,e,g)});return function(){return m.map(function(a){return a()})}}if(d instanceof Function&&(g=e||{},e=d,h=!0),0<=g.delay&&(e=c.wrapDelayCallback(e,g.delay)),0<=g.throttle&&(e=c.wrapThrottleCallback(e,g.throttle)),0<=g.wait&&(e=c.wrapWaitCallback(e,g.wait)),g.frame&&(e=c.wrapFrameCallback(e,g.frame)),g.idle&&(e=c.wrapIdleCallback(e)),h){var n=b[BindingAll].length;if(b[BindingAll].push(e),!("now"in g)||g.now)for(var o in b)e(b[o],o,b,!1);return function(){delete b[BindingAll][n]}}b[Binding][d]||(b[Binding][d]=[]);var j=b[Binding][d].length;if(g.children){var i=e;e=function(){for(var c=arguments.length,d=Array(c),e=0;e<c;e++)d[e]=arguments[e];var f=d[0],h=b[SubBinding].get(i);if(h&&(b[SubBinding]["delete"](i),h()),"object"!==_typeof(f))return void i.apply(void 0,d);var j=a.make(f);a.isBindable(j)&&b[SubBinding].set(i,j.bindTo(function(){for(var a=arguments.length,b=Array(a),c=0;c<a;c++)b[c]=arguments[c];return i.apply(void 0,d.concat(b))},Object.assign({},g,{children:!1}))),i.apply(void 0,d)}}b[Binding][d].push(e),(!("now"in g)||g.now)&&e(b[d],d,b,!1);var k=!1,l=function(){var a=b[SubBinding].get(e);(a&&(b[SubBinding]["delete"](e),a()),!k)&&(k=!0,b[Binding][d]&&delete b[Binding][d][j])};return g.removeWith&&g.removeWith instanceof View&&g.removeWith.onRemove(function(){return l}),l};Object.defineProperty(b,"bindTo",{configurable:!1,enumerable:!1,writable:!1,value:f});Object.defineProperty(b,"bindChain",{configurable:!1,enumerable:!1,writable:!1,value:function value(a,e){var f=a.split("."),g=f.shift(),h=f.slice(0),i=[];return i.push(b.bindTo(g,function(a,b,f,g){var d=h.join(".");return 0===h.length?void e(a,b,f,g):void(void 0===a&&(a=f[b]=c.makeBindable({})),i=i.concat(a.bindChain(d,e)))})),function(){return i.map(function(a){return a()})}}}),Object.defineProperty(b,"___before",{configurable:!1,enumerable:!1,writable:!1,value:function ___before(a){var c=b.___before___.length;b.___before___.push(a);var d=!1;return function(){d||(d=!0,delete b.___before___[c])}}}),Object.defineProperty(b,"___after",{configurable:!1,enumerable:!1,writable:!1,value:function ___after(a){var c=b.___after___.length;b.___after___.push(a);var d=!1;return function(){d||(d=!0,delete b.___after___[c])}}});var g=function(){for(var a in b[BindingAll])if(b[BindingAll][a])return!0;for(var c in b[Binding])for(var d in b[Binding][c])if(b[Binding][c][d])return!0;return!1};for(var n in Object.defineProperty(b,"isBound",{configurable:!1,enumerable:!1,writable:!1,value:g}),b)b[n]&&b[n]instanceof Object&&!b[n]instanceof Node&&!b[n]instanceof Promise&&(b[n]=a.make(b[n]));var h=function(c,d,e){if(void 0!==b[Deck][d]&&b[Deck][d]===e)return!0;if("string"==typeof d&&"___"===d.substring(0,3)&&"___"===d.slice(-3))return!0;if(c[d]===e)return!0;for(var i in e&&e instanceof Object&&!(e instanceof Node)&&!a.isBindable(e)&&(e=a.makeBindable(e)),b[Deck][d]=e,b[BindingAll])b[BindingAll][i]&&b[BindingAll][i](e,d,c,!1);var f=!1;if(d in b[Binding])for(var j in b[Binding][d])b[Binding][d]&&b[Binding][d][j]&&!1===b[Binding][d][j](e,d,c,!1,c[d])&&(f=!0);if(delete b[Deck][d],!f){var g=Object.getOwnPropertyDescriptor(c,d),h=c instanceof File&&"lastModifiedDate"==d;h||g&&!g.writable||c[d]!==e||(c[d]=e)}return Reflect.set(c,d,e)},j=function(a,c){if(!(c in a))return!0;for(var d in b[BindingAll])b[BindingAll][d](void 0,c,a,!0,a[c]);if(c in b[Binding])for(var e in b[Binding][c])b[Binding][c][e]&&b[Binding][c][e](void 0,c,a,!0,a[c]);return delete a[c],!0},k=function(c,d){if(d===Ref||"isBound"===d||"bindTo"===d||"__proto__"===d)return c[d];var e=Object.getOwnPropertyDescriptor(b,d);return!e||e.configurable||e.writable?b[OnAllGet]?b[OnAllGet](d):b[OnGet]&&!(d in b)?b[OnGet](d):c[d]instanceof Function?c[Wrapped][d]?a.make(c[Wrapped][d]):!e||e.configurable||e.writable?(c[Wrapped][d]=function(){c[Executing]=d,c[Stack].unshift(d);for(var a=arguments.length,e=Array(a),f=0;f<a;f++)e[f]=arguments[f];for(var i in c.___before___)c.___before___[i](c,d,c[Stack],b,e);var g=b instanceof Promise||b instanceof EventTarget||b instanceof MutationObserver||b instanceof IntersectionObserver||b instanceof MutationObserver||b instanceof PerformanceObserver||"function"==typeof ResizeObserver&&b instanceof ResizeObserver||b instanceof Map||b instanceof Set?b:b[Ref],h=new.target?_construct(c[d],e):c[d].apply(g||b,e);for(var j in c.___after___)c.___after___[j](c,d,c[Stack],b,e);return c[Executing]=null,c[Stack].shift(),h},c[Wrapped][d]):(c[Wrapped][d]=c[d],c[Wrapped][d]):(c[d]instanceof Object&&!c[d][Ref]&&a.make(c[d]),c[d]):c[d]},l=function(b,c){for(var e in b.___before___)b.___before___[e](b,"constructor",b[Stack],void 0,c);var d=a.make(_construct(b,_toConsumableArray(c)));for(var f in b.___after___)b.___after___[f](b,"constructor",b[Stack],d,c);return d},m=function(a){return GetProto in b?b[GetProto]:Reflect.getPrototypeOf(a)};return Object.defineProperty(b,Ref,{configurable:!1,enumerable:!1,writable:!0,value:b[Ref]}),Object.defineProperty(b,Original,{configurable:!1,enumerable:!1,writable:!1,value:b}),b[Ref]=new Proxy(b,{get:k,set:h,construct:l,getPrototypeOf:m,deleteProperty:j}),b[Ref]}},{key:"clearBindings",value:function clearBindings(a){var b=function maps(a){return function(){for(var b=arguments.length,c=Array(b),d=0;d<b;d++)c[d]=arguments[d];return c.map(a)}}(function clearObj(a){return Object.keys(a).map(function(b){return delete a[b]})});b(a[Wrapped],a[Binding],a[BindingAll],a.___after___,a.___before___)}},{key:"resolve",value:function resolve(a,b){for(var c,d=!!(2<arguments.length&&void 0!==arguments[2])&&arguments[2],e=b.split("."),f=e[0];e.length;){if(d&&1===e.length){var g=this.makeBindable(a);return[g,e.shift(),f]}c=e.shift(),!(!c in a)&&a[c]&&a[c]instanceof Object||(a[c]={}),a=this.makeBindable(a[c])}return[this.makeBindable(a),c,f]}},{key:"wrapDelayCallback",value:function wrapDelayCallback(a,b){return function(c,e,f,g){return setTimeout(function(){return a(c,e,f,g,f[e])},b)}}},{key:"wrapThrottleCallback",value:function wrapThrottleCallback(a,b){var c=this;return this.throttles.set(a,!1),function(a){return function(e,f,g,h){c.throttles.get(a,!0)||(a(e,f,g,h,g[f]),c.throttles.set(a,!0),setTimeout(function(){c.throttles.set(a,!1)},b))}}(a)}},{key:"wrapWaitCallback",value:function wrapWaitCallback(a,b){var c=!1;return function(e,f,g,h){for(var d=arguments.length,i=Array(5<d?d-5:0),j=5;j<d;j++)i[j-5]=arguments[j];c&&(clearTimeout(c),c=!1),c=setTimeout(function(){return a.apply(void 0,[e,f,g,h,g[f]].concat(i))},b)}}},{key:"wrapFrameCallback",value:function wrapFrameCallback(a){return function(b,c,e,f,d){for(var g=arguments.length,h=Array(5<g?g-5:0),i=5;i<g;i++)h[i-5]=arguments[i];requestAnimationFrame(function(){return a.apply(void 0,[b,c,e,f,d].concat(h))})}}},{key:"wrapIdleCallback",value:function wrapIdleCallback(a){return function(b,c,e,f,d){for(var g=arguments.length,h=Array(5<g?g-5:0),i=5;i<g;i++)h[i-5]=arguments[i];var j=window.requestIdleCallback||requestAnimationFrame;j(function(){return a.apply(void 0,[b,c,e,f,d].concat(h))})}}}]),a}();exports.Bindable=Bindable,_defineProperty(Bindable,"throttles",new WeakMap),Object.defineProperty(Bindable,"OnGet",{configurable:!1,enumerable:!1,writable:!1,value:OnGet}),Object.defineProperty(Bindable,"GetProto",{configurable:!1,enumerable:!1,writable:!1,value:GetProto}),Object.defineProperty(Bindable,"OnAllGet",{configurable:!1,enumerable:!1,writable:!1,value:OnAllGet});
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.Cache=void 0;function _classCallCheck(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function _defineProperties(a,b){for(var c,d=0;d<b.length;d++)c=b[d],c.enumerable=c.enumerable||!1,c.configurable=!0,"value"in c&&(c.writable=!0),Object.defineProperty(a,c.key,c)}function _createClass(a,b,c){return b&&_defineProperties(a.prototype,b),c&&_defineProperties(a,c),a}var Cache=function(){function a(){_classCallCheck(this,a)}return _createClass(a,null,[{key:"store",value:function store(a,b,c){var d=3<arguments.length&&void 0!==arguments[3]?arguments[3]:"standard",e=0;c&&(e=1e3*c+new Date().getTime()),this.bucket||(this.bucket={}),this.bucket[d]||(this.bucket[d]={}),this.bucket[d][a]={expiration:e,value:b}}},{key:"load",value:function load(a){var b=!!(1<arguments.length&&void 0!==arguments[1])&&arguments[1],c=2<arguments.length&&void 0!==arguments[2]?arguments[2]:"standard";return this.bucket&&this.bucket[c]&&this.bucket[c][a]&&(0==this.bucket[c][a].expiration||this.bucket[c][a].expiration>new Date().getTime())?this.bucket[c][a].value:b}}]),a}();exports.Cache=Cache;
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.Config=void 0;function _classCallCheck(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function _defineProperties(a,b){for(var c,d=0;d<b.length;d++)c=b[d],c.enumerable=c.enumerable||!1,c.configurable=!0,"value"in c&&(c.writable=!0),Object.defineProperty(a,c.key,c)}function _createClass(a,b,c){return b&&_defineProperties(a.prototype,b),c&&_defineProperties(a,c),a}var AppConfig={};try{AppConfig=require("/Config").Config||{}}catch(a){!0===window.devMode&&console.error(a)}var Config=function(){function a(){_classCallCheck(this,a)}return _createClass(a,null,[{key:"get",value:function get(a){return this.configs[a]}},{key:"set",value:function set(a,b){return this.configs[a]=b,this}},{key:"dump",value:function dump(){return this.configs}},{key:"init",value:function init(){for(var a=arguments.length,b=Array(a),c=0;c<a;c++)b[c]=arguments[c];for(var d in b){var e=b[d];for(var f in"string"==typeof e&&(e=JSON.parse(e)),e){var g=e[f];return this.configs[f]=g}}return this}}]),a}();exports.Config=Config,Object.defineProperty(Config,"configs",{configurable:!1,enumerable:!1,writable:!1,value:AppConfig});
"use strict";var _Bindable=require("./Bindable");Object.defineProperty(exports,"__esModule",{value:!0}),exports.Cookie=void 0;function _slicedToArray(a,b){return _arrayWithHoles(a)||_iterableToArrayLimit(a,b)||_unsupportedIterableToArray(a,b)||_nonIterableRest()}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(a,b){if(a){if("string"==typeof a)return _arrayLikeToArray(a,b);var c=Object.prototype.toString.call(a).slice(8,-1);return"Object"===c&&a.constructor&&(c=a.constructor.name),"Map"===c||"Set"===c?Array.from(a):"Arguments"===c||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(c)?_arrayLikeToArray(a,b):void 0}}function _arrayLikeToArray(a,b){(null==b||b>a.length)&&(b=a.length);for(var c=0,d=Array(b);c<b;c++)d[c]=a[c];return d}function _iterableToArrayLimit(a,b){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(a)){var c=[],d=!0,e=!1,f=void 0;try{for(var g,h=a[Symbol.iterator]();!(d=(g=h.next()).done)&&(c.push(g.value),!(b&&c.length===b));d=!0);}catch(a){e=!0,f=a}finally{try{d||null==h["return"]||h["return"]()}finally{if(e)throw f}}return c}}function _arrayWithHoles(a){if(Array.isArray(a))return a}function _classCallCheck(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function _defineProperties(a,b){for(var c,d=0;d<b.length;d++)c=b[d],c.enumerable=c.enumerable||!1,c.configurable=!0,"value"in c&&(c.writable=!0),Object.defineProperty(a,c.key,c)}function _createClass(a,b,c){return b&&_defineProperties(a.prototype,b),c&&_defineProperties(a,c),a}var Cookie=function(){function a(){_classCallCheck(this,a)}return _createClass(a,null,[{key:"set",value:function set(b,c){a.jar[b]=c}},{key:"get",value:function get(b){return a.jar[b]}},{key:"delete",value:function _delete(b){delete a.jar[b]}}]),a}();exports.Cookie=Cookie;Cookie.jar=Cookie.jar||_Bindable.Bindable.make({}),document.cookie&&"data"!==window.location.href.substr(0,4)&&(document.cookie.split(";").map(function(a){var b=a.split("="),c=_slicedToArray(b,2),d=c[0],e=c[1];try{e=JSON.parse(e)}catch(a){e=e}d=d.trim(),Cookie.jar[decodeURIComponent(d)]=e}),Cookie.jar.bindTo(function(a,b,c,e){document.cookie=e?"".concat(encodeURIComponent(b),"=;expires=").concat(new Date(0)):"".concat(encodeURIComponent(b),"=").concat(a)}));
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.Dom=void 0;function _classCallCheck(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function _defineProperties(a,b){for(var c,d=0;d<b.length;d++)c=b[d],c.enumerable=c.enumerable||!1,c.configurable=!0,"value"in c&&(c.writable=!0),Object.defineProperty(a,c.key,c)}function _createClass(a,b,c){return b&&_defineProperties(a.prototype,b),c&&_defineProperties(a,c),a}var traversals=0,Dom=function(){function a(){_classCallCheck(this,a)}return _createClass(a,null,[{key:"mapTags",value:function mapTags(a,b,c,d,e){var f=[],g=!0;d&&(g=!1);for(var h=!1,i=document.createTreeWalker(a,NodeFilter.SHOW_ELEMENT|NodeFilter.SHOW_TEXT,{acceptNode:function acceptNode(a){if(!g)if(a===d)g=!0;else return NodeFilter.FILTER_SKIP;return e&&a===e&&(h=!0),h?NodeFilter.FILTER_SKIP:b?a instanceof Element&&a.matches(b)?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP:NodeFilter.FILTER_ACCEPT}},!1),j=traversals++;i.nextNode();)f.push(c(i.currentNode,i));return f}},{key:"dispatchEvent",value:function dispatchEvent(b,c){b.dispatchEvent(c),a.mapTags(b,!1,function(a){a.dispatchEvent(c)})}}]),a}();exports.Dom=Dom;
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.Import=void 0;function _classCallCheck(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function _defineProperties(a,b){for(var c,d=0;d<b.length;d++)c=b[d],c.enumerable=c.enumerable||!1,c.configurable=!0,"value"in c&&(c.writable=!0),Object.defineProperty(a,c.key,c)}function _createClass(a,b,c){return b&&_defineProperties(a.prototype,b),c&&_defineProperties(a,c),a}var Import=function(){function a(b){if(_classCallCheck(this,a),console.log(this.__proto__.constructor),this.__proto__.constructor.instances[b])return this.__proto__.constructor.instances[b];this.uri=b;var c=document.createElement("script");c.setAttribute("src",this.uri),this.ready=new Promise(function(a,b){c.addEventListener("load",function(){return a(c)}),c.addEventListener("error",function(a){console.error(a),b(a)})}),this.tag=c,this.attached=!1,this.__proto__.constructor.instances[b]=this}return _createClass(a,[{key:"attach",value:function attach(){var a=0<arguments.length&&void 0!==arguments[0]?arguments[0]:null;this.attached||(a=a||document.head,a.append(this.tag),this.attached=!0)}}]),a}();exports.Import=Import,Import.instances={};
"use strict";var _Bindable=require("./Bindable");Object.defineProperty(exports,"__esModule",{value:!0}),exports.Mixin=void 0;function _toConsumableArray(a){return _arrayWithoutHoles(a)||_iterableToArray(a)||_unsupportedIterableToArray(a)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _iterableToArray(a){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(a))return Array.from(a)}function _arrayWithoutHoles(a){if(Array.isArray(a))return _arrayLikeToArray(a)}function _typeof(a){"@babel/helpers - typeof";return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(a){return typeof a}:function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a},_typeof(a)}function _createForOfIteratorHelper(a,b){var c;if("undefined"==typeof Symbol||null==a[Symbol.iterator]){if(Array.isArray(a)||(c=_unsupportedIterableToArray(a))||b&&a&&"number"==typeof a.length){c&&(a=c);var d=0,e=function(){};return{s:e,n:function n(){return d>=a.length?{done:!0}:{done:!1,value:a[d++]}},e:function e(a){throw a},f:e}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var f,g=!0,h=!1;return{s:function s(){c=a[Symbol.iterator]()},n:function n(){var a=c.next();return g=a.done,a},e:function e(a){h=!0,f=a},f:function f(){try{g||null==c["return"]||c["return"]()}finally{if(h)throw f}}}}function _unsupportedIterableToArray(a,b){if(a){if("string"==typeof a)return _arrayLikeToArray(a,b);var c=Object.prototype.toString.call(a).slice(8,-1);return"Object"===c&&a.constructor&&(c=a.constructor.name),"Map"===c||"Set"===c?Array.from(a):"Arguments"===c||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(c)?_arrayLikeToArray(a,b):void 0}}function _arrayLikeToArray(a,b){(null==b||b>a.length)&&(b=a.length);for(var c=0,d=Array(b);c<b;c++)d[c]=a[c];return d}function _inherits(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function");a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,writable:!0,configurable:!0}}),b&&_setPrototypeOf(a,b)}function _setPrototypeOf(a,b){return _setPrototypeOf=Object.setPrototypeOf||function(a,b){return a.__proto__=b,a},_setPrototypeOf(a,b)}function _createSuper(a){var b=_isNativeReflectConstruct();return function(){var c,d=_getPrototypeOf(a);if(b){var e=_getPrototypeOf(this).constructor;c=Reflect.construct(d,arguments,e)}else c=d.apply(this,arguments);return _possibleConstructorReturn(this,c)}}function _possibleConstructorReturn(a,b){return b&&("object"===_typeof(b)||"function"==typeof b)?b:_assertThisInitialized(a)}function _assertThisInitialized(a){if(void 0===a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return a}function _isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(a){return!1}}function _getPrototypeOf(a){return _getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(a){return a.__proto__||Object.getPrototypeOf(a)},_getPrototypeOf(a)}function _classCallCheck(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function _defineProperties(a,b){for(var c,d=0;d<b.length;d++)c=b[d],c.enumerable=c.enumerable||!1,c.configurable=!0,"value"in c&&(c.writable=!0),Object.defineProperty(a,c.key,c)}function _createClass(a,b,c){return b&&_defineProperties(a.prototype,b),c&&_defineProperties(a,c),a}var Constructor=Symbol("constructor"),MixinList=Symbol("mixinList"),Mixin=function(){function a(){_classCallCheck(this,a)}return _createClass(a,null,[{key:"from",value:function from(b){for(var c=arguments.length,d=Array(1<c?c-1:0),e=1;e<c;e++)d[e-1]=arguments[e];var f=function(b){function c(){var b;_classCallCheck(this,c);for(var f=arguments.length,g=Array(f),h=0;h<f;h++)g[h]=arguments[h];b=e.call.apply(e,[this].concat(g));var i,j=_createForOfIteratorHelper(d);try{for(j.s();!(i=j.n()).done;){var k=i.value;switch(k[a.Constructor]&&k[a.Constructor].apply(_assertThisInitialized(b)),_typeof(k)){case"object":a.mixObject(k,_assertThisInitialized(b));}}}catch(a){j.e(a)}finally{j.f()}return b}_inherits(c,b);var e=_createSuper(c);return c}(b);return f}},{key:"with",value:function _with(){for(var a=arguments.length,b=Array(a),c=0;c<a;c++)b[c]=arguments[c];return this.from.apply(this,[Object].concat(b))}},{key:"mixObject",value:function mixObject(a,b){var c,d=_createForOfIteratorHelper(Object.getOwnPropertyNames(a));try{for(d.s();!(c=d.n()).done;){var g=c.value;if("function"==typeof a[g]){b[g]=a[g].bind(b);continue}b[g]=a[g]}}catch(a){d.e(a)}finally{d.f()}var e,f=_createForOfIteratorHelper(Object.getOwnPropertySymbols(a));try{for(f.s();!(e=f.n()).done;){var h=e.value;if("function"==typeof a[h]){b[h]=a[h].bind(b);continue}b[h]=a[h]}}catch(a){f.e(a)}finally{f.f()}}},{key:"mixClass",value:function mixClass(a,b){var c,d=_createForOfIteratorHelper(Object.getOwnPropertyNames(a.prototype));try{for(d.s();!(c=d.n()).done;){var o=c.value;b.prototype[o]=a.prototype[o].bind(b.prototype)}}catch(a){d.e(a)}finally{d.f()}var e,f=_createForOfIteratorHelper(Object.getOwnPropertySymbols(a.prototype));try{for(f.s();!(e=f.n()).done;){var p=e.value;b.prototype[p]=a.prototype[p].bind(b.prototype)}}catch(a){f.e(a)}finally{f.f()}var g,h=_createForOfIteratorHelper(Object.getOwnPropertyNames(a));try{var i=function(){var c=g.value;if("function"!=typeof a[c])return"continue";var d=b[c]||!1,e=a[c].bind(b);b[c]=function(){return d&&d.apply(void 0,arguments),e.apply(void 0,arguments)}};for(h.s();!(g=h.n()).done;){var j=i()}}catch(a){h.e(a)}finally{h.f()}var k,l=_createForOfIteratorHelper(Object.getOwnPropertySymbols(a));try{var m=function(){var c=k.value;if("function"!=typeof a[c])return"continue";var d=b[c]||!1,e=a[c].bind(b);b[c]=function(){return d&&d.apply(void 0,arguments),e.apply(void 0,arguments)}};for(l.s();!(k=l.n()).done;){var n=m()}}catch(a){l.e(a)}finally{l.f()}}},{key:"mix",value:function mix(a){for(var b={},c={},d=_Bindable.Bindable.makeBindable(a),e=function(e){var f,g=Object.getOwnPropertyNames(e.prototype),h=Object.getOwnPropertyNames(e),i=/^(before|after)__(.+)/,j=_createForOfIteratorHelper(h);try{var k=function(){var c=f.value,g=c.match(i);if(g){switch(g[1]){case"before":d.___before(function(b,d,f,h,i){if(d===g[2]){var a=e[c].bind(h);return a.apply(void 0,_toConsumableArray(i))}});break;case"after":d.___after(function(b,d,f,h,i){if(d===g[2]){var a=e[c].bind(h);return a.apply(void 0,_toConsumableArray(i))}});}return"continue"}return b[c]?"continue":"function"==typeof e[c]?void(b[c]=e[c]):"continue"};for(j.s();!(f=j.n()).done;){var l=k()}}catch(a){j.e(a)}finally{j.f()}var m,n=_createForOfIteratorHelper(g);try{var o=function(){var b=m.value,f=b.match(i);if(f){switch(f[1]){case"before":d.___before(function(c,d,g,h,i){if(d===f[2]){var a=e.prototype[b].bind(h);return a.apply(void 0,_toConsumableArray(i))}});break;case"after":d.___after(function(c,d,g,h,i){if(d===f[2]){var a=e.prototype[b].bind(h);return a.apply(void 0,_toConsumableArray(i))}});}return"continue"}return c[b]?"continue":"function"==typeof e.prototype[b]?void(c[b]=e.prototype[b]):"continue"};for(n.s();!(m=n.n()).done;){var p=o()}}catch(a){n.e(a)}finally{n.f()}},f=this;f&&f.prototype;f=Object.getPrototypeOf(f))e(f);for(var h in b)a[h]=b[h].bind(a);var g=function(b){a.prototype[b]=function(){for(var a=arguments.length,d=Array(a),e=0;e<a;e++)d[e]=arguments[e];return c[b].apply(this,d)}};for(var i in c)g(i);return d}}]),a}();exports.Mixin=Mixin,Mixin.Constructor=Constructor;
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.Model=void 0;var _Cache=require("./Cache"),_Bindable=require("./Bindable"),_Repository=require("./Repository");function _classCallCheck(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function _defineProperties(a,b){for(var c,d=0;d<b.length;d++)c=b[d],c.enumerable=c.enumerable||!1,c.configurable=!0,"value"in c&&(c.writable=!0),Object.defineProperty(a,c.key,c)}function _createClass(a,b,c){return b&&_defineProperties(a.prototype,b),c&&_defineProperties(a,c),a}var Model=function(){function a(b){_classCallCheck(this,a),this.repository=b}return _createClass(a,[{key:"consume",value:function consume(b){for(var e in b){var f=b[e];if(b[e]instanceof Object&&b[e]["class"]&&b[e].publicId){var c="".concat(b[e]["class"],"::").concat(b[e].publidId),d=_Cache.Cache.load(c,!1,"model-type-repo");f=_Bindable.Bindable.makeBindable(new a(this.repository)),d&&(f=d),f.consume(b[e]),_Cache.Cache.store(c,f,0,"model-type-repo")}this[e]=f}}}]),a}();exports.Model=Model;
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.Repository=void 0;var _Bindable=require("./Bindable"),_Router=require("./Router"),_Cache=require("./Cache"),_Model=require("./Model"),_Bag=require("./Bag"),_Form=require("../form/Form"),_FormWrapper=require("../form/multiField/FormWrapper");function _typeof(a){"@babel/helpers - typeof";return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(a){return typeof a}:function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a},_typeof(a)}function _classCallCheck(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function _defineProperties(a,b){for(var c,d=0;d<b.length;d++)c=b[d],c.enumerable=c.enumerable||!1,c.configurable=!0,"value"in c&&(c.writable=!0),Object.defineProperty(a,c.key,c)}function _createClass(a,b,c){return b&&_defineProperties(a.prototype,b),c&&_defineProperties(a,c),a}var objects={},Repository=function(){function a(b){_classCallCheck(this,a),this.uri=b}return _createClass(a,[{key:"get",value:function get(b){var c=this,d=!!(1<arguments.length&&void 0!==arguments[1])&&arguments[1],e=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{},f=this.uri+"/"+b,g=_Cache.Cache.load(f+_Router.Router.queryToString(_Router.Router.queryOver(e),!0),!1,"model-uri-repo");return!d&&g?Promise.resolve(g):a.request(f,e).then(function(a){return c.extractModel(a.body)})}},{key:"page",value:function page(){var b=this,c=0<arguments.length&&void 0!==arguments[0]?arguments[0]:0,d=1<arguments.length?arguments[1]:void 0;return a.request(this.uri,d).then(function(a){var c=[];for(var d in a.body){var e=a.body[d];c.push(b.extractModel(e))}return a.body=c,a})}},{key:"edit",value:function edit(){var b=0<arguments.length&&void 0!==arguments[0]?arguments[0]:null,c=1<arguments.length&&void 0!==arguments[1]?arguments[1]:null,d=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{},e=this.uri+"/create";return b&&(e=this.uri+"/"+b+"/edit"),c?a.request(e,{api:"json"},c).then(function(a){return a.body}):a.request(e).then(function(a){var b=new _Form.Form(a.meta.form,d);return new _FormWrapper.FormWrapper(b,e,"POST",d)})}},{key:"extractModel",value:function extractModel(a){var b=_Bindable.Bindable.makeBindable(new _Model.Model(this));b.consume(a);this.uri+"/"+b.publicId;if(b["class"])var c="".concat(b["class"],"::").concat(b.publidId),d=_Cache.Cache.load(c,!1,"model-type-repo");return b}}],[{key:"loadPage",value:function loadPage(){var a=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},b=!!(1<arguments.length&&void 0!==arguments[1])&&arguments[1];return this.request(this.uri,a).then(function(a){return a})}},{key:"domCache",value:function domCache(){}},{key:"load",value:function load(a){!!(1<arguments.length&&void 0!==arguments[1])&&arguments[1];return this.objects=this.objects||{},this.objects[this.uri]=this.objects[this.uri]||{},this.objects[this.uri][a]?Promise.resolve(this.objects[this.uri][a]):this.request(this.uri+"/"+a).then(function(){})}},{key:"form",value:function form(){var a=0<arguments.length&&void 0!==arguments[0]?arguments[0]:null,b=this.uri+"/create";return a&&(b=this.uri+"/"+a+"/edit"),this.request(b).then(function(a){return a})}},{key:"clearCache",value:function clearCache(){this.objects&&this.objects[this.uri]&&(this.objects[this.uri]={})}},{key:"encode",value:function encode(a){var b=1<arguments.length&&void 0!==arguments[1]?arguments[1]:null,c=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null;for(var d in c||(c=new FormData),a){var e=d;b&&(e="".concat(b,"[").concat(e,"]")),a[d]&&"object"!==_typeof(a[d])?c.append(e,a[d]):this.encode(a[d],e,c)}return c}},{key:"onResponse",value:function onResponse(a){return this._onResponse||(this._onResponse=new _Bag.Bag),this._onResponse.add(a)}},{key:"request",value:function request(a){var b=this,c=1<arguments.length&&void 0!==arguments[1]?arguments[1]:null,d=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null,e=!(3<arguments.length&&void 0!==arguments[3])||arguments[3],f=4<arguments.length&&void 0!==arguments[4]?arguments[4]:{},g="GET",h="",i=null,j={};c&&(j=c),this._onResponse||(this._onResponse=new _Bag.Bag),this.runningRequests||(this.runningRequests={}),j.api=j.api||"json",h=Object.keys(j).map(function(a){return encodeURIComponent(a)+"="+encodeURIComponent(j[a])}).join("&");var k=a;if(k=a+"?"+h,!d&&this.runningRequests[k])return this.runningRequests[k];d&&(e=!1,g="POST",i=d instanceof FormData?d:this.encode(d));var l=new XMLHttpRequest;if("responseType"in f&&(l.responseType=f.responseType),!d&&e&&this.cache&&this.cache[k])return Promise.resolve(this.cache[k]);var m="script[data-uri=\""+k+"\"]",n=document.querySelector(m);if(!d&&e&&n){var q=JSON.parse(n.innerText);return Promise.resolve(q)}l.withCredentials=!("withCredentials"in f)||f.withCredentials;var o=document.createElement("a");o.href=k,d||(l.timeout=f.timeout||15e3,this.xhrs[k]=l);var p=new Promise(function(a,c){if(d&&"progressUp"in f&&(l.upload.onprogress=f.progressUp),"progressDown"in f&&(l.onprogress=f.progressDown),l.onreadystatechange=function(){var d,e=200;if(4===l.readyState)if(delete b.xhrs[k],delete b.runningRequests[k],b.cache||(b.cache={}),"application/json"!=l.getResponseHeader("Content-Type")&&"application/json; charset=utf-8"!=l.getResponseHeader("Content-Type")&&"text/json"!=l.getResponseHeader("Content-Type")&&"text/json; charset=utf-8"!=l.getResponseHeader("Content-Type")){var h=b._onResponse.items();for(var j in h)h[j](l,!0);l.status===e?a(l):c(l)}else if(d=JSON.parse(l.responseText),d&&0==d.code){var f=document.querySelector("script[data-uri=\""+k+"\"]"),g=window.prerenderer||navigator.userAgent.match(/prerender/i);g&&(window.prerenderer=window.prerenderer||!0,!f&&(f=document.createElement("script"),f.type="text/json",f.setAttribute("data-hack","application/ld+json-NOT!"),f.setAttribute("data-uri",k),document.head.appendChild(f)),f.innerText=JSON.stringify(d));var m=b._onResponse.items();for(var n in m)m[n](d,!0);d._http=l.status,l.status===e?a(d):c(d)}else{var i=b._onResponse.items();for(var o in i)i[o](d,!0);c(d)}},l.open(g,k,!0),f.headers)for(var e in f.headers)l.setRequestHeader(e,f.headers[e]);l.send(i)});return d||(this.runningRequests[k]=p),p}},{key:"cancel",value:function cancel(){var a=0<arguments.length&&void 0!==arguments[0]?arguments[0]:/^.$/;for(var b in this.xhrs)this.xhrs[b]&&b.match(a)&&(this.xhrs[b].abort(),delete this.xhrs[b])}}]),a}();exports.Repository=Repository,Repository.xhrs=[];
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.Router=void 0;var _View=require("./View"),_Cache=require("./Cache"),_Config=require("./Config"),_Routes=require("./Routes");function _createForOfIteratorHelper(a,b){var c;if("undefined"==typeof Symbol||null==a[Symbol.iterator]){if(Array.isArray(a)||(c=_unsupportedIterableToArray(a))||b&&a&&"number"==typeof a.length){c&&(a=c);var d=0,e=function(){};return{s:e,n:function n(){return d>=a.length?{done:!0}:{done:!1,value:a[d++]}},e:function e(a){throw a},f:e}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var f,g=!0,h=!1;return{s:function s(){c=a[Symbol.iterator]()},n:function n(){var a=c.next();return g=a.done,a},e:function e(a){h=!0,f=a},f:function f(){try{g||null==c["return"]||c["return"]()}finally{if(h)throw f}}}}function _unsupportedIterableToArray(a,b){if(a){if("string"==typeof a)return _arrayLikeToArray(a,b);var c=Object.prototype.toString.call(a).slice(8,-1);return"Object"===c&&a.constructor&&(c=a.constructor.name),"Map"===c||"Set"===c?Array.from(a):"Arguments"===c||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(c)?_arrayLikeToArray(a,b):void 0}}function _arrayLikeToArray(a,b){(null==b||b>a.length)&&(b=a.length);for(var c=0,d=Array(b);c<b;c++)d[c]=a[c];return d}function _classCallCheck(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function _defineProperties(a,b){for(var c,d=0;d<b.length;d++)c=b[d],c.enumerable=c.enumerable||!1,c.configurable=!0,"value"in c&&(c.writable=!0),Object.defineProperty(a,c.key,c)}function _createClass(a,b,c){return b&&_defineProperties(a.prototype,b),c&&_defineProperties(a,c),a}var Router=function(){function a(){_classCallCheck(this,a)}return _createClass(a,null,[{key:"wait",value:function wait(a){var b=this,c=1<arguments.length&&void 0!==arguments[1]?arguments[1]:"DOMContentLoaded",d=2<arguments.length&&void 0!==arguments[2]?arguments[2]:document;d.addEventListener(c,function(){b.listen(a)})}},{key:"listen",value:function(a){var b=this,c=!!(1<arguments.length&&void 0!==arguments[1])&&arguments[1];this.routes=c,Object.assign(this.query,this.queryOver({}));var d=function(c){for(var d in c.preventDefault(),c.state&&"routedId"in c.state?c.state.routedId<=b.routeCount?(b.history.splice(c.state.routedId),b.routeCount=c.state.routedId):c.state.routedId>b.routeCount&&(b.history.push(c.state.prev),b.routeCount=c.state.routedId):null!==b.prevPath&&b.prevPath!==location.pathname&&b.history.push(b.prevPath),"null"===location.origin?b.match(b.nextPath,a):b.match(location.pathname,a),b.query)delete b.query[d];Object.assign(b.query,b.queryOver({}))};window.addEventListener("popstate",d),window.addEventListener("cvUrlChanged",d);var e="null"!==location.origin&&location.pathname+location.search;location.origin&&location.hash&&(e+=location.hash),this.go(!1===e?"/":e)}},{key:"go",value:function go(a,b){var c=_Config.Config.get("title");for(var d in c&&(document.title=c),"null"===location.origin?this.nextPath=a:2===b&&location.pathname!==a?history.replaceState({routedId:this.routeCount,prev:this.prevPath,url:location.pathname},null,a):location.pathname!==a&&history.pushState({routedId:++this.routeCount,prev:this.prevPath,url:location.pathname},null,a),b||(!1===b&&(this.path=null),"#"===a.substring(0,1)?window.dispatchEvent(new HashChangeEvent("hashchange")):window.dispatchEvent(new CustomEvent("cvUrlChanged"))),this.query)delete this.query[d];Object.assign(this.query,this.queryOver({})),this.prevPath=a}},{key:"match",value:function match(a,b){var c=this,d=!!(2<arguments.length&&void 0!==arguments[2])&&arguments[2];if(this.path!==a||d){this.queryString=location.search,this.path=a;var e=this.prevPath,f=b.args.content,g=this.routes||b.routes||_Routes.Routes.dump(),h=new URLSearchParams(location.search);for(var q in console.log(a,g),this.query)delete this.query[q];Object.assign(this.query,this.queryOver({}));var k={},l=!1,m="";for(var i in a=a.substr(1).split("/"),this.query)k[i]=this.query[i];L1:for(var r in g){var s=r.split("/");if(!(s.length<a.length&&"*"!==s[s.length-1])){L2:for(var t in s)if("%"==s[t].substr(0,1)){var n=null,o=/^%(\w+)\??/.exec(s[t]);if(o&&o[1]&&(n=o[1]),!n)throw new Error("".concat(s[t]," is not a valid argument segment in route \"").concat(r,"\""));if(!!a[t])k[n]=a[t];else if("?"==s[t].substr(s[t].length-1,1))k[n]="";else continue L1}else if("*"!==s[t]&&a[t]!==s[t])continue L1;l=r,m=g[r],"*"===s[s.length-1]&&(k.pathparts=a.slice(s.length-1));break}}var p=new CustomEvent("cvRouteStart",{cancelable:!0,detail:{path:a,prev:e,root:b,selected:l,routes:g}});if(document.dispatchEvent(p)){console.log(g[l]);try{return m="function"==typeof g[l]?g[l].prototype instanceof _View.View?new g[l](k):g[l](k):g[l],m instanceof Promise?m.then(function(e){console.log(e),c.update(b,a,e,g,l,k,d)})["catch"](function(f){throw document.dispatchEvent(new CustomEvent("cvRouteError",{detail:{error:f,path:a,prev:e,view:b,routes:g,selected:l}})),c.update(b,a,window.devMode?f+"":"Error: 500",g,l,k,d),f}):this.update(b,a,m,g,l,k,d)}catch(c){throw document.dispatchEvent(new CustomEvent("cvRouteError",{detail:{error:c,path:a,prev:e,view:b,routes:g,selected:l}})),this.update(b,a,window.devMode?c+"":"Error: 500",g,l,k,d),c}}}}},{key:"update",value:function update(a,b,c,d,e,f,g){if(a){var h=this.prevPath,i=new CustomEvent("cvRoute",{cancelable:!0,detail:{result:c,path:b,prev:h,view:a,routes:d,selected:e}});!1!==c&&(a.args.content instanceof _View.View&&(a.args.content.pause(!0),a.args.content.remove()),document.dispatchEvent(i)&&(a.args.content=c),c instanceof _View.View&&(c.pause(!1),c.update(f,g)));var j=new CustomEvent("cvRouteEnd",{cancelable:!0,detail:{result:c,path:b,prev:h,view:a,routes:d,selected:e}});document.dispatchEvent(j)}}},{key:"queryOver",value:function queryOver(){var a,b=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},c=new URLSearchParams(location.search),d={},e={},f=_createForOfIteratorHelper(c);try{for(f.s();!(a=f.n()).done;){var g=a.value;e[g[0]]=g[1]}}catch(a){f.e(a)}finally{f.f()}return d=Object.assign(d,e,b),delete d.api,d}},{key:"queryToString",value:function queryToString(){var a=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},b=!!(1<arguments.length&&void 0!==arguments[1])&&arguments[1],c=[],d=a;for(var e in b||(d=this.queryOver(a)),d)""!==d[e]&&c.push(e+"="+encodeURIComponent(d[e]));return c.join("&")}},{key:"setQuery",value:function setQuery(a,b,c){var d=this.queryOver();d[a]=b,void 0===b&&delete d[a];var e=this.queryToString(d,!0);this.go(location.pathname+(e?"?"+e:""),c)}}]),a}();exports.Router=Router,Object.defineProperty(Router,"query",{configurable:!1,enumerable:!1,writable:!1,value:{}}),Object.defineProperty(Router,"history",{configurable:!1,enumerable:!1,writable:!1,value:[]}),Object.defineProperty(Router,"routeCount",{configurable:!1,enumerable:!1,writable:!0,value:0}),Object.defineProperty(Router,"prevPath",{configurable:!1,enumerable:!1,writable:!0,value:null}),Object.defineProperty(Router,"queryString",{configurable:!1,enumerable:!1,writable:!0,value:null});
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.Routes=void 0;function _classCallCheck(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function _defineProperties(a,b){for(var c,d=0;d<b.length;d++)c=b[d],c.enumerable=c.enumerable||!1,c.configurable=!0,"value"in c&&(c.writable=!0),Object.defineProperty(a,c.key,c)}function _createClass(a,b,c){return b&&_defineProperties(a.prototype,b),c&&_defineProperties(a,c),a}var AppRoutes={};try{Object.assign(AppRoutes,require("Routes").Routes||{})}catch(a){!0===window.devMode&&console.warn(a)}var Routes=function(){function a(){_classCallCheck(this,a)}return _createClass(a,null,[{key:"get",value:function get(a){return this.routes[a]}},{key:"dump",value:function dump(){return this.routes}}]),a}();exports.Routes=Routes,Object.defineProperty(Routes,"routes",{configurable:!1,enumerable:!1,writable:!1,value:AppRoutes});
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.RuleSet=void 0;var _Dom=require("./Dom"),_Tag=require("./Tag"),_View=require("./View");function _createForOfIteratorHelper(a,b){var c;if("undefined"==typeof Symbol||null==a[Symbol.iterator]){if(Array.isArray(a)||(c=_unsupportedIterableToArray(a))||b&&a&&"number"==typeof a.length){c&&(a=c);var d=0,e=function(){};return{s:e,n:function n(){return d>=a.length?{done:!0}:{done:!1,value:a[d++]}},e:function e(a){throw a},f:e}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var f,g=!0,h=!1;return{s:function s(){c=a[Symbol.iterator]()},n:function n(){var a=c.next();return g=a.done,a},e:function e(a){h=!0,f=a},f:function f(){try{g||null==c["return"]||c["return"]()}finally{if(h)throw f}}}}function _unsupportedIterableToArray(a,b){if(a){if("string"==typeof a)return _arrayLikeToArray(a,b);var c=Object.prototype.toString.call(a).slice(8,-1);return"Object"===c&&a.constructor&&(c=a.constructor.name),"Map"===c||"Set"===c?Array.from(a):"Arguments"===c||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(c)?_arrayLikeToArray(a,b):void 0}}function _arrayLikeToArray(a,b){(null==b||b>a.length)&&(b=a.length);for(var c=0,d=Array(b);c<b;c++)d[c]=a[c];return d}function _classCallCheck(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function _defineProperties(a,b){for(var c,d=0;d<b.length;d++)c=b[d],c.enumerable=c.enumerable||!1,c.configurable=!0,"value"in c&&(c.writable=!0),Object.defineProperty(a,c.key,c)}function _createClass(a,b,c){return b&&_defineProperties(a.prototype,b),c&&_defineProperties(a,c),a}var RuleSet=function(){function a(){_classCallCheck(this,a)}return _createClass(a,[{key:"add",value:function add(a,b){return this.rules=this.rules||{},this.rules[a]=this.rules[a]||[],this.rules[a].push(b),this}},{key:"apply",value:function apply(){var b=0<arguments.length&&void 0!==arguments[0]?arguments[0]:document,c=1<arguments.length&&void 0!==arguments[1]?arguments[1]:null;for(var j in a.apply(b,c),this.rules)for(var k in this.rules[j]){var d,e=this.rules[j][k],f=a.wrap(b,e,c),g=b.querySelectorAll(j),h=_createForOfIteratorHelper(g);try{for(h.s();!(d=h.n()).done;){var i=d.value;f(i)}}catch(a){h.e(a)}finally{h.f()}}}}],[{key:"add",value:function add(a,b){return this.globalRules=this.globalRules||{},this.globalRules[a]=this.globalRules[a]||[],this.globalRules[a].push(b),this}},{key:"apply",value:function apply(){var a=0<arguments.length&&void 0!==arguments[0]?arguments[0]:document,b=1<arguments.length&&void 0!==arguments[1]?arguments[1]:null;for(var h in this.globalRules)for(var j in this.globalRules[h]){var c,d=this.globalRules[h][j],e=this.wrap(a,d,b),f=a.querySelectorAll(h),g=_createForOfIteratorHelper(f);try{for(g.s();!(c=g.n()).done;){var i=c.value;e(i)}}catch(a){g.e(a)}finally{g.f()}}}},{key:"wait",value:function wait(){var a=this,b=0<arguments.length&&void 0!==arguments[0]?arguments[0]:"DOMContentLoaded",c=1<arguments.length&&void 0!==arguments[1]?arguments[1]:document,d=function(b,c){return function(){return c.removeEventListener(b,d),a.apply()}}(b,c);c.addEventListener(b,d)}},{key:"wrap",value:function wrap(a,b){var c=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null;return(b instanceof _View.View||b&&b.prototype&&b.prototype instanceof _View.View)&&(b=function(a){return function(){return a}}(b)),function(a){for(var k in"undefined"==typeof a.___cvApplied___&&Object.defineProperty(a,"___cvApplied___",{enumerable:!1,writable:!1,value:[]}),a.___cvApplied___)if(b==a.___cvApplied___[k])return;var d,e;c&&(d=e=c,c.viewList&&(e=c.viewList.parent));var f=new _Tag.Tag(a,e,null,void 0,d),g=f.element.parentNode,h=f.element.nextSibling,j=b(f);if(!1!==j&&a.___cvApplied___.push(b),j instanceof HTMLElement&&(j=new _Tag.Tag(j)),j instanceof _Tag.Tag){if(!j.element.contains(f.element)){for(;f.element.firstChild;)j.element.appendChild(f.element.firstChild);f.remove()}h?g.insertBefore(j.element,h):g.appendChild(j.element)}j&&j.prototype&&j.prototype instanceof _View.View&&(j=new j({},c)),j instanceof _View.View&&(c&&(c.cleanup.push(function(a){return function(){a.remove()}}(j)),c.cleanup.push(c.args.bindTo(function(a,b,c){c[b]=a,j.args[b]=a})),c.cleanup.push(j.args.bindTo(function(a,b,d){d[b]=a,c.args[b]=a}))),f.clear(),j.render(f.element))}}}]),a}();exports.RuleSet=RuleSet;
"use strict";var _Bindable=require("./Bindable");Object.defineProperty(exports,"__esModule",{value:!0}),exports.Tag=void 0;function _classCallCheck(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function _defineProperties(a,b){for(var c,d=0;d<b.length;d++)c=b[d],c.enumerable=c.enumerable||!1,c.configurable=!0,"value"in c&&(c.writable=!0),Object.defineProperty(a,c.key,c)}function _createClass(a,b,c){return b&&_defineProperties(a.prototype,b),c&&_defineProperties(a,c),a}var Tag=function(){function a(b,c,d,e,f){var g=this;if(_classCallCheck(this,a),"string"==typeof b){var h=document.createRange().createContextualFragment(b);b=h.firstChild}return this.element=_Bindable.Bindable.makeBindable(b),this.node=this.element,this.parent=c,this.direct=f,this.ref=d,this.index=e,this.cleanup=[],this[_Bindable.Bindable.OnAllGet]=function(a){return"function"==typeof g[a]?g[a]:"function"==typeof g.element[a]?function(){var b;return(b=g.element)[a].apply(b,arguments)}:a in g.element?g.element[a]:g[a]},this.style=function(a){return _Bindable.Bindable.make(function(b){if(a.node){var c=new CustomEvent("cvStyle",{detail:{styles:b}});if(a.node.dispatchEvent(c))for(var d in b)"-"===d[0]&&a.node.style.setProperty(d,b[d]),a.node.style[d]=b[d]}})}(this),this.proxy=_Bindable.Bindable.make(this),this.proxy.style.bindTo(function(a,b){g.element.style[b]=a}),this.proxy.bindTo(function(a,c){return c in b&&(b[c]=a),!1}),this.proxy}return _createClass(a,[{key:"attr",value:function attr(a){for(var b in a)void 0===a[b]?this.node.removeAttribute(b):null===a[b]?this.node.setAttribute(b,""):this.node.setAttribute(b,a[b])}},{key:"remove",value:function remove(){this.node.remove(),_Bindable.Bindable.clearBindings(this);for(var a;a=this.cleanup.shift();)a();if(this.clear(),!!this.node){new Event("cvDomDetached");this.node=this.element=this.ref=this.parent=null}}},{key:"clear",value:function clear(){if(this.node)for(var a=new Event("cvDomDetached");this.node.firstChild;)this.node.firstChild.dispatchEvent(a),this.node.removeChild(this.node.firstChild)}},{key:"pause",value:function pause(){!(0<arguments.length&&void 0!==arguments[0])||arguments[0]}}]),a}();exports.Tag=Tag;
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.Theme=void 0;function _slicedToArray(a,b){return _arrayWithHoles(a)||_iterableToArrayLimit(a,b)||_unsupportedIterableToArray(a,b)||_nonIterableRest()}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _iterableToArrayLimit(a,b){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(a)){var c=[],d=!0,e=!1,f=void 0;try{for(var g,h=a[Symbol.iterator]();!(d=(g=h.next()).done)&&(c.push(g.value),!(b&&c.length===b));d=!0);}catch(a){e=!0,f=a}finally{try{d||null==h["return"]||h["return"]()}finally{if(e)throw f}}return c}}function _arrayWithHoles(a){if(Array.isArray(a))return a}function _createForOfIteratorHelper(a,b){var c;if("undefined"==typeof Symbol||null==a[Symbol.iterator]){if(Array.isArray(a)||(c=_unsupportedIterableToArray(a))||b&&a&&"number"==typeof a.length){c&&(a=c);var d=0,e=function(){};return{s:e,n:function n(){return d>=a.length?{done:!0}:{done:!1,value:a[d++]}},e:function e(a){throw a},f:e}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var f,g=!0,h=!1;return{s:function s(){c=a[Symbol.iterator]()},n:function n(){var a=c.next();return g=a.done,a},e:function e(a){h=!0,f=a},f:function f(){try{g||null==c["return"]||c["return"]()}finally{if(h)throw f}}}}function _unsupportedIterableToArray(a,b){if(a){if("string"==typeof a)return _arrayLikeToArray(a,b);var c=Object.prototype.toString.call(a).slice(8,-1);return"Object"===c&&a.constructor&&(c=a.constructor.name),"Map"===c||"Set"===c?Array.from(a):"Arguments"===c||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(c)?_arrayLikeToArray(a,b):void 0}}function _arrayLikeToArray(a,b){(null==b||b>a.length)&&(b=a.length);for(var c=0,d=Array(b);c<b;c++)d[c]=a[c];return d}function _classCallCheck(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function _defineProperties(a,b){for(var c,d=0;d<b.length;d++)c=b[d],c.enumerable=c.enumerable||!1,c.configurable=!0,"value"in c&&(c.writable=!0),Object.defineProperty(a,c.key,c)}function _createClass(a,b,c){return b&&_defineProperties(a.prototype,b),c&&_defineProperties(a,c),a}var Theme=function(){function a(b){_classCallCheck(this,a),this.key=b,this.viewMap=new Map,this.templateMap=new Map,this.fallbacks=[]}return _createClass(a,null,[{key:"get",value:function get(){var a=0<arguments.length&&void 0!==arguments[0]?arguments[0]:"";return this.instances||(this.instances={}),this.instances[a]||(this.instances[a]=new this(a)),this.instances[a]}}]),_createClass(a,[{key:"setFallback",value:function setFallback(){var a;return(a=this.fallbacks).push.apply(a,arguments),this}},{key:"setView",value:function setView(a,b){return this.viewMap.set(a,b),this}},{key:"getView",value:function getView(a){return this.resolve(a,"viewMap")}},{key:"setTemplate",value:function setTemplate(a,b){return this.viewMap.set(a,b),this}},{key:"getTemplate",value:function getTemplate(a){return this.resolve(a,"templateMap")}},{key:"resolve",value:function resolve(a,b){var c=a.constructor,d=this[b];if(d.has(c))return d.get(c);var e,f=!1,g=_createForOfIteratorHelper(d);try{for(g.s();!(e=g.n()).done;){var h=_slicedToArray(e.value,2),i=h[0],j=h[1];c.prototype instanceof i&&(f=j)}}catch(a){g.e(a)}finally{g.f()}if(!f){var k,l=_createForOfIteratorHelper(this.fallbacks);try{for(l.s();!(k=l.n()).done;){var m=k.value;if(f=m.resolve(a,b))return f}}catch(a){l.e(a)}finally{l.f()}}return f&&d.set(c,f),f}}]),a}();exports.Theme=Theme;
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.View=void 0;var _Bindable=require("./Bindable"),_ViewList=require("./ViewList"),_Router=require("./Router"),_Dom=require("./Dom"),_Tag=require("./Tag"),_Bag=require("./Bag"),_RuleSet=require("./RuleSet"),_Mixin=require("./Mixin"),_PromiseMixin=require("../mixin/PromiseMixin"),_EventTargetMixin=require("../mixin/EventTargetMixin");function _typeof(a){"@babel/helpers - typeof";return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(a){return typeof a}:function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a},_typeof(a)}function _toConsumableArray(a){return _arrayWithoutHoles(a)||_iterableToArray(a)||_unsupportedIterableToArray(a)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _iterableToArray(a){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(a))return Array.from(a)}function _arrayWithoutHoles(a){if(Array.isArray(a))return _arrayLikeToArray(a)}function _slicedToArray(a,b){return _arrayWithHoles(a)||_iterableToArrayLimit(a,b)||_unsupportedIterableToArray(a,b)||_nonIterableRest()}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _iterableToArrayLimit(a,b){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(a)){var c=[],d=!0,e=!1,f=void 0;try{for(var g,h=a[Symbol.iterator]();!(d=(g=h.next()).done)&&(c.push(g.value),!(b&&c.length===b));d=!0);}catch(a){e=!0,f=a}finally{try{d||null==h["return"]||h["return"]()}finally{if(e)throw f}}return c}}function _arrayWithHoles(a){if(Array.isArray(a))return a}function _createForOfIteratorHelper(a,b){var c;if("undefined"==typeof Symbol||null==a[Symbol.iterator]){if(Array.isArray(a)||(c=_unsupportedIterableToArray(a))||b&&a&&"number"==typeof a.length){c&&(a=c);var d=0,e=function(){};return{s:e,n:function n(){return d>=a.length?{done:!0}:{done:!1,value:a[d++]}},e:function e(a){throw a},f:e}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var f,g=!0,h=!1;return{s:function s(){c=a[Symbol.iterator]()},n:function n(){var a=c.next();return g=a.done,a},e:function e(a){h=!0,f=a},f:function f(){try{g||null==c["return"]||c["return"]()}finally{if(h)throw f}}}}function _unsupportedIterableToArray(a,b){if(a){if("string"==typeof a)return _arrayLikeToArray(a,b);var c=Object.prototype.toString.call(a).slice(8,-1);return"Object"===c&&a.constructor&&(c=a.constructor.name),"Map"===c||"Set"===c?Array.from(a):"Arguments"===c||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(c)?_arrayLikeToArray(a,b):void 0}}function _arrayLikeToArray(a,b){(null==b||b>a.length)&&(b=a.length);for(var c=0,d=Array(b);c<b;c++)d[c]=a[c];return d}function _classCallCheck(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function _defineProperties(a,b){for(var c,d=0;d<b.length;d++)c=b[d],c.enumerable=c.enumerable||!1,c.configurable=!0,"value"in c&&(c.writable=!0),Object.defineProperty(a,c.key,c)}function _createClass(a,b,c){return b&&_defineProperties(a.prototype,b),c&&_defineProperties(a,c),a}function _inherits(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function");a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,writable:!0,configurable:!0}}),b&&_setPrototypeOf(a,b)}function _setPrototypeOf(a,b){return _setPrototypeOf=Object.setPrototypeOf||function(a,b){return a.__proto__=b,a},_setPrototypeOf(a,b)}function _createSuper(a){var b=_isNativeReflectConstruct();return function(){var c,d=_getPrototypeOf(a);if(b){var e=_getPrototypeOf(this).constructor;c=Reflect.construct(d,arguments,e)}else c=d.apply(this,arguments);return _possibleConstructorReturn(this,c)}}function _possibleConstructorReturn(a,b){return b&&("object"===_typeof(b)||"function"==typeof b)?b:_assertThisInitialized(a)}function _assertThisInitialized(a){if(void 0===a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return a}function _isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(a){return!1}}function _getPrototypeOf(a){return _getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(a){return a.__proto__||Object.getPrototypeOf(a)},_getPrototypeOf(a)}var dontParse=Symbol("dontParse"),expandBind=Symbol("expandBind"),uuid=Symbol("uuid"),moveIndex=0,View=function(a){function b(){var a,d=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:null;return _classCallCheck(this,b),a=c.call(this),Object.defineProperty(_assertThisInitialized(a),"args",{value:_Bindable.Bindable.make(d)}),Object.defineProperty(_assertThisInitialized(a),uuid,{value:a.uuid()}),Object.defineProperty(_assertThisInitialized(a),"attach",{value:new _Bag.Bag(function(){})}),Object.defineProperty(_assertThisInitialized(a),"detach",{value:new _Bag.Bag(function(){})}),Object.defineProperty(_assertThisInitialized(a),"_onRemove",{value:new _Bag.Bag(function(){})}),Object.defineProperty(_assertThisInitialized(a),"cleanup",{value:[]}),Object.defineProperty(_assertThisInitialized(a),"parent",{value:e}),Object.defineProperty(_assertThisInitialized(a),"views",{value:new Map}),Object.defineProperty(_assertThisInitialized(a),"viewLists",{value:new Map}),Object.defineProperty(_assertThisInitialized(a),"withViews",{value:new Map}),Object.defineProperty(_assertThisInitialized(a),"tags",{value:_Bindable.Bindable.make({})}),Object.defineProperty(_assertThisInitialized(a),"nodes",{value:_Bindable.Bindable.make([])}),Object.defineProperty(_assertThisInitialized(a),"intervals",{value:[]}),Object.defineProperty(_assertThisInitialized(a),"timeouts",{value:[]}),Object.defineProperty(_assertThisInitialized(a),"frames",{value:[]}),Object.defineProperty(_assertThisInitialized(a),"ruleSet",{value:new _RuleSet.RuleSet}),Object.defineProperty(_assertThisInitialized(a),"preRuleSet",{value:new _RuleSet.RuleSet}),Object.defineProperty(_assertThisInitialized(a),"subBindings",{value:{}}),Object.defineProperty(_assertThisInitialized(a),"templates",{value:{}}),Object.defineProperty(_assertThisInitialized(a),"eventCleanup",{value:[]}),Object.defineProperty(_assertThisInitialized(a),"interpolateRegex",{value:/(\[\[((?:\$+)?[\w\.\|-]+)\]\])/g}),Object.defineProperty(_assertThisInitialized(a),"rendered",{value:new Promise(function(b){return Object.defineProperty(_assertThisInitialized(a),"renderComplete",{value:b})})}),a.template="",a.firstNode=null,a.lastNode=null,a.viewList=null,a.mainView=null,a.preserve=!1,a.removed=!1,_possibleConstructorReturn(a,_Bindable.Bindable.make(_assertThisInitialized(a)))}_inherits(b,a);var c=_createSuper(b);return _createClass(b,[{key:"_id",get:function get(){return this[uuid]}}],[{key:"from",value:function from(a){var b=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},c=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null,d=new this(b,c);return d.template=a,d}}]),_createClass(b,[{key:"onFrame",value:function onFrame(a){var b=this,d=!1,e=function(){d=!0},f=function(){b.removed||d||(!b.paused&&a(Date.now()),requestAnimationFrame(f))};return requestAnimationFrame(function(){return f(Date.now())}),this.frames.push(e),e}},{key:"onNextFrame",value:function onNextFrame(a){return requestAnimationFrame(function(){return a(Date.now())})}},{key:"onIdle",value:function onIdle(a){return requestIdleCallback(function(){return a(Date.now())})}},{key:"onTimeout",value:function onTimeout(a,b){var c=this,d=function(){c.timeouts[f].fired=!0,c.timeouts[f].callback=null,b()},e=setTimeout(d,a),f=this.timeouts.length;return this.timeouts.push({timeout:e,callback:d,time:a,fired:!1,created:new Date().getTime(),paused:!1}),e}},{key:"clearTimeout",value:function(a){function b(){return a.apply(this,arguments)}return b.toString=function(){return a.toString()},b}(function(a){for(var b in this.timeouts)a===this.timeouts[b].timeout&&(clearTimeout(this.timeouts[b].timeout),delete this.timeouts[b])})},{key:"onInterval",value:function onInterval(a,b){var c=setInterval(b,a);return this.intervals.push({timeout:c,callback:b,time:a,paused:!1}),c}},{key:"clearInterval",value:function(a){function b(){return a.apply(this,arguments)}return b.toString=function(){return a.toString()},b}(function(a){for(var b in this.intervals)a===this.intervals[b].timeout&&(clearInterval(this.intervals[b].timeout),delete this.intervals[b])})},{key:"pause",value:function pause(){var a=0<arguments.length&&void 0!==arguments[0]?arguments[0]:void 0;if(void 0===a&&(this.paused=!this.paused),this.paused=a,this.paused){for(var h in this.timeouts){if(this.timeouts[h].fired){delete this.timeouts[h];continue}clearTimeout(this.timeouts[h].timeout)}for(var j in this.intervals)clearInterval(this.intervals[j].timeout)}else{for(var k in this.timeouts)if(this.timeouts[k].timeout.paused){if(this.timeouts[k].fired){delete this.timeouts[k];continue}this.timeouts[k].timeout=setTimeout(this.timeouts[k].callback,this.timeouts[k].time)}for(var l in this.intervals)this.intervals[l].timeout.paused&&(this.intervals[l].timeout.paused=!1,this.intervals[l].timeout=setInterval(this.intervals[l].callback,this.intervals[l].time))}var b,c=_createForOfIteratorHelper(this.viewLists);try{for(c.s();!(b=c.n()).done;){var d=_slicedToArray(b.value,2),e=d[0],f=d[1];f.pause(!!a)}}catch(a){c.e(a)}finally{c.f()}for(var m in this.tags){if(Array.isArray(this.tags[m])){for(var g in this.tags[m])this.tags[m][g].pause(!!a);continue}this.tags[m].pause(!!a)}}},{key:"render",value:function render(){var a,c=this,d=0<arguments.length&&void 0!==arguments[0]?arguments[0]:null,e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:null;if(d instanceof b&&(d=d.firstNode.parentNode),e instanceof b&&(e=e.firstNode),this.firstNode)return this.reRender(d,e);this.dispatchEvent(new CustomEvent("render"));var f=this.template instanceof DocumentFragment?this.template.cloneNode(!0):b.templates.has(this.template),g=f?this.template instanceof DocumentFragment?f:b.templates.get(this.template).cloneNode(!0):document.createRange().createContextualFragment(this.template);if(f||this.template instanceof DocumentFragment||b.templates.set(this.template,g.cloneNode(!0)),this.mainView||this.preRuleSet.apply(g,this),this.mapTags(g),this.mainView||this.ruleSet.apply(g,this),!0===window.devMode?(this.firstNode=document.createComment("Template ".concat(this._id," Start")),this.lastNode=document.createComment("Template ".concat(this._id," End"))):(this.firstNode=document.createTextNode(""),this.lastNode=document.createTextNode("")),(a=this.nodes).push.apply(a,[this.firstNode].concat(_toConsumableArray(Array.from(g.childNodes)),[this.lastNode])),this.postRender(d),this.dispatchEvent(new CustomEvent("rendered")),!!this.dispatchAttach()){if(d){var h=d.getRootNode(),j="internal",k=!1;h.isConnected&&(k=!0,j="external"),e?(d.insertBefore(this.firstNode,e),d.insertBefore(this.lastNode,e)):(d.appendChild(this.firstNode),d.appendChild(this.lastNode)),d.insertBefore(g,this.lastNode),moveIndex++,k?(this.attached(h,d),this.dispatchAttached(h,d)):d.addEventListener("cvDomAttached",function(){c.attached(h,d),c.dispatchAttached(h,d)},{once:!0})}return this.renderComplete(this.nodes),this.nodes}}},{key:"dispatchAttach",value:function dispatchAttach(){return this.dispatchEvent(new CustomEvent("attach",{cancelable:!0,target:this}))}},{key:"dispatchAttached",value:function dispatchAttached(a,b){this.dispatchEvent(new CustomEvent("attached",{target:this}));var c=this.attach.items();for(var d in c)c[d](a,b);this.nodes.filter(function(a){return a.nodeType!==Node.COMMENT_NODE}).map(function(a){a.matches&&(_Dom.Dom.mapTags(a,!1,function(a){a.matches&&a.dispatchEvent(new Event("cvDomAttached",{target:a}))}),a.dispatchEvent(new Event("cvDomAttached",{target:a})))})}},{key:"reRender",value:function reRender(a,b){var c=this.dispatchEvent(new CustomEvent("reRender"),{cancelable:!0,target:this});if(c){var d=new DocumentFragment;if(this.firstNode.isConnected){var e=this.detach.items();for(var f in e)e[f]()}if(d.append.apply(d,_toConsumableArray(this.nodes)),a){b?(a.insertBefore(this.firstNode,b),a.insertBefore(this.lastNode,b)):(a.appendChild(this.firstNode),a.appendChild(this.lastNode)),a.insertBefore(d,this.lastNode),this.dispatchEvent(new CustomEvent("reRendered"),{cancelable:!0,target:this});var g=a.getRootNode();g.isConnected&&(this.attached(g,a),this.dispatchAttached(g,a))}return this.nodes}}},{key:"mapTags",value:function mapTags(a){var b=this;_Dom.Dom.mapTags(a,!1,function(a,c){a[dontParse]||(a.matches?(a=b.mapInterpolatableTag(a),a=a.matches("[cv-template]")&&b.mapTemplateTag(a)||a,a=a.matches("[cv-slot]")&&b.mapSlotTag(a)||a,a=a.matches("[cv-prerender]")&&b.mapPrendererTag(a)||a,a=a.matches("[cv-link]")&&b.mapLinkTag(a)||a,a=a.matches("[cv-attr]")&&b.mapAttrTag(a)||a,a=a.matches("[cv-expand]")&&b.mapExpandableTag(a)||a,a=a.matches("[cv-ref]")&&b.mapRefTag(a)||a,a=a.matches("[cv-on]")&&b.mapOnTag(a)||a,a=a.matches("[cv-each]")&&b.mapEachTag(a)||a,a=a.matches("[cv-bind]")&&b.mapBindTag(a)||a,a=a.matches("[cv-with]")&&b.mapWithTag(a)||a,a=a.matches("[cv-if]")&&b.mapIfTag(a)||a,a=a.matches("[cv-view]")&&b.mapViewTag(a)||a):a=b.mapInterpolatableTag(a),a!==c.currentNode&&(c.currentNode=a))})}},{key:"mapExpandableTag",value:function mapExpandableTag(a){var b=a[expandBind];b&&(b(),a[expandBind]=!1);var c=_Bindable.Bindable.resolve(this.args,a.getAttribute("cv-expand"),!0),d=_slicedToArray(c,2),e=d[0],f=d[1];return a.removeAttribute("cv-expand"),e[f]||(e[f]={}),this.onRemove(a[expandBind]=e[f].bindTo(function(b,c,e,f){return f||void 0===b?void a.removeAttribute(c,b):null===b?void a.setAttribute(c,""):void a.setAttribute(c,b)})),a}},{key:"compileExpandableTag",value:function compileExpandableTag(a){return function(b){var c=a.cloneNode(!0),d=c.getAttribute("cv-expand"),e=_Bindable.Bindable.make(b.args[d]||{});c.removeAttribute("cv-expand");var f=function(a){if("name"===a||"type"===a)return"continue";var d=e.bindTo(a,function(a,b){return function(c){a.setAttribute(b,c)}}(c,a));b.onRemove(function(){d(),e.isBound()&&_Bindable.Bindable.clearBindings(e)})};for(var h in e){var g=f(h)}return c}}},{key:"mapAttrTag",value:function mapAttrTag(a){var b=this.compileAttrTag(a),c=b(this);return a.replaceWith(c),c}},{key:"compileAttrTag",value:function compileAttrTag(a){var b=a.getAttribute("cv-attr"),c=b.split(","),d=c.map(function(a){return a.split(":")});return a.removeAttribute("cv-attr"),function(b){var c=a.cloneNode(!0),e=function(a){var e=d[a][1]||d[a][0],f=_Bindable.Bindable.resolve(b.args,e,!0),g=_slicedToArray(f,2),h=g[0],j=g[1],l=d[a][0];b.onRemove(h.bindTo(j,function(a,b,e,f){return f||void 0===a?void c.removeAttribute(l,a):null===a?void c.setAttribute(l,""):void c.setAttribute(l,a)}))};for(var f in d)e(f);return c}}},{key:"mapInterpolatableTag",value:function mapInterpolatableTag(a){var c=this,d=this.interpolateRegex;if(a.nodeType===Node.TEXT_NODE){var o=a.nodeValue;if(!this.interpolatable(o))return a;for(var e,f,g=0,h=function(){var d=e[2],f=!1,h=!1,j=d.split("|"),l=!1;if(1<j.length&&(l=c.stringTransformer(j.slice(1)),d=j[0]),"$$"===d.substr(0,2)&&(f=!0,h=!0,d=d.substr(2)),"$"===d.substr(0,1)&&(f=!0,d=d.substr(1)),"000"===d.substr(0,3))return expand=!0,d=d.substr(3),"continue";var m=o.substring(g,e.index);g=e.index+e[1].length;var n=document.createTextNode(m);n[dontParse]=!0,a.parentNode.insertBefore(n,a);var p;p=f?document.createElement("div"):document.createTextNode(""),p[dontParse]=!0;var q=c.args,r=d;if(d.match(/\./)){var s=_Bindable.Bindable.resolve(c.args,d,!0),t=_slicedToArray(s,2);q=t[0],r=t[1]}a.parentNode.insertBefore(p,a);var u=q.bindTo(r,function(d,e,g){if(g[e]!==d&&(g[e]instanceof b||g[e]instanceof Node||g[e]instanceof _Tag.Tag)&&!g[e].preserve&&g[e].remove(),p.nodeValue="",h&&!(d instanceof b)){var j=d;d=new b(c.args,c),d.template=j}if(l&&(d=l(d)),d instanceof b){var k=function(a){d.dispatchAttach()&&(d.attached(a),d.dispatchAttached())};c.attach.add(k),d.render(a.parentNode,p);var m=function(){d.preserve||d.remove()};c.onRemove(m),d.onRemove(function(){c.attach.remove(k),c._onRemove.remove(m)})}else d instanceof Node?(a.parentNode.insertBefore(d,p),c.onRemove(function(){return d.remove()})):d instanceof _Tag.Tag?(a.parentNode.insertBefore(d.node,p),c.onRemove(function(){return d.remove()})):(d instanceof Object&&d.__toString instanceof Function&&(d=d.__toString()),f?p.innerHTML=d:p.nodeValue=d);p[dontParse]=!0});c.onRemove(u)};e=d.exec(o);)f=h(),"continue"===f;var j=o.substring(g),k=document.createTextNode(j);k[dontParse]=!0,a.parentNode.insertBefore(k,a),a.nodeValue=""}if(a.nodeType===Node.ELEMENT_NODE)for(var l,m=function(b){if(!c.interpolatable(a.attributes[b].value))return"continue";for(var e=0,f=void 0,g=a.attributes[b].value,h=a.attributes[b],l={},m=[];f=d.exec(g);)m.push(g.substring(e,f.index)),l[f[2]]||(l[f[2]]=[]),l[f[2]].push(m.length),m.push(f[1]),e=f.index+f[1].length;m.push(g.substring(e));var n=function(b){var d=c.args,e=b,f=b.split("|"),g=!1,j=b;if(1<f.length&&(g=c.stringTransformer(f.slice(1)),e=f[0]),e.match(/\./)){var k=_Bindable.Bindable.resolve(c.args,e,!0),n=_slicedToArray(k,2);d=n[0],e=n[1]}l[j];c.onRemove(d.bindTo(e,function(b,c,d){for(var f in g&&(b=g(b)),l)for(var k in l[j])m[l[j][k]]=d[f],c===e&&(m[l[j][k]]=b);a.setAttribute(h.name,m.join(""))})),c.onRemove(function(){d.isBound()||_Bindable.Bindable.clearBindings(d)})};for(var o in l)n(o)},n=0;n<a.attributes.length;n++)l=m(n),"continue"===l;return a}},{key:"mapRefTag",value:function mapRefTag(a){var b=a.getAttribute("cv-ref"),c=b.split(":"),d=_slicedToArray(c,3),e=d[0],f=d[1],g=void 0===f?null:f,h=d[2],j=void 0===h?null:h,k=_Tag.Tag;g&&(k=this.stringToClass(g)),a.removeAttribute("cv-ref"),Object.defineProperty(a,"___tag___",{enumerable:!1,writable:!0}),this.onRemove(function(){a.___tag___=null,a.remove()});var l=this,m=this;this.viewList&&(l=this.viewList.parent);var n=new k(a,this,e,void 0,m);for(a.___tag___=n,this.tags[e]=n;l;){!l.parent;var o=this.args[j];void 0===o?l.tags[e]=n:(!l.tags[e]&&(l.tags[e]=[]),l.tags[e][o]=n),l=l.parent}return a}},{key:"mapBindTag",value:function mapBindTag(a){var c=this,d=a.getAttribute("cv-bind"),e=this.args,f=d,g=null;if(d.match(/\./)){var h=_Bindable.Bindable.resolve(this.args,d,!0),j=_slicedToArray(h,3);e=j[0],f=j[1],g=j[2]}e!==this.args&&(this.subBindings[d]=this.subBindings[d]||[],this.onRemove(this.args.bindTo(g,function(){for(;c.subBindings.length;)c.subBindings.shift()()})));var l=!1;"$"===f.substr(0,1)&&(f=f.substr(1),l=!0);var m=e.bindTo(f,function(e,f,g,h,d){(d instanceof b||d instanceof Node||d instanceof _Tag.Tag)&&d!==e&&d.remove();var j=new CustomEvent("cvAutoChanged",{bubbles:!0});if(["INPUT","SELECT","TEXTAREA"].includes(a.tagName)){var r=a.getAttribute("type");if(r&&"checkbox"===r.toLowerCase())a.checked=!!e,a.dispatchEvent(j);else if(r&&"radio"===r.toLowerCase())a.checked=e==a.value,a.dispatchEvent(j);else if("file"!==r){if("SELECT"===a.tagName){var s=function(){var b,c=_createForOfIteratorHelper(a.options);try{for(c.s();!(b=c.n()).done;){var d=b.value;d.value==e&&(a.selectedIndex=i)}}catch(a){c.e(a)}finally{c.f()}};c.attach.add(s)}else a.value=null==e?"":e;a.dispatchEvent(j)}}else if(e instanceof b){var k,m=_createForOfIteratorHelper(a.childNodes);try{for(m.s();!(k=m.n()).done;){var t=k.value;t.remove()}}catch(a){m.e(a)}finally{m.f()}var u=function(a){e.dispatchAttach()&&(e.attached(a),e.dispatchAttached())};c.attach.add(u),e.render(a),e.onRemove(function(){return c.attach.remove(u)})}else if(e instanceof Node)a.insert(e);else if(e instanceof _Tag.Tag)a.append(e.node);else if(l){if(a.innerHTML!==e){if(e+="",a.innerHTML===e.substring(0,a.innerHTML.length))a.innerHTML+=e.substring(a.innerHTML.length);else{var n,o=_createForOfIteratorHelper(a.childNodes);try{for(o.s();!(n=o.n()).done;){var w=n.value;w.remove()}}catch(a){o.e(a)}finally{o.f()}a.innerHTML=e}_Dom.Dom.mapTags(a,!1,function(a){return a[dontParse]=!0})}}else if(a.textContent!==e){var p,q=_createForOfIteratorHelper(a.childNodes);try{for(q.s();!(p=q.n()).done;){var x=p.value;x.remove()}}catch(a){q.e(a)}finally{q.f()}a.textContent=e}});e!==this.args&&this.subBindings[d].push(m),this.onRemove(m);var n=a.getAttribute("type"),o=a.getAttribute("multiple"),p=function(b){if(b.target===a)if(n&&"checkbox"===n.toLowerCase())e[f]=!!a.checked&&b.target.getAttribute("value");else if(b.target.matches("[contenteditable=true]"))e[f]=b.target.innerHTML;else if("file"===n&&o){var c=Array.from(b.target.files),d=e[f]||_Bindable.Bindable.onDeck(e,f);if(!d||!c.length)e[f]=c;else{var g=function(a){if(c[a]!==d[a])return c[a].toJSON=function(){return{name:file[a].name,size:file[a].size,type:file[a].type,date:file[a].lastModified}},d[a]=c[a],"break"};for(var j in c){var h=g(j);if("break"===h)break}}}else if("file"===n&&!o){var k=b.target.files.item(0);k.toJSON=function(){return{name:k.name,size:k.size,type:k.type,date:k.lastModified}},e[f]=k}else e[f]=b.target.value};return"file"===n||"radio"===n?a.addEventListener("change",p):(a.addEventListener("input",p),a.addEventListener("change",p),a.addEventListener("value-changed",p)),this.onRemove(function(a,b){return function(){"file"===n||"radio"===n?a.removeEventListener("change",p):(a.removeEventListener("input",p),a.removeEventListener("change",p),a.removeEventListener("value-changed",p)),a=void 0,b=void 0}}(a,p)),a.removeAttribute("cv-bind"),a}},{key:"mapOnTag",value:function mapOnTag(a){var b=this,c=a.getAttribute("cv-on")+"";return c.split(";").map(function(b){return b.split(":")}).map(function(c){c=c.map(function(b){return b.trim()});var d=c.length,e=(c.shift()+"").trim(),f=((c.shift()||e)+"").trim(),g=((c.shift()||"")+"").trim(),h=[],j=/(\w+)(?:\(([$\w\s-'",]+)\))?/.exec(f);j?(f=j[1].replace(/(^[\s\n]+|[\s\n]+$)/,""),j[2]&&(h=j[2].split(",").map(function(a){return a.trim()})),j.length):h.push("$event"),e&&1!==d||(e=f);for(var k,l=b;l;){if("function"==typeof l[f]){var m=function(){var a=l,b=f;return k=function(){a[b].apply(a,arguments)},"break"}();if("break"===m)break}if(l.parent)l=l.parent;else break}var n=function(c){var d=h.map(function(d){var e;return parseInt(d)==d?d:"event"===d||"$event"===d?c:"$view"===d?l:"$tag"===d?a:"$parent"===d?b.parent:"$subview"===d?b:d in b.args?b.args[d]:(e=/^['"]([\w-]+?)["']$/.exec(d))?e[1]:void 0});if("function"!=typeof k)throw new Error("".concat(f," is not defined on View object.")+"\nTag:\n"+"".concat(a.outerHTML));k.apply(void 0,_toConsumableArray(d))},o={};switch(g.includes("p")?o.passive=!0:g.includes("P")&&(o.passive=!1),g.includes("c")?o.capture=!0:g.includes("C")&&(o.capture=!1),g.includes("o")?o.once=!0:g.includes("O")&&(o.once=!1),e){case"_init":n();break;case"_attach":b.attach.add(n);break;case"_detach":b.detach.add(n);break;default:a.addEventListener(e,n,o),b.onRemove(function(){a.removeEventListener(e,n,o)});}return[e,f,h]}),a.removeAttribute("cv-on"),a}},{key:"mapLinkTag",value:function mapLinkTag(a){var b=a.getAttribute("cv-link");a.setAttribute("href",b);var c=function(c){return c.preventDefault(),"http"===b.substring(0,4)||"//"===b.substring(0,2)?void window.open(a.getAttribute("href",b)):void _Router.Router.go(a.getAttribute("href"))};return a.addEventListener("click",c),this.onRemove(function(a,b){return function(){a.removeEventListener("click",b),a=void 0,b=void 0}}(a,c)),a.removeAttribute("cv-link"),a}},{key:"compileLinkTag",value:function compileLinkTag(a){var b=a.getAttribute("cv-link");return a.removeAttribute("cv-link"),function(){var c=a.cloneNode(!0);return c.setAttribute("href",b),c}}},{key:"mapPrendererTag",value:function mapPrendererTag(a){var b=a.getAttribute("cv-prerender"),c=window.prerenderer||navigator.userAgent.match(/prerender/i);return c&&(window.prerenderer=window.prerenderer||!0),("never"===b&&c||"only"===b&&!c)&&a.parentNode.removeChild(a),a}},{key:"mapWithTag",value:function mapWithTag(a){var c=this,d=a.getAttribute("cv-with"),e=a.getAttribute("cv-carry"),f=a.getAttribute("cv-view");a.removeAttribute("cv-with"),a.removeAttribute("cv-carry"),a.removeAttribute("cv-view");var g=f?this.stringToClass(f):b,h=new DocumentFragment;_toConsumableArray(a.childNodes).map(function(a){return h.appendChild(a)});var j=[];e&&(j=e.split(",").map(function(a){return a.trim()}));var k=this.args.bindTo(d,function(b){for(c.withViews.has(a)&&c.withViews["delete"](a);a.firstChild;)a.removeChild(a.firstChild);var d=new g({},c);c.onRemove(function(a){return function(){a.remove()}}(d)),d.template=h;var e=function(a){var b=c.args.bindTo(j[a],function(a,b){d.args[b]=a});d.onRemove(b),c.onRemove(function(){b(),d.remove()})};for(var k in j)e(k);var f=function(a){var e=b.bindTo(a,function(a,b){d.args[b]=a}),f=d.args.bindTo(a,function(a,c){b[c]=a});c.onRemove(function(){e(),b.isBound()||_Bindable.Bindable.clearBindings(b),d.remove()}),d.onRemove(function(){e(),b.isBound()||_Bindable.Bindable.clearBindings(b)})};for(var l in b)f(l);d.render(a),c.withViews.set(a,d)});return this.onRemove(function(){c.withViews["delete"](a),k()}),a}},{key:"mapViewTag",value:function mapViewTag(a){var c=this,d=a.getAttribute("cv-view");a.removeAttribute("cv-view");var e=new DocumentFragment;_toConsumableArray(a.childNodes).map(function(a){return e.appendChild(a)});var f=d.split(":"),g=f.pop()?this.stringToClass(d):b,h=f.shift(),j=new g(this.args,this);return this.views.set(a,j),h&&this.views.set(h,j),this.onRemove(function(b){return function(){b.remove(),c.views["delete"](a),c.views["delete"](h)}}(j)),j.template=e,j.render(a),a}},{key:"mapEachTag",value:function mapEachTag(a){var c=this,d=a.getAttribute("cv-each"),e=a.getAttribute("cv-view");a.removeAttribute("cv-each"),a.removeAttribute("cv-view");var f=e?this.stringToClass(e):b,g=new DocumentFragment;Array.from(a.childNodes).map(function(a){return g.appendChild(a)});var h=d.split(":"),j=_slicedToArray(h,3),k=j[0],l=j[1],m=j[2],n=this.args.bindTo(k,function(b){c.viewLists.has(a)&&c.viewLists.get(a).remove();var e=new _ViewList.ViewList(g,l,b,c,m,f),h=function(){return e.remove()};c.onRemove(h),e.onRemove(function(){return c._onRemove.remove(h)});var j=c.args.bindTo(function(a,b,c,f){"_id"===b||(f&&delete e.subArgs[b],e.subArgs[b]=a)}),k=e.args.bindTo(function(a,b,e,f){"_id"===b||"value"===b||"___"===b.substring(0,3)||(f&&delete c.args[b],b in c.args&&(c.args[b]=a))});for(e.onRemove(j),e.onRemove(k),c.onRemove(j),c.onRemove(k);a.firstChild;)a.removeChild(a.firstChild);c.viewLists.set(a,e),e.render(a)});return this.onRemove(n),a}},{key:"mapIfTag",value:function mapIfTag(a){var c=a,d=c.getAttribute("cv-if"),e=!1,f=!1;c.removeAttribute("cv-if"),"!"===d.substr(0,1)&&(d=d.substr(1),e=!0),"?"===d.substr(0,1)&&(d=d.substr(1),f=!0);var g=new DocumentFragment;Array.from(c.childNodes).map(function(a){return g.appendChild(a)});var h=this,j=new DocumentFragment,k=new b(this.args,h);k.template=g;var l=h.args,m=d;if(d.match(/\./)){var n=_Bindable.Bindable.resolve(h.args,d,!0),o=_slicedToArray(n,2);l=o[0],m=o[1]}var p=!1,q=l.bindTo(m,function(b){f&&(b=null!==b&&void 0!==b),Array.isArray(b)&&(b=!!b.length),e&&(b=!b),p||(k.render(j),p=!0),b?a.appendChild(j):k.nodes.map(function(a){return j.appendChild(a)})});h.onRemove(q);var r=function(){l.isBound()||_Bindable.Bindable.clearBindings(l)};return h.onRemove(function viewDebind(){q(),r(),h._onRemove.remove(q),h._onRemove.remove(r)}),a}},{key:"compileIfTag",value:function compileIfTag(a){var c=a.getAttribute("cv-if"),d=!1;a.removeAttribute("cv-if"),"!"===c.substr(0,1)&&(c=c.substr(1),d=!0);var e=new DocumentFragment;return Array.from(a.childNodes).map(function(a){return e.appendChild(a.cloneNode(!0))}),function(f){var g=a.cloneNode(),h=new DocumentFragment,j=new b({},f);j.template=e,f.syncBind(j);var k=f.args,l=c;if(c.match(/\./)){var m=_Bindable.Bindable.resolve(f.args,c,!0),n=_slicedToArray(m,2);k=n[0],l=n[1]}var o=!1,p=k.bindTo(l,function(a){if(!o){var b=f.args[l]||d?g:h;return j.render(b),void(o=!0)}Array.isArray(a)&&(a=!!a.length),d&&(a=!a),a?g.appendChild(h):j.nodes.map(function(a){return h.appendChild(a)})});f.onRemove(p);var q=function(){k.isBound()||_Bindable.Bindable.clearBindings(k)};return j.onRemove(function viewDebind(){p(),q(),f._onRemove.remove(p),f._onRemove.remove(q)}),g}}},{key:"mapTemplateTag",value:function mapTemplateTag(a){var b=a.getAttribute("cv-template");return a.removeAttribute("cv-template"),this.templates[b]=function(){return"TEMPLATE"===a.tagName?a.content.cloneNode(!0):new DocumentFragment(a.innerHTML)},this.rendered.then(function(){return a.remove()}),a}},{key:"mapSlotTag",value:function mapSlotTag(a){var b=a.getAttribute("cv-slot"),c=this.templates[b];if(!c){for(var e=this;e&&(c=e.templates[b],!c);)e=this.parent;if(!c)return void console.error("Template ".concat(b," not found."))}var d=c();for(a.removeAttribute("cv-slot");a.firstChild;)a.firstChild.remove();return a.appendChild(d),a}},{key:"syncBind",value:function syncBind(a){var c=this,d=this.args.bindTo(function(b,c){"_id"===c||a.args[c]!==b&&(a.args[c]=b)}),e=a.args.bindTo(function(a,e,f,g,d){if("_id"!==e){var h=a,j=d;h instanceof b&&(h=h.___ref___),j instanceof b&&(j=j.___ref___),h!==j&&j instanceof b&&d.remove(),e in c.args&&(c.args[e]=a)}});this.onRemove(d),this.onRemove(e),a.onRemove(function(){c._onRemove.remove(d),c._onRemove.remove(e)})}},{key:"postRender",value:function postRender(){}},{key:"attached",value:function attached(){}},{key:"interpolatable",value:function interpolatable(a){return!!(a+"").match(this.interpolateRegex)}},{key:"uuid",value:function(){return"10000000-1000-4000-8000-100000000000".replace(/[018]/g,function(a){return(a^crypto.getRandomValues(new Uint8Array(1))[0]&15>>a/4).toString(16)})}},{key:"remove",value:function remove(){var a=this,b=!!(0<arguments.length&&void 0!==arguments[0])&&arguments[0],c=function(){for(var b in a.nodes)a.nodes[b]&&a.nodes[b].dispatchEvent(new Event("cvDomDetached")),a.nodes[b]&&a.nodes[b].remove();a.firstNode=a.lastNode=void 0};b?c():requestAnimationFrame(c);var d,e=this._onRemove.items(),f=_createForOfIteratorHelper(e);try{for(f.s();!(d=f.n()).done;){var n=d.value;this._onRemove.remove(n),n()}}catch(a){f.e(a)}finally{f.f()}for(var o;o=this.cleanup.shift();)o&&o();var g,h=_createForOfIteratorHelper(this.viewLists);try{for(h.s();!(g=h.n()).done;){var j=_slicedToArray(g.value,2),k=j[0],l=j[1];l.remove()}}catch(a){h.e(a)}finally{h.f()}for(var p in this.viewLists.clear(),this.timeouts)clearTimeout(this.timeouts[p].timeout),delete this.timeouts[p];for(var m in this.intervals)clearInterval(this.intervals[m].timeout),delete this.intervals[m];for(var m in this.frames)this.frames[m](),delete this.frames[m];this.removed=!0}},{key:"findTag",value:function findTag(a){for(var b in this.nodes){var c=void 0;if(this.nodes[b].querySelector){if(this.nodes[b].matches(a))return new _Tag.Tag(this.nodes[b],this,void 0,void 0,this);if(c=this.nodes[b].querySelector(a))return new _Tag.Tag(c,this,void 0,void 0,this)}}}},{key:"findTags",value:function findTags(a){var b=this;return this.nodes.filter(function(a){return a.querySelectorAll}).map(function(b){return _toConsumableArray(b.querySelectorAll(a))}).flat().map(function(a){return new _Tag.Tag(a,b,void 0,void 0,b)})}},{key:"onRemove",value:function onRemove(a){this._onRemove.add(a)}},{key:"update",value:function update(){}},{key:"beforeUpdate",value:function beforeUpdate(){}},{key:"afterUpdate",value:function afterUpdate(){}},{key:"stringTransformer",value:function stringTransformer(a){var b=this;return function(c){for(var f in a){for(var d=b,e=a[f];d&&!d[e];)d=d.parent;if(!d)return;c=d[a[f]](c)}return c}}},{key:"stringToClass",value:function stringToClass(a){if(b.refClasses.has(a))return b.refClasses.get(a);var c=a.split("/"),d=c[c.length-1],e=require(a);return b.refClasses.set(a,e[d]),e[d]}},{key:"preventParsing",value:function preventParsing(a){a[dontParse]=!0}},{key:"toString",value:function toString(){return this.nodes.map(function(a){return a.outerHTML}).join(" ")}},{key:"listen",value:function listen(a,c,d,e){var f=this;if("string"==typeof a&&(e=d,d=c,c=a,a=this),a instanceof b)return this.listen(a.nodes,c,d,e);if(Array.isArray(a)){var j=a.map(function(a){return f.listen(a,c,d,e)});return function(){return j.map(function(a){return a()})}}if(a instanceof _Tag.Tag)return this.listen(a.element,c,d,e);a.addEventListener(c,d,e);var g=function(){a.removeEventListener(c,d,e)},h=function(){g(),g=function(){}};return this.onRemove(function(){return h()}),h}}],[{key:"isView",value:function isView(){return b}}]),b}(_Mixin.Mixin["with"](_EventTargetMixin.EventTargetMixin));exports.View=View,Object.defineProperty(View,"templates",{value:new Map}),Object.defineProperty(View,"refClasses",{value:new Map});
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.ViewList=void 0;var _Bindable=require("./Bindable"),_View=require("./View"),_Bag=require("./Bag");function _createForOfIteratorHelper(a,b){var c;if("undefined"==typeof Symbol||null==a[Symbol.iterator]){if(Array.isArray(a)||(c=_unsupportedIterableToArray(a))||b&&a&&"number"==typeof a.length){c&&(a=c);var d=0,e=function(){};return{s:e,n:function n(){return d>=a.length?{done:!0}:{done:!1,value:a[d++]}},e:function e(a){throw a},f:e}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var f,g=!0,h=!1;return{s:function s(){c=a[Symbol.iterator]()},n:function n(){var a=c.next();return g=a.done,a},e:function e(a){h=!0,f=a},f:function f(){try{g||null==c["return"]||c["return"]()}finally{if(h)throw f}}}}function _unsupportedIterableToArray(a,b){if(a){if("string"==typeof a)return _arrayLikeToArray(a,b);var c=Object.prototype.toString.call(a).slice(8,-1);return"Object"===c&&a.constructor&&(c=a.constructor.name),"Map"===c||"Set"===c?Array.from(a):"Arguments"===c||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(c)?_arrayLikeToArray(a,b):void 0}}function _arrayLikeToArray(a,b){(null==b||b>a.length)&&(b=a.length);for(var c=0,d=Array(b);c<b;c++)d[c]=a[c];return d}function _typeof(a){"@babel/helpers - typeof";return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(a){return typeof a}:function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a},_typeof(a)}function _classCallCheck(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function _defineProperties(a,b){for(var c,d=0;d<b.length;d++)c=b[d],c.enumerable=c.enumerable||!1,c.configurable=!0,"value"in c&&(c.writable=!0),Object.defineProperty(a,c.key,c)}function _createClass(a,b,c){return b&&_defineProperties(a.prototype,b),c&&_defineProperties(a,c),a}var ViewList=function(){function a(b,c,d,e){var f=this,g=4<arguments.length&&void 0!==arguments[4]?arguments[4]:null,h=5<arguments.length&&void 0!==arguments[5]?arguments[5]:null;_classCallCheck(this,a),this.removed=!1,this.args=_Bindable.Bindable.makeBindable({}),this.args.value=_Bindable.Bindable.makeBindable(d||{}),this.subArgs=_Bindable.Bindable.makeBindable({}),this.views=[],this.cleanup=[],this.viewClass=h||_View.View,this._onRemove=new _Bag.Bag,this.template=b,this.subProperty=c,this.keyProperty=g,this.tag=null,this.paused=!1,this.parent=e,this.rendered=new Promise(function(a){Object.defineProperty(f,"renderComplete",{configurable:!1,writable:!0,value:a})}),this.willReRender=!1,this.args.___before(function(a,b){"bindTo"==b||(f.paused=!0)}),this.args.___after(function(a,b,c){"bindTo"==b||(f.paused=1<c.length,f.reRender())});var i=this.args.value.bindTo(function(a,b,c,e){if(!f.paused){var d=b;if("symbol"!==_typeof(b))if(isNaN(b)&&(d="_"+b),e)for(var g in f.views[d]&&f.views[d].remove(),delete f.views[d],f.views){if("string"==typeof g){f.views[g].args[f.keyProperty]=g.substr(1);continue}f.views[g].args[f.keyProperty]=g}else f.views[d]||f.willReRender?f.views[d]&&f.views[d].args&&(f.views[d].args[f.keyProperty]=b,f.views[d].args[f.subProperty]=a):f.willReRender=requestAnimationFrame(function(){f.reRender()})}});this._onRemove.add(i)}return _createClass(a,[{key:"render",value:function render(a){var b,c=this,d=[],e=_createForOfIteratorHelper(this.views);try{var f=function(){var c=b.value;c.render(a),d.push(c.rendered.then(function(){return c}))};for(e.s();!(b=e.n()).done;)f()}catch(a){e.e(a)}finally{e.f()}this.tag=a,Promise.all(d).then(function(a){return c.renderComplete(a)})}},{key:"reRender",value:function reRender(){var a=this;if(!this.paused&&this.tag){var b=[];for(var o in this.views)b[o]=this.views[o];var c=[];this.upDebind&&this.upDebind.map(function(a){return a&&a()}),this.downDebind&&this.downDebind.map(function(a){return a&&a()}),this.upDebind=[],this.downDebind=[];var d=1/0,e=1/0,f=function(f){var g=!1,h=f;for(var l in h=isNaN(h)?"_"+f:+h,b)if(b[l]&&void 0!==a.args.value[f]&&a.args.value[f]===b[l].args[a.subProperty]){g=!0,c[h]=b[l],isNaN(h)||(d=Math.min(d,h),0<h&&(e=Math.min(e,h))),c[h].args[a.keyProperty]=f,delete b[l];break}if(!g){var i={},j=c[h]=new a.viewClass(i,a.parent);isNaN(h)||(d=Math.min(d,h),0<h&&(e=Math.min(e,h))),c[h].template=a.template instanceof Object?a.template:a.template,c[h].viewList=a,c[h].args[a.keyProperty]=f,c[h].args[a.subProperty]=a.args.value[f],a.upDebind[h]=i.bindTo(a.subProperty,function(b,c,e,f){var d=i[a.keyProperty];return f?void delete a.args.value[d]:void(a.args.value[d]=b)}),a.downDebind[h]=a.subArgs.bindTo(function(a,b,c,e){return e?void delete i[b]:void(i[b]=a)}),j.onRemove(function(){a.upDebind[h]&&a.upDebind[h](),a.downDebind[h]&&a.downDebind[h](),delete a.downDebind[h],delete a.upDebind[h]}),a._onRemove.add(function(){a.upDebind.filter(function(a){return a}).map(function(a){return a()}),a.upDebind.splice(0)}),a._onRemove.add(function(){a.downDebind.filter(function(a){return a}).map(function(a){return a()}),a.downDebind.splice(0)}),i[a.subProperty]=a.args.value[f]}};for(var i in this.args.value)f(i);for(var p in b){var q=!1;for(var r in c)if(b[p]===c[r]){q=!0;break}q||b[p].remove()}if(Array.isArray(this.args.value)){var g=0===d&&void 0!==c[1]&&1<c.length||e===1/0?d:e,h=function(){for(var b=0<arguments.length&&void 0!==arguments[0]?arguments[0]:0,d=c.length-b-1;d>g&&void 0===c[d];)d--;return d<g?Promise.resolve():c[d]===a.views[d]?c[d].firstNode?h(+b+1):(c[d].render(a.tag,c[d+1]),c[d].rendered.then(function(){return h(+b+1)})):(c[d].render(a.tag,c[d+1]),a.views.splice(d,0,c[d]),c[d].rendered.then(function(){return h(+b+1)}))};this.rendered=h()}else{var k=[],l=Object.assign({},c),m=function(b){return delete l[b],c[b].firstNode&&c[b]===a.views[b]?"continue":void(c[b].render(a.tag),k.push(c[b].rendered.then(function(){return c[b]})))};for(var j in c){var n=m(j)}for(var s in l)delete this.args.views[s],l.remove();this.rendered=Promise.all(k)}for(var t in this.views=c,c){if(isNaN(t)){c[t].args[this.keyProperty]=t.substr(1);continue}c[t].args[this.keyProperty]=t}this.willReRender=!1}}},{key:"pause",value:function pause(){var a=!(0<arguments.length&&void 0!==arguments[0])||arguments[0];for(var b in this.views)this.views[b].pause(a)}},{key:"onRemove",value:function onRemove(a){this._onRemove.add(a)}},{key:"remove",value:function remove(){for(var b in this.views)this.views[b].remove();var a=this._onRemove.items();for(var c in a)this._onRemove.remove(a[c]),a[c]();for(var d;this.cleanup.length;)d=this.cleanup.pop(),d();for(this.views=[];this.tag&&this.tag.firstChild;)this.tag.removeChild(this.tag.firstChild);this.subArgs&&_Bindable.Bindable.clearBindings(this.subArgs),_Bindable.Bindable.clearBindings(this.args),this.args.value&&!this.args.value.isBound()&&_Bindable.Bindable.clearBindings(this.args.value),this.removed=!0}}]),a}();exports.ViewList=ViewList;
