"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.LoginView=void 0;var _Config=require("Config"),_View2=require("../base/View"),_Router=require("../base/Router"),_Repository=require("../base/Repository"),_UserRepository=require("./UserRepository"),_Toast=require("../toast/Toast"),_ToastAlert=require("../toast/ToastAlert");function _typeof(a){"@babel/helpers - typeof";return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(a){return typeof a}:function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a},_typeof(a)}function _classCallCheck(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function _defineProperties(a,b){for(var c,d=0;d<b.length;d++)c=b[d],c.enumerable=c.enumerable||!1,c.configurable=!0,"value"in c&&(c.writable=!0),Object.defineProperty(a,c.key,c)}function _createClass(a,b,c){return b&&_defineProperties(a.prototype,b),c&&_defineProperties(a,c),a}function _inherits(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function");a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,writable:!0,configurable:!0}}),b&&_setPrototypeOf(a,b)}function _setPrototypeOf(a,b){return _setPrototypeOf=Object.setPrototypeOf||function(a,b){return a.__proto__=b,a},_setPrototypeOf(a,b)}function _createSuper(a){var b=_isNativeReflectConstruct();return function(){var c,d=_getPrototypeOf(a);if(b){var e=_getPrototypeOf(this).constructor;c=Reflect.construct(d,arguments,e)}else c=d.apply(this,arguments);return _possibleConstructorReturn(this,c)}}function _possibleConstructorReturn(a,b){return b&&("object"===_typeof(b)||"function"==typeof b)?b:_assertThisInitialized(a)}function _assertThisInitialized(a){if(void 0===a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return a}function _isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(a){return!1}}function _getPrototypeOf(a){return _getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(a){return a.__proto__||Object.getPrototypeOf(a)},_getPrototypeOf(a)}var LoginView=function(a){function b(){var a;return _classCallCheck(this,b),a=c.call(this),a.template="\n\t\t\t<a cv-link = \"user\">User</a>\n\t\t\t<br />\n\t\t\t\n\t\t\t<a cv-link = \"user/login\">Login</a>\n\t\t\t<br />\n\n\t\t\t<a cv-link = \"user/register\">Register</a>\n\t\t\t<br />\n\n\t\t\t<a cv-link = \"user/logout\">Logout</a>\n\t\t\t<br />\n\n\t\t\t<input\n\t\t\t\ttype  = \"button\"\n\t\t\t\tvalue = \"Login via FaceBook\"\n\t\t\t \tcv-on = \"click:facebookLogin(event)\"\n\t\t\t />\n\t\t\t <input\n\t\t\t\ttype  = \"button\"\n\t\t\t\tvalue = \"Log Out\"\n\t\t\t \tcv-on = \"click:logout(event)\"\n\t\t\t />\n\t\t",a}_inherits(b,a);var c=_createSuper(b);return _createClass(b,[{key:"facebookLogin",value:function facebookLogin(a){var b=this;console.log("fb!"),a.preventDefault();window.open(_Config.Config.backend+"/facebookLogin");this.userCheck&&this.clearInterval(this.userCheck),this.userCheck=this.onInterval(333,function(){_UserRepository.UserRepository.getCurrentUser(!0).then(function(a){var c=a.body;c.id&&c&&(b.clearInterval(b.userCheck),_Router.Router.clearCache(),_Repository.Repository.clearCache(),_Toast.Toast.instance().pop(new _ToastAlert.ToastAlert({title:"Logged in as "+c.username,body:"ID: "+c.publicId,time:2400})))})})}},{key:"logout",value:function logout(){window.open(_Config.Config.backend+"/user/logout?page=app%3Fclose%3D1")}}]),b}(_View2.View);exports.LoginView=LoginView;
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.UserRepository=void 0;var _Config=require("../base/Config"),_Bindable=require("../base/Bindable"),_Repository2=require("../base/Repository");function _typeof(a){"@babel/helpers - typeof";return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(a){return typeof a}:function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a},_typeof(a)}function _classCallCheck(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function _defineProperties(a,b){for(var c,d=0;d<b.length;d++)c=b[d],c.enumerable=c.enumerable||!1,c.configurable=!0,"value"in c&&(c.writable=!0),Object.defineProperty(a,c.key,c)}function _createClass(a,b,c){return b&&_defineProperties(a.prototype,b),c&&_defineProperties(a,c),a}function _inherits(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function");a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,writable:!0,configurable:!0}}),b&&_setPrototypeOf(a,b)}function _setPrototypeOf(a,b){return _setPrototypeOf=Object.setPrototypeOf||function(a,b){return a.__proto__=b,a},_setPrototypeOf(a,b)}function _createSuper(a){var b=_isNativeReflectConstruct();return function(){var c,d=_getPrototypeOf(a);if(b){var e=_getPrototypeOf(this).constructor;c=Reflect.construct(d,arguments,e)}else c=d.apply(this,arguments);return _possibleConstructorReturn(this,c)}}function _possibleConstructorReturn(a,b){return b&&("object"===_typeof(b)||"function"==typeof b)?b:_assertThisInitialized(a)}function _assertThisInitialized(a){if(void 0===a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return a}function _isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(a){return!1}}function _getPrototypeOf(a){return _getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(a){return a.__proto__||Object.getPrototypeOf(a)},_getPrototypeOf(a)}var UserRepository=function(a){function b(){return _classCallCheck(this,b),c.apply(this,arguments)}_inherits(b,a);var c=_createSuper(b);return _createClass(b,null,[{key:"getCurrentUser",value:function getCurrentUser(){var a=this,b=0<arguments.length&&void 0!==arguments[0]?arguments[0]:null;return window.prerenderer||navigator.userAgent.match(/prerender/i)?void(window.prerenderer=window.prerenderer||!0):this.args.response&&!1===b?Promise.resolve(this.args.response):this.request(this.uri+"current",!1,!1).then(function(b){if(b.body&&b.body.roles)for(var c in b.body.roles)"SeanMorris\\Access\\Role\\Administrator"==b.body.roles[c]["class"]&&(b.body.isAdmin=!0);return b.body&&b.body.id&&(a.args.response=b,a.args.current=b.body),b})["catch"](function(a){console.error(a)})}},{key:"login",value:function login(){return this.request(this.uri+"/login")}},{key:"logout",value:function logout(){var a=this,b=this.args.current;return delete this.args.current,this.request(this.uri+"logout",!1,{},!1).then(function(){return a.args.current=null,b})}},{key:"onChange",value:function onChange(a){return this.args.bindTo("current",a)}},{key:"uri",get:function get(){return _Config.Config.get("backend")+"/user/"}}]),b}(_Repository2.Repository);exports.UserRepository=UserRepository,Object.defineProperty(UserRepository,"args",{configurable:!1,writable:!1,value:_Bindable.Bindable.makeBindable({})}),_Repository2.Repository.onResponse(function(a){a&&a.meta&&"currentUser"in a.meta&&(!UserRepository.args.current||a.meta.currentUser.id!==UserRepository.args.current.id)&&(UserRepository.args.current=a.meta.currentUser)});
"use strict";var _Bindable=require("./Bindable");Object.defineProperty(exports,"__esModule",{value:!0}),exports.Bag=void 0;function _classCallCheck(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function _defineProperties(a,b){for(var c,d=0;d<b.length;d++)c=b[d],c.enumerable=c.enumerable||!1,c.configurable=!0,"value"in c&&(c.writable=!0),Object.defineProperty(a,c.key,c)}function _createClass(a,b,c){return b&&_defineProperties(a.prototype,b),c&&_defineProperties(a,c),a}var toId=function(a){return(+a).toString(36)},fromId=function(a){return parseInt(a,36)},Bag=function(){function a(){var b=0<arguments.length&&void 0!==arguments[0]?arguments[0]:void 0;_classCallCheck(this,a),this.meta=Symbol("meta"),this.content=new Map,this.list=_Bindable.Bindable.makeBindable({}),this.current=0,this.type=void 0,this.changeCallback=b}return _createClass(a,[{key:"add",value:function add(b){if(void 0===b||!(b instanceof Object))throw new Error("Only objects may be added to Bags.");if(this.type&&!(b instanceof this.type))throw console.error(this.type,b),new Error("Only objects of type ".concat(this.type," may be added to this Bag."));if(!this.content.has(b)){var c=toId(this.current++);this.content.set(b,c),this.list[c]=b,this.changeCallback&&this.changeCallback(b,this.meta,a.ITEM_ADDED,c)}}},{key:"remove",value:function remove(b){if(void 0===b||!(b instanceof Object))throw new Error("Only objects may be removed from Bags.");if(this.type&&!(b instanceof this.type))throw console.error(this.type,b),new Error("Only objects of type ".concat(this.type," may be removed from this Bag."));if(!this.content.has(b))return this.changeCallback&&this.changeCallback(b,this.meta,0,void 0),!1;var c=this.content.get(b);return delete this.list[c],this.content["delete"](b),this.changeCallback&&this.changeCallback(b,this.meta,a.ITEM_REMOVED,c),b}},{key:"items",value:function items(){return Array.from(this.content.entries()).map(function(a){return a[0]})}}]),a}();exports.Bag=Bag,Object.defineProperty(Bag,"ITEM_ADDED",{configurable:!1,enumerable:!1,writable:!0,value:1}),Object.defineProperty(Bag,"ITEM_REMOVED",{configurable:!1,enumerable:!1,writable:!0,value:-1});
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.Bindable=void 0;function _toConsumableArray(a){return _arrayWithoutHoles(a)||_iterableToArray(a)||_unsupportedIterableToArray(a)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(a,b){if(a){if("string"==typeof a)return _arrayLikeToArray(a,b);var c=Object.prototype.toString.call(a).slice(8,-1);return"Object"===c&&a.constructor&&(c=a.constructor.name),"Map"===c||"Set"===c?Array.from(a):"Arguments"===c||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(c)?_arrayLikeToArray(a,b):void 0}}function _iterableToArray(a){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(a))return Array.from(a)}function _arrayWithoutHoles(a){if(Array.isArray(a))return _arrayLikeToArray(a)}function _arrayLikeToArray(a,b){(null==b||b>a.length)&&(b=a.length);for(var c=0,d=Array(b);c<b;c++)d[c]=a[c];return d}function _construct(){return _construct=_isNativeReflectConstruct()?Reflect.construct:function(b,c,d){var e=[null];e.push.apply(e,c);var a=Function.bind.apply(b,e),f=new a;return d&&_setPrototypeOf(f,d.prototype),f},_construct.apply(null,arguments)}function _isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(a){return!1}}function _setPrototypeOf(a,b){return _setPrototypeOf=Object.setPrototypeOf||function(a,b){return a.__proto__=b,a},_setPrototypeOf(a,b)}function _typeof(a){"@babel/helpers - typeof";return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(a){return typeof a}:function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a},_typeof(a)}function _classCallCheck(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function _defineProperties(a,b){for(var c,d=0;d<b.length;d++)c=b[d],c.enumerable=c.enumerable||!1,c.configurable=!0,"value"in c&&(c.writable=!0),Object.defineProperty(a,c.key,c)}function _createClass(a,b,c){return b&&_defineProperties(a.prototype,b),c&&_defineProperties(a,c),a}var Ref=Symbol("ref"),Deck=Symbol("deck"),Binding=Symbol("binding"),BindingAll=Symbol("bindingAll"),IsBindable=Symbol("isBindable"),Executing=Symbol("executing"),Stack=Symbol("stack"),ObjSymbol=Symbol("object"),Wrapped=Symbol("wrapped"),Bindable=function(){function a(){_classCallCheck(this,a)}return _createClass(a,null,[{key:"isBindable",value:function isBindable(b){return!!(b&&b[Binding])&&b[Binding]===a}},{key:"onDeck",value:function onDeck(a,b){return a[Deck][b]||!1}},{key:"ref",value:function ref(a){return a[Ref]||!1}},{key:"makeBindable",value:function makeBindable(a){return this.make(a)}},{key:"make",value:function make(b){var c=this;if(!b||!["function","object"].includes(_typeof(b)))return b;var d=window||{},e=[d.Node,d.Map,d.Set,d.ResizeObserver,d.MutationObserver,d.PerformanceObserver,d.IntersectionObserver].filter(function(a){return"function"==typeof a});if(e.filter(function(a){return b instanceof a}).length||Object.isSealed(b)||!Object.isExtensible(b))return b;if(b[Ref])return b;if(b[Binding])return b;Object.defineProperty(b,Ref,{configurable:!0,enumerable:!1,writable:!0,value:b}),Object.defineProperty(b,Deck,{configurable:!1,enumerable:!1,writable:!1,value:{}}),Object.defineProperty(b,Binding,{configurable:!1,enumerable:!1,writable:!1,value:{}}),Object.defineProperty(b,BindingAll,{configurable:!1,enumerable:!1,writable:!1,value:[]}),Object.defineProperty(b,IsBindable,{configurable:!1,enumerable:!1,writable:!1,value:a}),Object.defineProperty(b,Executing,{enumerable:!1,writable:!0}),Object.defineProperty(b,Stack,{configurable:!1,enumerable:!1,writable:!1,value:[]}),Object.defineProperty(b,"___before___",{configurable:!1,enumerable:!1,writable:!1,value:[]}),Object.defineProperty(b,"___after___",{configurable:!1,enumerable:!1,writable:!1,value:[]}),Object.defineProperty(b,Wrapped,{configurable:!1,enumerable:!1,writable:!1,value:{}});Object.defineProperty(b,"bindTo",{configurable:!1,enumerable:!1,writable:!1,value:function bindTo(a){var d=1<arguments.length&&void 0!==arguments[1]?arguments[1]:null,e=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{},f=!1;if(a instanceof Function&&(e=d||{},d=a,f=!0),0<=e.delay&&(d=c.wrapDelayCallback(d,e.delay)),0<=e.throttle&&(d=c.wrapThrottleCallback(d,e.throttle)),0<=e.wait&&(d=c.wrapWaitCallback(d,e.wait)),e.frame&&(d=c.wrapFrameCallback(d,e.frame)),e.idle&&(d=c.wrapIdleCallback(d)),f){var k=b[BindingAll].length;for(var l in b[BindingAll].push(d),b)d(b[l],l,b,!1);return function(){delete b[BindingAll][k]}}b[Binding][a]||(b[Binding][a]=[]);var g=b[Binding][a].length;b[Binding][a].push(d),d(b[a],a,b,!1);var h=!1,j=function(){h||(h=!0,b[Binding][a]&&delete b[Binding][a][g])};return e.removeWith&&e.removeWith instanceof View&&e.removeWith.onRemove(function(){return j}),j}});Object.defineProperty(b,"bindChain",{configurable:!1,enumerable:!1,writable:!1,value:function value(a,e){var f=a.split("."),g=f.shift(),h=f.slice(0),i=[];return i.push(b.bindTo(g,function(a,b,f,g){var d=h.join(".");return 0===h.length?void e(a,b,f,g):void(void 0===a&&(a=f[b]=c.makeBindable({})),i=i.concat(a.bindChain(d,e)))})),function(){return i.map(function(a){return a()})}}}),Object.defineProperty(b,"___before",{configurable:!1,enumerable:!1,writable:!1,value:function ___before(a){var c=b.___before___.length;b.___before___.push(a);var d=!1;return function(){d||(d=!0,delete b.___before___[c])}}}),Object.defineProperty(b,"___after",{configurable:!1,enumerable:!1,writable:!1,value:function ___after(a){var c=b.___after___.length;b.___after___.push(a);var d=!1;return function(){d||(d=!0,delete b.___after___[c])}}});var f=function(){for(var a in b[BindingAll])if(b[BindingAll][a])return!0;for(var c in b[Binding])for(var d in b[Binding][c])if(b[Binding][c][d])return!0;return!1};for(var k in Object.defineProperty(b,"isBound",{configurable:!1,enumerable:!1,writable:!1,value:f}),b)b[k]&&b[k]instanceof Object&&!b[k]instanceof Node&&!b[k]instanceof Promise&&(b[k]=a.make(b[k]));var g=function(d,e,f){if(void 0!==b[Deck][e]&&b[Deck][e]===f)return!0;if("string"==typeof e&&"___"===e.substring(0,3)&&"___"===e.slice(-3))return!0;if(d[e]===f)return!0;if(f&&f instanceof Object&&!(f instanceof Node)&&f.___isBindable___!==a&&(f=a.makeBindable(f),c.isBindable(f)))for(var j in f)f[j]&&f[j]instanceof Object&&(f[j]=a.makeBindable(f[j]));for(var k in b[Deck][e]=f,b[BindingAll])b[BindingAll][k]&&b[BindingAll][k](f,e,d,!1);var g=!1;if(e in b[Binding])for(var l in b[Binding][e])b[Binding][e]&&b[Binding][e][l]&&!1===b[Binding][e][l](f,e,d,!1,d[e])&&(g=!0);if(delete b[Deck][e],!g){var h=Object.getOwnPropertyDescriptor(d,e),i=d instanceof File&&"lastModifiedDate"==e;i||h&&!h.writable||d[e]!==f||(d[e]=f)}return Reflect.set(d,e,f)},h=function(a,c){if(!(c in a))return!0;for(var d in b[BindingAll])b[BindingAll][d](void 0,c,a,!0,a[c]);if(c in b[Binding])for(var e in b[Binding][c])b[Binding][c][e]&&b[Binding][c][e](void 0,c,a,!0,a[c]);return delete a[c],!0},j=function(b,c){for(var e in b.___before___)b.___before___[e](b,"constructor",b[Stack],void 0,c);var d=a.make(_construct(b,_toConsumableArray(c)));for(var f in b.___after___)b.___after___[f](b,"constructor",b[Stack],d,c);return d};return Object.defineProperty(b,Ref,{configurable:!1,enumerable:!1,writable:!0,value:b[Ref]}),b[Ref]=new Proxy(b,{deleteProperty:h,construct:j,get:function get(c,d){if(d===Ref||"isBound"===d||"bindTo"===d)return c[d];if(c[d]instanceof Function){if(c[Wrapped][d])return c[Wrapped][d];var e=Object.getOwnPropertyDescriptor(b,d);return!e||e.configurable||e.writable?(c[Wrapped][d]=function(){c[Executing]=d,c[Stack].unshift(d);for(var a=arguments.length,e=Array(a),f=0;f<a;f++)e[f]=arguments[f];for(var i in c.___before___)c.___before___[i](c,d,c[Stack],b,e);var g=b instanceof Promise||b instanceof EventTarget||b instanceof MutationObserver||b instanceof IntersectionObserver||b instanceof MutationObserver||b instanceof PerformanceObserver||"function"==typeof ResizeObserver&&b instanceof ResizeObserver||b instanceof Map||b instanceof Set?b:b[Ref],h=new.target?_construct(c[d],e):c[d].apply(g||b,e);for(var j in c.___after___)c.___after___[j](c,d,c[Stack],b,e);return c[Executing]=null,c[Stack].shift(),h},c[Wrapped][d]):(c[Wrapped][d]=c[d],c[Wrapped][d])}return c[d]instanceof Object&&!c[d][Ref]&&a.make(c[d]),c[d]},set:g}),b[Ref]}},{key:"clearBindings",value:function clearBindings(a){var b=function maps(a){return function(){for(var b=arguments.length,c=Array(b),d=0;d<b;d++)c[d]=arguments[d];return c.map(a)}}(function clearObj(a){return Object.keys(a).map(function(b){return delete a[b]})});b(a[Wrapped],a[Binding],a[BindingAll],a.___after___,a.___before___)}},{key:"resolve",value:function resolve(a,b){for(var c,d=!!(2<arguments.length&&void 0!==arguments[2])&&arguments[2],e=b.split("."),f=e[0];e.length;){if(d&&1===e.length){var g=this.makeBindable(a);return[g,e.shift(),f]}c=e.shift(),!(!c in a)&&a[c]&&a[c]instanceof Object||(a[c]={}),a=this.makeBindable(a[c])}return[this.makeBindable(a),c,f]}},{key:"wrapDelayCallback",value:function wrapDelayCallback(a,b){return function(c,e,f,g){setTimeout(function(){return a(c,e,f,g,f[e])},b)}}},{key:"wrapThrottleCallback",value:function wrapThrottleCallback(a){return function(a){var b=!1;return function(c,e,f,g){b||(a(c,e,f,g,f[e]),b=!0,setTimeout(function(){b=!1},b))}}(a)}},{key:"wrapWaitCallback",value:function wrapWaitCallback(a,b){var c=!1;return function(e,f,g,h){c&&(clearTimeout(c),c=!1),c=setTimeout(function(){return a(e,f,g,h,g[f])},b)}}},{key:"wrapFrameCallback",value:function wrapFrameCallback(a){return function(b,c,e,f,d){requestAnimationFrame(function(){return a(b,c,e,f,d)})}}},{key:"wrapIdleCallback",value:function wrapIdleCallback(a){return function(b,c,e,f,d){var g=window.requestIdleCallback||requestAnimationFrame;g(function(){return a(b,c,e,f,d)})}}}]),a}();exports.Bindable=Bindable;
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.Cache=void 0;function _classCallCheck(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function _defineProperties(a,b){for(var c,d=0;d<b.length;d++)c=b[d],c.enumerable=c.enumerable||!1,c.configurable=!0,"value"in c&&(c.writable=!0),Object.defineProperty(a,c.key,c)}function _createClass(a,b,c){return b&&_defineProperties(a.prototype,b),c&&_defineProperties(a,c),a}var Cache=function(){function a(){_classCallCheck(this,a)}return _createClass(a,null,[{key:"store",value:function store(a,b,c){var d=3<arguments.length&&void 0!==arguments[3]?arguments[3]:"standard",e=0;c&&(e=1e3*c+new Date().getTime()),this.bucket||(this.bucket={}),this.bucket[d]||(this.bucket[d]={}),this.bucket[d][a]={expiration:e,value:b}}},{key:"load",value:function load(a){var b=!!(1<arguments.length&&void 0!==arguments[1])&&arguments[1],c=2<arguments.length&&void 0!==arguments[2]?arguments[2]:"standard";return this.bucket&&this.bucket[c]&&this.bucket[c][a]&&(0==this.bucket[c][a].expiration||this.bucket[c][a].expiration>new Date().getTime())?this.bucket[c][a].value:b}}]),a}();exports.Cache=Cache;
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.Config=void 0;function _classCallCheck(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function _defineProperties(a,b){for(var c,d=0;d<b.length;d++)c=b[d],c.enumerable=c.enumerable||!1,c.configurable=!0,"value"in c&&(c.writable=!0),Object.defineProperty(a,c.key,c)}function _createClass(a,b,c){return b&&_defineProperties(a.prototype,b),c&&_defineProperties(a,c),a}var AppConfig={};try{Object.assign(AppConfig,require("Config").Config||{})}catch(a){console.error(a)}var Config=function(){function a(){_classCallCheck(this,a)}return _createClass(a,null,[{key:"get",value:function get(a){return this.configs[a]}},{key:"set",value:function set(a,b){return this.configs[a]=b,this}},{key:"dump",value:function dump(){return this.configs}},{key:"init",value:function init(){for(var a=arguments.length,b=Array(a),c=0;c<a;c++)b[c]=arguments[c];for(var d in b){var e=b[d];for(var f in"string"==typeof e&&(e=JSON.parse(e)),e){var g=e[f];return this.configs[f]=g}}return this}}]),a}();exports.Config=Config,Object.defineProperty(Config,"configs",{configurable:!1,enumerable:!1,writable:!1,value:AppConfig});
"use strict";var _Bindable=require("./Bindable");Object.defineProperty(exports,"__esModule",{value:!0}),exports.Cookie=void 0;function _slicedToArray(a,b){return _arrayWithHoles(a)||_iterableToArrayLimit(a,b)||_unsupportedIterableToArray(a,b)||_nonIterableRest()}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(a,b){if(a){if("string"==typeof a)return _arrayLikeToArray(a,b);var c=Object.prototype.toString.call(a).slice(8,-1);return"Object"===c&&a.constructor&&(c=a.constructor.name),"Map"===c||"Set"===c?Array.from(a):"Arguments"===c||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(c)?_arrayLikeToArray(a,b):void 0}}function _arrayLikeToArray(a,b){(null==b||b>a.length)&&(b=a.length);for(var c=0,d=Array(b);c<b;c++)d[c]=a[c];return d}function _iterableToArrayLimit(a,b){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(a)){var c=[],d=!0,e=!1,f=void 0;try{for(var g,h=a[Symbol.iterator]();!(d=(g=h.next()).done)&&(c.push(g.value),!(b&&c.length===b));d=!0);}catch(a){e=!0,f=a}finally{try{d||null==h["return"]||h["return"]()}finally{if(e)throw f}}return c}}function _arrayWithHoles(a){if(Array.isArray(a))return a}function _classCallCheck(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function _defineProperties(a,b){for(var c,d=0;d<b.length;d++)c=b[d],c.enumerable=c.enumerable||!1,c.configurable=!0,"value"in c&&(c.writable=!0),Object.defineProperty(a,c.key,c)}function _createClass(a,b,c){return b&&_defineProperties(a.prototype,b),c&&_defineProperties(a,c),a}var Cookie=function(){function a(){_classCallCheck(this,a)}return _createClass(a,null,[{key:"set",value:function set(b,c){a.jar[b]=c}},{key:"get",value:function get(b){return a.jar[b]}},{key:"delete",value:function _delete(b){delete a.jar[b]}}]),a}();exports.Cookie=Cookie;Cookie.jar=Cookie.jar||_Bindable.Bindable.make({}),document.cookie&&"data"!==window.location.href.substr(0,4)&&(document.cookie.split(";").map(function(a){var b=a.split("="),c=_slicedToArray(b,2),d=c[0],e=c[1];try{e=JSON.parse(e)}catch(a){e=e}d=d.trim(),Cookie.jar[decodeURIComponent(d)]=e}),Cookie.jar.bindTo(function(a,b,c,e){document.cookie=e?"".concat(encodeURIComponent(b),"=;expires=").concat(new Date(0)):"".concat(encodeURIComponent(b),"=").concat(a)}));
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.Dom=void 0;function _classCallCheck(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function _defineProperties(a,b){for(var c,d=0;d<b.length;d++)c=b[d],c.enumerable=c.enumerable||!1,c.configurable=!0,"value"in c&&(c.writable=!0),Object.defineProperty(a,c.key,c)}function _createClass(a,b,c){return b&&_defineProperties(a.prototype,b),c&&_defineProperties(a,c),a}var traversals=0,Dom=function(){function a(){_classCallCheck(this,a)}return _createClass(a,null,[{key:"mapTags",value:function mapTags(a,b,c,d,e){var f=[],g=!0;d&&(g=!1);for(var h=!1,i=document.createTreeWalker(a,NodeFilter.SHOW_ELEMENT|NodeFilter.SHOW_TEXT,{acceptNode:function acceptNode(a){if(!g)if(a===d)g=!0;else return NodeFilter.FILTER_SKIP;return e&&a===e&&(h=!0),h?NodeFilter.FILTER_SKIP:b?a instanceof Element&&a.matches(b)?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP:NodeFilter.FILTER_ACCEPT}},!1),j=traversals++;i.nextNode();)f.push(c(i.currentNode,i));return f}},{key:"dispatchEvent",value:function dispatchEvent(b,c){b.dispatchEvent(c),a.mapTags(b,!1,function(a){a.dispatchEvent(c)})}}]),a}();exports.Dom=Dom;
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.Import=void 0;function _classCallCheck(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function _defineProperties(a,b){for(var c,d=0;d<b.length;d++)c=b[d],c.enumerable=c.enumerable||!1,c.configurable=!0,"value"in c&&(c.writable=!0),Object.defineProperty(a,c.key,c)}function _createClass(a,b,c){return b&&_defineProperties(a.prototype,b),c&&_defineProperties(a,c),a}var Import=function(){function a(b){if(_classCallCheck(this,a),console.log(this.__proto__.constructor),this.__proto__.constructor.instances[b])return this.__proto__.constructor.instances[b];this.uri=b;var c=document.createElement("script");c.setAttribute("src",this.uri),this.ready=new Promise(function(a,b){c.addEventListener("load",function(){return a(c)}),c.addEventListener("error",function(a){console.error(a),b(a)})}),this.tag=c,this.attached=!1,this.__proto__.constructor.instances[b]=this}return _createClass(a,[{key:"attach",value:function attach(){var a=0<arguments.length&&void 0!==arguments[0]?arguments[0]:null;this.attached||(a=a||document.head,a.append(this.tag),this.attached=!0)}}]),a}();exports.Import=Import,Import.instances={};
"use strict";var _Bindable=require("./Bindable");Object.defineProperty(exports,"__esModule",{value:!0}),exports.Mixin=void 0;function _toConsumableArray(a){return _arrayWithoutHoles(a)||_iterableToArray(a)||_unsupportedIterableToArray(a)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _iterableToArray(a){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(a))return Array.from(a)}function _arrayWithoutHoles(a){if(Array.isArray(a))return _arrayLikeToArray(a)}function _typeof(a){"@babel/helpers - typeof";return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(a){return typeof a}:function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a},_typeof(a)}function _createForOfIteratorHelper(a,b){var c;if("undefined"==typeof Symbol||null==a[Symbol.iterator]){if(Array.isArray(a)||(c=_unsupportedIterableToArray(a))||b&&a&&"number"==typeof a.length){c&&(a=c);var d=0,e=function(){};return{s:e,n:function n(){return d>=a.length?{done:!0}:{done:!1,value:a[d++]}},e:function e(a){throw a},f:e}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var f,g=!0,h=!1;return{s:function s(){c=a[Symbol.iterator]()},n:function n(){var a=c.next();return g=a.done,a},e:function e(a){h=!0,f=a},f:function f(){try{g||null==c["return"]||c["return"]()}finally{if(h)throw f}}}}function _unsupportedIterableToArray(a,b){if(a){if("string"==typeof a)return _arrayLikeToArray(a,b);var c=Object.prototype.toString.call(a).slice(8,-1);return"Object"===c&&a.constructor&&(c=a.constructor.name),"Map"===c||"Set"===c?Array.from(a):"Arguments"===c||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(c)?_arrayLikeToArray(a,b):void 0}}function _arrayLikeToArray(a,b){(null==b||b>a.length)&&(b=a.length);for(var c=0,d=Array(b);c<b;c++)d[c]=a[c];return d}function _inherits(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function");a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,writable:!0,configurable:!0}}),b&&_setPrototypeOf(a,b)}function _setPrototypeOf(a,b){return _setPrototypeOf=Object.setPrototypeOf||function(a,b){return a.__proto__=b,a},_setPrototypeOf(a,b)}function _createSuper(a){var b=_isNativeReflectConstruct();return function(){var c,d=_getPrototypeOf(a);if(b){var e=_getPrototypeOf(this).constructor;c=Reflect.construct(d,arguments,e)}else c=d.apply(this,arguments);return _possibleConstructorReturn(this,c)}}function _possibleConstructorReturn(a,b){return b&&("object"===_typeof(b)||"function"==typeof b)?b:_assertThisInitialized(a)}function _assertThisInitialized(a){if(void 0===a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return a}function _isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(a){return!1}}function _getPrototypeOf(a){return _getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(a){return a.__proto__||Object.getPrototypeOf(a)},_getPrototypeOf(a)}function _classCallCheck(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function _defineProperties(a,b){for(var c,d=0;d<b.length;d++)c=b[d],c.enumerable=c.enumerable||!1,c.configurable=!0,"value"in c&&(c.writable=!0),Object.defineProperty(a,c.key,c)}function _createClass(a,b,c){return b&&_defineProperties(a.prototype,b),c&&_defineProperties(a,c),a}var Constructor=Symbol("constructor"),MixinList=Symbol("mixinList"),Mixin=function(){function a(){_classCallCheck(this,a)}return _createClass(a,null,[{key:"from",value:function from(b){for(var c=arguments.length,d=Array(1<c?c-1:0),e=1;e<c;e++)d[e-1]=arguments[e];var f=function(b){function c(){var b;_classCallCheck(this,c);for(var f=arguments.length,g=Array(f),h=0;h<f;h++)g[h]=arguments[h];b=e.call.apply(e,[this].concat(g));var i,j=_createForOfIteratorHelper(d);try{for(j.s();!(i=j.n()).done;){var k=i.value;switch(k[a.constructor]&&k[a.constructor].apply(_assertThisInitialized(b)),_typeof(k)){case"object":a.mixObject(k,_assertThisInitialized(b));}}}catch(a){j.e(a)}finally{j.f()}return b}_inherits(c,b);var e=_createSuper(c);return c}(b);return f}},{key:"with",value:function _with(){for(var a=arguments.length,b=Array(a),c=0;c<a;c++)b[c]=arguments[c];return this.from.apply(this,[Object].concat(b))}},{key:"mixObject",value:function mixObject(a,b){var c,d=_createForOfIteratorHelper(Object.getOwnPropertyNames(a));try{for(d.s();!(c=d.n()).done;){var g=c.value;if("function"==typeof a[g]){b[g]=a[g].bind(b);continue}b[g]=a[g]}}catch(a){d.e(a)}finally{d.f()}var e,f=_createForOfIteratorHelper(Object.getOwnPropertySymbols(a));try{for(f.s();!(e=f.n()).done;){var h=e.value;if("function"==typeof a[h]){b[h]=a[h].bind(b);continue}b[h]=a[h]}}catch(a){f.e(a)}finally{f.f()}}},{key:"mixClass",value:function mixClass(a,b){var c,d=_createForOfIteratorHelper(Object.getOwnPropertyNames(a.prototype));try{for(d.s();!(c=d.n()).done;){var o=c.value;b.prototype[o]=a.prototype[o].bind(b.prototype)}}catch(a){d.e(a)}finally{d.f()}var e,f=_createForOfIteratorHelper(Object.getOwnPropertySymbols(a.prototype));try{for(f.s();!(e=f.n()).done;){var p=e.value;b.prototype[p]=a.prototype[p].bind(b.prototype)}}catch(a){f.e(a)}finally{f.f()}var g,h=_createForOfIteratorHelper(Object.getOwnPropertyNames(a));try{var i=function(){var c=g.value;if("function"!=typeof a[c])return"continue";var d=b[c]||!1,e=a[c].bind(b);b[c]=function(){return d&&d.apply(void 0,arguments),e.apply(void 0,arguments)}};for(h.s();!(g=h.n()).done;){var j=i()}}catch(a){h.e(a)}finally{h.f()}var k,l=_createForOfIteratorHelper(Object.getOwnPropertySymbols(a));try{var m=function(){var c=k.value;if("function"!=typeof a[c])return"continue";var d=b[c]||!1,e=a[c].bind(b);b[c]=function(){return d&&d.apply(void 0,arguments),e.apply(void 0,arguments)}};for(l.s();!(k=l.n()).done;){var n=m()}}catch(a){l.e(a)}finally{l.f()}}},{key:"mix",value:function mix(a){for(var b={},c={},d=_Bindable.Bindable.makeBindable(a),e=function(e){var f,g=Object.getOwnPropertyNames(e.prototype),h=Object.getOwnPropertyNames(e),i=/^(before|after)__(.+)/,j=_createForOfIteratorHelper(h);try{var k=function(){var c=f.value,g=c.match(i);if(g){switch(g[1]){case"before":d.___before(function(b,d,f,h,i){if(d===g[2]){var a=e[c].bind(h);return a.apply(void 0,_toConsumableArray(i))}});break;case"after":d.___after(function(b,d,f,h,i){if(d===g[2]){var a=e[c].bind(h);return a.apply(void 0,_toConsumableArray(i))}});}return"continue"}return b[c]?"continue":"function"==typeof e[c]?void(b[c]=e[c]):"continue"};for(j.s();!(f=j.n()).done;){var l=k()}}catch(a){j.e(a)}finally{j.f()}var m,n=_createForOfIteratorHelper(g);try{var o=function(){var b=m.value,f=b.match(i);if(f){switch(f[1]){case"before":d.___before(function(c,d,g,h,i){if(d===f[2]){var a=e.prototype[b].bind(h);return a.apply(void 0,_toConsumableArray(i))}});break;case"after":d.___after(function(c,d,g,h,i){if(d===f[2]){var a=e.prototype[b].bind(h);return a.apply(void 0,_toConsumableArray(i))}});}return"continue"}return c[b]?"continue":"function"==typeof e.prototype[b]?void(c[b]=e.prototype[b]):"continue"};for(n.s();!(m=n.n()).done;){var p=o()}}catch(a){n.e(a)}finally{n.f()}},f=this;f&&f.prototype;f=Object.getPrototypeOf(f))e(f);for(var h in b)a[h]=b[h].bind(a);var g=function(b){a.prototype[b]=function(){for(var a=arguments.length,d=Array(a),e=0;e<a;e++)d[e]=arguments[e];return c[b].apply(this,d)}};for(var i in c)g(i);return d}}]),a}();exports.Mixin=Mixin,Mixin.constructor=Constructor;
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.Model=void 0;var _Cache=require("./Cache"),_Bindable=require("./Bindable"),_Repository=require("./Repository");function _classCallCheck(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function _defineProperties(a,b){for(var c,d=0;d<b.length;d++)c=b[d],c.enumerable=c.enumerable||!1,c.configurable=!0,"value"in c&&(c.writable=!0),Object.defineProperty(a,c.key,c)}function _createClass(a,b,c){return b&&_defineProperties(a.prototype,b),c&&_defineProperties(a,c),a}var Model=function(){function a(b){_classCallCheck(this,a),this.repository=b}return _createClass(a,[{key:"consume",value:function consume(b){for(var e in b){var f=b[e];if(b[e]instanceof Object&&b[e]["class"]&&b[e].publicId){var c="".concat(b[e]["class"],"::").concat(b[e].publidId),d=_Cache.Cache.load(c,!1,"model-type-repo");f=_Bindable.Bindable.makeBindable(new a(this.repository)),d&&(f=d),f.consume(b[e]),_Cache.Cache.store(c,f,0,"model-type-repo")}this[e]=f}}}]),a}();exports.Model=Model;
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.Repository=void 0;var _Bindable=require("./Bindable"),_Router=require("./Router"),_Cache=require("./Cache"),_Model=require("./Model"),_Bag=require("./Bag"),_Form=require("../form/Form"),_FormWrapper=require("../form/multiField/FormWrapper");function _typeof(a){"@babel/helpers - typeof";return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(a){return typeof a}:function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a},_typeof(a)}function _classCallCheck(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function _defineProperties(a,b){for(var c,d=0;d<b.length;d++)c=b[d],c.enumerable=c.enumerable||!1,c.configurable=!0,"value"in c&&(c.writable=!0),Object.defineProperty(a,c.key,c)}function _createClass(a,b,c){return b&&_defineProperties(a.prototype,b),c&&_defineProperties(a,c),a}var objects={},Repository=function(){function a(b){_classCallCheck(this,a),this.uri=b}return _createClass(a,[{key:"get",value:function get(b){var c=this,d=!!(1<arguments.length&&void 0!==arguments[1])&&arguments[1],e=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{},f=this.uri+"/"+b,g=_Cache.Cache.load(f+_Router.Router.queryToString(_Router.Router.queryOver(e),!0),!1,"model-uri-repo");return!d&&g?Promise.resolve(g):a.request(f,e).then(function(a){return c.extractModel(a.body)})}},{key:"page",value:function page(){var b=this,c=0<arguments.length&&void 0!==arguments[0]?arguments[0]:0,d=1<arguments.length?arguments[1]:void 0;return a.request(this.uri,d).then(function(a){var c=[];for(var d in a.body){var e=a.body[d];c.push(b.extractModel(e))}return a.body=c,a})}},{key:"edit",value:function edit(){var b=0<arguments.length&&void 0!==arguments[0]?arguments[0]:null,c=1<arguments.length&&void 0!==arguments[1]?arguments[1]:null,d=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{},e=this.uri+"/create";return b&&(e=this.uri+"/"+b+"/edit"),c?a.request(e,{api:"json"},c).then(function(a){return a.body}):a.request(e).then(function(a){var b=new _Form.Form(a.meta.form,d);return new _FormWrapper.FormWrapper(b,e,"POST",d)})}},{key:"extractModel",value:function extractModel(a){var b=_Bindable.Bindable.makeBindable(new _Model.Model(this));b.consume(a);this.uri+"/"+b.publicId;if(b["class"])var c="".concat(b["class"],"::").concat(b.publidId),d=_Cache.Cache.load(c,!1,"model-type-repo");return b}}],[{key:"loadPage",value:function loadPage(){var a=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},b=!!(1<arguments.length&&void 0!==arguments[1])&&arguments[1];return this.request(this.uri,a).then(function(a){return a})}},{key:"domCache",value:function domCache(){}},{key:"load",value:function load(a){!!(1<arguments.length&&void 0!==arguments[1])&&arguments[1];return this.objects=this.objects||{},this.objects[this.uri]=this.objects[this.uri]||{},this.objects[this.uri][a]?Promise.resolve(this.objects[this.uri][a]):this.request(this.uri+"/"+a).then(function(){})}},{key:"form",value:function form(){var a=0<arguments.length&&void 0!==arguments[0]?arguments[0]:null,b=this.uri+"/create";return a&&(b=this.uri+"/"+a+"/edit"),this.request(b).then(function(a){return a})}},{key:"clearCache",value:function clearCache(){this.objects&&this.objects[this.uri]&&(this.objects[this.uri]={})}},{key:"encode",value:function encode(a){var b=1<arguments.length&&void 0!==arguments[1]?arguments[1]:null,c=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null;for(var d in c||(c=new FormData),a){var e=d;b&&(e="".concat(b,"[").concat(e,"]")),a[d]&&"object"!==_typeof(a[d])?c.append(e,a[d]):this.encode(a[d],e,c)}return c}},{key:"onResponse",value:function onResponse(a){return this._onResponse||(this._onResponse=new _Bag.Bag),this._onResponse.add(a)}},{key:"request",value:function request(a){var b=this,c=1<arguments.length&&void 0!==arguments[1]?arguments[1]:null,d=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null,e=!(3<arguments.length&&void 0!==arguments[3])||arguments[3],f=4<arguments.length&&void 0!==arguments[4]?arguments[4]:{},g="GET",h="",i=null,j={};c&&(j=c),this._onResponse||(this._onResponse=new _Bag.Bag),this.runningRequests||(this.runningRequests={}),j.api=j.api||"json",h=Object.keys(j).map(function(a){return encodeURIComponent(a)+"="+encodeURIComponent(j[a])}).join("&");var k=a;if(k=a+"?"+h,!d&&this.runningRequests[k])return this.runningRequests[k];d&&(e=!1,g="POST",i=d instanceof FormData?d:this.encode(d));var l=new XMLHttpRequest;if("responseType"in f&&(l.responseType=f.responseType),!d&&e&&this.cache&&this.cache[k])return Promise.resolve(this.cache[k]);var m="script[data-uri=\""+k+"\"]",n=document.querySelector(m);if(!d&&e&&n){var q=JSON.parse(n.innerText);return Promise.resolve(q)}l.withCredentials=!("withCredentials"in f)||f.withCredentials;var o=document.createElement("a");o.href=k,d||(l.timeout=f.timeout||15e3,this.xhrs[k]=l);var p=new Promise(function(a,c){if(d&&"progressUp"in f&&(l.upload.onprogress=f.progressUp),"progressDown"in f&&(l.onprogress=f.progressDown),l.onreadystatechange=function(){var d,e=200;if(4===l.readyState)if(delete b.xhrs[k],delete b.runningRequests[k],b.cache||(b.cache={}),"application/json"!=l.getResponseHeader("Content-Type")&&"application/json; charset=utf-8"!=l.getResponseHeader("Content-Type")&&"text/json"!=l.getResponseHeader("Content-Type")&&"text/json; charset=utf-8"!=l.getResponseHeader("Content-Type")){var h=b._onResponse.items();for(var j in h)h[j](l,!0);l.status===e?a(l):c(l)}else if(d=JSON.parse(l.responseText),d&&0==d.code){var f=document.querySelector("script[data-uri=\""+k+"\"]"),g=window.prerenderer||navigator.userAgent.match(/prerender/i);g&&(window.prerenderer=window.prerenderer||!0,!f&&(f=document.createElement("script"),f.type="text/json",f.setAttribute("data-hack","application/ld+json-NOT!"),f.setAttribute("data-uri",k),document.head.appendChild(f)),f.innerText=JSON.stringify(d));var m=b._onResponse.items();for(var n in m)m[n](d,!0);d._http=l.status,l.status===e?a(d):c(d)}else{var i=b._onResponse.items();for(var o in i)i[o](d,!0);c(d)}},l.open(g,k,!0),f.headers)for(var e in f.headers)l.setRequestHeader(e,f.headers[e]);l.send(i)});return d||(this.runningRequests[k]=p),p}},{key:"cancel",value:function cancel(){var a=0<arguments.length&&void 0!==arguments[0]?arguments[0]:/^.$/;for(var b in this.xhrs)this.xhrs[b]&&b.match(a)&&(this.xhrs[b].abort(),delete this.xhrs[b])}}]),a}();exports.Repository=Repository,Repository.xhrs=[];
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.Router=void 0;var _View=require("./View"),_Cache=require("./Cache"),_Config=require("./Config"),_Routes=require("./Routes");function _createForOfIteratorHelper(a,b){var c;if("undefined"==typeof Symbol||null==a[Symbol.iterator]){if(Array.isArray(a)||(c=_unsupportedIterableToArray(a))||b&&a&&"number"==typeof a.length){c&&(a=c);var d=0,e=function(){};return{s:e,n:function n(){return d>=a.length?{done:!0}:{done:!1,value:a[d++]}},e:function e(a){throw a},f:e}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var f,g=!0,h=!1;return{s:function s(){c=a[Symbol.iterator]()},n:function n(){var a=c.next();return g=a.done,a},e:function e(a){h=!0,f=a},f:function f(){try{g||null==c["return"]||c["return"]()}finally{if(h)throw f}}}}function _unsupportedIterableToArray(a,b){if(a){if("string"==typeof a)return _arrayLikeToArray(a,b);var c=Object.prototype.toString.call(a).slice(8,-1);return"Object"===c&&a.constructor&&(c=a.constructor.name),"Map"===c||"Set"===c?Array.from(a):"Arguments"===c||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(c)?_arrayLikeToArray(a,b):void 0}}function _arrayLikeToArray(a,b){(null==b||b>a.length)&&(b=a.length);for(var c=0,d=Array(b);c<b;c++)d[c]=a[c];return d}function _classCallCheck(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function _defineProperties(a,b){for(var c,d=0;d<b.length;d++)c=b[d],c.enumerable=c.enumerable||!1,c.configurable=!0,"value"in c&&(c.writable=!0),Object.defineProperty(a,c.key,c)}function _createClass(a,b,c){return b&&_defineProperties(a.prototype,b),c&&_defineProperties(a,c),a}var Router=function(){function a(){_classCallCheck(this,a)}return _createClass(a,null,[{key:"wait",value:function wait(a){var b=this,c=1<arguments.length&&void 0!==arguments[1]?arguments[1]:"DOMContentLoaded",d=2<arguments.length&&void 0!==arguments[2]?arguments[2]:document;d.addEventListener(c,function(){b.listen(a)})}},{key:"listen",value:function(a){var b=this,c=!!(1<arguments.length&&void 0!==arguments[1])&&arguments[1];this.routes=c;var d=location.pathname+location.search;location.hash&&(d+=location.hash),Object.assign(this.query,this.queryOver({}));var e=function(c){for(var d in c.preventDefault(),c.state&&"routedId"in c.state?c.state.routedId<=b.routeCount?(b.history.splice(c.state.routedId),b.routeCount=c.state.routedId):c.state.routedId>b.routeCount&&(b.history.push(c.state.prev),b.routeCount=c.state.routedId):null!==b.prevPath&&b.prevPath!==location.pathname&&b.history.push(b.prevPath),b.match(location.pathname,a),b.query)delete b.query[d];Object.assign(b.query,b.queryOver({}))};window.addEventListener("popstate",e),window.addEventListener("cvUrlChanged",e),this.go(d)}},{key:"go",value:function go(a,b){var c=_Config.Config.get("title");for(var d in c&&(document.title=c),2===b&&location.pathname!==a?history.replaceState({routedId:this.routeCount,prev:this.prevPath,url:location.pathname},null,a):location.pathname!==a&&history.pushState({routedId:++this.routeCount,prev:this.prevPath,url:location.pathname},null,a),b||(!1===b&&(this.path=null),"#"===a.substring(0,1)?window.dispatchEvent(new HashChangeEvent("hashchange")):window.dispatchEvent(new CustomEvent("cvUrlChanged"))),this.query)delete this.query[d];Object.assign(this.query,this.queryOver({})),this.prevPath=a}},{key:"match",value:function match(a,b){var c=this,d=!!(2<arguments.length&&void 0!==arguments[2])&&arguments[2];if(this.path!==a||d){this.queryString=location.search,this.path=a;var e=this.prevPath,f=b.args.content,g=this.routes||b.routes||_Routes.Routes.dump(),h=new URLSearchParams(location.search);for(var q in this.query)delete this.query[q];Object.assign(this.query,this.queryOver({}));var k={},l=!1,m="";for(var i in a=a.substr(1).split("/"),this.query)k[i]=this.query[i];L1:for(var s in g){var t=s.split("/");if(!(t.length<a.length&&"*"!==t[t.length-1])){L2:for(var u in t)if("%"==t[u].substr(0,1)){var n=null,o=/^%(\w+)\??/.exec(t[u]);if(o&&o[1]&&(n=o[1]),!n)throw new Error("".concat(t[u]," is not a valid argument segment in route \"").concat(s,"\""));if(!!a[u])k[n]=a[u];else if("?"==t[u].substr(t[u].length-1,1))k[n]="";else continue L1}else if("*"!==t[u]&&a[u]!==t[u])continue L1;l=s,m=g[s],"*"===t[t.length-1]&&(k.pathparts=a.slice(t.length-1));break}}if(!d&&b&&f&&m instanceof Object&&f instanceof m&&!(m instanceof Promise)&&f.update(k))return b.args.content=f,!0;var p=new CustomEvent("cvRouteStart",{cancelable:!0,detail:{path:a,prev:e,root:b,selected:l,routes:g}});if(document.dispatchEvent(p)){if(l in g&&g[l]instanceof Object&&g[l].isView&&g[l].isView())m=new g[l](k),b&&(m.root=function(){return b});else if(g[l]instanceof Function){m="";var j=g[l](k);m=j}else g[l]instanceof Object?m=new g[l](k):"string"==typeof g[l]&&(m=g[l]);return m instanceof Promise||(m=Promise.resolve(m)),m.then(function(e){return c.update(b,a,e,g,l,k,d)})["catch"](function(e){return c.update(b,a,e,g,l,k,d)})}}}},{key:"update",value:function update(a,b,c,d,e,f,g){if(a){var h=this.prevPath,i=new CustomEvent("cvRoute",{cancelable:!0,detail:{result:c,path:b,prev:h,view:a,routes:d,selected:e}});!1!==c&&(a.args.content instanceof _View.View&&(a.args.content.pause(!0),a.args.content.remove()),document.dispatchEvent(i)&&(a.args.content=c),c instanceof _View.View&&(c.pause(!1),c.update(f,g)));var j=new CustomEvent("cvRouteEnd",{cancelable:!0,detail:{result:c,path:b,prev:h,view:a,routes:d,selected:e}});document.dispatchEvent(j)}}},{key:"queryOver",value:function queryOver(){var a,b=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},c=new URLSearchParams(location.search),d={},e={},f=_createForOfIteratorHelper(c);try{for(f.s();!(a=f.n()).done;){var g=a.value;e[g[0]]=g[1]}}catch(a){f.e(a)}finally{f.f()}return d=Object.assign(d,e,b),delete d.api,d}},{key:"queryToString",value:function queryToString(){var a=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},b=!!(1<arguments.length&&void 0!==arguments[1])&&arguments[1],c=[],d=a;for(var e in b||(d=this.queryOver(a)),d)""!==d[e]&&c.push(e+"="+encodeURIComponent(d[e]));return c.join("&")}},{key:"setQuery",value:function setQuery(a,b,c){var d=this.queryOver();d[a]=b,void 0===b&&delete d[a];var e=this.queryToString(d,!0);this.go(location.pathname+(e?"?"+e:""),c)}}]),a}();exports.Router=Router,Object.defineProperty(Router,"query",{configurable:!1,enumerable:!1,writable:!1,value:{}}),Object.defineProperty(Router,"history",{configurable:!1,enumerable:!1,writable:!1,value:[]}),Object.defineProperty(Router,"routeCount",{configurable:!1,enumerable:!1,writable:!0,value:0}),Object.defineProperty(Router,"prevPath",{configurable:!1,enumerable:!1,writable:!0,value:null}),Object.defineProperty(Router,"queryString",{configurable:!1,enumerable:!1,writable:!0,value:null});
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.Routes=void 0;function _classCallCheck(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function _defineProperties(a,b){for(var c,d=0;d<b.length;d++)c=b[d],c.enumerable=c.enumerable||!1,c.configurable=!0,"value"in c&&(c.writable=!0),Object.defineProperty(a,c.key,c)}function _createClass(a,b,c){return b&&_defineProperties(a.prototype,b),c&&_defineProperties(a,c),a}var AppRoutes={};try{Object.assign(AppRoutes,require("Routes").Routes||{})}catch(a){window.devmode&&console.warn(a)}var Routes=function(){function a(){_classCallCheck(this,a)}return _createClass(a,null,[{key:"get",value:function get(a){return this.routes[a]}},{key:"dump",value:function dump(){return this.routes}}]),a}();exports.Routes=Routes,Object.defineProperty(Routes,"routes",{configurable:!1,enumerable:!1,writable:!1,value:AppRoutes});
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.RuleSet=void 0;var _Dom=require("./Dom"),_Tag=require("./Tag"),_View=require("./View");function _createForOfIteratorHelper(a,b){var c;if("undefined"==typeof Symbol||null==a[Symbol.iterator]){if(Array.isArray(a)||(c=_unsupportedIterableToArray(a))||b&&a&&"number"==typeof a.length){c&&(a=c);var d=0,e=function(){};return{s:e,n:function n(){return d>=a.length?{done:!0}:{done:!1,value:a[d++]}},e:function e(a){throw a},f:e}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var f,g=!0,h=!1;return{s:function s(){c=a[Symbol.iterator]()},n:function n(){var a=c.next();return g=a.done,a},e:function e(a){h=!0,f=a},f:function f(){try{g||null==c["return"]||c["return"]()}finally{if(h)throw f}}}}function _unsupportedIterableToArray(a,b){if(a){if("string"==typeof a)return _arrayLikeToArray(a,b);var c=Object.prototype.toString.call(a).slice(8,-1);return"Object"===c&&a.constructor&&(c=a.constructor.name),"Map"===c||"Set"===c?Array.from(a):"Arguments"===c||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(c)?_arrayLikeToArray(a,b):void 0}}function _arrayLikeToArray(a,b){(null==b||b>a.length)&&(b=a.length);for(var c=0,d=Array(b);c<b;c++)d[c]=a[c];return d}function _classCallCheck(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function _defineProperties(a,b){for(var c,d=0;d<b.length;d++)c=b[d],c.enumerable=c.enumerable||!1,c.configurable=!0,"value"in c&&(c.writable=!0),Object.defineProperty(a,c.key,c)}function _createClass(a,b,c){return b&&_defineProperties(a.prototype,b),c&&_defineProperties(a,c),a}var RuleSet=function(){function a(){_classCallCheck(this,a)}return _createClass(a,[{key:"add",value:function add(a,b){return this.rules=this.rules||{},this.rules[a]=this.rules[a]||[],this.rules[a].push(b),this}},{key:"apply",value:function apply(){var b=0<arguments.length&&void 0!==arguments[0]?arguments[0]:document,c=1<arguments.length&&void 0!==arguments[1]?arguments[1]:null;for(var j in a.apply(b,c),this.rules)for(var k in this.rules[j]){var d,e=this.rules[j][k],f=a.wrap(b,e,c),g=b.querySelectorAll(j),h=_createForOfIteratorHelper(g);try{for(h.s();!(d=h.n()).done;){var i=d.value;f(i)}}catch(a){h.e(a)}finally{h.f()}}}}],[{key:"add",value:function add(a,b){return this.globalRules=this.globalRules||{},this.globalRules[a]=this.globalRules[a]||[],this.globalRules[a].push(b),this}},{key:"apply",value:function apply(){var a=0<arguments.length&&void 0!==arguments[0]?arguments[0]:document,b=1<arguments.length&&void 0!==arguments[1]?arguments[1]:null;for(var h in this.globalRules)for(var j in this.globalRules[h]){var c,d=this.globalRules[h][j],e=this.wrap(a,d,b),f=a.querySelectorAll(h),g=_createForOfIteratorHelper(f);try{for(g.s();!(c=g.n()).done;){var i=c.value;e(i)}}catch(a){g.e(a)}finally{g.f()}}}},{key:"wait",value:function wait(){var a=this,b=0<arguments.length&&void 0!==arguments[0]?arguments[0]:"DOMContentLoaded",c=1<arguments.length&&void 0!==arguments[1]?arguments[1]:document,d=function(b,c){return function(){return c.removeEventListener(b,d),a.apply()}}(b,c);c.addEventListener(b,d)}},{key:"wrap",value:function wrap(a,b){var c=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null;return(b instanceof _View.View||b&&b.prototype&&b.prototype instanceof _View.View)&&(b=function(a){return function(){return a}}(b)),function(a){for(var k in"undefined"==typeof a.___cvApplied___&&Object.defineProperty(a,"___cvApplied___",{enumerable:!1,writable:!1,value:[]}),a.___cvApplied___)if(b==a.___cvApplied___[k])return;var d,e;c&&(d=e=c,c.viewList&&(e=c.viewList.parent));var f=new _Tag.Tag(a,e,null,void 0,d),g=f.element.parentNode,h=f.element.nextSibling,j=b(f);if(!1!==j&&a.___cvApplied___.push(b),j instanceof HTMLElement&&(j=new _Tag.Tag(j)),j instanceof _Tag.Tag){if(!j.element.contains(f.element)){for(;f.element.firstChild;)j.element.appendChild(f.element.firstChild);f.remove()}h?g.insertBefore(j.element,h):g.appendChild(j.element)}j&&j.prototype&&j.prototype instanceof _View.View&&(j=new j),j instanceof _View.View&&(c&&(c.cleanup.push(function(a){return function(){a.remove()}}(j)),j.parent=c,c.cleanup.push(c.args.bindTo(function(a,b,c){c[b]=a,j.args[b]=a})),c.cleanup.push(j.args.bindTo(function(a,b,d){d[b]=a,c.args[b]=a}))),f.clear(),j.render(f.element))}}}]),a}();exports.RuleSet=RuleSet;
"use strict";var _Bindable=require("./Bindable");Object.defineProperty(exports,"__esModule",{value:!0}),exports.Tag=void 0;function _classCallCheck(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function _defineProperties(a,b){for(var c,d=0;d<b.length;d++)c=b[d],c.enumerable=c.enumerable||!1,c.configurable=!0,"value"in c&&(c.writable=!0),Object.defineProperty(a,c.key,c)}function _createClass(a,b,c){return b&&_defineProperties(a.prototype,b),c&&_defineProperties(a,c),a}var Tag=function(){function a(b,c,d,e,f){_classCallCheck(this,a),this.element=_Bindable.Bindable.makeBindable(b),this.parent=c,this.direct=f,this.ref=d,this.index=e,this.cleanup=[],this.proxy=_Bindable.Bindable.makeBindable(this)}return _createClass(a,[{key:"remove",value:function remove(){_Bindable.Bindable.clearBindings(this);for(var b;b=this.cleanup.shift();)b();if(this.clear(),!!this.element){var a=new Event("cvDomDetached");this.element.dispatchEvent(a),this.element.remove(),this.element=this.ref=this.parent=null}}},{key:"clear",value:function clear(){if(this.element)for(var a=new Event("cvDomDetached");this.element.firstChild;)this.element.firstChild.dispatchEvent(a),this.element.removeChild(this.element.firstChild)}},{key:"pause",value:function pause(){!(0<arguments.length&&void 0!==arguments[0])||arguments[0]}}]),a}();exports.Tag=Tag;
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.Theme=void 0;function _slicedToArray(a,b){return _arrayWithHoles(a)||_iterableToArrayLimit(a,b)||_unsupportedIterableToArray(a,b)||_nonIterableRest()}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _iterableToArrayLimit(a,b){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(a)){var c=[],d=!0,e=!1,f=void 0;try{for(var g,h=a[Symbol.iterator]();!(d=(g=h.next()).done)&&(c.push(g.value),!(b&&c.length===b));d=!0);}catch(a){e=!0,f=a}finally{try{d||null==h["return"]||h["return"]()}finally{if(e)throw f}}return c}}function _arrayWithHoles(a){if(Array.isArray(a))return a}function _createForOfIteratorHelper(a,b){var c;if("undefined"==typeof Symbol||null==a[Symbol.iterator]){if(Array.isArray(a)||(c=_unsupportedIterableToArray(a))||b&&a&&"number"==typeof a.length){c&&(a=c);var d=0,e=function(){};return{s:e,n:function n(){return d>=a.length?{done:!0}:{done:!1,value:a[d++]}},e:function e(a){throw a},f:e}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var f,g=!0,h=!1;return{s:function s(){c=a[Symbol.iterator]()},n:function n(){var a=c.next();return g=a.done,a},e:function e(a){h=!0,f=a},f:function f(){try{g||null==c["return"]||c["return"]()}finally{if(h)throw f}}}}function _unsupportedIterableToArray(a,b){if(a){if("string"==typeof a)return _arrayLikeToArray(a,b);var c=Object.prototype.toString.call(a).slice(8,-1);return"Object"===c&&a.constructor&&(c=a.constructor.name),"Map"===c||"Set"===c?Array.from(a):"Arguments"===c||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(c)?_arrayLikeToArray(a,b):void 0}}function _arrayLikeToArray(a,b){(null==b||b>a.length)&&(b=a.length);for(var c=0,d=Array(b);c<b;c++)d[c]=a[c];return d}function _classCallCheck(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function _defineProperties(a,b){for(var c,d=0;d<b.length;d++)c=b[d],c.enumerable=c.enumerable||!1,c.configurable=!0,"value"in c&&(c.writable=!0),Object.defineProperty(a,c.key,c)}function _createClass(a,b,c){return b&&_defineProperties(a.prototype,b),c&&_defineProperties(a,c),a}var Theme=function(){function a(b){_classCallCheck(this,a),this.key=b,this.viewMap=new Map,this.templateMap=new Map,this.fallbacks=[]}return _createClass(a,null,[{key:"get",value:function get(){var a=0<arguments.length&&void 0!==arguments[0]?arguments[0]:"";return this.instances||(this.instances={}),this.instances[a]||(this.instances[a]=new this(a)),this.instances[a]}}]),_createClass(a,[{key:"setFallback",value:function setFallback(){var a;return(a=this.fallbacks).push.apply(a,arguments),this}},{key:"setView",value:function setView(a,b){return this.viewMap.set(a,b),this}},{key:"getView",value:function getView(a){return this.resolve(a,"viewMap")}},{key:"setTemplate",value:function setTemplate(a,b){return this.viewMap.set(a,b),this}},{key:"getTemplate",value:function getTemplate(a){return this.resolve(a,"templateMap")}},{key:"resolve",value:function resolve(a,b){var c=a.constructor,d=this[b];if(d.has(c))return d.get(c);var e,f=!1,g=_createForOfIteratorHelper(d);try{for(g.s();!(e=g.n()).done;){var h=_slicedToArray(e.value,2),i=h[0],j=h[1];c.prototype instanceof i&&(f=j)}}catch(a){g.e(a)}finally{g.f()}if(!f){var k,l=_createForOfIteratorHelper(this.fallbacks);try{for(l.s();!(k=l.n()).done;){var m=k.value;if(f=m.resolve(a,b))return f}}catch(a){l.e(a)}finally{l.f()}}return f&&d.set(c,f),f}}]),a}();exports.Theme=Theme;
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.View=void 0;var _Bindable=require("./Bindable"),_ViewList=require("./ViewList"),_Router=require("./Router"),_Dom=require("./Dom"),_Tag=require("./Tag"),_Bag=require("./Bag"),_RuleSet=require("./RuleSet");function _createForOfIteratorHelper(a,b){var c;if("undefined"==typeof Symbol||null==a[Symbol.iterator]){if(Array.isArray(a)||(c=_unsupportedIterableToArray(a))||b&&a&&"number"==typeof a.length){c&&(a=c);var d=0,e=function(){};return{s:e,n:function n(){return d>=a.length?{done:!0}:{done:!1,value:a[d++]}},e:function e(a){throw a},f:e}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var f,g=!0,h=!1;return{s:function s(){c=a[Symbol.iterator]()},n:function n(){var a=c.next();return g=a.done,a},e:function e(a){h=!0,f=a},f:function f(){try{g||null==c["return"]||c["return"]()}finally{if(h)throw f}}}}function _slicedToArray(a,b){return _arrayWithHoles(a)||_iterableToArrayLimit(a,b)||_unsupportedIterableToArray(a,b)||_nonIterableRest()}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _iterableToArrayLimit(a,b){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(a)){var c=[],d=!0,e=!1,f=void 0;try{for(var g,h=a[Symbol.iterator]();!(d=(g=h.next()).done)&&(c.push(g.value),!(b&&c.length===b));d=!0);}catch(a){e=!0,f=a}finally{try{d||null==h["return"]||h["return"]()}finally{if(e)throw f}}return c}}function _arrayWithHoles(a){if(Array.isArray(a))return a}function _toConsumableArray(a){return _arrayWithoutHoles(a)||_iterableToArray(a)||_unsupportedIterableToArray(a)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(a,b){if(a){if("string"==typeof a)return _arrayLikeToArray(a,b);var c=Object.prototype.toString.call(a).slice(8,-1);return"Object"===c&&a.constructor&&(c=a.constructor.name),"Map"===c||"Set"===c?Array.from(a):"Arguments"===c||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(c)?_arrayLikeToArray(a,b):void 0}}function _iterableToArray(a){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(a))return Array.from(a)}function _arrayWithoutHoles(a){if(Array.isArray(a))return _arrayLikeToArray(a)}function _arrayLikeToArray(a,b){(null==b||b>a.length)&&(b=a.length);for(var c=0,d=Array(b);c<b;c++)d[c]=a[c];return d}function _classCallCheck(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function _defineProperties(a,b){for(var c,d=0;d<b.length;d++)c=b[d],c.enumerable=c.enumerable||!1,c.configurable=!0,"value"in c&&(c.writable=!0),Object.defineProperty(a,c.key,c)}function _createClass(a,b,c){return b&&_defineProperties(a.prototype,b),c&&_defineProperties(a,c),a}var dontParse=Symbol("dontParse"),expandBind=Symbol("expandBind"),moveIndex=0,View=function(){function a(){var b=this,c=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},d=1<arguments.length&&void 0!==arguments[1]?arguments[1]:null;_classCallCheck(this,a),Object.defineProperty(this,"___VIEW___",{enumerable:!1,writable:!0}),this.___VIEW___=a,Object.defineProperty(this,"args",{configurable:!1,writable:!1,value:_Bindable.Bindable.make(c)});var e=this;return this.args._id||Object.defineProperty(this.args,"_id",{configurable:!1,get:function get(){return e._id}}),this.template="",this.document="",this.firstNode=null,this.lastNode=null,this.nodes=null,this.cleanup=[],this._onRemove=new _Bag.Bag(function(){}),this.attach=new _Bag.Bag(function(){}),this.detach=new _Bag.Bag(function(){}),this.eventCleanup=[],this.mainView=null,this.parent=d,this.viewList=null,this.viewLists={},this.withViews={},this.tags=_Bindable.Bindable.make({}),this.intervals=[],this.timeouts=[],this.frames=[],this.ruleSet=new _RuleSet.RuleSet,this.preRuleSet=new _RuleSet.RuleSet,this.subBindings={},this.subTemplates={},this.removed=!1,this.preserve=!1,this.interpolateRegex=/(\[\[((?:\$+)?[\w\.\|-]+)\]\])/g,this.rendered=new Promise(function(a){Object.defineProperty(b,"renderComplete",{configurable:!1,writable:!1,value:a})}),_Bindable.Bindable.make(this)}return _createClass(a,[{key:"_id",get:function get(){return this.__id||Object.defineProperty(this,"__id",{configurable:!1,writable:!1,value:this.uuid()}),this.__id}}],[{key:"from",value:function from(a){var b=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},c=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null,d=new this(b,c);return d.template=a,d}}]),_createClass(a,[{key:"onFrame",value:function onFrame(a){var b=this,d=!1,e=function(){d=!0},f=function(){b.removed||d||(!b.paused&&a(Date.now()),requestAnimationFrame(f))};return requestAnimationFrame(function(){return f(Date.now())}),this.frames.push(e),e}},{key:"onNextFrame",value:function onNextFrame(a){return requestAnimationFrame(function(){return a(Date.now())})}},{key:"onIdle",value:function onIdle(a){return requestIdleCallback(function(){return a(Date.now())})}},{key:"onTimeout",value:function onTimeout(a,b){var c=this,d=function(){c.timeouts[f].fired=!0,c.timeouts[f].callback=null,b()},e=setTimeout(d,a),f=this.timeouts.length;return this.timeouts.push({timeout:e,callback:d,time:a,fired:!1,created:new Date().getTime(),paused:!1}),e}},{key:"clearTimeout",value:function(a){function b(){return a.apply(this,arguments)}return b.toString=function(){return a.toString()},b}(function(a){for(var b in this.timeouts)a===this.timeouts[b].timeout&&(clearTimeout(this.timeouts[b].timeout),delete this.timeouts[b])})},{key:"onInterval",value:function onInterval(a,b){var c=setInterval(b,a);return this.intervals.push({timeout:c,callback:b,time:a,paused:!1}),c}},{key:"clearInterval",value:function(a){function b(){return a.apply(this,arguments)}return b.toString=function(){return a.toString()},b}(function(a){for(var b in this.intervals)a===this.intervals[b].timeout&&(clearInterval(this.intervals[b].timeout),delete this.intervals[b])})},{key:"pause",value:function pause(){var a=0<arguments.length&&void 0!==arguments[0]?arguments[0]:void 0;if(void 0===a&&(this.paused=!this.paused),this.paused=a,this.paused){for(var c in this.timeouts){if(this.timeouts[c].fired){delete this.timeouts[c];continue}clearTimeout(this.timeouts[c].timeout)}for(var d in this.intervals)clearInterval(this.intervals[d].timeout)}else{for(var e in this.timeouts)if(this.timeouts[e].timeout.paused){if(this.timeouts[e].fired){delete this.timeouts[e];continue}this.timeouts[e].timeout=setTimeout(this.timeouts[e].callback,this.timeouts[e].time)}for(var f in this.intervals)this.intervals[f].timeout.paused&&(this.intervals[f].timeout.paused=!1,this.intervals[f].timeout=setInterval(this.intervals[f].callback,this.intervals[f].time))}for(var g in this.viewLists){if(!this.viewLists[g])return;this.viewLists[g].pause(!!a)}for(var h in this.tags){if(Array.isArray(this.tags[h])){for(var b in this.tags[h])this.tags[h][b].pause(!!a);continue}this.tags[h].pause(!!a)}}},{key:"render",value:function render(){var b,c=0<arguments.length&&void 0!==arguments[0]?arguments[0]:null,d=1<arguments.length&&void 0!==arguments[1]?arguments[1]:null;if(c instanceof a&&(c=c.firstNode.parentNode),d instanceof a&&(d=d.firstNode),this.firstNode)return this.reRender(c,d);var e=this.template instanceof DocumentFragment?this.template.cloneNode(!0):a.templates.has(this.template),f=e?this.template instanceof DocumentFragment?e:a.templates.get(this.template).cloneNode(!0):document.createRange().createContextualFragment(this.template);if(e||this.template instanceof DocumentFragment||a.templates.set(this.template,f.cloneNode(!0)),this.mainView||this.preRuleSet.apply(f,this),this.mapTags(f),this.mainView||this.ruleSet.apply(f,this),this.nodes=[],!0===window.devmode?(this.firstNode=document.createComment("Template ".concat(this._id," Start")),this.lastNode=document.createComment("Template ".concat(this._id," End"))):(this.firstNode=document.createTextNode(""),this.lastNode=document.createTextNode("")),(b=this.nodes).push.apply(b,[this.firstNode].concat(_toConsumableArray(Array.from(f.childNodes)),[this.lastNode])),c){var g=c.getRootNode(),h="internal",j=!1;if(g.isConnected&&(j=!0,h="external"),d?(c.insertBefore(this.firstNode,d),c.insertBefore(this.lastNode,d)):(c.appendChild(this.firstNode),c.appendChild(this.lastNode)),c.insertBefore(f,this.lastNode),moveIndex++,j){this.attached(g,c);var k=this.attach.items();for(var l in k)k[l](g,c);this.nodes.filter(function(a){return a.nodeType!==Node.COMMENT_NODE}).map(function(a){a.dispatchEvent(new Event("cvDomAttached",{bubbles:!0,target:a}))})}}return this.renderComplete(this.nodes),this.postRender(c),this.nodes}},{key:"reRender",value:function reRender(a,b){var c=new DocumentFragment;if(this.firstNode.isConnected){var d=this.detach.items();for(var e in d)d[e]();this.nodes.filter(function(a){return a.nodeType===Node.ELEMENT_NODE}).map(function(a){a.dispatchEvent(new Event("cvDomDetached",{bubbles:!0,target:a}))})}if(c.append.apply(c,_toConsumableArray(this.nodes)),a){b?(a.insertBefore(this.firstNode,b),a.insertBefore(this.lastNode,b)):(a.appendChild(this.firstNode),a.appendChild(this.lastNode)),a.insertBefore(c,this.lastNode);var f=a.getRootNode();if(f.isConnected){this.nodes.filter(function(a){return a.nodeType===Node.ELEMENT_NODE}).map(function(a){a.dispatchEvent(new Event("cvDomAttached",{bubbles:!0,target:a}))});var g=this.attach.items();for(var h in g)g[h](f,a)}}return this.nodes}},{key:"mapTags",value:function mapTags(a){var b=this;_Dom.Dom.mapTags(a,!1,function(a,c){a[dontParse]||(a.matches?(a=b.mapInterpolatableTag(a),a=a.matches("[cv-template]")&&b.mapTemplateTag(a)||a,a=a.matches("[cv-slot]")&&b.mapSlotTag(a)||a,a=a.matches("[cv-prerender]")&&b.mapPrendererTag(a)||a,a=a.matches("[cv-link]")&&b.mapLinkTag(a)||a,a=a.matches("[cv-attr]")&&b.mapAttrTag(a)||a,a=a.matches("[cv-expand]")&&b.mapExpandableTag(a)||a,a=a.matches("[cv-ref]")&&b.mapRefTag(a)||a,a=a.matches("[cv-on]")&&b.mapOnTag(a)||a,a=a.matches("[cv-each]")&&b.mapEachTag(a)||a,a=a.matches("[cv-bind]")&&b.mapBindTag(a)||a,a=a.matches("[cv-if]")&&b.mapIfTag(a)||a,a=a.matches("[cv-with]")&&b.mapWithTag(a)||a):a=b.mapInterpolatableTag(a),a!==c.currentNode&&(c.currentNode=a))})}},{key:"mapExpandableTag",value:function mapExpandableTag(a){var b=a[expandBind];b&&(b(),a[expandBind]=!1);var c=_Bindable.Bindable.resolve(this.args,a.getAttribute("cv-expand"),!0),d=_slicedToArray(c,2),e=d[0],f=d[1];return a.removeAttribute("cv-expand"),e[f]||(e[f]={}),this.onRemove(a[expandBind]=e[f].bindTo(function(b,c,e,f){return f||void 0===b?void a.removeAttribute(c,b):null===b?void a.setAttribute(c,""):void a.setAttribute(c,b)})),a}},{key:"compileExpandableTag",value:function compileExpandableTag(a){return function(b){var c=a.cloneNode(!0),d=c.getAttribute("cv-expand"),e=_Bindable.Bindable.make(b.args[d]||{});c.removeAttribute("cv-expand");var f=function(a){if("name"===a||"type"===a)return"continue";var d=e.bindTo(a,function(a,b){return function(c){a.setAttribute(b,c)}}(c,a));b.onRemove(function(){d(),e.isBound()&&_Bindable.Bindable.clearBindings(e)})};for(var h in e){var g=f(h)}return c}}},{key:"mapAttrTag",value:function mapAttrTag(a){var b=this.compileAttrTag(a),c=b(this);return a.replaceWith(c),c}},{key:"compileAttrTag",value:function compileAttrTag(a){var b=a.getAttribute("cv-attr"),c=b.split(","),d=c.map(function(a){return a.split(":")});return a.removeAttribute("cv-attr"),function(b){var c=a.cloneNode(!0),e=function(a){var e=d[a][1]||d[a][0],f=_Bindable.Bindable.resolve(b.args,e,!0),g=_slicedToArray(f,2),h=g[0],i=g[1],j=d[a][0];b.onRemove(h.bindTo(i,function(a,b,e,f){return f||void 0===a?void c.removeAttribute(j,a):null===a?void c.setAttribute(j,""):void c.setAttribute(j,a)}))};for(var f in d)e(f);return c}}},{key:"mapInterpolatableTag",value:function mapInterpolatableTag(b){var c=this,d=this.interpolateRegex;if(b.nodeType===Node.TEXT_NODE){var o=b.nodeValue;if(!this.interpolatable(o))return b;for(var e,f,g=0,h=function(){var d=e[2],f=!1,h=!1,i=d.split("|"),j=!1;if(1<i.length&&(j=c.stringTransformer(i.slice(1)),d=i[0]),"$$"===d.substr(0,2)&&(f=!0,h=!0,d=d.substr(2)),"$"===d.substr(0,1)&&(f=!0,d=d.substr(1)),"000"===d.substr(0,3))return expand=!0,d=d.substr(3),"continue";var k=o.substring(g,e.index);g=e.index+e[1].length;var l=document.createTextNode(k);l[dontParse]=!0,b.parentNode.insertBefore(l,b);var m;m=f?document.createElement("div"):document.createTextNode(""),m[dontParse]=!0;var n=c.args,p=d;if(d.match(/\./)){var q=_Bindable.Bindable.resolve(c.args,d,!0),r=_slicedToArray(q,2);n=r[0],p=r[1]}b.parentNode.insertBefore(m,b);var s=n.bindTo(p,function(d,e,g){if(g[e]instanceof a&&g[e]!==d&&!g[e].preserve&&g[e].remove(),m.nodeValue="",h&&!(d instanceof a)){var i=d;d=new a(c.args,c),d.template=i}if(d instanceof a){var k=function(a){d.attached(a)};c.attach.add(k),d.render(b.parentNode,m);var l=function(){d.preserve||d.remove()};c.onRemove(l),d.onRemove(function(){c.attach.remove(k),c._onRemove.remove(l)})}else j&&(d=j(d)),d instanceof Object&&d.__toString instanceof Function&&(d=d.__toString()),f?m.innerHTML=d:m.nodeValue=d,m[dontParse]=!0});c.onRemove(function(){s(),n.isBound()||_Bindable.Bindable.clearBindings(n)})};e=d.exec(o);)f=h(),"continue"===f;var j=o.substring(g),k=document.createTextNode(j);k[dontParse]=!0,b.parentNode.insertBefore(k,b),b.nodeValue=""}if(b.nodeType===Node.ELEMENT_NODE)for(var l,m=function(a){if(!c.interpolatable(b.attributes[a].value))return"continue";for(var e=0,f=void 0,g=b.attributes[a].value,h=b.attributes[a],i={},l=[];f=d.exec(g);)l.push(g.substring(e,f.index)),i[f[2]]||(i[f[2]]=[]),i[f[2]].push(l.length),l.push(f[1]),e=f.index+f[1].length;l.push(g.substring(e));var m=function(a){var d=c.args,e=a,f=a.split("|"),g=!1,j=a;if(1<f.length&&(g=c.stringTransformer(f.slice(1)),e=f[0]),e.match(/\./)){var k=_Bindable.Bindable.resolve(c.args,e,!0),m=_slicedToArray(k,2);d=m[0],e=m[1]}i[j];c.onRemove(d.bindTo(e,function(a,c,d){for(var f in g&&(a=g(a)),i)for(var k in i[j])l[i[j][k]]=d[f],c===e&&(l[i[j][k]]=a);b.setAttribute(h.name,l.join(""))})),c.onRemove(function(){d.isBound()||_Bindable.Bindable.clearBindings(d)})};for(var n in i)m(n)},n=0;n<b.attributes.length;n++)l=m(n),"continue"===l;return b}},{key:"mapRefTag",value:function mapRefTag(a){var b=a.getAttribute("cv-ref"),c=b.split(":"),d=_slicedToArray(c,3),e=d[0],f=d[1],g=void 0===f?null:f,h=d[2],i=void 0===h?null:h;g||(g="curvature/base/Tag");var j=this.stringToClass(g);a.removeAttribute("cv-ref"),Object.defineProperty(a,"___tag___",{enumerable:!1,writable:!0}),this.onRemove(function(){a.___tag___=null,a.remove()});var k=this,l=this;this.viewList&&(k=this.viewList.parent);var m=new j(a,this,e,void 0,l);for(a.___tag___=m,this.tags[e]=a;k;){!k.parent;var n=this.args[i];void 0===n?k.tags[e]=m:(!k.tags[e]&&(k.tags[e]=[]),k.tags[e][n]=m),k=k.parent}return a}},{key:"mapBindTag",value:function mapBindTag(b){var c=this,d=b.getAttribute("cv-bind"),e=this.args,f=d,g=null;if(d.match(/\./)){var h=_Bindable.Bindable.resolve(this.args,d,!0),i=_slicedToArray(h,3);e=i[0],f=i[1],g=i[2]}e!==this.args&&(this.subBindings[d]=this.subBindings[d]||[],this.onRemove(this.args.bindTo(g,function(){for(;c.subBindings.length;)c.subBindings.shift()()})));var j=!1;"$"===f.substr(0,1)&&(f=f.substr(1),j=!0);var k=e.bindTo(f,function(e,f,g,h,d){d instanceof a&&d!==e&&d.remove();var k=new CustomEvent("cvAutoChanged",{bubbles:!0});if(["INPUT","SELECT","TEXTAREA"].includes(b.tagName)){var r=b.getAttribute("type");if(r&&"checkbox"===r.toLowerCase())b.checked=!!e,b.dispatchEvent(k);else if(r&&"radio"===r.toLowerCase())b.checked=e==b.value,b.dispatchEvent(k);else if("file"!==r){if("SELECT"===b.tagName)for(var s in b.options){var i=b.options[s];i.value==e&&(b.selectedIndex=s)}b.value=null==e?"":e,b.dispatchEvent(k)}}else if(e instanceof a){var l,m=_createForOfIteratorHelper(b.childNodes);try{for(m.s();!(l=m.n()).done;){var t=l.value;t.remove()}}catch(a){m.e(a)}finally{m.f()}var u=function(a){e.attached(a)};c.attach.add(u),e.render(b),e.onRemove(function(){return c.attach.remove(u)})}else if(j){if(b.innerHTML!==e)if(b.innerHTML===e.substring(0,b.innerHTML.length))b.innerHTML+=e.substring(b.innerHTML.length);else{var n,o=_createForOfIteratorHelper(b.childNodes);try{for(o.s();!(n=o.n()).done;){var v=n.value;v.remove()}}catch(a){o.e(a)}finally{o.f()}b.innerHTML=e}}else if(b.textContent!==e){var p,q=_createForOfIteratorHelper(b.childNodes);try{for(q.s();!(p=q.n()).done;){var w=p.value;w.remove()}}catch(a){q.e(a)}finally{q.f()}b.textContent=e}});e!==this.args&&this.subBindings[d].push(k),this.onRemove(k);var l=b.getAttribute("type"),m=b.getAttribute("multiple"),n=function(a){if(a.target===b)if(l&&"checkbox"===l.toLowerCase())e[f]=!!b.checked&&a.target.getAttribute("value");else if(a.target.matches("[contenteditable=true]"))e[f]=a.target.innerHTML;else if("file"===l&&m){var c=Array.from(a.target.files),d=e[f]||_Bindable.Bindable.onDeck(e,f);if(!d||!c.length)e[f]=c;else{var g=function(a){if(c[a]!==d[a])return c[a].toJSON=function(){return{name:file[a].name,size:file[a].size,type:file[a].type,date:file[a].lastModified}},d[a]=c[a],"break"};for(var j in c){var h=g(j);if("break"===h)break}}}else if("file"===l&&!m){var i=a.target.files.item(0);i.toJSON=function(){return{name:i.name,size:i.size,type:i.type,date:i.lastModified}},e[f]=i}else e[f]=a.target.value};return"file"===l||"radio"===l?b.addEventListener("change",n):(b.addEventListener("input",n),b.addEventListener("change",n),b.addEventListener("value-changed",n)),this.onRemove(function(a,b){return function(){"file"===l||"radio"===l?a.removeEventListener("change",n):(a.removeEventListener("input",n),a.removeEventListener("change",n),a.removeEventListener("value-changed",n)),a=void 0,b=void 0}}(b,n)),b.removeAttribute("cv-bind"),b}},{key:"mapOnTag",value:function mapOnTag(a){var b=this,c=a.getAttribute("cv-on")+"";return c.split(";").map(function(b){return b.split(":")}).map(function(c){c=c.map(function(b){return b.trim()});var d=c.length,e=(c.shift()+"").trim(),f=((c.shift()||e)+"").trim(),g=((c.shift()||"")+"").trim(),h=[],i=/(\w+)(?:\(([$\w\s-'",]+)\))?/.exec(f);i?(f=i[1].replace(/(^[\s\n]+|[\s\n]+$)/,""),i[2]&&(h=i[2].split(",").map(function(a){return a.trim()})),i.length):h.push("$event"),e&&1!==d||(e=f);for(var j,k=b;k;){if("function"==typeof k[f]){var l=function(){var a=k,b=f;return j=function(){a[b].apply(a,arguments)},"break"}();if("break"===l)break}if(k.parent)k=k.parent;else break}var m=function(c){var d=h.map(function(d){var e;return parseInt(d)==d?d:"event"===d||"$event"===d?c:"$view"===d?k:"$tag"===d?a:"$parent"===d?b.parent:"$subview"===d?b:d in b.args?b.args[d]:(e=/^['"]([\w-]+?)["']$/.exec(d))?e[1]:void 0});if("function"!=typeof j)throw new Error("".concat(f," is not defined on View object.")+"\nTag:\n"+"".concat(a.outerHTML));j.apply(void 0,_toConsumableArray(d))},n={};switch(g.includes("p")?n.passive=!0:g.includes("P")&&(n.passive=!1),g.includes("c")?n.capture=!0:g.includes("C")&&(n.capture=!1),g.includes("o")?n.once=!0:g.includes("O")&&(n.once=!1),e){case"_init":m();break;case"_attach":b.attach.add(m);break;case"_detach":b.detach.add(m);break;default:a.addEventListener(e,m,n),b.onRemove(function(){a.removeEventListener(e,m,n)});}return[e,f,h]}),a.removeAttribute("cv-on"),a}},{key:"mapLinkTag",value:function mapLinkTag(a){var b=a.getAttribute("cv-link");a.setAttribute("href",b);var c=function(c){return c.preventDefault(),"http"===b.substring(0,4)||"//"===b.substring(0,2)?void window.open(a.getAttribute("href",b)):void _Router.Router.go(a.getAttribute("href"))};return a.addEventListener("click",c),this.onRemove(function(a,b){return function(){a.removeEventListener("click",b),a=void 0,b=void 0}}(a,c)),a.removeAttribute("cv-link"),a}},{key:"compileLinkTag",value:function compileLinkTag(b){var c=b.getAttribute("cv-link");return b.removeAttribute("cv-link"),function(d){var e=b.cloneNode(!0);return e.setAttribute("href",c),e.addEventListener("click",a.linkClicked),d.onRemove(function(){return e.removeEventListener(a.linkClicked)}),e}}},{key:"mapPrendererTag",value:function mapPrendererTag(a){var b=a.getAttribute("cv-prerender"),c=window.prerenderer||navigator.userAgent.match(/prerender/i);return c&&(window.prerenderer=window.prerenderer||!0),("never"===b&&c||"only"===b&&!c)&&a.parentNode.removeChild(a),a}},{key:"mapWithTag",value:function mapWithTag(b){var c=this,d=b.getAttribute("cv-with"),e=b.getAttribute("cv-carry"),f=b.getAttribute("cv-view");b.removeAttribute("cv-with"),b.removeAttribute("cv-carry"),b.removeAttribute("cv-view");var g=f?this.stringToClass(f):a,h=new DocumentFragment;Array.from(b.childNodes).map(function(a){return h.appendChild(a)});var j=[];e&&(j=e.split(",").map(function(a){return a.trim()}));var k=this.args.bindTo(d,function(a,d){for(c.withViews[d]&&c.withViews[d].remove();b.firstChild;)b.removeChild(b.firstChild);var e=new g({},c);c.onRemove(function(a){return function(){a.remove()}}(e)),e.template=h;var f=function(a){var b=c.args.bindTo(j[a],function(a,b){e.args[b]=a});e.onRemove(b),c.onRemove(function(){b(),e.remove()})};for(var l in j)f(l);var k=function(b){var d=a.bindTo(b,function(a,b){e.args[b]=a}),f=e.args.bindTo(b,function(b,c){a[c]=b});c.onRemove(function(){d(),a.isBound()||_Bindable.Bindable.clearBindings(a),e.remove()}),e.onRemove(function(){d(),a.isBound()||_Bindable.Bindable.clearBindings(a)})};for(var i in a)k(i);e.render(b),c.withViews[d]=e});return this.onRemove(k),b}},{key:"mapEachTag",value:function mapEachTag(b){var c=this,d=b.getAttribute("cv-each"),e=b.getAttribute("cv-view");b.removeAttribute("cv-each"),b.removeAttribute("cv-view");var f=e?this.stringToClass(e):a,g=new DocumentFragment;Array.from(b.childNodes).map(function(a){return g.appendChild(a)});var h=d.split(":"),i=_slicedToArray(h,3),j=i[0],k=i[1],l=i[2],m=this.args.bindTo(j,function(a){c.viewLists[j]&&c.viewLists[j].remove();var d=new _ViewList.ViewList(g,k,a,c,l,f),e=function(){return d.remove()};c.onRemove(e),d.onRemove(function(){return c._onRemove.remove(e)});var h=c.args.bindTo(function(a,b){"_id"===b||(d.subArgs[b]=a)}),i=d.args.bindTo(function(a,b){"_id"===b||"value"===b||"___"===b.substring(0,3)||b in c.args&&(c.args[b]=a)});for(d.onRemove(h),d.onRemove(i),c.onRemove(h),c.onRemove(i);b.firstChild;)b.removeChild(b.firstChild);c.viewLists[j]=d,d.render(b)});return this.onRemove(m),b}},{key:"mapIfTag",value:function mapIfTag(b){var c=b,d=c.getAttribute("cv-if"),e=!1;c.removeAttribute("cv-if"),"!"===d.substr(0,1)&&(d=d.substr(1),e=!0);var f=new DocumentFragment;Array.from(c.childNodes).map(function(a){return f.appendChild(a)});var g=this,h=new DocumentFragment,i=new a(this.args,g);i.template=f;var j=g.args,k=d;if(d.match(/\./)){var l=_Bindable.Bindable.resolve(g.args,d,!0),m=_slicedToArray(l,2);j=m[0],k=m[1]}var n=!1,o=j.bindTo(k,function(a){if(!n){var c=j[k],d=!!c^!!e?b:h;return i.render(d),void(n=!0)}Array.isArray(a)&&(a=!!a.length),e&&(a=!a),a?b.appendChild(h):i.nodes.map(function(a){return h.appendChild(a)})});g.onRemove(o);var p=function(){j.isBound()||_Bindable.Bindable.clearBindings(j)};return g.onRemove(function viewDebind(){o(),p(),g._onRemove.remove(o),g._onRemove.remove(p)}),b}},{key:"compileIfTag",value:function compileIfTag(b){var c=b.getAttribute("cv-if"),d=!1;b.removeAttribute("cv-if"),"!"===c.substr(0,1)&&(c=c.substr(1),d=!0);var e=new DocumentFragment;return Array.from(b.childNodes).map(function(a){return e.appendChild(a.cloneNode(!0))}),function(f){var g=b.cloneNode(),h=new DocumentFragment,i=new a({},f);i.template=e,f.syncBind(i);var j=f.args,k=c;if(c.match(/\./)){var l=_Bindable.Bindable.resolve(f.args,c,!0),m=_slicedToArray(l,2);j=m[0],k=m[1]}var n=!1,o=j.bindTo(k,function(a){if(!n){var b=f.args[k]||d?g:h;return i.render(b),void(n=!0)}Array.isArray(a)&&(a=!!a.length),d&&(a=!a),a?g.appendChild(h):i.nodes.map(function(a){return h.appendChild(a)})});f.onRemove(o);var p=function(){j.isBound()||_Bindable.Bindable.clearBindings(j)};return i.onRemove(function viewDebind(){o(),p(),f._onRemove.remove(o),f._onRemove.remove(p)}),g}}},{key:"mapTemplateTag",value:function mapTemplateTag(a){var b=a.getAttribute("cv-template");return a.removeAttribute("cv-template"),this.subTemplates[b]=function(){return"TEMPLATE"===a.tagName?a.content.cloneNode(!0):new DocumentFragment(a.innerHTML)},a}},{key:"mapSlotTag",value:function mapSlotTag(a){var b=a.getAttribute("cv-slot"),c=this.subTemplates[b];if(!c){for(var e=this;e&&(c=e.subTemplates[b],!c);)e=this.parent;if(!c)return void console.error("Template ".concat(b," not found."))}var d=c();for(a.removeAttribute("cv-slot");a.firstChild;)a.firstChild.remove();return a.appendChild(d),a}},{key:"syncBind",value:function syncBind(b){var c=this,d=this.args.bindTo(function(a,c){"_id"===c||b.args[c]!==a&&(b.args[c]=a)}),e=b.args.bindTo(function(b,e,f,g,d){if("_id"!==e){var h=b,i=d;h instanceof a&&(h=h.___ref___),i instanceof a&&(i=i.___ref___),h!==i&&i instanceof a&&d.remove(),e in c.args&&(c.args[e]=b)}});this.onRemove(d),this.onRemove(e),b.onRemove(function(){c._onRemove.remove(d),c._onRemove.remove(e)})}},{key:"postRender",value:function postRender(){}},{key:"attached",value:function attached(){}},{key:"interpolatable",value:function interpolatable(a){return!!(a+"").match(this.interpolateRegex)}},{key:"uuid",value:function uuid(){return"10000000-1000-4000-8000-100000000000".replace(/[018]/g,function(a){return(a^crypto.getRandomValues(new Uint8Array(1))[0]&15>>a/4).toString(16)})}},{key:"remove",value:function remove(){var a=this,b=!!(0<arguments.length&&void 0!==arguments[0])&&arguments[0],c=function(){for(var b in a.firstNode=a.lastNode=void 0,a.nodes)a.nodes[b].dispatchEvent(new Event("cvDomDetached")),a.nodes[b].remove()};b?c():requestAnimationFrame(c);var d,e=this._onRemove.items(),f=_createForOfIteratorHelper(e);try{for(f.s();!(d=f.n()).done;){var h=d.value;this._onRemove.remove(h),h()}}catch(a){f.e(a)}finally{f.f()}for(var j;j=this.cleanup.shift();)j&&j();for(var k in this.viewLists)this.viewLists[k]&&this.viewLists[k].remove();for(var l in this.viewLists=[],this.timeouts)clearTimeout(this.timeouts[l].timeout),delete this.timeouts[l];for(var g in this.intervals)clearInterval(this.intervals[g].timeout),delete this.intervals[g];for(var g in this.frames)this.frames[g](),delete this.frames[g];this.removed=!0}},{key:"findTag",value:function findTag(a){for(var b in this.nodes){var c=void 0;if(this.nodes[b].querySelector){if(this.nodes[b].matches(a))return this.nodes[b];if(c=this.nodes[b].querySelector(a))return c}}}},{key:"findTags",value:function findTags(a){return this.nodes,map(function(b){return b.querySelectorAll(a)}).flat()}},{key:"onRemove",value:function onRemove(a){this._onRemove.add(a)}},{key:"update",value:function update(){}},{key:"beforeUpdate",value:function beforeUpdate(){}},{key:"afterUpdate",value:function afterUpdate(){}},{key:"stringTransformer",value:function stringTransformer(a){var b=this;return function(c){for(var f in a){for(var d=b,e=a[f];d&&!d[e];)d=d.parent;if(!d)return;c=d[a[f]](c)}return c}}},{key:"stringToClass",value:function stringToClass(b){if(a.refClasses.has(b))return a.refClasses.get(b);var c=b.split("/"),d=c[c.length-1],e=require(b);return a.refClasses.set(b,e[d]),e[d]}},{key:"preventParsing",value:function preventParsing(a){a[dontParse]=!0}},{key:"toString",value:function toString(){return this.nodes.map(function(a){return a.outerHTML}).join(" ")}},{key:"listen",value:function listen(a,b,c,d){a.addEventListener(b,c,d);var e=function(){a.removeEventListener(b,c,d)},f=function(){e(),e=function(){}};return this.onRemove(function(){return f()}),f}}],[{key:"isView",value:function isView(){return a}}]),a}();exports.View=View,Object.defineProperty(View,"templates",{enumerable:!1,writable:!1,value:new Map}),Object.defineProperty(View,"refClasses",{enumerable:!1,writable:!1,value:new Map}),Object.defineProperty(View,"linkClicked",function(a){a.preventDefault();var b=a.target.getAttribute("href");return"http"===b.substring(0,4)||"//"===b.substring(0,2)?void window.open(b):void _Router.Router.go(b)});
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.ViewList=void 0;var _Bindable=require("./Bindable"),_View=require("./View"),_Bag=require("./Bag");function _createForOfIteratorHelper(a,b){var c;if("undefined"==typeof Symbol||null==a[Symbol.iterator]){if(Array.isArray(a)||(c=_unsupportedIterableToArray(a))||b&&a&&"number"==typeof a.length){c&&(a=c);var d=0,e=function(){};return{s:e,n:function n(){return d>=a.length?{done:!0}:{done:!1,value:a[d++]}},e:function e(a){throw a},f:e}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var f,g=!0,h=!1;return{s:function s(){c=a[Symbol.iterator]()},n:function n(){var a=c.next();return g=a.done,a},e:function e(a){h=!0,f=a},f:function f(){try{g||null==c["return"]||c["return"]()}finally{if(h)throw f}}}}function _unsupportedIterableToArray(a,b){if(a){if("string"==typeof a)return _arrayLikeToArray(a,b);var c=Object.prototype.toString.call(a).slice(8,-1);return"Object"===c&&a.constructor&&(c=a.constructor.name),"Map"===c||"Set"===c?Array.from(a):"Arguments"===c||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(c)?_arrayLikeToArray(a,b):void 0}}function _arrayLikeToArray(a,b){(null==b||b>a.length)&&(b=a.length);for(var c=0,d=Array(b);c<b;c++)d[c]=a[c];return d}function _classCallCheck(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function _defineProperties(a,b){for(var c,d=0;d<b.length;d++)c=b[d],c.enumerable=c.enumerable||!1,c.configurable=!0,"value"in c&&(c.writable=!0),Object.defineProperty(a,c.key,c)}function _createClass(a,b,c){return b&&_defineProperties(a.prototype,b),c&&_defineProperties(a,c),a}var ViewList=function(){function a(b,c,d,e){var f=this,g=4<arguments.length&&void 0!==arguments[4]?arguments[4]:null,h=5<arguments.length&&void 0!==arguments[5]?arguments[5]:null;_classCallCheck(this,a),this.removed=!1,this.args=_Bindable.Bindable.makeBindable({}),this.args.value=_Bindable.Bindable.makeBindable(d||{}),this.subArgs=_Bindable.Bindable.makeBindable({}),this.views=[],this.cleanup=[],this.viewClass=h||_View.View,this._onRemove=new _Bag.Bag,this.template=b,this.subProperty=c,this.keyProperty=g,this.tag=null,this.paused=!1,this.parent=e,this.rendered=new Promise(function(a){Object.defineProperty(f,"renderComplete",{configurable:!1,writable:!0,value:a})}),this.willReRender=!1,this.args.___before(function(a,b){"bindTo"==b||(f.paused=!0)}),this.args.___after(function(a,b,c){"bindTo"==b||(f.paused=1<c.length,f.reRender())});var i=this.args.value.bindTo(function(a,b,c,e){if(!f.paused){var d=b;if(isNaN(b)&&(d="_"+b),e)for(var g in f.views[d]&&f.views[d].remove(),delete f.views[d],f.views){if("string"==typeof g){f.views[g].args[f.keyProperty]=g.substr(1);continue}f.views[g].args[f.keyProperty]=g}else f.views[d]||f.willReRender?f.views[d]&&f.views[d].args&&(f.views[d].args[f.keyProperty]=b,f.views[d].args[f.subProperty]=a):f.willReRender=requestAnimationFrame(function(){f.reRender()})}});this._onRemove.add(i)}return _createClass(a,[{key:"render",value:function render(a){var b,c=this,d=[],e=_createForOfIteratorHelper(this.views);try{var f=function(){var c=b.value;c.render(a),d.push(c.rendered.then(function(){return c}))};for(e.s();!(b=e.n()).done;)f()}catch(a){e.e(a)}finally{e.f()}this.tag=a,Promise.all(d).then(function(a){return c.renderComplete(a)})}},{key:"reRender",value:function reRender(){var a=this;if(!this.paused&&this.tag){var b=[];for(var m in this.views)b[m]=this.views[m];var c=[];for(var i in this.args.value){var d=!1,e=i;for(var n in isNaN(e)&&(e="_"+i),b)if(b[n]&&void 0!==this.args.value[i]&&this.args.value[i]===b[n].args[this.subProperty]){d=!0,c[e]=b[n],c[e].args[this.keyProperty]=i,delete b[n];break}d||function(){var b={},d=c[e]=new a.viewClass(b,a.parent);c[e].template=a.template instanceof Object?a.template:a.template,c[e].viewList=a,c[e].args[a.keyProperty]=i,c[e].args[a.subProperty]=a.args.value[i];var f=b.bindTo(a.subProperty,function(c){var d=b[a.keyProperty];a.args.value[d]=c}),g=a.subArgs.bindTo(function(a,c){b[c]=a});d.onRemove(function(){f(),g(),a._onRemove.remove(f),a._onRemove.remove(g)}),a._onRemove.add(f),a._onRemove.add(g),b[a.subProperty]=a.args.value[i]}()}for(var j in b){var o=!1;for(var p in c)if(b[j]===c[p]){o=!0;break}o||b[j].remove()}if(Array.isArray(this.args.value)){var q=function(){var b=0<arguments.length&&void 0!==arguments[0]?arguments[0]:0,d=c.length-b-1;return c[d]?c[d]===a.views[d]?c[d].firstNode?q(b+1):(c[d].render(a.tag,c[d+1]),c[d].rendered.then(function(){return q(b+1)})):(c[d].render(a.tag,c[d+1]),a.views.splice(d,0,c[d]),c[d].rendered.then(function(){return q(b+1)})):Promise.resolve()};this.rendered=q()}else{var f=[],g=Object.assign({},c),h=function(b){return delete g[b],c[b].firstNode&&c[b]===a.views[b]?"continue":void(c[b].render(a.tag),f.push(c[b].rendered.then(function(){return c[b]})))};for(var r in c){var l=h(r)}for(var s in g)delete this.args.views[s],g.remove();this.rendered=Promise.all(f)}for(var t in this.views=c,c){if(isNaN(t)){c[t].args[this.keyProperty]=t.substr(1);continue}c[t].args[this.keyProperty]=t}this.willReRender=!1}}},{key:"pause",value:function pause(){var a=!(0<arguments.length&&void 0!==arguments[0])||arguments[0];for(var b in this.views)this.views[b].pause(a)}},{key:"onRemove",value:function onRemove(a){this._onRemove.add(a)}},{key:"remove",value:function remove(){for(var b in this.views)this.views[b].remove();var a=this._onRemove.items();for(var c in a)this._onRemove.remove(a[c]),a[c]();for(var d;this.cleanup.length;)d=this.cleanup.pop(),d();for(this.views=[];this.tag&&this.tag.firstChild;)this.tag.removeChild(this.tag.firstChild);this.subArgs&&_Bindable.Bindable.clearBindings(this.subArgs),_Bindable.Bindable.clearBindings(this.args),this.args.value&&!this.args.value.isBound()&&_Bindable.Bindable.clearBindings(this.args.value),this.removed=!0}}]),a}();exports.ViewList=ViewList;
"use strict";var _Field2=require("./Field");Object.defineProperty(exports,"__esModule",{value:!0}),exports.ButtonField=void 0;function _typeof(a){"@babel/helpers - typeof";return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(a){return typeof a}:function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a},_typeof(a)}function _classCallCheck(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function _defineProperties(a,b){for(var c,d=0;d<b.length;d++)c=b[d],c.enumerable=c.enumerable||!1,c.configurable=!0,"value"in c&&(c.writable=!0),Object.defineProperty(a,c.key,c)}function _createClass(a,b,c){return b&&_defineProperties(a.prototype,b),c&&_defineProperties(a,c),a}function _inherits(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function");a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,writable:!0,configurable:!0}}),b&&_setPrototypeOf(a,b)}function _setPrototypeOf(a,b){return _setPrototypeOf=Object.setPrototypeOf||function(a,b){return a.__proto__=b,a},_setPrototypeOf(a,b)}function _createSuper(a){var b=_isNativeReflectConstruct();return function(){var c,d=_getPrototypeOf(a);if(b){var e=_getPrototypeOf(this).constructor;c=Reflect.construct(d,arguments,e)}else c=d.apply(this,arguments);return _possibleConstructorReturn(this,c)}}function _possibleConstructorReturn(a,b){return b&&("object"===_typeof(b)||"function"==typeof b)?b:_assertThisInitialized(a)}function _assertThisInitialized(a){if(void 0===a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return a}function _isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(a){return!1}}function _getPrototypeOf(a){return _getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(a){return a.__proto__||Object.getPrototypeOf(a)},_getPrototypeOf(a)}var ButtonField=function(a){function b(a,d,e,f){var g;_classCallCheck(this,b),g=c.call(this,a,d,e,f),g.args.title=g.args.title||g.args.value,g._onClick=[];var h=g.args.attrs||{};return h.type=h.type||g.args.type,g.args.name=h.name=g.args.name||f,g.template="\n\t\t\t<label\n\t\t\t\tfor       = \"".concat(g.getName(),"\"\n\t\t\t\tdata-type = \"").concat(h.type,"\"\n\t\t\t\tcv-ref    = \"label:curvature/base/Tag\">\n\t\t\t\t<input\n\t\t\t\t\tname      = \"").concat(g.getName(),"\"\n\t\t\t\t\ttype      = \"").concat(h.type,"\"\n\t\t\t\t\tvalue     = \"[[value]]\"\n\t\t\t\t\tcv-on     = \"click:clicked(event)\"\n\t\t\t\t\tcv-ref    = \"input:curvature/base/Tag\"\n\t\t\t\t\tcv-expand = \"attrs\"\n\t\t\t\t/>\n\t\t\t</label>\n\t\t"),g}_inherits(b,a);var c=_createSuper(b);return _createClass(b,[{key:"clicked",value:function clicked(a){var b=this._onClick.map(function(b){return!1===b(a)}).filter(function(a){return a});return b.length?void("submit"==this.args.attrs.type&&(a.preventDefault(),a.stopPropagation())):void("submit"==this.args.attrs.type&&(a.preventDefault(),a.stopPropagation(),this.form.tags.formTag.element.dispatchEvent(new Event("submit",{cancelable:!0,bubbles:!0}))))}},{key:"onClick",value:function onClick(a){this._onClick.push(a)}}]),b}(_Field2.Field);exports.ButtonField=ButtonField;
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.Field=void 0;var _View2=require("../base/View"),_Bindable=require("../base/Bindable");function _typeof(a){"@babel/helpers - typeof";return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(a){return typeof a}:function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a},_typeof(a)}function _classCallCheck(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function _defineProperties(a,b){for(var c,d=0;d<b.length;d++)c=b[d],c.enumerable=c.enumerable||!1,c.configurable=!0,"value"in c&&(c.writable=!0),Object.defineProperty(a,c.key,c)}function _createClass(a,b,c){return b&&_defineProperties(a.prototype,b),c&&_defineProperties(a,c),a}function _inherits(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function");a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,writable:!0,configurable:!0}}),b&&_setPrototypeOf(a,b)}function _setPrototypeOf(a,b){return _setPrototypeOf=Object.setPrototypeOf||function(a,b){return a.__proto__=b,a},_setPrototypeOf(a,b)}function _createSuper(a){var b=_isNativeReflectConstruct();return function(){var c,d=_getPrototypeOf(a);if(b){var e=_getPrototypeOf(this).constructor;c=Reflect.construct(d,arguments,e)}else c=d.apply(this,arguments);return _possibleConstructorReturn(this,c)}}function _possibleConstructorReturn(a,b){return b&&("object"===_typeof(b)||"function"==typeof b)?b:_assertThisInitialized(a)}function _assertThisInitialized(a){if(void 0===a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return a}function _isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(a){return!1}}function _getPrototypeOf(a){return _getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(a){return a.__proto__||Object.getPrototypeOf(a)},_getPrototypeOf(a)}var Field=function(a){function b(a,d,e,f){var g,h,i,j;_classCallCheck(this,b);var k=Object.assign({},a);j=c.call(this,k),j.args.title=null!==(g=j.args.title)&&void 0!==g?g:f,j.args.value=null!==(h=j.args.value)&&void 0!==h?h:"",j.value=null!==(i=j.args.value)&&void 0!==i?i:"",j.skeleton=k,j.disabled=null,j.args.valueString="",j.form=d,j.parent=e,j.key=f,j.ignore=!!j.args.attrs&&(j.args.attrs["data-cv-ignore"]||!1);var l="",m=j.args.attrs||{};m.type=m.type||k.type||null,j.args.name=m.name=m.name||j.args.name||f,"checkbox"==m.type&&(l="value = \"1\""),j.template="\n\t\t\t<label\n\t\t\t\tfor           = \"".concat(j.getName(),"\"\n\t\t\t\tdata-type     = \"").concat(m.type||"text","\"\n\t\t\t\tcv-ref        = \"label:curvature/base/Tag\"\n\t\t\t>\n\t\t\t\t<span cv-if = \"title\">\n\t\t\t\t\t<span cv-ref = \"title:curvature/base/Tag\">[[title]]</span>\n\t\t\t\t</span>\n\t\t\t\t<input\n\t\t\t\t\tname      = \"").concat(j.getName(),"\"\n\t\t\t\t\ttype      = \"").concat(m.type||"text","\"\n\t\t\t\t\tcv-bind   = \"value\"\n\t\t\t\t\tcv-ref    = \"input:curvature/base/Tag\"\n\t\t\t\t\tcv-expand = \"attrs\"\n\t\t\t\t\t").concat(l,"\n\t\t\t\t/>\n\t\t\t\t<span cv-each = \"errors:error:e\">\n\t\t\t\t\t<p class = \"cv-error\">[[error]]</p>\n\t\t\t\t</span>\n\t\t\t</label>\n\t\t");var n=null;return j.args.bindTo("value",function(a,b){if(!isNaN(a)&&a.length&&a==+a&&a.length===(+a+"").length&&(a=+a),j.value=a,n!=b){if(n=f,j.args.valueString=JSON.stringify(a||"",null,4),j.valueString=j.args.valueString,!("file"==m.type&&j.tags.input&&j.tags.input.element.files&&j.tags.input.element.length))j.parent.args.value||(j.parent.args.value={}),j.parent.args.value[f]=a;else if(!m.multiple)j.parent.args.value[f]=j.tags.input.element.files[0];else{var c=Array.from(j.tags.input.element.files);if(!j.parent.args.value[b]||!c.length)j.parent.args.value[f]=c;else{for(var d in c)c[d]!==j.parent.args.value[f][d]&&(j.parent.args.value[f]=c);j.parent.args.value.splice(c.length)}}j.args.errors=[],n=null}}),j.parent.args.value[j.key]=j.args.value,j.parent.args.value.bindTo(f,function(a,b){if(n!=b){if(n=b,"file"!=m.type)j.args.value=a;else if(!(j.tags.input&&j.tags.input.element.files&&j.tags.input.element.files.length))j.args.value=a;else if(!m.multiple)j.parent.args.value[f]=j.tags.input.element.files[0];else{var c=Array.from(j.tags.input.element.files);if(!j.parent.args.value[f]||!c.length)j.parent.args.value[f]=c;else{for(var d in c)c[d]!==j.parent.args.value[f][d]&&(j.parent.args.value[f]=c);j.parent.args.value[f].splice(c.length)}}n=null}}),j}_inherits(b,a);var c=_createSuper(b);return _createClass(b,[{key:"disable",value:function disable(){this.hasChildren(),this.disabled="disabled"}},{key:"enable",value:function enable(){this.hasChildren(),this.disabled=!1}},{key:"hasChildren",value:function hasChildren(){return!1}},{key:"getName",value:function getName(){var a=!(0<arguments.length&&void 0!==arguments[0])||arguments[0];if(this.tags.input)return this.tags.input.element.getAttribute("name");var b=this.key;if(a){for(var c=this.parent,d=[b];c&&c.array&&"undefined"!=typeof c.key;)d.unshift(c.key),c=c.parent;b=d.shift(),d.length&&(b+="[".concat(d.join("]["),"]"))}return b}}]),b}(_View2.View);exports.Field=Field;
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.FieldSet=void 0;var _Field2=require("./Field"),_Form=require("./Form");function _typeof(a){"@babel/helpers - typeof";return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(a){return typeof a}:function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a},_typeof(a)}function _classCallCheck(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function _defineProperties(a,b){for(var c,d=0;d<b.length;d++)c=b[d],c.enumerable=c.enumerable||!1,c.configurable=!0,"value"in c&&(c.writable=!0),Object.defineProperty(a,c.key,c)}function _createClass(a,b,c){return b&&_defineProperties(a.prototype,b),c&&_defineProperties(a,c),a}function _inherits(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function");a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,writable:!0,configurable:!0}}),b&&_setPrototypeOf(a,b)}function _setPrototypeOf(a,b){return _setPrototypeOf=Object.setPrototypeOf||function(a,b){return a.__proto__=b,a},_setPrototypeOf(a,b)}function _createSuper(a){var b=_isNativeReflectConstruct();return function(){var c,d=_getPrototypeOf(a);if(b){var e=_getPrototypeOf(this).constructor;c=Reflect.construct(d,arguments,e)}else c=d.apply(this,arguments);return _possibleConstructorReturn(this,c)}}function _possibleConstructorReturn(a,b){return b&&("object"===_typeof(b)||"function"==typeof b)?b:_assertThisInitialized(a)}function _assertThisInitialized(a){if(void 0===a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return a}function _isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(a){return!1}}function _getPrototypeOf(a){return _getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(a){return a.__proto__||Object.getPrototypeOf(a)},_getPrototypeOf(a)}var FieldSet=function(a){function b(a,d,e,f){var g;_classCallCheck(this,b),g=c.call(this,a,d,e,f);var h=g.args.attrs||{};return h.type=h.type||"fieldset",g.array=!1,(a.array||h["data-array"]||h["data-multi"])&&(g.array=h["data-array"]=!0),g.args.value={},g.args.fields=_Form.Form.renderFields(a.children,_assertThisInitialized(g)),g.fields=g.args.fields,g.template="\n\t\t\t<label\n\t\t\t\tfor        = \"".concat(g.getName(),"\"\n\t\t\t\tdata-type  = \"").concat(h.type,"\"\n\t\t\t\tdata-multi = \"").concat(h["data-multi"]?"true":"false","\"\n\t\t\t\tcv-ref     = \"label:curvature/base/Tag\"\n\t\t\t>\n\t\t\t\t<span cv-if = \"title\">\n\t\t\t\t\t<span cv-ref = \"title:curvature/base/Tag\">[[title]]</span>\n\t\t\t\t</span>\n\t\t\t\t<fieldset\n\t\t\t\t\tname   = \"").concat(g.getName(),"\"\n\t\t\t\t\tcv-ref = \"input:curvature/base/Tag\"\n\t\t\t\t\tcv-expand=\"attrs\"\n\t\t\t\t\tcv-each = \"fields:field\"\n\t\t\t\t>\n\t\t\t\t\t[[field]]\n\t\t\t\t</fieldset>\n\t\t\t\t<span cv-each = \"errors:error:e\">\n\t\t\t\t\t<p class = \"cv-error\">[[error]]</p>\n\t\t\t\t</span>\n\t\t\t</label>\n\t\t"),g}_inherits(b,a);var c=_createSuper(b);return _createClass(b,[{key:"hasChildren",value:function hasChildren(){return!!Object.keys(this.args.fields).length}},{key:"wrapSubfield",value:function wrapSubfield(a){return a}}]),b}(_Field2.Field);exports.FieldSet=FieldSet;
"use strict";var _Field2=require("./Field");Object.defineProperty(exports,"__esModule",{value:!0}),exports.FileField=void 0;function _typeof(a){"@babel/helpers - typeof";return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(a){return typeof a}:function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a},_typeof(a)}function _classCallCheck(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function _inherits(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function");a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,writable:!0,configurable:!0}}),b&&_setPrototypeOf(a,b)}function _setPrototypeOf(a,b){return _setPrototypeOf=Object.setPrototypeOf||function(a,b){return a.__proto__=b,a},_setPrototypeOf(a,b)}function _createSuper(a){var b=_isNativeReflectConstruct();return function(){var c,d=_getPrototypeOf(a);if(b){var e=_getPrototypeOf(this).constructor;c=Reflect.construct(d,arguments,e)}else c=d.apply(this,arguments);return _possibleConstructorReturn(this,c)}}function _possibleConstructorReturn(a,b){return b&&("object"===_typeof(b)||"function"==typeof b)?b:_assertThisInitialized(a)}function _assertThisInitialized(a){if(void 0===a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return a}function _isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(a){return!1}}function _getPrototypeOf(a){return _getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(a){return a.__proto__||Object.getPrototypeOf(a)},_getPrototypeOf(a)}var FileField=function(a){function b(a,d,e,f){var g;_classCallCheck(this,b),g=c.call(this,a,d,e,f);var h=g.args.attrs||{};return h.type=h.type||g.args.type||"file",g.template="\n\t\t\t<label\n\t\t\t\tfor       = \"".concat(g.getName(),"\"\n\t\t\t\tdata-type = \"").concat(h.type,"\"\n\t\t\t\tcv-ref    = \"label:curvature/base/Tag\">\n\t\t\t>\n\t\t\t\t<input\n\t\t\t\t\tname    = \"").concat(g.getName(),"\"\n\t\t\t\t\ttype    = \"").concat(h.type,"\"\n\t\t\t\t\tcv-bind = \"value\"\n\t\t\t\t\tcv-ref  = \"input:curvature/base/Tag\"\n\t\t\t\t\tcv-expand = \"attrs\"\n\t\t\t\t/>\n\t\t\t\t<span style = \"display:none\" cv-if = \"value\">[[[value]]]</span>\n\t\t\t\t<span cv-each = \"errors:error:e\">\n\t\t\t\t\t<p class = \"cv-error\">[[error]]</p>\n\t\t\t\t</span>\n\t\t\t</label>\n\t\t"),g}_inherits(b,a);var c=_createSuper(b);return b}(_Field2.Field);exports.FileField=FileField;
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.Form=void 0;var _View2=require("../base/View"),_Field=require("./Field"),_FieldSet=require("./FieldSet"),_SelectField=require("./SelectField"),_RadioField=require("./RadioField"),_HtmlField=require("./HtmlField"),_HiddenField=require("./HiddenField"),_ButtonField=require("./ButtonField"),_TextareaField=require("./TextareaField"),_View3=require("./multiField/View"),_Bindable=require("../base/Bindable");function _typeof(a){"@babel/helpers - typeof";return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(a){return typeof a}:function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a},_typeof(a)}function _classCallCheck(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function _defineProperties(a,b){for(var c,d=0;d<b.length;d++)c=b[d],c.enumerable=c.enumerable||!1,c.configurable=!0,"value"in c&&(c.writable=!0),Object.defineProperty(a,c.key,c)}function _createClass(a,b,c){return b&&_defineProperties(a.prototype,b),c&&_defineProperties(a,c),a}function _inherits(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function");a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,writable:!0,configurable:!0}}),b&&_setPrototypeOf(a,b)}function _setPrototypeOf(a,b){return _setPrototypeOf=Object.setPrototypeOf||function(a,b){return a.__proto__=b,a},_setPrototypeOf(a,b)}function _createSuper(a){var b=_isNativeReflectConstruct();return function(){var c,d=_getPrototypeOf(a);if(b){var e=_getPrototypeOf(this).constructor;c=Reflect.construct(d,arguments,e)}else c=d.apply(this,arguments);return _possibleConstructorReturn(this,c)}}function _possibleConstructorReturn(a,b){return b&&("object"===_typeof(b)||"function"==typeof b)?b:_assertThisInitialized(a)}function _assertThisInitialized(a){if(void 0===a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return a}function _isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(a){return!1}}function _getPrototypeOf(a){return _getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(a){return a.__proto__||Object.getPrototypeOf(a)},_getPrototypeOf(a)}var Form=function(a){function b(a){var d,e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};_classCallCheck(this,b),d=c.call(this,{}),d.args.flatValue=d.args.flatValue||{},d.args.value=d.args.value||{},d.args.method=a._method||"GET",d.args.classes=d.args.classes||[],d.skeleton=a,d.args.bindTo("classes",function(a){d.args._classes=a.join(" ")}),d._onSubmit=[],d._onRender=[],d.action="",d.template="\n\t\t\t<form\n\t\t\t\tclass     = \"[[_classes]]\"\n\t\t\t\tmethod    = \"[[method]]\"\n\t\t\t\tenctype   = \"multipart/form-data\"\n\t\t\t\tcv-on     = \"submit:submit(event)\"\n\t\t\t\tcv-ref    = \"formTag:curvature/base/Tag\"\n\t\t\t\tcv-each   = \"fields:field\"\n\t\t\t\tcv-expand = \"attrs\"\n\t\t\t>\n\t\t\t\t[[field]]\n\t\t\t</form>\n\t\t",d.args.fields=b.renderFields(a,_assertThisInitialized(d),e),d.fields=d.args.fields;var f=_Bindable.Bindable.makeBindable(_assertThisInitialized(d));return d.args.bindTo("value",function(a){f.value=a}),d.args.bindTo("valueString",function(a){f.json=a}),_possibleConstructorReturn(d,f)}_inherits(b,a);var c=_createSuper(b);return _createClass(b,[{key:"submitHandler",value:function submitHandler(a){a.preventDefault(),a.stopPropagation()}},{key:"submit",value:function submit(a){for(var b in this.args.valueString=JSON.stringify(this.args.value,null,4),this._onSubmit)this._onSubmit[b](this,a)}},{key:"buttonClick",value:function buttonClick(){}},{key:"onSubmit",value:function onSubmit(a){this._onSubmit.push(a)}},{key:"onRender",value:function onRender(a){return this.nodes?void a(this):void this._onRender.push(a)}},{key:"formData",value:function formData(){var a=0<arguments.length&&void 0!==arguments[0]?arguments[0]:null,b=1<arguments.length&&void 0!==arguments[1]?arguments[1]:null,c=2<arguments.length&&void 0!==arguments[2]?arguments[2]:[];a||(a=new FormData),b||(b=this);for(var g in b.args.fields)if(!(b.args.fields[g]&&b.args.fields[g].disabled)){var d=c.slice(0);if(d.push(g),b.args.fields[g]&&b.args.fields[g].hasChildren())this.formData(a,b.args.fields[g],d);else if(b.args.fields[g]){var h=b.args.fields[g].getName();if(!("file"==b.args.fields[g].args.type&&b.args.fields[g].tags.input.element.files&&b.args.fields[g].tags.input.element.files.length))("file"!==b.args.fields[g].args.type||b.args.fields[g].args.value)&&a.append(h,void 0===b.args.fields[g].args.value?"":b.args.fields[g].args.value);else if(b.args.fields[g].args.attrs.multiple)for(var e=b.args.fields[g].tags.input.element.files,f=0;f<e.length;f++)e[f]&&a.append(h+"[]",e[f]);else b.args.fields[g].tags.input.element.files[0]&&a.append(h,b.args.fields[g].tags.input.element.files[0])}}return a}},{key:"queryString",value:function queryString(){var a=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},b=[];for(var c in this.args.flatValue)a[c]=a[c]||this.args.flatValue[c];for(var d in a)b.push(d+"="+encodeURIComponent(a[d]));return b.join("&")}},{key:"populate",value:function populate(a){for(var b in a)this.args.value[b]=a[b]}},{key:"hasChildren",value:function hasChildren(){return!!Object.keys(this.args.fields).length}},{key:"postRender",value:function postRender(){for(var a in this._onRender)this._onRender[a](this)}}],[{key:"renderFields",value:function renderFields(a){var c=1<arguments.length&&void 0!==arguments[1]?arguments[1]:null,d=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{},e={},f=function(f){if(e[f])return"continue";if("_"==f.substr(0,1))return"continue";var g=null,h=null;if(c&&(c instanceof b?h=c:h=c.form),d&&a[f].name in d)g=new d[a[f].name](a[f],h,c,f);else switch(a[f].type){case"fieldset":g=a[f].attrs&&a[f].attrs["data-multi"]?new _View3.View(a[f],h,c,f):new _FieldSet.FieldSet(a[f],h,c,f);break;case"select":g=new _SelectField.SelectField(a[f],h,c,f);break;case"radios":g=new _RadioField.RadioField(a[f],h,c,f);break;case"html":g=new _HtmlField.HtmlField(a[f],h,c,f);break;case"submit":case"button":g=new _ButtonField.ButtonField(a[f],h,c,f);break;case"hidden":g=new _HiddenField.HiddenField(a[f],h,c,f);break;case"textarea":g=new _TextareaField.TextareaField(a[f],h,c,f);break;default:g=new _Field.Field(a[f],h,c,f);}e[f]=g;var i=g.key;g.args.bindTo("value",function(a,b,d){if(!isNaN(a)&&a.length&&a==+a&&a.length===(+a+"").length&&(a=+a),("html"!=d.type||d.contentEditable)&&"fieldset"!=d.type){if(d.disabled)return void delete h.args.flatValue[i];d.attrs=d.attrs||{};var e=d.attrs.multiple,f=Array.isArray(a),g=c.args.value[i],j=d.attrs.multiple&&f&&Array.isArray(g);if(j)for(var k in a)a[k]!==c.args.value[i][k]&&(c.args.value[i][k]=a[k]),c.args.value[i].splice(a.length);else c.args.value[i]=a;h.args.flatValue[i]=a,h.args.valueString=JSON.stringify(h.args.value,null,4),console.log()}})};for(var h in a){var g=f(h)}return e}},{key:"_updateFields",value:function _updateFields(a,b){for(var c in a.args.fields){var d=a.args.fields[c];b[c]&&(b[c].value&&(d.args.value=b[c].value),b[c].errors&&(d.args.errors=b[c].errors),b[c].title&&(d.args.title=b[c].title),b[c].options&&(d.args.options=b[c].options),b[c].attrs&&(d.args.attrs=b[c].attrs),d.children&&b[c].children&&this._updateFields(d,b[c].children))}}}]),b}(_View2.View);exports.Form=Form;
"use strict";var _Field2=require("./Field");Object.defineProperty(exports,"__esModule",{value:!0}),exports.HiddenField=void 0;function _typeof(a){"@babel/helpers - typeof";return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(a){return typeof a}:function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a},_typeof(a)}function _classCallCheck(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function _inherits(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function");a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,writable:!0,configurable:!0}}),b&&_setPrototypeOf(a,b)}function _setPrototypeOf(a,b){return _setPrototypeOf=Object.setPrototypeOf||function(a,b){return a.__proto__=b,a},_setPrototypeOf(a,b)}function _createSuper(a){var b=_isNativeReflectConstruct();return function(){var c,d=_getPrototypeOf(a);if(b){var e=_getPrototypeOf(this).constructor;c=Reflect.construct(d,arguments,e)}else c=d.apply(this,arguments);return _possibleConstructorReturn(this,c)}}function _possibleConstructorReturn(a,b){return b&&("object"===_typeof(b)||"function"==typeof b)?b:_assertThisInitialized(a)}function _assertThisInitialized(a){if(void 0===a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return a}function _isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(a){return!1}}function _getPrototypeOf(a){return _getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(a){return a.__proto__||Object.getPrototypeOf(a)},_getPrototypeOf(a)}var HiddenField=function(a){function b(a,d,e,f){var g;_classCallCheck(this,b),a.type="hidden",g=c.call(this,a,d,e,f);var h=g.args.attrs||{};return g.args.type=h.type=h.type||g.args.type||"hidden",g.args.name=h.name=h.name||g.args.name||f,g.template="\n\t\t\t<label\n\t\t\t\tfor       = \"".concat(g.getName(),"\"\n\t\t\t\tdata-type = \"").concat(h.type,"\"\n\t\t\t\tstyle     = \"display:none\"\n\t\t\t\tcv-ref    = \"label:curvature/base/Tag\">\n\t\t\t\t<input\n\t\t\t\t\t\tname      = \"").concat(g.getName(),"\"\n\t\t\t\t\t\ttype      = \"hidden\"\n\t\t\t\t\t\tcv-bind   = \"value\"\n\t\t\t\t\t\tcv-ref    = \"input:curvature/base/Tag\"\n\t\t\t\t\t\tcv-expand = \"attrs\"\n\t\t\t\t/>\n\t\t\t\t<span cv-if = \"value\">[[[value]]]</span>\n\t\t\t</label>\n\t\t"),g}_inherits(b,a);var c=_createSuper(b);return b}(_Field2.Field);exports.HiddenField=HiddenField;
"use strict";var _Field2=require("./Field");Object.defineProperty(exports,"__esModule",{value:!0}),exports.HtmlField=void 0;function _typeof(a){"@babel/helpers - typeof";return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(a){return typeof a}:function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a},_typeof(a)}function _classCallCheck(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function _defineProperties(a,b){for(var c,d=0;d<b.length;d++)c=b[d],c.enumerable=c.enumerable||!1,c.configurable=!0,"value"in c&&(c.writable=!0),Object.defineProperty(a,c.key,c)}function _createClass(a,b,c){return b&&_defineProperties(a.prototype,b),c&&_defineProperties(a,c),a}function _inherits(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function");a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,writable:!0,configurable:!0}}),b&&_setPrototypeOf(a,b)}function _setPrototypeOf(a,b){return _setPrototypeOf=Object.setPrototypeOf||function(a,b){return a.__proto__=b,a},_setPrototypeOf(a,b)}function _createSuper(a){var b=_isNativeReflectConstruct();return function(){var c,d=_getPrototypeOf(a);if(b){var e=_getPrototypeOf(this).constructor;c=Reflect.construct(d,arguments,e)}else c=d.apply(this,arguments);return _possibleConstructorReturn(this,c)}}function _possibleConstructorReturn(a,b){return b&&("object"===_typeof(b)||"function"==typeof b)?b:_assertThisInitialized(a)}function _assertThisInitialized(a){if(void 0===a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return a}function _isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(a){return!1}}function _getPrototypeOf(a){return _getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(a){return a.__proto__||Object.getPrototypeOf(a)},_getPrototypeOf(a)}var HtmlField=function(a){function b(a,d,e,f){var g;return _classCallCheck(this,b),g=c.call(this,a,d,e,f),g.key=f,g.args.tagName=g.args.tagName||"div",g.args.displayValue=g.args.value,g.args.attrs=g.args.attrs||{},g.ignore=g.args.attrs["data-cv-ignore"]||!1,g.args.contentEditable=g.args.attrs.contenteditable||!1,g.args.bindTo("value",function(a){g.tags.input&&g.tags.input.element!==document.activeElement&&(g.args.displayValue=a)}),g.template="<".concat(g.args.tagName,"\n\t\t\tname            = \"").concat(g.getName(),"\"\n\t\t\tcv-ref          = \"input:curvature/base/Tag\"\n\t\t\tcontenteditable = \"[[contentEditable]]\"\n\t\t\tcv-expand       = \"attrs\"\n\t\t\tcv-bind         = \"$displayValue\"\n\t\t\tcv-on           = \"input:inputProvided(event);\"\n\t\t></").concat(g.args.tagName,">"),g}_inherits(b,a);var c=_createSuper(b);return _createClass(b,[{key:"inputProvided",value:function inputProvided(a){this.args.value=a.target.innerHTML}},{key:"hasChildren",value:function hasChildren(){return!1}},{key:"getName",value:function getName(){return this.key}}]),b}(_Field2.Field);exports.HtmlField=HtmlField;
"use strict";var _Field2=require("./Field");Object.defineProperty(exports,"__esModule",{value:!0}),exports.RadioField=void 0;function _typeof(a){"@babel/helpers - typeof";return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(a){return typeof a}:function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a},_typeof(a)}function _classCallCheck(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function _defineProperties(a,b){for(var c,d=0;d<b.length;d++)c=b[d],c.enumerable=c.enumerable||!1,c.configurable=!0,"value"in c&&(c.writable=!0),Object.defineProperty(a,c.key,c)}function _createClass(a,b,c){return b&&_defineProperties(a.prototype,b),c&&_defineProperties(a,c),a}function _inherits(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function");a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,writable:!0,configurable:!0}}),b&&_setPrototypeOf(a,b)}function _setPrototypeOf(a,b){return _setPrototypeOf=Object.setPrototypeOf||function(a,b){return a.__proto__=b,a},_setPrototypeOf(a,b)}function _createSuper(a){var b=_isNativeReflectConstruct();return function(){var c,d=_getPrototypeOf(a);if(b){var e=_getPrototypeOf(this).constructor;c=Reflect.construct(d,arguments,e)}else c=d.apply(this,arguments);return _possibleConstructorReturn(this,c)}}function _possibleConstructorReturn(a,b){return b&&("object"===_typeof(b)||"function"==typeof b)?b:_assertThisInitialized(a)}function _assertThisInitialized(a){if(void 0===a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return a}function _isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(a){return!1}}function _getPrototypeOf(a){return _getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(a){return a.__proto__||Object.getPrototypeOf(a)},_getPrototypeOf(a)}var RadioField=function(a){function b(a,d,e,f){var g;_classCallCheck(this,b),g=c.call(this,a,d,e,f);var h=g.args.attrs||{};return g.args.name=h.name=h.name||g.args.name||f,g.args.value=g.args.value||"",g.template="\n\t\t\t<label\n\t\t\t\tfor       = \"".concat(g.getName(),"\"\n\t\t\t\tdata-type = \"").concat(h.type,"\"\n\t\t\t\tcv-ref    = \"label:curvature/base/Tag\">\n\t\t\t\t<span cv-if = \"title\">\n\t\t\t\t\t<span cv-ref = \"title:curvature/base/Tag\">[[title]]</span>\n\t\t\t\t</span>\n\t\t\t\t<span cv-each  = \"options:option:optionText\"/>\n\t\t\t\t\t<label>\n\t\t\t\t\t\t<input\n\t\t\t\t\t\t\tname      = \"").concat(g.args.name,"\"\n\t\t\t\t\t\t\ttype      = \"radio\"\n\t\t\t\t\t\t\tvalue     = \"[[option]]\"\n\t\t\t\t\t\t\tcv-bind   = \"value\"\n\t\t\t\t\t\t\tcv-expand = \"attrs\"\n\t\t\t\t\t\t\tcv-on     = \"change:changed(event)\"\n\t\t\t\t\t/>\n\t\t\t\t\t\t[[optionText]]\n\t\t\t\t\t</label>\n\t\t\t\t</span>\n\t\t\t\t<span cv-each = \"errors:error:e\">\n\t\t\t\t\t<p class = \"cv-error\">[[error]]</p>\n\t\t\t\t</span>\n\t\t\t</label>\n\t\t"),g}_inherits(b,a);var c=_createSuper(b);return _createClass(b,[{key:"getLabel",value:function getLabel(){for(var a in this.args.options)if(this.args.options[a]==this.args.value)return a}},{key:"changed",value:function changed(a){this.args.value=a.target.value}}]),b}(_Field2.Field);exports.RadioField=RadioField;
"use strict";var _Field2=require("./Field");Object.defineProperty(exports,"__esModule",{value:!0}),exports.SelectField=void 0;function _typeof(a){"@babel/helpers - typeof";return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(a){return typeof a}:function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a},_typeof(a)}function _createForOfIteratorHelper(a,b){var c;if("undefined"==typeof Symbol||null==a[Symbol.iterator]){if(Array.isArray(a)||(c=_unsupportedIterableToArray(a))||b&&a&&"number"==typeof a.length){c&&(a=c);var d=0,e=function(){};return{s:e,n:function n(){return d>=a.length?{done:!0}:{done:!1,value:a[d++]}},e:function e(a){throw a},f:e}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var f,g=!0,h=!1;return{s:function s(){c=a[Symbol.iterator]()},n:function n(){var a=c.next();return g=a.done,a},e:function e(a){h=!0,f=a},f:function f(){try{g||null==c["return"]||c["return"]()}finally{if(h)throw f}}}}function _unsupportedIterableToArray(a,b){if(a){if("string"==typeof a)return _arrayLikeToArray(a,b);var c=Object.prototype.toString.call(a).slice(8,-1);return"Object"===c&&a.constructor&&(c=a.constructor.name),"Map"===c||"Set"===c?Array.from(a):"Arguments"===c||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(c)?_arrayLikeToArray(a,b):void 0}}function _arrayLikeToArray(a,b){(null==b||b>a.length)&&(b=a.length);for(var c=0,d=Array(b);c<b;c++)d[c]=a[c];return d}function _classCallCheck(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function _defineProperties(a,b){for(var c,d=0;d<b.length;d++)c=b[d],c.enumerable=c.enumerable||!1,c.configurable=!0,"value"in c&&(c.writable=!0),Object.defineProperty(a,c.key,c)}function _createClass(a,b,c){return b&&_defineProperties(a.prototype,b),c&&_defineProperties(a,c),a}function _inherits(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function");a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,writable:!0,configurable:!0}}),b&&_setPrototypeOf(a,b)}function _setPrototypeOf(a,b){return _setPrototypeOf=Object.setPrototypeOf||function(a,b){return a.__proto__=b,a},_setPrototypeOf(a,b)}function _createSuper(a){var b=_isNativeReflectConstruct();return function(){var c,d=_getPrototypeOf(a);if(b){var e=_getPrototypeOf(this).constructor;c=Reflect.construct(d,arguments,e)}else c=d.apply(this,arguments);return _possibleConstructorReturn(this,c)}}function _possibleConstructorReturn(a,b){return b&&("object"===_typeof(b)||"function"==typeof b)?b:_assertThisInitialized(a)}function _assertThisInitialized(a){if(void 0===a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return a}function _isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(a){return!1}}function _getPrototypeOf(a){return _getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(a){return a.__proto__||Object.getPrototypeOf(a)},_getPrototypeOf(a)}var SelectField=function(a){function b(a,d,e,f){var g;_classCallCheck(this,b),g=c.call(this,a,d,e,f);var h=g.args.attrs||{};return g.template="\n\t\t\t<label\n\t\t\t\tfor       = \"".concat(g.getName(),"\"\n\t\t\t\tdata-type = \"").concat(h.type||"select","\"\n\t\t\t\tcv-ref    = \"label:curvature/base/Tag\">\n\t\t\t\t<span cv-if = \"title\">\n\t\t\t\t\t<span cv-ref = \"title:curvature/base/Tag\">[[title]]</span>\n\t\t\t\t</span>\n\t\t\t\t<select\n\t\t\t\t\tname      = \"").concat(g.getName(),"\"\n\t\t\t\t\tcv-bind   = \"value\"\n\t\t\t\t\tcv-each   = \"options:option:optionText\"\n\t\t\t\t\tcv-ref    = \"input:curvature/base/Tag\"\n\t\t\t\t\tcv-expand = \"attrs\"\n\t\t\t\t/>\n\t\t\t\t\t<option value = \"[[option]]\">[[optionText]]</option>\n\t\t\t\t</select>\n\t\t\t\t<span cv-each = \"errors:error:e\">\n\t\t\t\t\t<p class = \"cv-error\">[[error]]</p>\n\t\t\t\t</span>\n\t\t\t</label>\n\t\t"),g}_inherits(b,a);var c=_createSuper(b);return _createClass(b,[{key:"postRender",value:function postRender(){var a=this;this.args.bindTo("value",function(b){return a.selectOptionByValue(b)}),this.args.bindTo("options",function(){var b=a.viewLists.options;b.rendered.then(function(){a.selectOptionByValue(a.args.value)})},{frame:!0})}},{key:"selectOptionByValue",value:function selectOptionByValue(a){var b,c=this.tags.input.element,d=_createForOfIteratorHelper(c.options);try{for(d.s();!(b=d.n()).done;){var e=b.value;e.value==a&&(c.selectedIndex=e.index)}}catch(a){d.e(a)}finally{d.f()}}},{key:"getLabel",value:function getLabel(){for(var a in this.args.options)if(this.args.options[a]==this.args.value)return a}}]),b}(_Field2.Field);exports.SelectField=SelectField;
"use strict";var _Field2=require("./Field");Object.defineProperty(exports,"__esModule",{value:!0}),exports.TextareaField=void 0;function _typeof(a){"@babel/helpers - typeof";return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(a){return typeof a}:function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a},_typeof(a)}function _classCallCheck(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function _inherits(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function");a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,writable:!0,configurable:!0}}),b&&_setPrototypeOf(a,b)}function _setPrototypeOf(a,b){return _setPrototypeOf=Object.setPrototypeOf||function(a,b){return a.__proto__=b,a},_setPrototypeOf(a,b)}function _createSuper(a){var b=_isNativeReflectConstruct();return function(){var c,d=_getPrototypeOf(a);if(b){var e=_getPrototypeOf(this).constructor;c=Reflect.construct(d,arguments,e)}else c=d.apply(this,arguments);return _possibleConstructorReturn(this,c)}}function _possibleConstructorReturn(a,b){return b&&("object"===_typeof(b)||"function"==typeof b)?b:_assertThisInitialized(a)}function _assertThisInitialized(a){if(void 0===a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return a}function _isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(a){return!1}}function _getPrototypeOf(a){return _getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(a){return a.__proto__||Object.getPrototypeOf(a)},_getPrototypeOf(a)}var TextareaField=function(a){function b(a,d,e,f){var g;_classCallCheck(this,b),g=c.call(this,a,d,e,f);var h=g.args.attrs||{};return h.type=h.type||"textarea",g.template="\n\t\t\t<label\n\t\t\t\tfor       = \"".concat(g.getName(),"\"\n\t\t\t\tdata-type = \"").concat(h.type,"\"\n\t\t\t\tcv-ref    = \"label:curvature/base/Tag\">\n\t\t\t\t<span cv-if = \"title\">\n\t\t\t\t\t<span cv-ref = \"title:curvature/base/Tag\">[[title]]</span>\n\t\t\t\t</span>\n\t\t\t\t<textarea\n\t\t\t\t\t\tname      = \"").concat(g.getName(),"\"\n\t\t\t\t\t\tcv-bind   = \"value\"\n\t\t\t\t\t\tcv-ref    = \"input:curvature/base/Tag\"\n\t\t\t\t\t\tcv-expand = \"attrs\"\n\t\t\t\t></textarea>\n\t\t\t\t<cv-template cv-if = \"attrs.data-caption\">\n\t\t\t\t\t<p>[[attrs.data-caption]]</p>\n\t\t\t\t</cv-template>\n\t\t\t\t<span cv-each = \"errors:error:e\">\n\t\t\t\t\t<p class = \"cv-error\">[[error]]</p>\n\t\t\t\t</span>\n\t\t\t</label>\n\t\t"),g}_inherits(b,a);var c=_createSuper(b);return b}(_Field2.Field);exports.TextareaField=TextareaField;
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.CreateForm=void 0;var _FormWrapper2=require("./FormWrapper"),_HiddenField=require("../../form/HiddenField");function _typeof(a){"@babel/helpers - typeof";return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(a){return typeof a}:function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a},_typeof(a)}function _classCallCheck(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function _defineProperties(a,b){for(var c,d=0;d<b.length;d++)c=b[d],c.enumerable=c.enumerable||!1,c.configurable=!0,"value"in c&&(c.writable=!0),Object.defineProperty(a,c.key,c)}function _createClass(a,b,c){return b&&_defineProperties(a.prototype,b),c&&_defineProperties(a,c),a}function _get(a,b,c){return _get="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(a,b,c){var d=_superPropBase(a,b);if(d){var e=Object.getOwnPropertyDescriptor(d,b);return e.get?e.get.call(c):e.value}},_get(a,b,c||a)}function _superPropBase(a,b){for(;!Object.prototype.hasOwnProperty.call(a,b)&&(a=_getPrototypeOf(a),null!==a););return a}function _inherits(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function");a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,writable:!0,configurable:!0}}),b&&_setPrototypeOf(a,b)}function _setPrototypeOf(a,b){return _setPrototypeOf=Object.setPrototypeOf||function(a,b){return a.__proto__=b,a},_setPrototypeOf(a,b)}function _createSuper(a){var b=_isNativeReflectConstruct();return function(){var c,d=_getPrototypeOf(a);if(b){var e=_getPrototypeOf(this).constructor;c=Reflect.construct(d,arguments,e)}else c=d.apply(this,arguments);return _possibleConstructorReturn(this,c)}}function _possibleConstructorReturn(a,b){return b&&("object"===_typeof(b)||"function"==typeof b)?b:_assertThisInitialized(a)}function _assertThisInitialized(a){if(void 0===a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return a}function _isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(a){return!1}}function _getPrototypeOf(a){return _getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(a){return a.__proto__||Object.getPrototypeOf(a)},_getPrototypeOf(a)}var CreateForm=function(a){function b(a,d){var e,f=2<arguments.length&&void 0!==arguments[2]?arguments[2]:"GET",g=3<arguments.length&&void 0!==arguments[3]?arguments[3]:{};return _classCallCheck(this,b),e=c.call(this,a,d,"POST",g||{}),e.creating=!!a.publicId,e}_inherits(b,a);var c=_createSuper(b);return _createClass(b,[{key:"onLoad",value:function onLoad(a){for(var d in a.args.fields)if(a.args.fields[d].tags.input&&"hidden"!=a.args.fields[d].args.attrs.type){var c=a.args.fields[d].tags.input.element;c.focus();break}_get(_getPrototypeOf(b.prototype),"onLoad",this).call(this,a)}},{key:"onRequest",value:function onRequest(){return this.args.view.args.loading=!0,this.args.view.args.classes+=" loading",_get(_getPrototypeOf(b.prototype),"onRequest",this).call(this)}},{key:"onResponse",value:function onResponse(a){this.args.view.args.loading=!1,this.args.view.args.classes="",this.args.wrapper?this.args.wrapper.refresh(a.body):this.args.view.addRecord(a.body),this.args.view.args.creating="",_get(_getPrototypeOf(b.prototype),"onResponse",this).call(this,a)}}]),b}(_FormWrapper2.FormWrapper);exports.CreateForm=CreateForm;
"use strict";
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.FormWrapper=void 0;var _Repository=require("../../base/Repository"),_Form=require("../../form/Form"),_Toast=require("../../toast/Toast"),_ToastAlert=require("../../toast/ToastAlert"),_View2=require("../../base/View"),_Router=require("../../base/Router");function _typeof(a){"@babel/helpers - typeof";return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(a){return typeof a}:function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a},_typeof(a)}function _createForOfIteratorHelper(a,b){var c;if("undefined"==typeof Symbol||null==a[Symbol.iterator]){if(Array.isArray(a)||(c=_unsupportedIterableToArray(a))||b&&a&&"number"==typeof a.length){c&&(a=c);var d=0,e=function(){};return{s:e,n:function n(){return d>=a.length?{done:!0}:{done:!1,value:a[d++]}},e:function e(a){throw a},f:e}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var f,g=!0,h=!1;return{s:function s(){c=a[Symbol.iterator]()},n:function n(){var a=c.next();return g=a.done,a},e:function e(a){h=!0,f=a},f:function f(){try{g||null==c["return"]||c["return"]()}finally{if(h)throw f}}}}function _unsupportedIterableToArray(a,b){if(a){if("string"==typeof a)return _arrayLikeToArray(a,b);var c=Object.prototype.toString.call(a).slice(8,-1);return"Object"===c&&a.constructor&&(c=a.constructor.name),"Map"===c||"Set"===c?Array.from(a):"Arguments"===c||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(c)?_arrayLikeToArray(a,b):void 0}}function _arrayLikeToArray(a,b){(null==b||b>a.length)&&(b=a.length);for(var c=0,d=Array(b);c<b;c++)d[c]=a[c];return d}function _classCallCheck(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function _defineProperties(a,b){for(var c,d=0;d<b.length;d++)c=b[d],c.enumerable=c.enumerable||!1,c.configurable=!0,"value"in c&&(c.writable=!0),Object.defineProperty(a,c.key,c)}function _createClass(a,b,c){return b&&_defineProperties(a.prototype,b),c&&_defineProperties(a,c),a}function _inherits(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function");a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,writable:!0,configurable:!0}}),b&&_setPrototypeOf(a,b)}function _setPrototypeOf(a,b){return _setPrototypeOf=Object.setPrototypeOf||function(a,b){return a.__proto__=b,a},_setPrototypeOf(a,b)}function _createSuper(a){var b=_isNativeReflectConstruct();return function(){var c,d=_getPrototypeOf(a);if(b){var e=_getPrototypeOf(this).constructor;c=Reflect.construct(d,arguments,e)}else c=d.apply(this,arguments);return _possibleConstructorReturn(this,c)}}function _possibleConstructorReturn(a,b){return b&&("object"===_typeof(b)||"function"==typeof b)?b:_assertThisInitialized(a)}function _assertThisInitialized(a){if(void 0===a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return a}function _isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(a){return!1}}function _getPrototypeOf(a){return _getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(a){return a.__proto__||Object.getPrototypeOf(a)},_getPrototypeOf(a)}var FormWrapper=function(a){function b(a,d){var e,f=2<arguments.length&&void 0!==arguments[2]?arguments[2]:"GET",g=3<arguments.length&&void 0!==arguments[3]?arguments[3]:{};return _classCallCheck(this,b),e=c.call(this,a),e.path=d,e.args.method=f,e.args.action=e.args.action||null,e.args.form=null,e.args.title=null,e.args["class"]="",e.template="\n\t\t\t<div class = \"form constrict [[class]]\">\n\t\t\t\t<div cv-if = \"title\"><label>[[title]]</label></div>\n\t\t\t\t[[form]]\n\t\t\t</div>\n\t\t",e._onLoad=[],e._onSubmit=[],e._onRender=[],e._onRequest=[],e._onError=[],e._onResponse=[],d instanceof _Form.Form?e.loadForm(form,g):_Repository.Repository.request(d).then(function(a){return a&&a.meta&&a.meta.form&&a.meta.form instanceof Object?void(e.loadForm(new _Form.Form(a.meta.form,g)),e.onLoad(e.args.form,a.body)):void console.log("Cannot render form with ",a)}),e}_inherits(b,a);var c=_createSuper(b);return _createClass(b,[{key:"loadForm",value:function loadForm(a){var b=this;this.args.form=a,this.args.form.onSubmit(function(a,c){if(!1!==b.onSubmit(a,c)){c&&(c.preventDefault(),c.stopPropagation());var d=a.tags.formTag.element,e=d.getAttribute("action")||b.args.action||b.path,f=d.getAttribute("method")||b.args.method,g=a.args.flatValue;if(f=f.toUpperCase(),"GET"==f){var l={};for(var m in b.args.content&&b.args.content.args&&(b.args.content.args.page=0),l.page=0,g)"api"!=m&&(l[m]=g[m]);var i=b.onRequest(l);i.then(function(){b.onResponse({}),_Router.Router.go(e+"?"+_Router.Router.queryToString(l)),b.update(l)})["catch"](function(a){b.onRequestError(a)})}else if("POST"==f){var h,j=a.formData(),k=_createForOfIteratorHelper(j.entries());try{for(k.s();!(h=k.n()).done;)h.value}catch(a){k.e(a)}finally{k.f()}var n=b.onRequest(j);n&&n.then(function(){_Repository.Repository.request(e,{api:"json"},j,!1,{progressDown:function progressDown(a){b.progressDown(a)},progressUp:function progressUp(a){b.progressUp(a)}}).then(function(a){b.onResponse(a)})["catch"](function(a){b.onRequestError(a)})})}}})}},{key:"onRequest",value:function onRequest(a){var b=[];for(var c in this._onRequest){var d=this._onRequest[c](a,this);d&&b.push(d)}return 0==b.length?Promise.resolve():Promise.all(b)}},{key:"onRequestError",value:function onRequestError(a){for(var b in this._onError)this._onError[b](a,this);if(a.messages)for(var c in a.messages)_Toast.Toast.instance().alert(a.body&&a.body.id?"Success!":"Error!",a.messages[c],3500)}},{key:"onResponse",value:function onResponse(a){for(var b in this._onResponse)this._onResponse[b](a,this);if(a.messages)for(var c in a.messages)_Toast.Toast.instance().alert(a.body&&a.body.id?"Success!":"Error!",a.messages[c],3500)}},{key:"onLoad",value:function onLoad(a,b){for(var c in this._onLoad)this._onLoad[c](this,a,b)}},{key:"onSubmit",value:function onSubmit(a,b){for(var c in this._onSubmit)this._onSubmit[c](this,b)}},{key:"postRender",value:function postRender(){for(var a in this._onRender)this._onRender[a](this.args.form)}},{key:"customFields",value:function customFields(){return{}}},{key:"submit",value:function submit(){}},{key:"progressUp",value:function progressUp(a){console.log(a.loaded,a.total,a.loaded/a.total)}},{key:"progressDown",value:function progressDown(a){console.log(a.loaded,a.total,a.loaded/a.total)}}]),b}(_View2.View);exports.FormWrapper=FormWrapper;
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.SearchForm=void 0;var _Config=require("Config"),_FormWrapper2=require("./FormWrapper"),_HiddenField=require("../../form/HiddenField"),_Repository=require("../../base/Repository");function _typeof(a){"@babel/helpers - typeof";return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(a){return typeof a}:function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a},_typeof(a)}function _classCallCheck(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function _defineProperties(a,b){for(var c,d=0;d<b.length;d++)c=b[d],c.enumerable=c.enumerable||!1,c.configurable=!0,"value"in c&&(c.writable=!0),Object.defineProperty(a,c.key,c)}function _createClass(a,b,c){return b&&_defineProperties(a.prototype,b),c&&_defineProperties(a,c),a}function _get(a,b,c){return _get="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(a,b,c){var d=_superPropBase(a,b);if(d){var e=Object.getOwnPropertyDescriptor(d,b);return e.get?e.get.call(c):e.value}},_get(a,b,c||a)}function _superPropBase(a,b){for(;!Object.prototype.hasOwnProperty.call(a,b)&&(a=_getPrototypeOf(a),null!==a););return a}function _inherits(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function");a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,writable:!0,configurable:!0}}),b&&_setPrototypeOf(a,b)}function _setPrototypeOf(a,b){return _setPrototypeOf=Object.setPrototypeOf||function(a,b){return a.__proto__=b,a},_setPrototypeOf(a,b)}function _createSuper(a){var b=_isNativeReflectConstruct();return function(){var c,d=_getPrototypeOf(a);if(b){var e=_getPrototypeOf(this).constructor;c=Reflect.construct(d,arguments,e)}else c=d.apply(this,arguments);return _possibleConstructorReturn(this,c)}}function _possibleConstructorReturn(a,b){return b&&("object"===_typeof(b)||"function"==typeof b)?b:_assertThisInitialized(a)}function _assertThisInitialized(a){if(void 0===a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return a}function _isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(a){return!1}}function _getPrototypeOf(a){return _getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(a){return a.__proto__||Object.getPrototypeOf(a)},_getPrototypeOf(a)}var backend=_Config.Config?_Config.Config.backend:"//",SearchForm=function(a){function b(a,d){var e,f=2<arguments.length&&void 0!==arguments[2]?arguments[2]:"GET",g=3<arguments.length&&void 0!==arguments[3]?arguments[3]:{};return _classCallCheck(this,b),e=c.call(this,a,d,"POST",{search:_HiddenField.HiddenField}),e.superTemplate=e.template,e.args.records=[],e.selected=null,e.template="\n\t\t\t".concat(e.superTemplate,"\n\t\t\t<div cv-each = \"records:record:r\" class = \"dropdown-results\">\n\t\t\t\t<div\n\t\t\t\t\tcv-on         = \"click:select(event)\"\n\t\t\t\t\tdata-index    = \"[[r]]\"\n\t\t\t\t\tdata-publicId = \"[[record.publicId]]\"\n\t\t\t\t\tclass         = \"[[record.classes]]\"\n\t\t\t\t>\n\t\t\t\t\t[[record.title]]\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t"),e}_inherits(b,a);var c=_createSuper(b);return _createClass(b,[{key:"onLoad",value:function onLoad(a){var c=this;for(var e in a.args.fields)if(a.args.fields[e].tags.input&&"hidden"!=a.args.fields[e].args.attrs.type){var d=a.args.fields[e].tags.input.element;d.focus();break}a.args.flatValue.bindTo("keyword",function(a){c.args.records=[],c.selected=null,a&&(console.log(c.path,a),_Repository.Repository.request(backend+c.path,{keyword:a}).then(function(b){console.log(b.body),b.body&&(c.args.records=b.body.map(function(b){return b.classes="",b.title==a&&(b.classes="selected",c.selected=b),b}))}))}),_get(_getPrototypeOf(b.prototype),"onLoad",this).call(this,a)}},{key:"onRequest",value:function onRequest(){return _get(_getPrototypeOf(b.prototype),"onRequest",this).call(this)}},{key:"onResponse",value:function onResponse(a){_get(_getPrototypeOf(b.prototype),"onResponse",this).call(this,a)}},{key:"select",value:function select(a){var b=this,c=a.target.getAttribute("data-index"),d=a.target.getAttribute("data-publicId"),e=this.args.records[c];return console.log(e),this.args.view.addRecord(e),void this.args.view.addButtonClicked()}},{key:"onSubmit",value:function onSubmit(a,b){return b.preventDefault(),b.stopPropagation(),this.selected&&(this.args.view.addRecord(this.selected),this.args.view.addButtonClicked()),!1}}]),b}(_FormWrapper2.FormWrapper);exports.SearchForm=SearchForm;
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.View=void 0;var _Config=require("Config"),_Form=require("../../form/Form"),_FieldSet2=require("../../form/FieldSet"),_CreateForm=require("./CreateForm"),_SearchForm=require("./SearchForm"),_FormWrapper=require("./FormWrapper"),_Wrapper=require("./Wrapper");function _typeof(a){"@babel/helpers - typeof";return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(a){return typeof a}:function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a},_typeof(a)}function _classCallCheck(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function _defineProperties(a,b){for(var c,d=0;d<b.length;d++)c=b[d],c.enumerable=c.enumerable||!1,c.configurable=!0,"value"in c&&(c.writable=!0),Object.defineProperty(a,c.key,c)}function _createClass(a,b,c){return b&&_defineProperties(a.prototype,b),c&&_defineProperties(a,c),a}function _inherits(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function");a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,writable:!0,configurable:!0}}),b&&_setPrototypeOf(a,b)}function _setPrototypeOf(a,b){return _setPrototypeOf=Object.setPrototypeOf||function(a,b){return a.__proto__=b,a},_setPrototypeOf(a,b)}function _createSuper(a){var b=_isNativeReflectConstruct();return function(){var c,d=_getPrototypeOf(a);if(b){var e=_getPrototypeOf(this).constructor;c=Reflect.construct(d,arguments,e)}else c=d.apply(this,arguments);return _possibleConstructorReturn(this,c)}}function _possibleConstructorReturn(a,b){return b&&("object"===_typeof(b)||"function"==typeof b)?b:_assertThisInitialized(a)}function _assertThisInitialized(a){if(void 0===a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return a}function _isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(a){return!1}}function _getPrototypeOf(a){return _getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(a){return a.__proto__||Object.getPrototypeOf(a)},_getPrototypeOf(a)}var View=function(a){function b(a,d,e,f){var g;for(var h in _classCallCheck(this,b),g=c.call(this,a,d,e,f),g.args._fields=[],g.dragging=!1,g.dropping=!1,g.args.fields)g.args._fields[h]=g.wrapSubfield(g.args.fields[h]);return g.args.fields[-1].disable(),g.args.creating="",g.args.fieldType="",g.args.createForm=g.args.createForm||"",g.args.searchForm=g.args.searchForm||"",g.args.createFormReady=!1,g.setCreateForm({view:_assertThisInitialized(g)}),g.args.loader="...",g.args.addIcon="&#215;",g.args.addIcon="a",g.args.addIcon="+",g.args.draggable="true",g.template="\n\t\t\t<label\n\t\t\t\tfor        = \"".concat(g.args.name,"\"\n\t\t\t\tdata-type  = \"").concat(g.args.attrs.type,"\"\n\t\t\t\tdata-multi = \"").concat(g.args.attrs["data-multi"]?"true":"false","\"\n\t\t\t>\n\t\t\t\t<span cv-if = \"title\">\n\t\t\t\t\t<span cv-ref = \"title:curvature/base/Tag\">[[title]]</span>\n\t\t\t\t</span>\n\n\t\t\t\t<fieldset\n\t\t\t\t\tname  = \"").concat(g.args.name,"\"\n\t\t\t\t\tclass = \"multi-field [[creating]] [[fieldType]]\"\n\t\t\t\t>\n\n\t\t\t\t\t<div class = \"record-list\" cv-each = \"_fields:field:f\">\n\t\t\t\t\t\t<div\n\t\t\t\t\t\t\tclass     = \"single-record\"\n\t\t\t\t\t\t\tdata-for  = \"[[f]]\"\n\t\t\t\t\t\t>[[field]]</div>\n\t\t\t\t\t</div>\n\n\t\t\t\t\t<div class = \"overlay create\">\n\t\t\t\t\t\t<div class = \"form constrict\">\n\t\t\t\t\t\t\t<div\n\t\t\t\t\t\t\t\tcv-on = \"click:addButtonClicked(event)\"\n\t\t\t\t\t\t\t\tclass = \"bubble bottom left-margin close\"\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t&#215;\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t[[createForm]]\n\t\t\t\t\t\t[[searchForm]]\n\t\t\t\t\t</div>\n\n\t\t\t\t\t<div class = \"overlay loading\">\n\t\t\t\t\t\t[[loader]]\n\t\t\t\t\t</div>\n\t\t\t\t\t<div cv-if = \"createFormReady\" class=\"add-button-holder\">\n\n\t\t\t\t\t\t<div\n\t\t\t\t\t\t\tcv-on = \"click:addButtonClicked(event)\"\n\t\t\t\t\t\t\tclass = \"bubble bottom left-margin add\"\n\t\t\t\t\t\t\ttab-index = \"0\"\n\t\t\t\t\t\t>[[addIcon]]</div>\n\n\t\t\t\t\t</div>\n\n\t\t\t\t</fieldset>\n\n\t\t\t\t<span cv-each = \"errors:error:e\">\n\t\t\t\t\t<p class = \"cv-error\">[[error]]</p>\n\t\t\t\t</span>\n\n\t\t\t</label>\n\t\t"),g}_inherits(b,a);var c=_createSuper(b);return _createClass(b,[{key:"setCreateForm",value:function setCreateForm(a){var b=this,c="";_Config.Config&&_Config.Config.backend&&(c=_Config.Config.backend),!1===this.args.attrs["data-create-endpoint"]?this.args.createFormReady=!0:(this.args.createForm=new _CreateForm.CreateForm(Object.assign({},a),this.args.attrs["data-create-endpoint"]?c+this.args.attrs["data-create-endpoint"]:a.publicId?c+"".concat(this.args.attrs["data-endpoint"],"/").concat(a.publicId,"/edit"):c+"".concat(this.args.attrs["data-endpoint"],"/create")),this.args.createForm._onLoad.push(function(){b.args.createFormReady=!0})),console.log(this.args.createFormReady),this.args.searchForm=new _SearchForm.SearchForm(Object.assign({},a),c+this.args.attrs["data-endpoint"])}},{key:"wrapSubfield",value:function wrapSubfield(a){return new _Wrapper.Wrapper({field:a,parent:this})}},{key:"addButtonClicked",value:function addButtonClicked(){this.args.creating||(this.args.creating="creating")}},{key:"addRecord",value:function addRecord(a){for(var f in this.args.creating="",Array.isArray(a)||(a=[a]),a){var b,c=this.args.fields[-1].constructor,d=Object.assign({},this.args.fields[-1].skeleton),e=Object.values(this.args.fields).length-1;d=this.cloneSkeleton(d),d=this.correctNames(d,e),d.attrs=null!==(b=d.attrs)&&void 0!==b?b:{},d.attrs["data-array"]=!0;var g={};g[e]=d;var h=_Form.Form.renderFields(g,this)[e];this.args.fields[e]=h;var i=this.wrapSubfield(h);h.args.value.id=a[f].id||"",h.args.value["class"]=a[f]["class"]||"",h.args.value.title=a[f].title||"",h.args.value.key=this.args._fields.length,this.args._fields.push(i),i.refresh(a[f])}}},{key:"editRecord",value:function editRecord(a,b){this.setCreateForm({view:this,publicId:a.publicId,wrapper:b}),this.args.creating=this.args.creating?"":"creating"}},{key:"deleteImage",value:function deleteImage(a){console.log(a,this.args.fields),this.args.fields[a].disable(),this.args._fields[a].args.classes="deleted"}},{key:"undeleteImage",value:function undeleteImage(a){this.args.fields[a].enable(),this.args._fields[a].args.classes=""}},{key:"cloneSkeleton",value:function cloneSkeleton(a){var b=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0,c={};for(var d in Array.isArray(a)&&(c=[]),a)if("fields"!=d){if(!a[d]||"object"!==_typeof(a[d])){c[d]=a[d];continue}c[d]=Object.assign({},this.cloneSkeleton(a[d],b+1))}return c}},{key:"correctNames",value:function correctNames(a,b){if(a.name=a.name.replace(/\[-1\]/,"[".concat(b,"]")),a.attrs.name=a.name,"children"in a)for(var c in a.children)a.children[c]=this.correctNames(a.children[c],b);return a}},{key:"drag",value:function drag(a){this.dragging=a.target}},{key:"dragOver",value:function dragOver(a){if(!this.dragging)return!1;for(var b=a.target;b&&!b.matches("[draggable=\"true\"]");)b=b.parentNode;dropping&&(this.dropping=dropping,a.preventDefault())}},{key:"drop",value:function drop(a){a.stopPropagation();var b=this.dragging.querySelector("label"),c=this.dropping.querySelector("label"),d=b.getAttribute("for"),e=c.getAttribute("for"),f=this.extractIndex(d),g=this.extractIndex(e);if(f==g||f==g-1)return this.dragging=!1,void(this.dropping=!1);var h,j,k=b.querySelectorAll("[name^=\""+d+"\"]"),l=b.querySelectorAll("[for^=\""+d+"\"]"),m=c.querySelectorAll("[name^=\""+e+"\"]"),n=c.querySelectorAll("[for^=\""+e+"\"]"),o=this.dropping,p=0;for(var z in this.args.fields){var q=this.args.fields[z].tags.input.element,r=this.args.fields[z].tags.label.element,s=q.getAttribute("name");b==r&&(h=this.args.fields[z]),c==r&&(j=this.args.fields[z]);var t=this.extractIndex(s),u=!1;if(!(0>t)&&(f>g&&t>=g&&t<=f?(u=this.changeIndex(s,t+1),p=-1):f<g&&t<=g&&t>=f&&(u=this.changeIndex(s,t-1),p=0),!1!==u)){this.changeAttributePrefix(r,"for",s,u),this.args.fields[z].args.fieldName=u,this.changeAttributePrefix(q,"name",s,u);for(var v=q.parentNode.querySelectorAll("[name^=\""+s+"\"]"),w=0;w<v.length;w++)this.changeAttributePrefix(v[w],"name",s,u);for(var x=q.parentNode.querySelectorAll("[for^=\""+s+"\"]"),y=0;y<x.length;y++)this.changeAttributePrefix(x[y],"for",s,u)}}d=b.getAttribute("for"),e=c.getAttribute("for"),f=this.extractIndex(d),g=this.extractIndex(e),this.changeAttributePrefix(b,"for",d,this.changeIndex(d,g+p));for(var i=0;i<k.length;i++)this.changeAttributePrefix(k[i],"name",d,this.changeIndex(d,g+p));for(var A=0;A<l.length;A++)this.changeAttributePrefix(l[A],"for",d,this.changeIndex(d,g+p));h.args.fieldName=b.getAttribute("for"),this.changeAttributePrefix(c,"for",e,this.changeIndex(e,g+p+1));for(var B=0;B<m.length;B++)this.changeAttributePrefix(m[B],"name",e,this.changeIndex(e,g+p+1));for(var C=0;C<n.length;C++)this.changeAttributePrefix(n[C],"for",e,this.changeIndex(e,g+p+1));j.args.fieldName=c.getAttribute("for"),this.dragging.parentNode.insertBefore(this.dragging,o),this.dragging=!1,this.dropping=!1}},{key:"dragStop",value:function dragStop(){this.dragging=!1,this.dropping=!1}},{key:"changeAttributePrefix",value:function changeAttributePrefix(a,b,c,d){var e=a.getAttribute(b),f=d+a.getAttribute(b).substring(c.length);a.setAttribute(b,f)}},{key:"extractIndex",value:function extractIndex(a){var b;return!!(b=/\[(-?\d+)\]$/.exec(a))&&parseInt(b[1])}},{key:"changeIndex",value:function changeIndex(a,b){var c=a.replace(/\[(-?\d+)\]$/,"["+b+"]");return c}},{key:"cancel",value:function cancel(a){a.stopPropagation()}}]),b}(_FieldSet2.FieldSet);exports.View=View;
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.Wrapper=void 0;var _Config=require("Config"),_View2=require("../../base/View"),_Repository=require("../../base/Repository");function _typeof(a){"@babel/helpers - typeof";return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(a){return typeof a}:function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a},_typeof(a)}function _classCallCheck(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function _defineProperties(a,b){for(var c,d=0;d<b.length;d++)c=b[d],c.enumerable=c.enumerable||!1,c.configurable=!0,"value"in c&&(c.writable=!0),Object.defineProperty(a,c.key,c)}function _createClass(a,b,c){return b&&_defineProperties(a.prototype,b),c&&_defineProperties(a,c),a}function _inherits(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function");a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,writable:!0,configurable:!0}}),b&&_setPrototypeOf(a,b)}function _setPrototypeOf(a,b){return _setPrototypeOf=Object.setPrototypeOf||function(a,b){return a.__proto__=b,a},_setPrototypeOf(a,b)}function _createSuper(a){var b=_isNativeReflectConstruct();return function(){var c,d=_getPrototypeOf(a);if(b){var e=_getPrototypeOf(this).constructor;c=Reflect.construct(d,arguments,e)}else c=d.apply(this,arguments);return _possibleConstructorReturn(this,c)}}function _possibleConstructorReturn(a,b){return b&&("object"===_typeof(b)||"function"==typeof b)?b:_assertThisInitialized(a)}function _assertThisInitialized(a){if(void 0===a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return a}function _isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(a){return!1}}function _getPrototypeOf(a){return _getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(a){return a.__proto__||Object.getPrototypeOf(a)},_getPrototypeOf(a)}var Wrapper=function(a){function b(a){var d;return _classCallCheck(this,b),d=c.call(this,a),d.template="\n\t\t\t<div\n\t\t\t\tclass = \"wrapped-field [[classes]]\"\n\t\t\t\tcv-on = \"click:editRecord(event, key)\"\n\t\t\t\ttitle = \"[[fieldName]]: [[id]]\"\n\t\t\t>\n\t\t\t\t<div\n\t\t\t\t\tcv-on = \"click:deleteImage(event, key)\"\n\t\t\t\t\tstyle = \"display: inline; cursor:pointer;\"\n\t\t\t\t>\n\t\t\t\t\t[[icon]]\n\t\t\t\t</div>\n\t\t\t\t<div class = \"field-content\">\n\t\t\t\t\t[[title]]\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<div style = \"display:none\">[[field]]</div>\n\t\t",d.args.field=d.args.field||"!",d.args.keyword="",d.args.title="",d.args.record={},d.args.key=d.args.field.key,d.args.classes="",d.args.icon="\xD7",d.deleted=!1,d.args.field.args.bindTo("fieldName",function(a){d.args.fieldName=a}),d.args.fieldName=d.args.field.args.name,d.args.id=d.args.field.args.value.id,d.args.bindTo("id",function(a){d.args.field.args.value.id=a}),d.args.field.args.value.bindTo("id",function(a){a&&_Repository.Repository.request(d.backendPath(),{id:a}).then(function(b){d.args.id=a;var c=b.body[0];return c?void d.refresh(c):(d.args.publicId=null,void(d.args.title=null))})},{wait:0}),d.args.field.args.value.bindTo("keyword",function(a){d.args.keyword=a}),d}_inherits(b,a);var c=_createSuper(b);return _createClass(b,[{key:"editRecord",value:function editRecord(){this.args.parent.editRecord(this.args.record,this)}},{key:"deleteImage",value:function deleteImage(a,b){a.stopPropagation(),this.deleted?(this.args.icon="\xD7",this.args.parent.undeleteImage(b),this.deleted=!1):(this.args.icon="\u21BA",this.args.parent.deleteImage(b),this.deleted=!0)}},{key:"backendPath",value:function backendPath(){var a=_Config.Config?_Config.Config.backend:"//";return a+this.args.parent.args.attrs["data-endpoint"]}},{key:"getRecordTitle",value:function getRecordTitle(a){return a._titleField?a[a._titleField]:a.title||a.publicId||a.id}},{key:"refresh",value:function refresh(a){for(var b in a)this.args[b]=a[b];this.args.record=a,this.args.title=this.getRecordTitle(a)}}]),b}(_View2.View);exports.Wrapper=Wrapper;
"use strict";
"use strict";var _Bindable=require("../base/Bindable");Object.defineProperty(exports,"__esModule",{value:!0}),exports.Keyboard=void 0;function _classCallCheck(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function _defineProperties(a,b){for(var c,d=0;d<b.length;d++)c=b[d],c.enumerable=c.enumerable||!1,c.configurable=!0,"value"in c&&(c.writable=!0),Object.defineProperty(a,c.key,c)}function _createClass(a,b,c){return b&&_defineProperties(a.prototype,b),c&&_defineProperties(a,c),a}var Keyboard=function(){function a(){var b=this;_classCallCheck(this,a),this.maxDecay=120,this.listening=!0,this.keys=_Bindable.Bindable.makeBindable({}),this.codes=_Bindable.Bindable.makeBindable({}),document.addEventListener("keyup",function(a){b.keys[a.key]=-1,b.codes[a.code]=-1}),document.addEventListener("keydown",function(a){0<b.keys[a.key]||(b.keys[a.key]=1,b.codes[a.code]=1)}),window.addEventListener("blur",function(){for(var a in b.keys)b.keys[a]=-1;for(var c in b.codes)b.codes[c]=-1})}return _createClass(a,null,[{key:"get",value:function get(){return this.instance=this.instance||new this}}]),_createClass(a,[{key:"getKey",value:function getKey(a){return this.keys[a]?this.keys[a]:0}},{key:"getKeyCode",value:function getKeyCode(a){return this.codes[a]?this.codes[a]:0}},{key:"update",value:function update(){for(var a in this.keys)0<this.keys[a]?this.keys[a]++:(this.keys[a]--,this.keys[a]<-this.maxDecay&&delete this.keys[a]);for(var a in this.codes)0<this.codes[a]?this.codes[a]++:(this.codes[a]--,this.codes[a]<-this.maxDecay&&delete this.keys[a])}}]),a}();exports.Keyboard=Keyboard;
"use strict";
"use strict";function _typeof(a){"@babel/helpers - typeof";return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(a){return typeof a}:function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a},_typeof(a)}function _defineProperties(a,b){for(var c,d=0;d<b.length;d++)c=b[d],c.enumerable=c.enumerable||!1,c.configurable=!0,"value"in c&&(c.writable=!0),Object.defineProperty(a,c.key,c)}function _createClass(a,b,c){return b&&_defineProperties(a.prototype,b),c&&_defineProperties(a,c),a}function _classCallCheck(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}var INSERT=1,ENTER=2,LEAVE=3,HOME=4,Chunk=function a(){_classCallCheck(this,a),this.depth=0,this.match=null,this.type="normal",this.list=[]},Parser=function(){function a(b,c){_classCallCheck(this,a),this.index=0,this.mode="normal",this.stack=[],this.tokens=b||{},this.modes=c||{}}return _createClass(a,[{key:"parse",value:function parse(a){if(!(this.mode in this.modes))throw new Error("Mode ".concat(this.mode," does not exist on parser."),this);var b=new Chunk,c=this.modes[this.mode];for(b.type=this.mode;this.index<a.length;){var j=!1;for(var k in c){var d=this.tokens[k],e=d.exec(a.substr(this.index));if(e&&!(0<e.index)){if(!c[k]){throw new Error("Invalid token type \"".concat(k,"\" found in mode \"").concat(this.mode,"\"."))}var f=e[0],g="object"===_typeof(c[k])?c[k]:[c[k]];j=!0,console.log(b.type,b.depth,f),this.index+=f.length;var h="normal";for(var l in g){var i=g[l];if("string"==typeof i){if(!(i in this.modes))throw new Error("Mode \"".concat(i,"\" does not exist."));this.mode=i,c=this.modes[this.mode],h=i;continue}switch(i){case INSERT:b.list.push(f);break;case ENTER:var m=new Chunk;m.depth=b.depth+1,m.match=f,m.type=h,b.list.push(m),this.stack.push(b),b=m;break;case LEAVE:if(!this.stack.length)throw console.log(this.mode,"\"".concat(f,"\""),b),new Error("Already at the top of the stack.");b=this.stack.pop(),this.mode=b.type,c=this.modes[this.mode];}}break}}if(!j)break}if(this.stack.length)throw new Error("Did not return to top of stack!");return this.stack.shift()||b}}]),a}();
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.LazyTag=void 0;var _ScrollTag2=require("./ScrollTag"),_Dom=require("../base/Dom");function _typeof(a){"@babel/helpers - typeof";return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(a){return typeof a}:function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a},_typeof(a)}function _classCallCheck(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function _inherits(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function");a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,writable:!0,configurable:!0}}),b&&_setPrototypeOf(a,b)}function _setPrototypeOf(a,b){return _setPrototypeOf=Object.setPrototypeOf||function(a,b){return a.__proto__=b,a},_setPrototypeOf(a,b)}function _createSuper(a){var b=_isNativeReflectConstruct();return function(){var c,d=_getPrototypeOf(a);if(b){var e=_getPrototypeOf(this).constructor;c=Reflect.construct(d,arguments,e)}else c=d.apply(this,arguments);return _possibleConstructorReturn(this,c)}}function _possibleConstructorReturn(a,b){return b&&("object"===_typeof(b)||"function"==typeof b)?b:_assertThisInitialized(a)}function _assertThisInitialized(a){if(void 0===a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return a}function _isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(a){return!1}}function _getPrototypeOf(a){return _getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(a){return a.__proto__||Object.getPrototypeOf(a)},_getPrototypeOf(a)}var LazyTag=function(a){function b(a,d,e,f,g){var h;return _classCallCheck(this,b),h=c.call(this,a,d,e,f,g),h.element.classList.remove("cv-visible"),h.element.classList.add("cv-not-visible"),h.bindTo("visible",function(a){a&&(h.afterScroll&&clearTimeout(h.afterScroll),h.afterScroll=setTimeout(function(){h.element&&(h.element.classList.add("cv-visible"),h.element.classList.remove("cv-not-visible"),_Dom.Dom.mapTags(h.element,"[cv-lazy-style]",function(a){var b=a.getAttribute("cv-lazy-style"),c=a.getAttribute("style");a.setAttribute("style",c+";"+b),a.removeAttribute("cv-lazy-style")}))},.5*(h.offsetTop||h.element.offsetTop)+.5*h.element.offsetLeft))}),h}_inherits(b,a);var c=_createSuper(b);return b}(_ScrollTag2.ScrollTag);exports.LazyTag=LazyTag;
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.PopOutTag=void 0;var _Bindable=require("../base/Bindable"),_Dom=require("../base/Dom"),_Tag2=require("../base/Tag");function _typeof(a){"@babel/helpers - typeof";return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(a){return typeof a}:function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a},_typeof(a)}function _classCallCheck(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function _defineProperties(a,b){for(var c,d=0;d<b.length;d++)c=b[d],c.enumerable=c.enumerable||!1,c.configurable=!0,"value"in c&&(c.writable=!0),Object.defineProperty(a,c.key,c)}function _createClass(a,b,c){return b&&_defineProperties(a.prototype,b),c&&_defineProperties(a,c),a}function _get(a,b,c){return _get="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(a,b,c){var d=_superPropBase(a,b);if(d){var e=Object.getOwnPropertyDescriptor(d,b);return e.get?e.get.call(c):e.value}},_get(a,b,c||a)}function _superPropBase(a,b){for(;!Object.prototype.hasOwnProperty.call(a,b)&&(a=_getPrototypeOf(a),null!==a););return a}function _inherits(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function");a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,writable:!0,configurable:!0}}),b&&_setPrototypeOf(a,b)}function _setPrototypeOf(a,b){return _setPrototypeOf=Object.setPrototypeOf||function(a,b){return a.__proto__=b,a},_setPrototypeOf(a,b)}function _createSuper(a){var b=_isNativeReflectConstruct();return function(){var c,d=_getPrototypeOf(a);if(b){var e=_getPrototypeOf(this).constructor;c=Reflect.construct(d,arguments,e)}else c=d.apply(this,arguments);return _possibleConstructorReturn(this,c)}}function _possibleConstructorReturn(a,b){return b&&("object"===_typeof(b)||"function"==typeof b)?b:_assertThisInitialized(a)}function _assertThisInitialized(a){if(void 0===a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return a}function _isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(a){return!1}}function _getPrototypeOf(a){return _getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(a){return a.__proto__||Object.getPrototypeOf(a)},_getPrototypeOf(a)}var PopOutTag=function(a){function b(a,d,e,f,g){var i;return _classCallCheck(this,b),i=c.call(this,a,d,e,f,g),i.poppedOut=!1,i.style=a.getAttribute("style")||"",i.moving=!1,i.hostSelector=a.getAttribute("cv-pop-to"),i.popMargin=a.getAttribute("cv-pop-margin")||0,i.popSpeed=a.getAttribute("data-pop-speed")||1750,a.removeAttribute("cv-pop-to"),a.removeAttribute("cv-pop-margin"),a.removeAttribute("data-pop-speed"),i.verticalDuration=.4,i.horizontalDuration=.1,i.unpoppedStyle="",i.previousScroll=0,i.bodyStyle="",i.bodyScroll=0,i.element.classList.add("unpopped"),i.scrollStyle="",i.style="",i.popTimeout=null,i.rect=null,i.transformRect=null,i.clickListener=function(a){var b=Math.sqrt,c=Math.pow;if(i.rect=i.element.getBoundingClientRect(),!i.poppedOut){i.distance=b(c(i.rect.top,2)+c(i.rect.left,2));var d=i.popSpeed,e=window.innerWidth-i.rect.right,f=window.innerHeight-i.rect.bottom,g=(i.rect.left+e)/2,h=(i.rect.top+f)/2;i.horizontalDuration=g/d,i.verticalDuration=h/d,.1>i.horizontalDuration&&(i.horizontalDuration=.1),.1>i.verticalDuration&&(i.verticalDuration=.1),.4<i.horizontalDuration&&(i.horizontalDuration=.4),.4<i.verticalDuration&&(i.verticalDuration=.4)}i.element.contains(a.target)&&(a.stopPropagation(),a.preventDefault(),i.moving||(i.poppedOut?a.target.matches(".closeButton")&&i.poppedOut&&i.unpop():i.pop()))},i.escapeListener=function(a){i.poppedOut&&"Escape"===a.key&&i.unpop()},i.resizeListener=function(){if(i.poppedOut){for(var g=i.element;g.parentNode&&!g.matches(i.hostSelector)&&g.parentNode!=document;)g=g.parentNode;var a=hostTag.getBoundingClientRect(),b=i.style+i.unpoppedStyle,c=a.x,d=a.y+document.documentElement.scrollTop,e=a.width,f=a.height;i.transformRect&&(c-=i.transformRect.x,d-=i.transformRect.y),c+i.popMargin,d+i.popMargin,e+2*i.popMargin,f+2*i.popMargin,b+=";\n\t\t\t\tz-index:    99999;\n\t\t\t\ttransition-duration: 0s;\n\t\t\t\toverflow: hidden;\n\t\t\t\tposition:  fixed;\n\t\t\t\tleft:      ".concat(c,"px;\n\t\t\t\ttop:        ").concat(d,"px;\n\t\t\t\twidth:      ").concat(e,"px;\n\t\t\t\theight:     ").concat(f,"px;\n\t\t\t\toverflow-y: auto;\n\t\t\t\ttransition-duration: 0s;\n\t\t\t"),i.element.setAttribute("style",b)}},i.element.___clickListener___||(Object.defineProperty(i.element,"___scrollListeners___",{enumerable:!1,writable:!0}),a.___clickListener___=i.clickListener,a.___escapeListener___=i.escapeListener,a.___resizeListener___=i.resizeListener,i.element.addEventListener("click",a.___clickListener___),window.addEventListener("keyup",a.___escapeListener___),window.addEventListener("resize",a.___resizeListener___),i.cleanup.push(function(a){return function(){a.removeEventListener("click",a.___clickListener___),window.removeEventListener("keyup",a.___escapeListener___),window.removeEventListener("resize",a.___resizeListener___)}}(a))),i}_inherits(b,a);var c=_createSuper(b);return _createClass(b,[{key:"pause",value:function pause(){var a=!(0<arguments.length&&void 0!==arguments[0])||arguments[0];_get(_getPrototypeOf(b.prototype),"pause",this).call(this,a),a&&(document.body.setAttribute("style",this.bodyStyle),document.body.setAttribute("style",""))}},{key:"pop",value:function pop(){var a=this;b.popLevel(),this.previousScroll=window.scrollY,this.rect=this.element.getBoundingClientRect(),this.style=this.element.getAttribute("style");var c=this.element;for(this.transformRect=null;c.parentNode&&!c.matches(this.hostSelector)&&c.parentNode!=document;)c=c.parentNode,this.transformRect||"none"===getComputedStyle(c).transform||(this.transformRect=c.getBoundingClientRect());console.log(this.transformRect);var d=c.getBoundingClientRect();this.element.classList.add("popping");var e=this.rect.x,f=this.rect.y,g=this.rect.width,i=this.rect.height;this.transformRect&&(e-=this.transformRect.x,f-=this.transformRect.y),window.requestAnimationFrame(function(){a.unpoppedStyle="\n\t\t\t\t;position:  fixed;\n\t\t\t\tleft:       ".concat(e,"px;\n\t\t\t\ttop:        ").concat(f,"px;\n\t\t\t\twidth:      ").concat(g,"px;\n\t\t\t\theight:     ").concat(i,"px;\n\t\t\t\tz-index:    99999;\n\t\t\t\ttransition-duration: 0s;\n\t\t\t\toverflow: hidden;\n\t\t\t");var b=d.x,c=d.y+document.documentElement.scrollTop,j=d.width,k=d.height;console.log(a.transformRect),a.transformRect&&(b-=a.transformRect.x,c-=a.transformRect.y),b+a.popMargin,c+a.popMargin,j+2*a.popMargin,k+2*a.popMargin;var h=a.style+a.unpoppedStyle;a.element.setAttribute("style",h),setTimeout(function(){h+="\n\t\t\t\t\t;left:      ".concat(b,"px;\n\t\t\t\t\ttop:        ").concat(c+document.documentElement.scrollTop,"px;\n\t\t\t\t\twidth:      ").concat(j,"px;\n\t\t\t\t\theight:     ").concat(k,"px;\n\t\t\t\t\toverflow-y: auto;\n\t\t\t\t\ttransition: width ").concat(a.horizontalDuration,"s ease-out\n\t\t\t\t\t\t, top ").concat(a.verticalDuration,"s           ease-out\n\t\t\t\t\t\t, left ").concat(a.horizontalDuration,"s        ease-out\n\t\t\t\t\t\t, height ").concat(a.verticalDuration,"s        ease-out\n\t\t\t\t\t\t, all ").concat(a.horizontalDuration,"s         ease-out;\n\t\t\t\t"),a.moving=!0,a.element.setAttribute("style",h),a.element.classList.add("popped"),a.element.classList.remove("unpopped"),a.element.classList.remove("popping"),a.popTimeout=setTimeout(function(){if(a.element){a.bodyStyle=document.body.getAttribute("style"),document.body.setAttribute("style","height:100%;overflow:hidden;"),a.moving=!1,_Dom.Dom.mapTags(a.element,!1,function(b){var c=new CustomEvent("cvPopped");b.dispatchEvent(c),a.scrollStyle=a.element.getAttribute("style")});var b=new CustomEvent("cvPop",{bubbles:!0,detail:{tag:a,view:a.parent,publicId:a.parent.args.publicId}});a.element.dispatchEvent(b)}},1e3*a.horizontalDuration)},2*16.7),a.poppedOut=!0})}},{key:"unpop",value:function unpop(){var a=this;this.element.classList.add("unpopping"),this.popTimeout&&clearTimeout(this.popTimeout),0==b.level?document.body.setAttribute("style",""):document.body.setAttribute("style",this.bodyStyle||""),b.unpopLevel(),this.rect||(this.rect=this.element.getBoundingClientRect()),window.scrollTo(0,this.previousScroll);var c=this.style+this.unpoppedStyle+";transition: width ".concat(this.horizontalDuration,"s ease-in\n\t\t\t\t\t, height ").concat(this.verticalDuration,"s        ease-in\n\t\t\t\t\t, all ").concat(this.horizontalDuration,"s         ease-in;");this.element.setAttribute("style",c),this.moving=!0,setTimeout(function(){a.element&&a.element.classList.remove("popped")},1e3*this.horizontalDuration),setTimeout(function(){if(a.element.classList.add("unpopped"),a.element.classList.remove("unpopping"),!!a.element){a.element.setAttribute("style",a.style),a.moving=!1,_Dom.Dom.mapTags(a.element,!1,function(a){var b=new CustomEvent("cvUnpopped");a.dispatchEvent(b)});var b=new CustomEvent("cvUnpop",{bubbles:!0,detail:{tag:a,view:a.parent,publicId:a.parent.args.publicId}});a.element.dispatchEvent(b)}},1e3*this.horizontalDuration),this.poppedOut=!1}},{key:"remove",value:function remove(){document.body.setAttribute("style",this.bodyStyle),_get(_getPrototypeOf(b.prototype),"remove",this).call(this)}}],[{key:"popLevel",value:function popLevel(){return this.level||(this.level=0),this.level++,this.level}},{key:"unpopLevel",value:function unpopLevel(){return this.level||(this.level=0),this.level--,0>this.level&&(this.level=0),this.level}}]),b}(_Tag2.Tag);exports.PopOutTag=PopOutTag;
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.ScrollTag=void 0;var _Tag2=require("../base/Tag"),_Dom=require("../base/Dom"),_Bindable=require("../base/Bindable");function _typeof(a){"@babel/helpers - typeof";return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(a){return typeof a}:function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a},_typeof(a)}function _classCallCheck(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function _defineProperties(a,b){for(var c,d=0;d<b.length;d++)c=b[d],c.enumerable=c.enumerable||!1,c.configurable=!0,"value"in c&&(c.writable=!0),Object.defineProperty(a,c.key,c)}function _createClass(a,b,c){return b&&_defineProperties(a.prototype,b),c&&_defineProperties(a,c),a}function _inherits(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function");a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,writable:!0,configurable:!0}}),b&&_setPrototypeOf(a,b)}function _setPrototypeOf(a,b){return _setPrototypeOf=Object.setPrototypeOf||function(a,b){return a.__proto__=b,a},_setPrototypeOf(a,b)}function _createSuper(a){var b=_isNativeReflectConstruct();return function(){var c,d=_getPrototypeOf(a);if(b){var e=_getPrototypeOf(this).constructor;c=Reflect.construct(d,arguments,e)}else c=d.apply(this,arguments);return _possibleConstructorReturn(this,c)}}function _possibleConstructorReturn(a,b){return b&&("object"===_typeof(b)||"function"==typeof b)?b:_assertThisInitialized(a)}function _assertThisInitialized(a){if(void 0===a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return a}function _isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(a){return!1}}function _getPrototypeOf(a){return _getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(a){return a.__proto__||Object.getPrototypeOf(a)},_getPrototypeOf(a)}var ScrollTag=function(a){function b(a,d,e,f,g){var h;return _classCallCheck(this,b),h=c.call(this,a,d,e,f,g),h.visible=!1,h.offsetTop=!1,h.offsetBottom=!1,h.attachListener=function(b){for(var c=b.target;c.parentNode;)c=c.parentNode;rootNode!==window&&rootNode!==document||b.target!==a||(h.addScrollListener(b.target),h.addResizeListener(b.target),h.scrolled(b.target),b.target.removeEventListener("cvDomAttached",h.attachListener))},h.element.addEventListener("cvDomAttached",h.attachListener),h.cleanup.push(function(a){return function(){a.removeEventListener("cvDomAttached",h.attachListener)}}(h.element)),h.bindTo("visible",function(a){var b;b=a?new Event("cvScrolledIn"):new Event("cvScrolledOut"),_Dom.Dom.mapTags(h.element,!1,function(a){a.dispatchEvent(b)}),h.element.dispatchEvent(b)}),h.bindTo("offsetTop",function(a){var b=new CustomEvent("cvScrolled",{detail:{offset:a}});_Dom.Dom.mapTags(h.element,!1,function(a){a.dispatchEvent(b)}),h.element.dispatchEvent(b)}),h}_inherits(b,a);var c=_createSuper(b);return _createClass(b,[{key:"scrolled",value:function scrolled(){var a=this.element;if(a){var b=!1,c=a.getBoundingClientRect();0<c.bottom&&c.top<window.innerHeight&&(b=!0),this.proxy.visible=b,this.proxy.offsetTop=c.top||0,this.proxy.offsetBottom=c.bottom||0}}},{key:"addScrollListener",value:function addScrollListener(a){var b=this;if(!a.___scrollListener___){Object.defineProperty(a,"___scrollListener___",{enumerable:!1,writable:!0}),a.___scrollListener___=function(a){b.scrolled(a.target)};for(var c=a,d={passive:!0,capture:!0};c.parentNode;)c=c.parentNode,c.addEventListener("scroll",a.___scrollListener___,d),this.direct.cleanup.push(function(a,b,c){return function(){a.removeEventListener("scroll",b.___scrollListener___,c),b=a=null}}(c,a,d))}}},{key:"addResizeListener",value:function addResizeListener(a){var b=this;a.___resizeListener___||(Object.defineProperty(a,"___resizeListener___",{enumerable:!1,writable:!0}),a.___resizeListener___=function(a){b.scrolled(a.target)},window.addEventListener("resize",this.resizeListener),this.direct.cleanup.push(function(b){return function(){window.removeEventListener("resize",b.___resizeListener___),a.___resizeListener___=null,a=null}}(a)))}}]),b}(_Tag2.Tag);exports.ScrollTag=ScrollTag;
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.Toast=void 0;var _View2=require("../base/View"),_Bindable=require("../base/Bindable"),_ToastAlert=require("./ToastAlert");function _typeof(a){"@babel/helpers - typeof";return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(a){return typeof a}:function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a},_typeof(a)}function _classCallCheck(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function _defineProperties(a,b){for(var c,d=0;d<b.length;d++)c=b[d],c.enumerable=c.enumerable||!1,c.configurable=!0,"value"in c&&(c.writable=!0),Object.defineProperty(a,c.key,c)}function _createClass(a,b,c){return b&&_defineProperties(a.prototype,b),c&&_defineProperties(a,c),a}function _inherits(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function");a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,writable:!0,configurable:!0}}),b&&_setPrototypeOf(a,b)}function _setPrototypeOf(a,b){return _setPrototypeOf=Object.setPrototypeOf||function(a,b){return a.__proto__=b,a},_setPrototypeOf(a,b)}function _createSuper(a){var b=_isNativeReflectConstruct();return function(){var c,d=_getPrototypeOf(a);if(b){var e=_getPrototypeOf(this).constructor;c=Reflect.construct(d,arguments,e)}else c=d.apply(this,arguments);return _possibleConstructorReturn(this,c)}}function _possibleConstructorReturn(a,b){return b&&("object"===_typeof(b)||"function"==typeof b)?b:_assertThisInitialized(a)}function _assertThisInitialized(a){if(void 0===a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return a}function _isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(a){return!1}}function _getPrototypeOf(a){return _getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(a){return a.__proto__||Object.getPrototypeOf(a)},_getPrototypeOf(a)}var Toast=function(a){function b(){var a;return _classCallCheck(this,b),a=c.call(this),a.template="\n\t\t\t<div id = \"[[_id]]\" cv-each = \"alerts:alert\" class = \"toast\">\n\t\t\t\t[[alert]]\n\t\t\t</div>\n\t\t",a.args.alerts=[],a}_inherits(b,a);var c=_createSuper(b);return _createClass(b,null,[{key:"instance",value:function instance(){return this.inst||(this.inst=new this),this.inst}}]),_createClass(b,[{key:"pop",value:function pop(a){var b=this,c=this.args.alerts.length;this.args.alerts.push(a),a.decay(function(a){return function(){for(var c in b.args.alerts)if(_Bindable.Bindable.ref(b.args.alerts[c])===_Bindable.Bindable.ref(a))return a.remove(),void delete b.args.alerts[c]}}(a))}},{key:"alert",value:function alert(a,b,c){return this.pop(new _ToastAlert.ToastAlert({title:a,body:b,time:c}))}}]),b}(_View2.View);exports.Toast=Toast;
"use strict";var _View2=require("../base/View");Object.defineProperty(exports,"__esModule",{value:!0}),exports.ToastAlert=void 0;function _typeof(a){"@babel/helpers - typeof";return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(a){return typeof a}:function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a},_typeof(a)}function _classCallCheck(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function _defineProperties(a,b){for(var c,d=0;d<b.length;d++)c=b[d],c.enumerable=c.enumerable||!1,c.configurable=!0,"value"in c&&(c.writable=!0),Object.defineProperty(a,c.key,c)}function _createClass(a,b,c){return b&&_defineProperties(a.prototype,b),c&&_defineProperties(a,c),a}function _inherits(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function");a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,writable:!0,configurable:!0}}),b&&_setPrototypeOf(a,b)}function _setPrototypeOf(a,b){return _setPrototypeOf=Object.setPrototypeOf||function(a,b){return a.__proto__=b,a},_setPrototypeOf(a,b)}function _createSuper(a){var b=_isNativeReflectConstruct();return function(){var c,d=_getPrototypeOf(a);if(b){var e=_getPrototypeOf(this).constructor;c=Reflect.construct(d,arguments,e)}else c=d.apply(this,arguments);return _possibleConstructorReturn(this,c)}}function _possibleConstructorReturn(a,b){return b&&("object"===_typeof(b)||"function"==typeof b)?b:_assertThisInitialized(a)}function _assertThisInitialized(a){if(void 0===a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return a}function _isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(a){return!1}}function _getPrototypeOf(a){return _getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(a){return a.__proto__||Object.getPrototypeOf(a)},_getPrototypeOf(a)}var ToastAlert=function(a){function b(a){var d;return _classCallCheck(this,b),d=c.call(this,a),d.args.running=!1,d.args.time=d.args.time||16e3,d.init=d.args.time,d.args.title=d.args.title||"Standard alert",d.args.status="new",d.args.body=d.args.body||"This is a standard alert.",d.template="\n\t\t\t<div id = \"[[_id]]\" class = \"alert toast-[[status]]\">\n\t\t\t\t<h3>[[title]]</h3>\n\t\t\t\t<p>[[body]]</p>\n\t\t\t</div>\n\t\t",d}_inherits(b,a);var c=_createSuper(b);return _createClass(b,[{key:"decay",value:function decay(){var a=this;this.args.running=!0,this.onTimeout(50,function(){a.args.status=""}),this.onTimeout(300,function(){a.args.status="decaying"}),this.onTimeout(2400,function(){a.args.status="imminent"}),this.onTimeout(3500,function(){a.remove()})}}]),b}(_View2.View);exports.ToastAlert=ToastAlert;
